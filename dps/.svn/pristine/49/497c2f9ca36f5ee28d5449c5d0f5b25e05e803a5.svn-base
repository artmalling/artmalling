<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자    : 박래형
 * 회 사 명    : FKSS
 * 작 성 일    : 2010.02.10  
 * 변 경 일    :  
 * 변경내용 :   
 * 개    요       :  개발팀에서 기입해주세요     
 -->  
<service name="/pord101.po">  
    <!-- 입고/반품  리스트 -->
    <gauce name="H_LIST"> 
        <column colName="SLIP_NO"             colType="TB_STRING"     size="12"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="STR_CD"              colType="TB_STRING"     size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="STR_NM"              colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SLIP_FLAG"           colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SLIP_FLAG_NM"        colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORD_DT"              colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SLIP_PROC_STAT"      colType="TB_STRING"     size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SLIP_PROC_STAT_NM"   colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_CD"           colType="TB_STRING"     size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_NM"           colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MG_APP_DT"           colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REJ_CAN_FLAG"        colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="EVENT_FLAG"          colType="TB_STRING"     size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>

    <!-- 매입발주 MASTER --> 
    <gauce name="H_MASTER"> 
		<column colName="STR_CD"              colType="TB_STRING"     size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="STR_NM"              colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="SLIP_NO"             colType="TB_STRING"     size="12"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="PUMBUN_CD"           colType="TB_STRING"     size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
		<column colName="PUMBUN_NM"           colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
		<column colName="VEN_CD"              colType="TB_STRING"     size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
		<column colName="VEN_NM"              colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
		<column colName="MG_APP_DT"           colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
		<column colName="EVENT_FLAG"          colType="TB_STRING"     size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
		<column colName="EVENT_FLAG_NM"       colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
		<column colName="EVENT_RATE"          colType="TB_STRING"     size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
		<column colName="SLIP_FLAG"           colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
		<column colName="SLIP_FLAG_NM"        colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="ORD_OWN_FLAG"        colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="ORD_OWN_FLAG_NM"     colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
		<column colName="ORD_FLAG"            colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
		<column colName="AFT_ORD_FLAG"        colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
		<column colName="ORD_DT"              colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="DELI_DT"             colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="CHK_DT"              colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SM_CONF_DT"          colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SM_ID"               colType="TB_STRING"     size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BUYER_CONF_ID"       colType="TB_STRING"     size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="ORD_CONF_DT"         colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />		
		<column colName="BUYER_CD"            colType="TB_STRING"     size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="BUYER_NM"            colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />		
		<column colName="ACC_CONF_DT"         colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />        
        <column colName="SLIP_PROC_STAT"      colType="TB_STRING"     size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />      
        <column colName="SLIP_PROC_STAT_NM"   colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />		
		<column colName="DTL_CNT"             colType="TB_DECIMAL"    size="3"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="ORD_TOT_QTY"         colType="TB_DECIMAL"    size="7"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NEW_COST_TAMT"       colType="TB_DECIMAL"    size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NEW_SALE_TAMT"       colType="TB_DECIMAL"    size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="GAP_TOT_AMT"         colType="TB_DECIMAL"    size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NEW_GAP_RATE"        colType="TB_DECIMAL"    size="5"    dec="2" keyType="TB_NORMAL" roundMode="ROUND" />  	
		<column colName="PAY_COND"            colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />		
		<column colName="REMARK"              colType="TB_STRING"     size="100"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />		
		<column colName="BIZ_TYPE"            colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="BIZ_TYPE_NM"         colType="TB_STRING"     size="40"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAX_FLAG"            colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAX_FLAG_NM"         colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="VAT_TAMT"            colType="TB_DECIMAL"    size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SUP_AMT"             colType="TB_DECIMAL"    size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REG_DATE"            colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MG_RATE"             colType="TB_DECIMAL"    size="5"    dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <!-- 매입발주 Detail -->   
    <gauce name="H_DETAIL"> 
         <column colName="CHECK1"              colType="TB_STRING"    size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="STR_CD"              colType="TB_STRING"    size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		 <column colName="SLIP_NO"             colType="TB_STRING"    size="12"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		 <column colName="ORD_SEQ_NO"          colType="TB_DECIMAL"   size="3"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		 <column colName="PUMMOK_SRT_CD"       colType="TB_STRING"    size="4"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />   
		 <column colName="PUMMOK_CD"           colType="TB_STRING"    size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />   
		 <column colName="PUMMOK_NM"           colType="TB_STRING"    size="20"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		 <column colName="ORD_UNIT_CD"         colType="TB_STRING"    size="3"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                            
		 <column colName="MG_RATE"             colType="TB_DECIMAL"   size="5"    dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
		 <column colName="SLIP_FLAG"           colType="TB_STRING"    size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="ORD_QTY"             colType="TB_DECIMAL"   size="7"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="NEW_GAP_RATE"        colType="TB_DECIMAL"   size="5"    dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="NEW_GAP_AMT"         colType="TB_DECIMAL"   size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		 <column colName="OLD_COST_PRC"        colType="TB_DECIMAL"   size="9"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                           
		 <column colName="NEW_COST_PRC"        colType="TB_DECIMAL"   size="9"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                           
		 <column colName="NEW_COST_AMT"        colType="TB_DECIMAL"   size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                           
		 <column colName="NEW_SALE_PRC"        colType="TB_DECIMAL"   size="9"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                           
		 <column colName="NEW_SALE_AMT"        colType="TB_DECIMAL"   size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                                
		 <column colName="PUMBUN_CD"           colType="TB_STRING"    size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
		 <column colName="VEN_CD"              colType="TB_STRING"    size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
		 <column colName="TAG_FLAG"            colType="TB_STRING"    size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
		 <column colName="TAG_FLAG_NM"         colType="TB_STRING"    size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                               
		 <column colName="TAG_PRT_OWN_FLAG"    colType="TB_STRING"    size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                               
		 <column colName="TAG_PRT_OWN_FLAG_NM" colType="TB_STRING"    size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
         <column colName="VAT_AMT"             colType="TB_DECIMAL"   size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="BIZ_TYPE"            colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <!-- 행사구분 --> 
    <gauce name="H_MARGIN_FLAG"> 
        <column colName="EVENT_FLAG"           colType="TB_STRING"     size="2"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="EVENT_FLAG_NM"        colType="TB_STRING"     size="10"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
    </gauce>    
    
    <!-- 행사율--> 
    <gauce name="H_MARGIN_RATE">
        <column colName="EVENT_RATE"           colType="TB_STRING"     size="2"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="EVENT_RATE_NM"        colType="TB_STRING"     size="10"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="NORM_MG_RATE"         colType="TB_DECIMAL"    size="5"   dec="2" keyType="TB_NORMAL" roundMode="ROUND" /> 
    </gauce>
    
    <!-- 품목코드 정보--> 
    <gauce name="H_PUMMOK_INFO">
        <column colName="PUMMOK_CD"            colType="TB_STRING"     size="8"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <!-- 단축코드 정보--> 
    <gauce name="H_PUMMOK_SRT_INFO">
        <column colName="PUMMOK_SRT_CD"        colType="TB_STRING"     size="4"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>

    <!-- 품목 매입발주  리스트 조회 -->
    <query name="SEL_LIST">
        <![CDATA[
        SELECT A.SLIP_NO                                                                         /* 전표번호 */
             , A.STR_CD                                                                          /* 점코드 */
             , DPS.FN_GET_STORE_NAME(A.STR_CD) AS STR_NM                                         /* 점명 */
             , A.SLIP_FLAG                                                                       /* 전표구분 */
             , COM.FN_GET_COMM_NAME('D', 'P201', A.SLIP_FLAG) AS  SLIP_FLAG_NM                   /* 전표구분명 */
             , A.ORD_DT                                                                          /* 발주일자(점출일, 시행일) */
             , A.SLIP_PROC_STAT                                                                  /* 전표진행상태 */
             , COM.FN_GET_COMM_NAME('D', 'P207', A.SLIP_PROC_STAT) AS  SLIP_PROC_STAT_NM         /* 전표진행상태명 */
             , A.PUMBUN_CD                                                                       /* 브랜드코드 */
             , DPS.FN_GET_PUMBUN_NAME(A.PUMBUN_CD) AS PUMBUN_NM                                  /* 브랜드명 */
             , A.MG_APP_DT
             , A.REJ_CAN_FLAG                                                                    /* 반려취소구 분 1:반려, 2:취소 */
        FROM (    
              SELECT SLP.SLIP_NO                                                                        
                   , SLP.STR_CD                                                                          
                   , SLP.SLIP_FLAG                                                                      
                   , SLP.ORD_DT                          
                   , SLP.DELI_DT                          
                   , SLP.CHK_DT                         
                   , SLP.SLIP_PROC_STAT                                                                  
                   , ORD_CF_DT
                   , PBN.SALE_ORG_CD
                   , PBN.BUY_ORG_CD
                   , SLP.PUMBUN_CD
                   , SLP.MG_APP_DT
                   , SLP.REJ_CAN_FLAG
                FROM DPS.PO_SLPMST SLP, DPS.PC_STRPBN PBN
               WHERE SLP.SLIP_FLAG IN ('A','B')
                 AND SLP.DEL_FLAG  = 'N'
                 AND PBN.SKU_FLAG  = '2'   
                 AND SLP.STR_CD    = ?
                 AND SLP.AUTO_SLIP_FLAG = '0'
                 AND SLP.STR_CD    = PBN.STR_CD
                 AND SLP.PUMBUN_CD = PBN.PUMBUN_CD
                 AND EXISTS ( SELECT MYORG.USER_ID
                                FROM COM.V_MYORG MYORG
                               WHERE MYORG.STR_CD      = SLP.STR_CD
                                 AND MYORG.PUMBUN_CD   = SLP.PUMBUN_CD
                                 AND MYORG.USER_ID     = ?
                                 AND ROWNUM            = 1
                                 AND MYORG.ORG_FLAG    = ?
                             )
        ]]>
    </query> 
     <query name="SEL_BUY_ORG_CD">
        <![CDATA[
                 AND SLP.SLIP_PROC_STAT LIKE '%' || ? || '%'
                 AND SLP.PUMBUN_CD      LIKE '%' || ? || '%'
                 AND SLP.VEN_CD         LIKE '%' || ? || '%'
                 AND SLP.SLIP_FLAG      LIKE '%' || ? || '%'
             ) A
           WHERE  A.BUY_ORG_CD   LIKE ? || '%'
        ]]>
    </query>
    <query name="SEL_SALE_ORG_CD">
        <![CDATA[
                 AND SLP.SLIP_PROC_STAT LIKE '%' || ? || '%'
                 AND SLP.PUMBUN_CD      LIKE '%' || ? || '%'
                 AND SLP.VEN_CD         LIKE '%' || ? || '%'
                 AND SLP.SLIP_FLAG      LIKE '%' || ? || '%'
             ) A
           WHERE A.SALE_ORG_CD   LIKE ? || '%'
        ]]>
    </query>
    <query name="SEL_ORD_DT">
        <![CDATA[
               AND A.ORD_DT BETWEEN ? AND ?
        ]]>
    </query>
    <query name="SEL_ORD_CONF">
        <![CDATA[
               AND A.ORD_CF_DT BETWEEN ? AND ?
        ]]>
    </query>
    <query name="SEL_DELI_DT">    
        <![CDATA[
               AND A.DELI_DT BETWEEN ? AND ?
        ]]>
    </query>
    <query name="SEL_CHK_DT">
        <![CDATA[
               AND A.CHK_DT BETWEEN ? AND ?
        ]]>
    </query>
    <query name="WHERE_SLIP_NO">
        <![CDATA[
            )A
          WHERE A.SLIP_NO = ?
        ]]>
    </query>
    <query name="SEL_ORDERBY">
        <![CDATA[
               
          ORDER BY A.STR_CD, A.SLIP_NO DESC
        ]]>
    </query>
    
    
    <!-- 품목 매입발주  마스터 조회 -->
    <query name="SEL_MASTER">
        <![CDATA[
	        SELECT A.STR_CD           
				 , DPS.FN_GET_STORE_NAME(STR_CD) AS STR_NM                  
				 , A.SLIP_NO          
				 , A.PUMBUN_CD        
				 , DPS.FN_GET_PUMBUN_NAME(A.PUMBUN_CD) AS PUMBUN_NM    
				 , A.VEN_CD           
				 , DPS.FN_GET_VENDOR_NAME(A.VEN_CD) AS VEN_NM   
				 , A.MG_APP_DT                     
				 , A.EVENT_FLAG      
				 , A.EVENT_FLAG     AS EVENT_FLAG_NM
				 , A.EVENT_RATE  
				 , A.SLIP_FLAG        
				 , COM.FN_GET_COMM_NAME('D', 'P201', A.SLIP_FLAG)  AS  SLIP_FLAG_NM                /* 전표구분명 */
				 , A.ORD_OWN_FLAG
				 , COM.FN_GET_COMM_NAME('D', 'P202', ORD_OWN_FLAG) AS ORD_OWN_FLAG_NM              /* 발주주체구분명 */
				 , A.ORD_FLAG
				 , A.AFT_ORD_FLAG   
				 , A.ORD_DT           
				 , A.DELI_DT      
				 , A.CHK_DT
				 , A.SM_CONF_DT      
				 , A.SM_ID      
				 , A.BUYER_CONF_ID  
				 , A.ORD_CF_DT AS ORD_CONF_DT  
				 , A.BUYER_CD        
				 , DPS.FN_GET_BUYER_NAME(A.BUYER_CD) AS BUYER_NM  
				 , A.ACC_CONF_DT 
				 , A.SLIP_PROC_STAT 
				 , COM.FN_GET_COMM_NAME('D', 'P207', SLIP_PROC_STAT) AS  SLIP_PROC_STAT_NM         /* 전표진행상태명 */
				 , A.DTL_CNT           
				 , DECODE(A.SLIP_PROC_STAT, '09', A.CHK_TOT_QTY, A.ORD_TOT_QTY) AS ORD_TOT_QTY               /* 발주수량합(검품확정'09'일경우 검품수량합) */
                 , DECODE(A.SLIP_PROC_STAT, '09', A.CHK_COST_TAMT, A.NEW_COST_TAMT) AS NEW_COST_TAMT         /* 신원가금액합(검품확정'09'일경우 검품원가금액합) */
                 , DECODE(A.SLIP_PROC_STAT, '09', A.CHK_SALE_TAMT, A.NEW_SALE_TAMT) AS NEW_SALE_TAMT         /* 신매가금액합(검품확정'09'일경우 검품매가금액합) */
                 , DECODE(A.SLIP_PROC_STAT, '09', A.CHK_GAP_AMT, A.GAP_TOT_AMT) AS GAP_TOT_AMT               /* 차익액합(검품확정'09'일경우 검품차익액합) */
                 , DECODE(A.SLIP_PROC_STAT, '09', A.CHK_GAP_RATE, A.NEW_GAP_RATE) AS NEW_GAP_RATE            /* 신차익율(검품확정'09'일경우 검품차익율) */
				 , A.PAY_COND   
				 , A.REMARK    
				 , A.BIZ_TYPE    
				 , COM.FN_GET_COMM_NAME('D', 'P003', A.BIZ_TYPE) AS  BIZ_TYPE_NM                   /* 거래형태명 */
				 , A.TAX_FLAG
				 , COM.FN_GET_COMM_NAME('D', 'P004', TAX_FLAG) AS TAX_FLAG_NM                      /* 과세구분명 */   
                 , CASE WHEN SLIP_PROC_STAT = '09' THEN A.CHK_VAT_TAMT ELSE A.VAT_TAMT END VAT_TAMT
                 , CASE WHEN SLIP_PROC_STAT = '09' THEN A.CHK_VAT_TAMT + A.CHK_COST_TAMT ELSE A.VAT_TAMT + A.NEW_COST_TAMT END SUP_AMT                
				 , TO_CHAR(A.REG_DATE, 'YYYYMMDD')             AS REG_DATE    
				 , (
				    SELECT MAX(MG_RATE)
				      FROM DPS.PO_SLPDTL B
				     WHERE B.STR_CD  = A.STR_CD
				       AND B.SLIP_NO = A.SLIP_NO  
				    )              AS MG_RATE    
			  FROM DPS.PO_SLPMST   A            
			 WHERE A.STR_CD = ?
			   AND A.SLIP_NO = ? 
        ]]>
    </query> 
    
    <!-- 품목 매입발주 디테일 조회 -->
    <query name="SEL_DETAIL">
        <![CDATA[
			SELECT 'F'               AS  CHECK1
				 , DTL.STR_CD                                                                                  /*점코드*/
				 , DTL.SLIP_NO                                                                                 /*전표번호*/
				 , DTL.ORD_SEQ_NO                                                                              /*전표상세번호*/
				 , DTL.PUMMOK_SRT_CD                                                                           /*단축코드*/
				 , DTL.PUMMOK_CD                                                                               /*품목코드*/
			     , DPS.FN_GET_PUMMOK_NAME(DTL.PUMMOK_CD) AS  PUMMOK_NM                                         /*품목코드명*/
			     , DTL.ORD_UNIT_CD                                                                             /*발주단위*/
			     , DTL.MG_RATE                                                                                 /*마진율*/
			     , DTL.SLIP_FLAG                                                                               /*전표구분*/
                 , DECODE(MST.SLIP_PROC_STAT, '09', DTL.CHK_QTY, DTL.ORD_QTY) AS ORD_QTY                       /*발주수량 */
                 , DECODE(MST.SLIP_PROC_STAT, '09', DTL.CHK_GAP_RATE, DTL.NEW_GAP_RATE) AS NEW_GAP_RATE        /*신차익율 */
                 , DECODE(MST.SLIP_PROC_STAT, '09', DTL.CHK_GAP_AMT, DTL.NEW_GAP_AMT) AS NEW_GAP_AMT           /*신차익액 */
			     , DTL.NEW_COST_PRC AS OLD_COST_PRC                                                            /*전원가단가*/
			     , DTL.NEW_COST_PRC                                                                            /*신원가단가*/
			     , DECODE(MST.SLIP_PROC_STAT, '09', DTL.CHK_COST_AMT, DTL.NEW_COST_AMT) AS NEW_COST_AMT        /*신원가금액 */
			     , DTL.NEW_SALE_PRC                                                                            /*신매가단가*/                              
			     , DECODE(MST.SLIP_PROC_STAT, '09', DTL.CHK_SALE_AMT, DTL.NEW_SALE_AMT) AS NEW_SALE_AMT        /*신매가금액 */
			     , DTL.PUMBUN_CD                                                                               /*브랜드*/
			     , DTL.VEN_CD                                                                                  /*협력사*/
			     , DTL.TAG_FLAG                                                                                /*택구분*/
			     , DTL.TAG_FLAG         AS TAG_FLAG_NM                                                         /*택구분명*/
			     , DTL.TAG_PRT_OWN_FLAG                                                                        /*택발행주체*/
			     , DTL.TAG_PRT_OWN_FLAG AS TAG_PRT_OWN_FLAG_NM                                                 /*택발행주체명*/
			     , DECODE(MST.SLIP_PROC_STAT, '09', DTL.CHK_VAT_AMT, DTL.VAT_AMT) AS VAT_AMT
			     , MST.BIZ_TYPE                                                                                /* BIZ TYPE */
			  FROM DPS.PO_SLPDTL DTL
                 , DPS.PO_SLPMST MST
             WHERE DTL.STR_CD  = MST.STR_CD
               AND DTL.SLIP_NO = MST.SLIP_NO
               AND DTL.STR_CD = ?
               AND DTL.SLIP_NO = ?
        ]]>
    </query> 
    
    <!-- 품목 전표번호 생성 -->
    <query name="SEL_SLIP_NO">
        <![CDATA[
            SELECT DPS.FN_GET_SLIPNO(?, ?, ?) AS SLIP_NO
              FROM DUAL  
        ]]>
    </query> 
    
    <!-- 품목 전표번호상세번호 생성 -->
    <query name="SEL_ORD_SEQ_NO">
        <![CDATA[
			SELECT LPAD(NVL(MAX(ORD_SEQ_NO),0)+1,3,'0') ORD_SEQ_NO
			  FROM DPS.PO_SLPDTL
			 WHERE STR_CD = ?
			   AND SLIP_NO = ?
        ]]>
    </query>
    
    <!-- 품목  매입발주 MASTER 등록 -->
    <query name="INS_MASTER">
        <![CDATA[
            INSERT INTO DPS.PO_SLPMST ( 
									  SLIP_NO                                     /* 전표번호 */
									, STR_CD                                      /* 점코드 */                                                   
									, PUMBUN_CD                                   /* 브랜드코드 */                          
									, VEN_CD                                      /* 협력사코드 */                                                 
									, SLIP_FLAG                                   /* 전표구분 */                     
									, ORD_OWN_FLAG                                /* 발주주체구분 */                        
									, ORD_FLAG                                    /* 발주구분 */                          
									, AUTO_SLIP_FLAG                              /* 자동전표구분 */                                                
									, AFT_ORD_FLAG                                /* 사전사후구분 */                                     
									, ORD_DT                                      /* 발주일자(점출일, 시행일) */                
									, DELI_DT                                     /* 납품(반품)예정일(점입일, 시행일) */
                                    , MG_APP_DT                                   /* 마진적용일 */
                                    , EVENT_FLAG                                  /* 행사구분 */
                                    , EVENT_RATE                                  /* 행사율 */
									, SM_CONF_DT                                  /* SM확정일자 */
									, SM_ID                                       /* SM ID */  
									, BUYER_CONF_ID                               /* 바이어ID */
									, ORD_CONF_DT                                 /* 바이어확정일자(발주확정일자) */          
									, BUYER_CD                                    /* 바이어코드 */                                                 
									, SLIP_PROC_STAT                              /* 전표진행상태 */                        
									, DTL_CNT                                     /* 명세건수 */                          
									, ORD_TOT_QTY                                 /* 발주수량합 */                         
                                    , NEW_COST_TAMT                               /* 신원가금액합 */                        
                                    , NEW_SALE_TAMT                               /* 신매가금액합 */                        
                                    , GAP_TOT_AMT                                 /* 신차익액 */                        
                                    , NEW_GAP_RATE                                /* 신차익율 */                                       
                                    , VAT_TAMT                                    /* 부가세 */   
									, REMARK                                      /* 비고 */                            
									, BIZ_TYPE                                    /* 거래형태 */                          
                                    , TAX_FLAG                                    /* 과세구분 */                          
                                    , DEL_FLAG                                    /* 삭제구분 */   
									, REG_DATE                                    /* 등록일시 */
									, REG_ID                                      /* 등록자 */
									, MOD_DATE                                    /* 수정일시 */
                                    , MOD_ID                                      /* 수정자 */     
                                    , INC_FLAG                                    /* 인상하 구분 */                                        
                                    , INOUT_FLAG                                  /* 출입 구분 */  
                                    , IMPORT_FLAG                                 /* 수입구분*/  
                                    , ORD_CF_DT                                   /* 발주확정일 */
                                    )
                             VALUES (
                                     ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , ?
                                   , SYSDATE
                                   , ?
                                   , SYSDATE
                                   , ?
                                   , 0
                                   , 0
                                   , 0
                                   , DECODE('00', DPS.FN_GET_ORDCONF_CHK(?,?), TO_CHAR(SYSDATE, 'YYYYMMDD'), '        ')
                                   )
        ]]>
    </query>    
    
    <!-- 품목 발주매입 MASTER LOG 등록 -->
    <query name="INS_MASTER_LOG">
        <![CDATA[
			MERGE INTO DPS.PO_SLPMSTLG
			   USING DUAL
			   ON (STR_CD = ? AND SLIP_NO = ?)
			   WHEN MATCHED THEN 
			    UPDATE SET SLIP_FLAG         = ?                    /* 전표구분 */                          
			             , SLIP_PROC_STAT    = ?                    /* 전표진행상태 */  
			   WHEN NOT MATCHED THEN 
			    INSERT ( 
			            STR_CD                                      /* 점코드 */ 
			          , SLIP_NO                                     /* 전표번호 */                                                  
			          , SLIP_FLAG                                   /* 전표구분 */                          
			          , SLIP_PROC_STAT                              /* 전표진행상태 */                                     
			          )
			   VALUES (
			            ?
			          , ? 
			          , ?
			          , ?
			          )
        ]]>
    </query>
    
    <!-- 품목 매입발주 MASTER 수정 -->
    <query name="UPD_MASTER">
        <![CDATA[
			UPDATE DPS.PO_SLPMST 
			   SET SLIP_FLAG      = ?
			     , AFT_ORD_FLAG   = ?
			     , PUMBUN_CD      = ?
			     , ORD_DT         = ?
			     , DELI_DT        = ?
			     , MG_APP_DT      = ?
			     , EVENT_FLAG     = ?
			     , EVENT_RATE     = ?
                 , REMARK         = ?
                 , DTL_CNT        = ?			     
			     , ORD_TOT_QTY    = ?
                 , NEW_COST_TAMT  = ?
                 , NEW_SALE_TAMT  = ?
                 , GAP_TOT_AMT    = ?
                 , NEW_GAP_RATE   = ?                                      
                 , VAT_TAMT       = ?         /* 부가세 */  
                 , ORD_CF_DT      = DECODE('00', DPS.FN_GET_ORDCONF_CHK(?,?), TO_CHAR(SYSDATE, 'YYYYMMDD'), '        ')
			 WHERE STR_CD         = ?
			   AND SLIP_NO        = ?
        ]]>
    </query>    
    
    <!-- 품목 매입발주 MASTER 삭제 -->
    <query name="DEL_MASTER">
        <![CDATA[
			DELETE FROM DPS.PO_SLPMST
			 WHERE STR_CD = ?
			   AND SLIP_NO = ?
        ]]>
    </query>    
    
    <!-- 품목 매입발주 디테일 전체 삭제-->
    <query name="DEL_DETAIL_ALL">
        <![CDATA[
			DELETE FROM DPS.PO_SLPDTL
			 WHERE STR_CD = ?
			   AND SLIP_NO = ?
        ]]>
    </query> 
    
     <!-- 품목  매입발주 LOG 삭제 -->
    <query name="DEL_DETAIL_LOG">
        <![CDATA[
			DELETE FROM DPS.PO_SLPMSTLG
			 WHERE STR_CD = ?
			   AND SLIP_NO = ?
        ]]>
    </query>     
    
    <!-- 품목  매입발주 DETAIL 등록 -->
    <query name="INS_DETAIL">
        <![CDATA[
			INSERT INTO DPS.PO_SLPDTL ( 
			                          STR_CD
			                        , SLIP_NO
			                        , ORD_SEQ_NO
                                    , PUMMOK_CD
                                    , PUMMOK_SRT_CD
                                    , SKU_CD
			                        , ORD_UNIT_CD
			                        , MG_RATE
			                        , ORD_QTY
                                    , NEW_GAP_RATE     
                                    , NEW_GAP_AMT     
                                    , NEW_COST_PRC
			                        , NEW_COST_AMT
                                    , NEW_SALE_PRC
                                    , NEW_SALE_AMT
                                    , VAT_AMT
                                    , PUMBUN_CD
                                    , VEN_CD
                                    , SLIP_FLAG
			                        , TAG_FLAG
			                        , TAG_PRT_OWN_FLAG
			                        , REG_DATE
			                        , REG_ID
			                        , MOD_DATE
			                        , MOD_ID)
			                   VALUES (  
			                          ?
			                        , ?
			                        , ?
			                        , ?
                                    , ?
                                    , ?
			                        , ?
			                        , ?
			                        , ?
			                        , ?
			                        , ?
			                        , ?
                                    , ?
                                    , ?
                                    , ?
                                    , ?
                                    , ?
                                    , ?
                                    , ?
                                    , ?
                                    , ?
			                        , SYSDATE
			                        , ?
			                        , SYSDATE
	    	                        , ?
		                              )

        ]]>
    </query>   
    
    <!-- 품목 매입발주 DETAIL 수정 -->
    <query name="UPD_DETAIL">
        <![CDATA[
			UPDATE DPS.PO_SLPDTL         
			   SET PUMMOK_CD        = ?             /*품목코드*/
			     , PUMMOK_SRT_CD    = ?             /*단축코드*/
			     , ORD_UNIT_CD      = ?             /*발주단위*/
			     , MG_RATE          = ?             /*마진율*/
			     , ORD_QTY          = ?             /*발주수량*/
                 , NEW_COST_PRC     = ?             /**/
                 , NEW_COST_AMT     = ?             /**/
                 , NEW_SALE_PRC     = ?             /**/
                 , NEW_SALE_AMT     = ?             /**/
                 , NEW_GAP_AMT      = ?             /**/
                 , NEW_GAP_RATE     = ?             /**/
                 , VAT_AMT          = ?             /*부과세*/
			     , PUMBUN_CD        = ?             /*브랜드코드*/
			     , VEN_CD           = ?             /*협력사코드*/
			     , SLIP_FLAG        = ?             /*전표구분*/
			     , TAG_FLAG         = ?             /*택구분*/
			     , TAG_PRT_OWN_FLAG = ?             /*택발행주체*/
			     , MOD_DATE         = SYSDATE       /*수정일자*/
			     , MOD_ID           = ?             /*수정자*/
			 WHERE STR_CD           = ?             /*점코드*/
               AND SLIP_NO          = ?             /*전표번호*/
               AND ORD_SEQ_NO       = ?             /*일련번호*/    
        ]]>
    </query>
    
    <!-- 품목 매입발주 DETAIL 삭제 -->
    <query name="DEL_DETAIL">
        <![CDATA[
			DELETE FROM DPS.PO_SLPDTL
			 WHERE STR_CD = ?
			   AND SLIP_NO = ?
			   AND ORD_SEQ_NO = ?
        ]]>
    </query> 
    
    <!-- 행사구분 조회 -->
    <query name="SEL_MARGIN_FLAG">
        <![CDATA[
			SELECT C.EVENT_FLAG
			     , C.EVENT_FLAG     AS EVENT_FLAG_NM
			  FROM DPS.PC_STRPBN    B
			     , DPS.PC_MARGINMST C 
			 WHERE B.STR_CD     = C.STR_CD
			   AND B.STR_CD    LIKE ? || '%'                /*점코드*/
			   AND B.PUMBUN_CD = C.PUMBUN_CD
			   AND B.PUMBUN_CD LIKE ? || '%'                /*브랜드코드*/
			   AND ? BETWEEN C.APP_S_DT AND C.APP_E_DT      /*마진적용율*/
			   AND C.EVENT_CD = '00000000000'
        ]]>
    </query>     
    
    <!-- 행사율 조회-->
    <query name="SEL_MARGIN_RATE">
        <![CDATA[
            SELECT C.EVENT_RATE
                 , C.EVENT_RATE       AS EVENT_RATE_NM
                 , C.NORM_MG_RATE     
              FROM DPS.PC_STRPBN    B
                 , DPS.PC_MARGINMST C 
             WHERE B.STR_CD     = C.STR_CD
               AND B.STR_CD     LIKE ? || '%'               /*점코드*/
               AND B.PUMBUN_CD = C.PUMBUN_CD
               AND B.PUMBUN_CD  LIKE ? || '%'               /*브랜드코드*/
               AND ? BETWEEN C.APP_S_DT AND C.APP_E_DT      /*마진적용율*/
               AND C.EVENT_CD = '00000000000'
               AND C.EVENT_FLAG = ?                         /*행사구분*/
        ]]>
    </query>  
    
    <!-- 품목코드 조회-->
    <query name="SEL_PUMMOK_INFO">
        <![CDATA[
		   SELECT A.PUMMOK_CD
		     FROM DPS.PC_PMKMST A
		        , DPS.PC_PBNPMK B
		    WHERE B.PUMMOK_CD = A.PUMMOK_CD
		      AND B.PUMBUN_CD = ?
		      AND A.PUMMOK_CD = ?
        ]]>
    </query>         
   
    <!-- 단축코드 조회-->
    <query name="SEL_PUMMOK_SRT_INFO">
        <![CDATA[
		   SELECT A.PUMMOK_SRT_CD
		     FROM DPS.PC_PMKMST A
		        , DPS.PC_PBNPMK B
		    WHERE B.PUMMOK_CD = A.PUMMOK_CD
		      AND B.PUMBUN_CD = ?
		      AND A.PUMMOK_SRT_CD = ?
        ]]>
    </query>         

</service>