<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 김영진
 * 회 사 명 : 한국후지쯔
 * 작 성 일 : 2010.05.26
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  
 -->
<service name="/psal934.ps">

    <gauce name="H_MASTER"> 
        <column colName="CHK_BOX"    colType="TB_STRING"   size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PAY_DT"     colType="TB_STRING"   size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PAY_SEQ"    colType="TB_DECIMAL"  size="3"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SEQ_NO"     colType="TB_DECIMAL"  size="7"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REC_FLAG"   colType="TB_STRING"   size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DATA_FLAG"  colType="TB_STRING"   size="42"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_DT"    colType="TB_STRING"   size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="RECV_DT"    colType="TB_STRING"   size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CARD_NO"    colType="TB_STRING"   size="20"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DIV_MONTH"  colType="TB_DECIMAL"  size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="APPR_NO"    colType="TB_STRING"   size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CRTN_CD"    colType="TB_STRING"   size="4"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="VRTN_CD"    colType="TB_STRING"   size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="VRTN_NM"    colType="TB_STRING"   size="42"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TRADE_AMT"  colType="TB_DECIMAL"  size="12"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CCOMP_CD"   colType="TB_STRING"   size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CCOMP_NM"   colType="TB_STRING"   size="42"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="JBRCH_ID"   colType="TB_STRING"   size="15"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="JBRCH_NM"   colType="TB_STRING"   size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BUYREQ_YN"  colType="TB_STRING"   size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REASON_CD"  colType="TB_STRING"   size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MEMO"       colType="TB_STRING"   size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <gauce name="H_DETAIL"> 
        <column colName="CHRG_DT"      colType="TB_STRING"   size="8"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CHRG_SEQ"     colType="TB_DECIMAL"  size="3"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SEQ_NO"       colType="TB_DECIMAL"  size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REC_FLAG"     colType="TB_STRING"   size="1"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DEVICE_ID"    colType="TB_STRING"   size="10" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="WORK_FLAG"    colType="TB_STRING"   size="2"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COMP_NO"      colType="TB_STRING"   size="10" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CARD_NO"      colType="TB_STRING"   size="20" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="EXP_DT"       colType="TB_STRING"   size="4"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DIV_MONTH"    colType="TB_DECIMAL"  size="2"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="APPR_AMT"     colType="TB_DECIMAL"  size="12" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SVC_AMT"      colType="TB_DECIMAL"  size="12" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="APPR_NO"      colType="TB_STRING"   size="10" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="APPR_DT"      colType="TB_STRING"   size="8"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="APPR_TIME"    colType="TB_STRING"   size="6"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CAN_DT"       colType="TB_STRING"   size="8"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CAN_TIME"     colType="TB_STRING"   size="6"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CCOMP_CD"     colType="TB_STRING"   size="2"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CCOMP_NM"     colType="TB_STRING"   size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BCOMP_CD"     colType="TB_STRING"   size="2"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="JBRCH_ID"     colType="TB_STRING"   size="15" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DOLLAR_FLAG"  colType="TB_STRING"   size="4"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="FILLER"       colType="TB_STRING"   size="66" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BUYREQ_YN"    colType="TB_STRING"   size="1"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REASON_CD"    colType="TB_STRING"   size="2"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MEMO"         colType="TB_STRING"   size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="FLAG"         colType="TB_STRING"   size="1"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REQ_DT"       colType="TB_STRING"   size="8"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <query name="SEL_MASTER">        
        <![CDATA[  
            SELECT 'F' AS CHK_BOX
                 , A.PAY_DT
                 , A.PAY_SEQ
                 , A.SEQ_NO
                 , A.REC_FLAG
                 , COM.FN_GET_COMM_NAME('D', 'D034', A.DATA_FLAG) DATA_FLAG
                 , A.SALE_DT
                 , A.RECV_DT
                 , A.CARD_NO
                 , A.DIV_MONTH
                 , A.APPR_NO
                 , A.CRTN_CD
                 , A.VRTN_CD
                 , COM.FN_GET_COMM_NAME('D', 'D041', A.VRTN_CD) VRTN_NM
                 , A.TRADE_AMT
                 , A.CCOMP_CD
                 , DPS.FN_GET_CCOMP_NM(A.CCOMP_CD) CCOMP_NM   
                 , A.JBRCH_ID
                 , C.JBRCH_NM
                 , NVL(B.BUYREQ_YN, 'N')   BUYREQ_YN
                 , B.REASON_CD
                 , B.MEMO
              FROM DPS.PD_RTND A
                 , DPS.PD_REBUYREQ B
                 , DPS.PD_BRANCH C
             WHERE A.PAY_DT   =    B.PAY_DT (+)
               AND A.PAY_SEQ  =    B.PAY_SEQ(+)
               AND A.SEQ_NO   =    B.SEQ_NO (+)
               AND A.JBRCH_ID =    C.JBRCH_ID
               AND C.STR_CD   LIKE ? || '%'
               AND A.PAY_DT   BETWEEN ? AND ?               
               AND A.VRTN_CD  LIKE ? || '%'
               AND A.CCOMP_CD LIKE ? || '%'
               AND A.CCOMP_CD IN (SELECT CCOMP_CD FROM DPS.PD_CARDCOMP
                                   WHERE BCOMP_CD LIKE ? || '%'                     
                                 )
               AND A.JBRCH_ID  LIKE ? || '%'
               AND A.CARD_NO   LIKE ? || '%'
               AND A.APPR_NO   LIKE ? || '%'
               AND BUYREQ_YN(+) IS NULL
        ]]>        
    </query>
    
    <query name="SEL_DETAIL1">        
        <![CDATA[
			SELECT M.CHRG_DT, M.CHRG_SEQ, M.SEQ_NO
			  FROM DPS.PD_BUYREQD M
			 WHERE     M.APPR_DT   = '20' || ?
			       AND M.CARD_NO   = ?
			       AND M.APPR_NO   = ?
			       AND M.JBRCH_ID  = ?
			       AND M.DIV_MONTH = ?
			       AND M.APPR_AMT  = ?
			       AND ROWNUM = 1                           /* 테스트중 포스 승인번호 중복으로 운영시 삭제 */
        ]]>        
    </query>    
    
    <query name="SEL_DETAIL2">        
        <![CDATA[
            SELECT A.CHRG_DT
                 , A.CHRG_SEQ
                 , A.SEQ_NO
                 , A.REC_FLAG
                 , A.DEVICE_ID
                 , A.WORK_FLAG
                 , A.COMP_NO
                 , A.CARD_NO
                 , A.EXP_DT
                 , A.DIV_MONTH
                 , A.APPR_AMT
                 , A.SVC_AMT
                 , A.APPR_NO
                 , A.APPR_DT
                 , A.APPR_TIME
                 , A.CAN_DT
                 , A.CAN_TIME
                 , A.CCOMP_CD
                 , DPS.FN_GET_CCOMP_NM(A.CCOMP_CD) CCOMP_NM   
                 , A.BCOMP_CD
                 , A.JBRCH_ID
                 , A.DOLLAR_FLAG
                 , A.FILLER
                 , 'Y' BUYREQ_YN
                 , ''  REASON_CD
                 , ''  MEMO    
                 , 'I' FLAG
                 , '' REQ_DT
              FROM DPS.PD_BUYREQD A
             WHERE A.CHRG_DT   =  ?      
               AND A.CHRG_SEQ  =  ?
               AND A.SEQ_NO    =  ?
        ]]>        
    </query>    
    
    <!-- 재청구 업데이트용 조회  -->
    <query name="SEL_REBUYREQ">        
        <![CDATA[
            SELECT PAY_DT  CHRG_DT
                 , PAY_SEQ CHRG_SEQ
                 , SEQ_NO
                 , REC_FLAG
                 , DEVICE_ID
                 , WORK_FLAG
                 , COMP_NO
                 , CARD_NO
                 , EXP_DT
                 , DIV_MONTH
                 , APPR_AMT
                 , SVC_AMT
                 , APPR_NO
                 , APPR_DT
                 , APPR_TIME
                 , CAN_DT
                 , CAN_TIME
                 , CCOMP_CD
                 , DPS.FN_GET_CCOMP_NM(CCOMP_CD) CCOMP_NM   
                 , BCOMP_CD
                 , JBRCH_ID
                 , DOLLAR_FLAG
                 , FILLER
                 , BUYREQ_YN
                 , REASON_CD
                 , MEMO    
                 , 'U' FLAG
                 , REQ_DT
              FROM DPS.PD_REBUYREQ
             WHERE PAY_DT   =  ?      
               AND PAY_SEQ  =  ?
               AND SEQ_NO   =  ?
        ]]>        
    </query>    

    <!-- 재청구 업데이트용 조회  -->
    <query name="SEL_REBUYREQ_CHK">        
        <![CDATA[
            SELECT DECODE(COUNT(*),0,'I','U') FLAG
              FROM DPS.PD_REBUYREQ
             WHERE PAY_DT   =  ?      
               AND PAY_SEQ  =  ?
               AND SEQ_NO   =  ?
        ]]>        
    </query>  
    
    <query name="SEL_RTND_KEY">        
        <![CDATA[
            SELECT SUBSTR(MAX_KEY, 1, 8) CHRG_DT
                 , TO_NUMBER( SUBSTR(MAX_KEY, 9, 3) ) CHRG_SEQ
                 , SUBSTR(MAX_KEY, 12, 7) SEQ_NO
                      FROM DPS.PD_RTND M
                     WHERE M.SALE_DT  = ?
                       AND M.CARD_NO  = ?
                       AND M.APPR_NO  = ?
                       AND M.JBRCH_ID = ? 
                       ORDER BY APPR_NO, SALE_DT
                   )
              WHERE ROWNUM = 1   /* 테스트중 포스 승인번호 중복으로 운영시 삭제 */
        ]]>        
    </query> 
    
    <!-- 재청구 등록  -->
    <query name="INS_REBUYREQ">        
        <![CDATA[
            INSERT INTO DPS.PD_REBUYREQ (
                                         PAY_DT   
                                       , PAY_SEQ  
                                       , SEQ_NO    
                                       , REC_FLAG  
                                       , DEVICE_ID 
                                       , WORK_FLAG 
                                       , COMP_NO   
                                       , CARD_NO   
                                       , EXP_DT    
                                       , DIV_MONTH 
                                       , APPR_AMT  
                                       , SVC_AMT   
                                       , APPR_NO   
                                       , APPR_DT   
                                       , APPR_TIME 
                                       , CAN_DT    
                                       , CAN_TIME  
                                       , CCOMP_CD  
                                       , BCOMP_CD  
                                       , JBRCH_ID  
                                       , DOLLAR_FLAG
                                       , FILLER    
                                       , BUYREQ_YN 
                                       , REASON_CD 
                                       , MEMO      
                                       , REG_DATE
                                       , REG_ID
                                       , MOD_DATE
                                       , MOD_ID
                                        ) 
                                 VALUES (
                                         ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , SYSDATE
                                       , ? 
                                       , SYSDATE
                                       , ?                  
                                       )   
         ]]>                    
    </query>  
    
    <!-- 재청구 수정 -->
    <query name="UPD_REBUYREQ">
        <![CDATA[
            UPDATE DPS.PD_REBUYREQ
               SET REC_FLAG    = ?  
                 , DEVICE_ID   = ?
                 , WORK_FLAG   = ?
                 , COMP_NO     = ? 
                 , CARD_NO     = ? 
                 , EXP_DT      = ?
                 , DIV_MONTH   = ?  
                 , APPR_AMT    = ?  
                 , SVC_AMT     = ? 
                 , APPR_NO     = ?  
                 , APPR_DT     = ?   
                 , APPR_TIME   = ?    
                 , CAN_DT      = ?    
                 , CAN_TIME    = ?    
                 , CCOMP_CD    = ?   
                 , BCOMP_CD    = ?
                 , JBRCH_ID    = ?
                 , DOLLAR_FLAG = ? 
                 , FILLER      = ?  
                 , BUYREQ_YN   = ?
                 , REASON_CD   = ?  
                 , MEMO        = ?
                 , MOD_DATE    = SYSDATE 
                 , MOD_ID      = ?  
             WHERE PAY_DT      = ?  
               AND PAY_SEQ     = ?
               AND SEQ_NO      = ?
        ]]>
    </query> 
</service>