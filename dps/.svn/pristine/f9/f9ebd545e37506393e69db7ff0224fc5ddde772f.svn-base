<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 김영진
 * 회 사 명 : 한국후지쯔
 * 작 성 일 : 2010.05.31
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  청구대상 데이터를 조회한다.
 -->
<service name="/psal927.ps">
    <!-- 청구대상 데이터 목록 -->
    <gauce name="H_MASTER">
        <column colName="ORG_REC_FLAG"     colType="TB_STRING"    size="1"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" /> 
		<column colName="ORG_DEVICE_ID"    colType="TB_STRING"    size="10"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
		<column colName="ORG_WORK_FLAG"    colType="TB_STRING"    size="2"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
		<column colName="ORG_WORK_FLAG_NM" colType="TB_STRING"    size="42"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
		<column colName="ORG_COMP_NO"      colType="TB_STRING"    size="10"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
		<column colName="ORG_CARD_NO"      colType="TB_STRING"    size="20"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
		<column colName="ORG_EXP_DT"       colType="TB_STRING"    size="4"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
		<column colName="ORG_DIV_MONTH"    colType="TB_STRING"    size="2"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" /> 
        <column colName="ORG_APPR_AMT"     colType="TB_DECIMAL"   size="12"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="ORG_SVC_AMT"      colType="TB_DECIMAL"   size="12"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="ORG_APPR_NO"      colType="TB_STRING"    size="10"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="ORG_APPR_DT"      colType="TB_STRING"    size="8"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="ORG_APPR_TIME"    colType="TB_STRING"    size="6"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="ORG_CAN_DT"       colType="TB_STRING"    size="8"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="ORG_CAN_TIME"     colType="TB_STRING"    size="6"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="ORG_CCOMP_CD"     colType="TB_STRING"    size="2"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="ORG_CCOMP_NM"     colType="TB_STRING"    size="43"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="ORG_CCOMP_CDNM"   colType="TB_STRING"    size="43"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="ORG_BCOMP_CD"     colType="TB_STRING"    size="43"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="ORG_JBRCH_ID"     colType="TB_STRING"    size="15"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="ORG_DOLLAR_FLAG"  colType="TB_STRING"    size="4"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="ORG_FILLER"       colType="TB_STRING"    size="66"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />        
        <column colName="REC_FLAG"         colType="TB_STRING"    size="1"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" /> 
		<column colName="DEVICE_ID"        colType="TB_STRING"    size="10"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
		<column colName="WORK_FLAG"        colType="TB_STRING"    size="2"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
		<column colName="WORK_FLAG_NM"     colType="TB_STRING"    size="42"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
		<column colName="COMP_NO"          colType="TB_STRING"    size="10"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
		<column colName="CARD_NO"          colType="TB_STRING"    size="20"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
		<column colName="EXP_DT"           colType="TB_STRING"    size="4"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
		<column colName="DIV_MONTH"        colType="TB_STRING"    size="2"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" /> 
        <column colName="APPR_AMT"         colType="TB_DECIMAL"   size="12"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="SVC_AMT"          colType="TB_DECIMAL"   size="12"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="APPR_NO"          colType="TB_STRING"    size="10"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="APPR_DT"          colType="TB_STRING"    size="8"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="APPR_TIME"        colType="TB_STRING"    size="6"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="CAN_DT"           colType="TB_STRING"    size="8"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="CAN_TIME"         colType="TB_STRING"    size="6"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="CCOMP_CD"         colType="TB_STRING"    size="2"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="CCOMP_NM"         colType="TB_STRING"    size="43"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="BCOMP_CD"         colType="TB_STRING"    size="43"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="JBRCH_ID"         colType="TB_STRING"    size="15"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="DOLLAR_FLAG"      colType="TB_STRING"    size="4"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="FILLER"           colType="TB_STRING"    size="66"  dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="REQ_DT"           colType="TB_STRING"    size="8"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="SEQ_NO"           colType="TB_STRING"    size="7"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
        <column colName="FCL_FLAG"         colType="TB_STRING"    size="1"   dec="0"   keyType="TB_NORMAL"   roundMode="ROUND" />
    </gauce>
    
    <!-- 청구대상 데이터 조회 -->
    <query name="SEL_MASTER">        
        <![CDATA[
            SELECT A.REC_FLAG                                                          AS ORG_REC_FLAG
                 , A.DEVICE_ID                                                         AS ORG_DEVICE_ID
                 , A.WORK_FLAG                                                         AS ORG_WORK_FLAG
                 , A.WORK_FLAG || ' ' || COM.FN_GET_COMM_NAME('D', 'D035',A.WORK_FLAG) AS ORG_WORK_FLAG_NM
                 , A.COMP_NO                                                           AS ORG_COMP_NO
                 , A.CARD_NO                                                           AS ORG_CARD_NO
                 , A.EXP_DT                                                            AS ORG_EXP_DT
                 , A.DIV_MONTH                                                         AS ORG_DIV_MONTH
                 , DECODE(A.WORK_FLAG, '12', A.APPR_AMT * -1,  A.APPR_AMT)           AS ORG_APPR_AMT
                 , A.SVC_AMT                                                           AS ORG_SVC_AMT
                 , A.APPR_NO                                                           AS ORG_APPR_NO
                 , A.APPR_DT                                                           AS ORG_APPR_DT
                 , A.APPR_TIME                                                         AS ORG_APPR_TIME
                 , A.CAN_DT                                                            AS ORG_CAN_DT
                 , A.CAN_TIME                                                          AS ORG_CAN_TIME
                 , A.CCOMP_CD                										   AS ORG_CCOMP_CD
                 , DPS.FN_GET_CCOMP_NM(A.CCOMP_CD)                                     AS ORG_CCOMP_NM 
                 , A.CCOMP_CD || ' ' || DPS.FN_GET_CCOMP_NM(A.CCOMP_CD)         	   AS ORG_CCOMP_CDNM
                 , A.BCOMP_CD                                                          AS ORG_BCOMP_CD  
                 , A.JBRCH_ID                                                          AS ORG_JBRCH_ID
                 , A.DOLLAR_FLAG                                                       AS ORG_DOLLAR_FLAG
                 , A.FILLER                                                            AS ORG_FILLER
                 , A.REC_FLAG
                 , A.DEVICE_ID
                 , A.WORK_FLAG
                 , A.WORK_FLAG || ' ' || COM.FN_GET_COMM_NAME('D', 'D035',A.WORK_FLAG) AS WORK_FLAG_NM
                 , A.COMP_NO
                 , A.CARD_NO
                 , A.EXP_DT
                 , A.DIV_MONTH
                 , DECODE(A.WORK_FLAG, '12', A.APPR_AMT * -1,  A.APPR_AMT)           AS APPR_AMT
                 , A.SVC_AMT
                 , A.APPR_NO
                 , A.APPR_DT
                 , A.APPR_TIME
                 , A.CAN_DT
                 , A.CAN_TIME
                 , A.CCOMP_CD            
                 , DPS.FN_GET_CCOMP_NM(A.CCOMP_CD)                                     AS CCOMP_NM   
                 , A.BCOMP_CD   
                 , A.JBRCH_ID
                 , A.DOLLAR_FLAG
                 , A.FILLER                  
                 , A.REQ_DT
                 , A.SEQ_NO
                 , A.FCL_FLAG
              FROM DPS.PD_BUYREQPREP A
             WHERE A.STR_CD     = ?
               AND A.REQ_DT BETWEEN ? AND ?
               AND A.CHRG_DT IS NULL
           ]]>     
    </query>
    
    <query name="SEL_MASTER_WHERE_BCOMPCD">        
        <![CDATA[
               AND A.BCOMP_CD   = ?
         ]]>     
    </query>
    <query name="SEL_MASTER_WHERE_JBRCHID">        
        <![CDATA[
               AND A.JBRCH_ID   = ?
         ]]>     
    </query>
    <query name="SEL_MASTER_WHERE_CARDNO">        
        <![CDATA[
               AND A.CARD_NO    = ?
         ]]>     
    </query>
    <query name="SEL_MASTER_WHERE_APPRNO">        
        <![CDATA[
               AND A.APPR_NO    = ?
         ]]>     
    </query>
    <query name="SEL_MASTER_WHERE_DIVMONTH">        
        <![CDATA[
               AND A.DIV_MONTH  = ? 
         ]]>     
    </query>
    
    <!-- 청구대상 오류데이터 COUNT -->
    <query name="SEL_COUNT">        
        <![CDATA[
            SELECT COUNT(*) CNT
              FROM DPS.PD_BUYREQPREP A
             WHERE CCOMP_CD     = '**'
               OR  BCOMP_CD     = '**'
               OR  JBRCH_ID     = null
               AND A.STR_CD     = ?
               AND A.REQ_DT     = ?
           ]]>     
    </query>
    
    <!-- 청구대상 수정 -->
    <query name="SEL_UPD_BUYREQPREP">        
        <![CDATA[
            UPDATE DPS.PD_BUYREQPREP
               SET REC_FLAG    = ?
                 , DEVICE_ID   = ?
                 , WORK_FLAG   = ?
                 , COMP_NO     = ?
                 , CARD_NO     = ?
                 , EXP_DT      = ?
                 , DIV_MONTH   = ?
                 , APPR_AMT    = ABS(?)
                 , SVC_AMT     = ?
                 , APPR_NO     = ?
                 , APPR_DT     = ?
                 , APPR_TIME   = ?
                 , CAN_DT      = ?
                 , CAN_TIME    = ?
                 , CCOMP_CD    = ?
                 , BCOMP_CD    = ?
                 , JBRCH_ID    = ?
                 , DOLLAR_FLAG = ?
                 , FILLER      = ?
                 , MOD_DATE    = SYSDATE
                 , MOD_ID      = ?
             WHERE REQ_DT      = ?
               AND FCL_FLAG    = ?
               AND SEQ_NO      = ?
           ]]>     
    </query>
    
</service>