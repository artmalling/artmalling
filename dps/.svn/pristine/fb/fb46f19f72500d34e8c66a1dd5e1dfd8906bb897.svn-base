<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 이정식
 * 회 사 명 : 
 * 작 성 일 : 2010.04.01
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  단품의 판매가격을 변경 관리
 -->
<service name="/pcod601.pc">
    <!-- 마스터 헤더  -->
    <gauce name="H_SEL_MASTER">
        <column colName="CHECK_FLAG"       colType="TB_STRING"  size="1"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="EDIT_FLAG"        colType="TB_STRING"  size="1"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="STR_CD"           colType="TB_STRING"  size="2"  dec="0" keyType="TB_KEY"    roundMode="ROUND"/>
        <column colName="SKU_CD"           colType="TB_STRING"  size="13" dec="0" keyType="TB_KEY"    roundMode="ROUND"/>
        <column colName="SKU_NAME"         colType="TB_STRING"  size="30" dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="STYLE_CD"         colType="TB_STRING"  size="54" dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="COLOR_NM"         colType="TB_STRING"  size="30" dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="SIZE_NM"          colType="TB_STRING"  size="30" dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="ORI_APP_S_DT"     colType="TB_STRING"  size="8"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="ORI_APP_E_DT"     colType="TB_STRING"  size="8"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="ORI_SAL_COST_PRC" colType="TB_INT"     size="9"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="ORI_SALE_PRC"     colType="TB_INT"     size="9"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="ORI_SALE_MG_RATE" colType="TB_DECIMAL" size="5"  dec="2" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="NEW_APP_S_DT"     colType="TB_STRING"  size="8"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="NEW_APP_E_DT"     colType="TB_STRING"  size="8"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="NEW_SAL_COST_PRC" colType="TB_INT"     size="9"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="NEW_SALE_PRC"     colType="TB_INT"     size="9"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="NEW_SALE_MG_RATE" colType="TB_DECIMAL" size="5"  dec="2" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="BIZ_TYPE"         colType="TB_STRING"  size="1"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="PUMBUN_TYPE"      colType="TB_STRING"  size="1"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="SKU_TYPE"         colType="TB_STRING"  size="1"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="LOW_MG_RATE"      colType="TB_STRING"  size="5"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="TAX_FLAG"         colType="TB_STRING"  size="1"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="ROUND_FLAG"       colType="TB_STRING"  size="1"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="TEMP"             colType="TB_STRING"  size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="NORM_MG_RATE" colType="TB_DECIMAL" size="5"  dec="2" keyType="TB_NORMAL" roundMode="ROUND"/>
    </gauce>
    
    <!-- 조회조건 헤더  -->
    <gauce name="H_SKU_COND">
        <column colName="STR_CD"       colType="TB_STRING"  size="2"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="PUMBUN_CD"    colType="TB_STRING"  size="6"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="VEN_CD"       colType="TB_STRING"  size="6"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="PUMMOK_CD"    colType="TB_STRING"  size="8"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="STYLE_CD_A"   colType="TB_STRING"  size="54" dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="STYLE_NM_A"   colType="TB_STRING"  size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="STYLE_CD_B"   colType="TB_STRING"  size="54" dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="STYLE_NM_B"   colType="TB_STRING"  size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="SKU_CD"       colType="TB_STRING"  size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="SKU_NM"       colType="TB_STRING"  size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="BRAND_CD_A"   colType="TB_STRING"  size="2"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="BRAND_CD_B"   colType="TB_STRING"  size="2"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="SUB_BRD_CD_A" colType="TB_STRING"  size="2"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="SUB_BRD_CD_B" colType="TB_STRING"  size="2"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="PLAN_YEAR"    colType="TB_STRING"  size="1"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="SEASON_CD"    colType="TB_STRING"  size="1"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="ITEM_CD"      colType="TB_STRING"  size="2"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="MNG_CD1"      colType="TB_STRING"  size="10" dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="MNG_CD2"      colType="TB_STRING"  size="10" dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="MNG_CD3"      colType="TB_STRING"  size="10" dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="MNG_CD4"      colType="TB_STRING"  size="10" dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="MNG_CD5"      colType="TB_STRING"  size="10" dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="ADJ_DATE"     colType="TB_STRING"  size="8"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="INC_FLAG"     colType="TB_STRING"  size="10" dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="INC_RATE"     colType="TB_DECIMAL" size="3"  dec="0" keyType="TB_NORMAL" roundMode="ROUND"/>
    </gauce>
    
    <!-- 마스터 조회 쿼리  -->
    <query name="SEL_SKUMST_CLOTH">
        <![CDATA[
        SELECT 'F' AS CHECK_FLAG
              , NVL(Y.EDIT_FLAG,      '1') AS EDIT_FLAG
              , X.STR_CD
              , X.SKU_CD
              , X.SKU_NAME
              , X.STYLE_CD
              , X.COLOR_NM
              , X.SIZE_NM
              , NVL(Y.ORI_APP_S_DT,    '') AS ORI_APP_S_DT
              , NVL(Y.ORI_APP_E_DT,    '') AS ORI_APP_E_DT
              , NVL(Y.ORI_SAL_COST_PRC, 0) AS ORI_SAL_COST_PRC
              , NVL(Y.ORI_SALE_PRC,     0) AS ORI_SALE_PRC
              , NVL(Y.ORI_SALE_MG_RATE, 0) AS ORI_SALE_MG_RATE
              , CASE NVL(Y.EDIT_FLAG, '1') 
                     WHEN '1' THEN ?
                     ELSE ''
                END                        AS NEW_APP_S_DT
              , CASE NVL(Y.EDIT_FLAG, '1') 
                     WHEN '1' THEN '99991231'
                     ELSE ''
                END                        AS NEW_APP_E_DT
              , CASE NVL(Y.EDIT_FLAG, '1') 
                     WHEN '1' THEN NVL(Y.NEW_SAL_COST_PRC, 0)
                     ELSE NULL
                END                        AS NEW_SAL_COST_PRC
              , CASE NVL(Y.EDIT_FLAG, '1') 
                     WHEN '1' THEN NVL(Y.NEW_SALE_PRC,     0)
                     ELSE NULL
                END                        AS NEW_SALE_PRC
              , CASE NVL(Y.EDIT_FLAG, '1') 
                     WHEN '1' THEN NVL(Y.NEW_SALE_MG_RATE, 0)
                     ELSE NULL
                END                        AS NEW_SALE_MG_RATE
              , X.BIZ_TYPE
              , X.PUMBUN_TYPE
              , X.SKU_TYPE
              , X.LOW_MG_RATE
              , X.TAX_FLAG
              , X.ROUND_FLAG
              , '' AS TEMP
              , X.NORM_MG_RATE
          FROM ( SELECT PRC.STR_CD
                      , SKU.SKU_CD
                      , PRC.VEN_CD
                      , SKU.SKU_NAME
                      , SKU.STYLE_CD
                      , COM.FN_GET_COMM_NAME('D','P062',SKU.COLOR_CD) AS COLOR_NM
                      , COM.FN_GET_COMM_NAME('D','P026',SKU.SIZE_CD)  AS SIZE_NM
                      , SKU.COLOR_CD
                      , SKU.SIZE_CD
                      , PBN.BIZ_TYPE
                      , PBN.PUMBUN_TYPE
                      , PBN.SKU_TYPE
                      , STR.LOW_MG_RATE
                      , SKU.PUMMOK_CD
                      , STY.STYLE_NAME
                      , STY.BRAND_CD
                      , STY.SUB_BRD_CD
                      , STY.PLAN_YEAR
                      , STY.SEASON_CD
                      , STY.ITEM_CD
                      , STY.MNG_CD1
                      , STY.MNG_CD2
                      , STY.MNG_CD3
                      , STY.MNG_CD4
                      , STY.MNG_CD5
                      , PBN.TAX_FLAG
                      , DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD) AS ROUND_FLAG
                      , (SELECT MGM.NORM_MG_RATE
                           FROM DPS.PC_MARGINMST MGM
                          WHERE MGM.EVENT_FLAG = '00'
                            AND MGM.MG_FLAG    = '0'
                            AND MGM.EVENT_CD   = '00000000000'
                            AND ? BETWEEN MGM.APP_S_DT AND MGM.APP_E_DT
                            AND STR.STR_CD    = MGM.STR_CD
                            AND STR.PUMBUN_CD = MGM.PUMBUN_CD) AS NORM_MG_RATE
                   FROM DPS.PC_STRSKUMST PRC
                      , DPS.PC_SKUMST    SKU
                      , DPS.PC_STYLEMST  STY
                      , DPS.PC_PBNMST    PBN
                      , DPS.PC_STRPBN    STR
                  WHERE PRC.SKU_CD    = SKU.SKU_CD
                    AND SKU.PUMBUN_CD = STY.PUMBUN_CD
                    AND SKU.STYLE_CD  = STY.STYLE_CD
                    AND SKU.PUMBUN_CD = PBN.PUMBUN_CD
                    AND PRC.STR_CD    = STR.STR_CD
                    AND SKU.PUMBUN_CD = STR.PUMBUN_CD
                    AND SKU.PUMBUN_CD = ?
               ) X LEFT OUTER JOIN 
               ( SELECT PRC.STR_CD
                      , SKU.SKU_CD
                      , PRC.APP_S_DT       AS ORI_APP_S_DT
                      , PRC.APP_E_DT       AS ORI_APP_E_DT
                      , PRC.SAL_COST_PRC   AS ORI_SAL_COST_PRC
                      , PRC.SALE_PRC       AS ORI_SALE_PRC
                      , PRC.SALE_MG_RATE   AS ORI_SALE_MG_RATE                      
                      , CASE ? WHEN '%' THEN NULL
                               ELSE CASE PBN.BIZ_TYPE 
                                         WHEN '1' THEN PRC.SAL_COST_PRC 
                                         ELSE DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), DPS.FN_GET_SALE_PRICE('', DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), DPS.FN_GET_SALE_PRICE(?, PRC.SALE_PRC, ?, PBN.TAX_FLAG, '0'),0), 0, PBN.TAX_FLAG, '1')*((100-PRC.SALE_MG_RATE)/100),0)
                                    END
                        END                AS NEW_SAL_COST_PRC
                      , CASE ? WHEN '%' THEN NULL 
                               ELSE DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), DPS.FN_GET_SALE_PRICE(?, PRC.SALE_PRC, ?, PBN.TAX_FLAG, '0'),0)
                        END                AS NEW_SALE_PRC
                      , CASE ? WHEN '%' THEN NULL
                               ELSE CASE PBN.BIZ_TYPE 
                                         WHEN '1' THEN DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), (DPS.FN_GET_SALE_PRICE('', DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), DPS.FN_GET_SALE_PRICE(?, PRC.SALE_PRC, ?, PBN.TAX_FLAG, '0'),0), 0, PBN.TAX_FLAG, '1')-PRC.SAL_COST_PRC)/DPS.FN_GET_SALE_PRICE('', DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), DPS.FN_GET_SALE_PRICE(?, PRC.SALE_PRC, ?, PBN.TAX_FLAG, '0'),0), 0, PBN.TAX_FLAG, '1') * 100,2)
                                         ELSE PRC.SALE_MG_RATE
                                    END 
                        END                AS NEW_SALE_MG_RATE
                      , CASE WHEN ? > PRC.APP_S_DT AND TO_CHAR(SYSDATE,'YYYYMMDD') >= PRC.APP_S_DT THEN '1' ELSE '0' END AS EDIT_FLAG
                   FROM DPS.PC_STRSKUPRCMST PRC
                      , DPS.PC_SKUMST       SKU
                      , DPS.PC_STYLEMST     STY
                      , DPS.PC_PBNMST       PBN
                  WHERE PRC.SKU_CD    = SKU.SKU_CD
                    AND SKU.PUMBUN_CD = STY.PUMBUN_CD
                    AND SKU.STYLE_CD  = STY.STYLE_CD
                    AND SKU.PUMBUN_CD = PBN.PUMBUN_CD
                    AND PRC.EVENT_CD  = '00000000000'
                    AND PRC.APP_E_DT  = '99991231'
                    AND SKU.PUMBUN_CD = ?
               ) Y
            ON X.STR_CD = Y.STR_CD
           AND X.SKU_CD = Y.SKU_CD
         WHERE EXISTS ( SELECT 1 
                          FROM COM.V_MYORG VMY
                         WHERE X.STR_CD = VMY.STR_CD
                           AND USER_ID  = ?
                           AND ORG_FLAG = ?)
        ]]>
    </query>
    
    <!-- 마스터 조회 쿼리  -->
    <query name="SEL_SKUMST">
        <![CDATA[
       SELECT 'F' AS CHECK_FLAG
              , NVL(Y.EDIT_FLAG,      '1') AS EDIT_FLAG
              , X.STR_CD
              , X.SKU_CD
              , X.SKU_NAME
              , X.STYLE_CD
              , X.COLOR_NM
              , X.SIZE_NM
              , NVL(Y.ORI_APP_S_DT,    '') AS ORI_APP_S_DT
              , NVL(Y.ORI_APP_E_DT,    '') AS ORI_APP_E_DT
              , NVL(Y.ORI_SAL_COST_PRC, 0) AS ORI_SAL_COST_PRC
              , NVL(Y.ORI_SALE_PRC,     0) AS ORI_SALE_PRC
              , NVL(Y.ORI_SALE_MG_RATE, 0) AS ORI_SALE_MG_RATE
              , CASE NVL(Y.EDIT_FLAG, '1') 
                     WHEN '1' THEN ?
                     ELSE ''
                END                        AS NEW_APP_S_DT
              , CASE NVL(Y.EDIT_FLAG, '1') 
                     WHEN '1' THEN '99991231'
                     ELSE ''
                END                        AS NEW_APP_E_DT
              , CASE NVL(Y.EDIT_FLAG, '1') 
                     WHEN '1' THEN NVL(Y.NEW_SAL_COST_PRC, 0)
                     ELSE NULL
                END                        AS NEW_SAL_COST_PRC
              , CASE NVL(Y.EDIT_FLAG, '1') 
                     WHEN '1' THEN NVL(Y.NEW_SALE_PRC,     0)
                     ELSE NULL
                END                        AS NEW_SALE_PRC
              , CASE NVL(Y.EDIT_FLAG, '1') 
                     WHEN '1' THEN NVL(Y.NEW_SALE_MG_RATE, 0)
                     ELSE NULL
                END                        AS NEW_SALE_MG_RATE
              , X.BIZ_TYPE
              , X.PUMBUN_TYPE
              , X.SKU_TYPE
              , X.LOW_MG_RATE
              , X.TAX_FLAG
              , X.ROUND_FLAG
              , '' AS TEMP
              , X.NORM_MG_RATE
          FROM ( SELECT PRC.STR_CD
                      , SKU.SKU_CD
                      , PRC.VEN_CD
                      , SKU.SKU_NAME
                      , SKU.STYLE_CD
                      , COM.FN_GET_COMM_NAME('D','P062',SKU.COLOR_CD) AS COLOR_NM
                      , COM.FN_GET_COMM_NAME('D','P026',SKU.SIZE_CD)  AS SIZE_NM
                      , SKU.COLOR_CD
                      , SKU.SIZE_CD
                      , PBN.BIZ_TYPE
                      , PBN.PUMBUN_TYPE
                      , PBN.SKU_TYPE
                      , STR.LOW_MG_RATE
                      , SKU.PUMMOK_CD
                      , PBN.TAX_FLAG
                      , DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD) AS ROUND_FLAG
                      , (SELECT MGM.NORM_MG_RATE
                           FROM DPS.PC_MARGINMST MGM
                          WHERE MGM.EVENT_FLAG = '00'
                            AND MGM.MG_FLAG    = '0'
                            AND MGM.EVENT_CD   = '00000000000'
                            AND ? BETWEEN MGM.APP_S_DT AND MGM.APP_E_DT
                            AND STR.STR_CD    = MGM.STR_CD
                            AND STR.PUMBUN_CD = MGM.PUMBUN_CD) AS NORM_MG_RATE
                   FROM DPS.PC_STRSKUMST PRC
                      , DPS.PC_SKUMST    SKU
                      , DPS.PC_PBNMST    PBN
                      , DPS.PC_STRPBN    STR
                  WHERE PRC.SKU_CD    = SKU.SKU_CD
                    AND SKU.PUMBUN_CD = PBN.PUMBUN_CD
                    AND PRC.STR_CD    = STR.STR_CD
                    AND SKU.PUMBUN_CD = STR.PUMBUN_CD
                    AND SKU.PUMBUN_CD = ?
               ) X LEFT OUTER JOIN 
               ( SELECT PRC.STR_CD
                      , SKU.SKU_CD
                      , PRC.APP_S_DT       AS ORI_APP_S_DT
                      , PRC.APP_E_DT       AS ORI_APP_E_DT
                      , PRC.SAL_COST_PRC   AS ORI_SAL_COST_PRC
                      , PRC.SALE_PRC       AS ORI_SALE_PRC
                      , PRC.SALE_MG_RATE   AS ORI_SALE_MG_RATE                      
                      , CASE ? WHEN '%' THEN NULL
                               ELSE CASE PBN.BIZ_TYPE 
                                         WHEN '1' THEN PRC.SAL_COST_PRC 
                                         ELSE DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), DPS.FN_GET_SALE_PRICE('', DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), DPS.FN_GET_SALE_PRICE(?, PRC.SALE_PRC, ?, PBN.TAX_FLAG, '0'),0), 0, PBN.TAX_FLAG, '1')*((100-PRC.SALE_MG_RATE)/100),0)
                                    END
                        END                AS NEW_SAL_COST_PRC
                      , CASE ? WHEN '%' THEN NULL 
                               ELSE DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), DPS.FN_GET_SALE_PRICE(?, PRC.SALE_PRC, ?, PBN.TAX_FLAG, '0'),0)
                        END                AS NEW_SALE_PRC
                      , CASE ? WHEN '%' THEN NULL
                               ELSE CASE PBN.BIZ_TYPE 
                                         WHEN '1' THEN DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), (DPS.FN_GET_SALE_PRICE('', DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), DPS.FN_GET_SALE_PRICE(?, PRC.SALE_PRC, ?, PBN.TAX_FLAG, '0'),0), 0, PBN.TAX_FLAG, '1')-PRC.SAL_COST_PRC)/DPS.FN_GET_SALE_PRICE('', DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), DPS.FN_GET_SALE_PRICE(?, PRC.SALE_PRC, ?, PBN.TAX_FLAG, '0'),0), 0, PBN.TAX_FLAG, '1') * 100,2)
                                         ELSE PRC.SALE_MG_RATE
                                    END 
                        END                AS NEW_SALE_MG_RATE
                      , CASE WHEN ? > PRC.APP_S_DT AND TO_CHAR(SYSDATE,'YYYYMMDD') >= PRC.APP_S_DT THEN '1' ELSE '0' END AS EDIT_FLAG
                   FROM DPS.PC_STRSKUPRCMST PRC
                      , DPS.PC_SKUMST       SKU
                      , DPS.PC_PBNMST       PBN
                  WHERE PRC.SKU_CD    = SKU.SKU_CD
                    AND SKU.PUMBUN_CD = PBN.PUMBUN_CD
                    AND PRC.EVENT_CD  = '00000000000'
                    AND PRC.APP_E_DT  = '99991231'
                    AND SKU.PUMBUN_CD = ?
               ) Y
            ON X.STR_CD = Y.STR_CD
           AND X.SKU_CD = Y.SKU_CD
         WHERE EXISTS ( SELECT 1 
                          FROM COM.V_MYORG VMY
                         WHERE X.STR_CD = VMY.STR_CD
                           AND USER_ID  = ?
                           AND ORG_FLAG = ?)
        ]]>
    </query>
    
    <query name="SEL_SKUMST_WHERE_STR_CD">
        <![CDATA[
           AND X.STR_CD = ?
        ]]>
    </query>

    <query name="SEL_SKUMST_WHERE_PUMMOK_CD">
        <![CDATA[
           AND X.PUMMOK_CD     = ? 
        ]]>
    </query>

    <query name="SEL_SKUMST_WHERE_VEN_CD">
        <![CDATA[
           AND X.VEN_CD     = ? 
        ]]>
    </query>
    <query name="SEL_SKUMST_WHERE_LIKE_SKU_CD">
        <![CDATA[
           AND X.SKU_CD        LIKE ?||'%'
           AND X.SKU_NAME      LIKE '%'||?||'%'
        ]]>
    </query>

    <query name="SEL_SKUMST_WHERE_STYLE_CD">
        <![CDATA[
           AND X.STYLE_CD    LIKE   ?||'%'
           AND X.STYLE_NAME  LIKE   '%'||?||'%'
        ]]>
    </query> 
    
    <query name="SEL_SKUMST_WHERE_BRAND_CD">
        <![CDATA[
           AND X.BRAND_CD           = ?
        ]]>
    </query>
    
    <query name="SEL_SKUMST_WHERE_SUB_BRD_CD">
        <![CDATA[
           AND X.SUB_BRD_CD          = ?  
        ]]>
    </query>
    
    <query name="SEL_SKUMST_WHERE_PLAN_YEAR">
        <![CDATA[
           AND X.PLAN_YEAR           = ?
        ]]>
    </query> 
    
    <query name="SEL_SKUMST_WHERE_SEASON_CD">
        <![CDATA[
           AND X.SEASON_CD           = ?
        ]]>
    </query>
    
    <query name="SEL_SKUMST_WHERE_ITEM_CD">
        <![CDATA[
           AND X.ITEM_CD             = ?
        ]]>
    </query>
    
    <query name="SEL_SKUMST_WHERE_MNG_CD1">
        <![CDATA[
           AND X.MNG_CD1             = ?
        ]]>
    </query>
    
    <query name="SEL_SKUMST_WHERE_MNG_CD2">
        <![CDATA[
           AND X.MNG_CD2             = ?
        ]]>
    </query> 
    
    <query name="SEL_SKUMST_WHERE_MNG_CD3">
        <![CDATA[
           AND X.MNG_CD3             = ?
        ]]>
    </query>
    
    <query name="SEL_SKUMST_WHERE_MNG_CD4">
        <![CDATA[
           AND X.MNG_CD4             = ?
        ]]>
    </query>
    
    <query name="SEL_SKUMST_WHERE_MNG_CD5">
        <![CDATA[
           AND X.MNG_CD5             = ?
        ]]>
    </query>
    
    <query name="SEL_SKUMST_ORDER_TYPE1">
        <![CDATA[
        ORDER BY X.STYLE_CD
               , X.COLOR_CD
               , X.SIZE_CD
        ]]>
    </query>
    
    <query name="SEL_SKUMST_ORDER_TYPE2">
        <![CDATA[
        ORDER BY X.SKU_CD
        ]]>
    </query>
    
    <query name="SEL_SKUMST2_CLOTH">
        <![CDATA[
        SELECT 'F' AS CHECK_FLAG
              , NVL(Y.EDIT_FLAG,      '1') AS EDIT_FLAG
              , X.STR_CD
              , X.SKU_CD
              , X.SKU_NAME
              , X.STYLE_CD
              , X.COLOR_NM
              , X.SIZE_NM
              , NVL(Y.ORI_APP_S_DT,    '') AS ORI_APP_S_DT
              , NVL(Y.ORI_APP_E_DT,    '') AS ORI_APP_E_DT
              , NVL(Y.ORI_SAL_COST_PRC, 0) AS ORI_SAL_COST_PRC
              , NVL(Y.ORI_SALE_PRC,     0) AS ORI_SALE_PRC
              , NVL(Y.ORI_SALE_MG_RATE, 0) AS ORI_SALE_MG_RATE
              , CASE NVL(Y.EDIT_FLAG, '1') 
                     WHEN '1' THEN ?
                     ELSE ''
                END                        AS NEW_APP_S_DT
              , CASE NVL(Y.EDIT_FLAG, '1') 
                     WHEN '1' THEN '99991231'
                     ELSE ''
                END                        AS NEW_APP_E_DT
              , CASE NVL(Y.EDIT_FLAG, '1') 
                     WHEN '1' THEN NVL(Y.NEW_SAL_COST_PRC, 0)
                     ELSE NULL
                END                        AS NEW_SAL_COST_PRC
              , CASE NVL(Y.EDIT_FLAG, '1') 
                     WHEN '1' THEN NVL(Y.NEW_SALE_PRC,     0)
                     ELSE NULL
                END                        AS NEW_SALE_PRC
              , CASE NVL(Y.EDIT_FLAG, '1') 
                     WHEN '1' THEN NVL(Y.NEW_SALE_MG_RATE, 0)
                     ELSE NULL
                END                        AS NEW_SALE_MG_RATE
              , X.BIZ_TYPE
              , X.PUMBUN_TYPE
              , X.SKU_TYPE
              , X.LOW_MG_RATE
              , X.TAX_FLAG
              , X.ROUND_FLAG
          FROM ( SELECT PRC.STR_CD
                      , SKU.SKU_CD
                      , PRC.VEN_CD
                      , SKU.SKU_NAME
                      , SKU.STYLE_CD
                      , COM.FN_GET_COMM_NAME('D','P062',SKU.COLOR_CD) AS COLOR_NM
                      , COM.FN_GET_COMM_NAME('D','P026',SKU.SIZE_CD)  AS SIZE_NM
                      , SKU.COLOR_CD
                      , SKU.SIZE_CD
                      , PBN.BIZ_TYPE
                      , PBN.PUMBUN_TYPE
                      , PBN.SKU_TYPE
                      , STR.LOW_MG_RATE
                      , SKU.PUMMOK_CD
                      , STY.STYLE_NAME
                      , STY.BRAND_CD
                      , STY.SUB_BRD_CD
                      , STY.PLAN_YEAR
                      , STY.SEASON_CD
                      , STY.ITEM_CD
                      , STY.MNG_CD1
                      , STY.MNG_CD2
                      , STY.MNG_CD3
                      , STY.MNG_CD4
                      , STY.MNG_CD5
                      , PBN.TAX_FLAG
                      , DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD) AS ROUND_FLAG
                   FROM DPS.PC_STRSKUMST PRC
                      , DPS.PC_SKUMST    SKU
                      , DPS.PC_STYLEMST  STY
                      , DPS.PC_PBNMST    PBN
                      , DPS.PC_STRPBN    STR
                  WHERE PRC.SKU_CD    = SKU.SKU_CD
                    AND SKU.PUMBUN_CD = STY.PUMBUN_CD
                    AND SKU.STYLE_CD  = STY.STYLE_CD
                    AND SKU.PUMBUN_CD = PBN.PUMBUN_CD
                    AND PRC.STR_CD    = STR.STR_CD
                    AND SKU.PUMBUN_CD = STR.PUMBUN_CD
                    AND SKU.PUMBUN_CD = ?
                    AND PRC.STR_CD    = ?
                    AND PRC.SKU_CD    = ?
               ) X LEFT OUTER JOIN 
               ( SELECT PRC.STR_CD
                      , SKU.SKU_CD
                      , PRC.APP_S_DT       AS ORI_APP_S_DT
                      , PRC.APP_E_DT       AS ORI_APP_E_DT
                      , PRC.SAL_COST_PRC   AS ORI_SAL_COST_PRC
                      , PRC.SALE_PRC       AS ORI_SALE_PRC
                      , PRC.SALE_MG_RATE   AS ORI_SALE_MG_RATE                      
                      , CASE ? WHEN '%' THEN NULL
                               ELSE CASE PBN.BIZ_TYPE 
                                         WHEN '1' THEN PRC.SAL_COST_PRC 
                                         ELSE DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), DPS.FN_GET_SALE_PRICE('', DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), DPS.FN_GET_SALE_PRICE(?, PRC.SALE_PRC, ?, PBN.TAX_FLAG, '0'),0), 0, PBN.TAX_FLAG, '1')*((100-PRC.SALE_MG_RATE)/100),0)
                                    END
                        END                AS NEW_SAL_COST_PRC
                      , CASE ? WHEN '%' THEN NULL 
                               ELSE DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), DPS.FN_GET_SALE_PRICE(?, PRC.SALE_PRC, ?, PBN.TAX_FLAG, '0'),0)
                        END                AS NEW_SALE_PRC
                      , CASE ? WHEN '%' THEN NULL
                               ELSE CASE PBN.BIZ_TYPE 
                                         WHEN '1' THEN DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), (DPS.FN_GET_SALE_PRICE('', DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), DPS.FN_GET_SALE_PRICE(?, PRC.SALE_PRC, ?, PBN.TAX_FLAG, '0'),0), 0, PBN.TAX_FLAG, '1')-PRC.SAL_COST_PRC)/DPS.FN_GET_SALE_PRICE('', DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), DPS.FN_GET_SALE_PRICE(?, PRC.SALE_PRC, ?, PBN.TAX_FLAG, '0'),0), 0, PBN.TAX_FLAG, '1') * 100,3)
                                         ELSE PRC.SALE_MG_RATE
                                    END 
                        END                AS NEW_SALE_MG_RATE
                      , CASE WHEN ? > PRC.APP_S_DT AND TO_CHAR(SYSDATE,'YYYYMMDD') >= PRC.APP_S_DT THEN '1' ELSE '0' END AS EDIT_FLAG
                   FROM DPS.PC_STRSKUPRCMST PRC
                      , DPS.PC_SKUMST       SKU
                      , DPS.PC_STYLEMST     STY
                      , DPS.PC_PBNMST       PBN
                  WHERE PRC.SKU_CD    = SKU.SKU_CD
                    AND SKU.PUMBUN_CD = STY.PUMBUN_CD
                    AND SKU.STYLE_CD  = STY.STYLE_CD
                    AND SKU.PUMBUN_CD = PBN.PUMBUN_CD
                    AND PRC.EVENT_CD  = '00000000000'
                    AND PRC.APP_E_DT  = '99991231'
                    AND SKU.PUMBUN_CD = ?
                    AND PRC.STR_CD    = ?
                    AND PRC.SKU_CD    = ?
               ) Y
            ON X.STR_CD = Y.STR_CD
           AND X.SKU_CD = Y.SKU_CD
        ]]>
    </query>
    
    <query name="SEL_SKUMST2">
        <![CDATA[
        SELECT 'F' AS CHECK_FLAG
              , NVL(Y.EDIT_FLAG,      '1') AS EDIT_FLAG
              , X.STR_CD
              , X.SKU_CD
              , X.SKU_NAME
              , X.STYLE_CD
              , X.COLOR_NM
              , X.SIZE_NM
              , NVL(Y.ORI_APP_S_DT,    '') AS ORI_APP_S_DT
              , NVL(Y.ORI_APP_E_DT,    '') AS ORI_APP_E_DT
              , NVL(Y.ORI_SAL_COST_PRC, 0) AS ORI_SAL_COST_PRC
              , NVL(Y.ORI_SALE_PRC,     0) AS ORI_SALE_PRC
              , NVL(Y.ORI_SALE_MG_RATE, 0) AS ORI_SALE_MG_RATE
              , CASE NVL(Y.EDIT_FLAG, '1') 
                     WHEN '1' THEN ?
                     ELSE ''
                END                        AS NEW_APP_S_DT
              , CASE NVL(Y.EDIT_FLAG, '1') 
                     WHEN '1' THEN '99991231'
                     ELSE ''
                END                        AS NEW_APP_E_DT
              , CASE NVL(Y.EDIT_FLAG, '1') 
                     WHEN '1' THEN NVL(Y.NEW_SAL_COST_PRC, 0)
                     ELSE NULL
                END                        AS NEW_SAL_COST_PRC
              , CASE NVL(Y.EDIT_FLAG, '1') 
                     WHEN '1' THEN NVL(Y.NEW_SALE_PRC,     0)
                     ELSE NULL
                END                        AS NEW_SALE_PRC
              , CASE NVL(Y.EDIT_FLAG, '1') 
                     WHEN '1' THEN NVL(Y.NEW_SALE_MG_RATE, 0)
                     ELSE NULL
                END                        AS NEW_SALE_MG_RATE
              , X.BIZ_TYPE
              , X.PUMBUN_TYPE
              , X.SKU_TYPE
              , X.LOW_MG_RATE
              , X.TAX_FLAG
              , X.ROUND_FLAG
          FROM ( SELECT PRC.STR_CD
                      , SKU.SKU_CD
                      , PRC.VEN_CD
                      , SKU.SKU_NAME
                      , SKU.STYLE_CD
                      , COM.FN_GET_COMM_NAME('D','P062',SKU.COLOR_CD) AS COLOR_NM
                      , COM.FN_GET_COMM_NAME('D','P026',SKU.SIZE_CD)  AS SIZE_NM
                      , SKU.COLOR_CD
                      , SKU.SIZE_CD
                      , PBN.BIZ_TYPE
                      , PBN.PUMBUN_TYPE
                      , PBN.SKU_TYPE
                      , STR.LOW_MG_RATE
                      , SKU.PUMMOK_CD
                      , PBN.TAX_FLAG
                      , DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD) AS ROUND_FLAG
                   FROM DPS.PC_STRSKUMST PRC
                      , DPS.PC_SKUMST    SKU
                      , DPS.PC_PBNMST    PBN
                      , DPS.PC_STRPBN    STR
                  WHERE PRC.SKU_CD    = SKU.SKU_CD
                    AND SKU.PUMBUN_CD = PBN.PUMBUN_CD
                    AND PRC.STR_CD    = STR.STR_CD
                    AND SKU.PUMBUN_CD = STR.PUMBUN_CD
                    AND SKU.PUMBUN_CD = ?
                    AND PRC.STR_CD    = ?
                    AND PRC.SKU_CD    = ?
               ) X LEFT OUTER JOIN 
               ( SELECT PRC.STR_CD
                      , SKU.SKU_CD
                      , PRC.APP_S_DT       AS ORI_APP_S_DT
                      , PRC.APP_E_DT       AS ORI_APP_E_DT
                      , PRC.SAL_COST_PRC   AS ORI_SAL_COST_PRC
                      , PRC.SALE_PRC       AS ORI_SALE_PRC
                      , PRC.SALE_MG_RATE   AS ORI_SALE_MG_RATE                      
                      , CASE ? WHEN '%' THEN NULL
                               ELSE CASE PBN.BIZ_TYPE 
                                         WHEN '1' THEN PRC.SAL_COST_PRC 
                                         ELSE DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), DPS.FN_GET_SALE_PRICE('', DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), DPS.FN_GET_SALE_PRICE(?, PRC.SALE_PRC, ?, PBN.TAX_FLAG, '0'),0), 0, PBN.TAX_FLAG, '1')*((100-PRC.SALE_MG_RATE)/100),0)
                                    END
                        END                AS NEW_SAL_COST_PRC
                      , CASE ? WHEN '%' THEN NULL 
                               ELSE DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), DPS.FN_GET_SALE_PRICE(?, PRC.SALE_PRC, ?, PBN.TAX_FLAG, '0'),0)
                        END                AS NEW_SALE_PRC
                      , CASE ? WHEN '%' THEN NULL
                               ELSE CASE PBN.BIZ_TYPE 
                                         WHEN '1' THEN DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), (DPS.FN_GET_SALE_PRICE('', DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), DPS.FN_GET_SALE_PRICE(?, PRC.SALE_PRC, ?, PBN.TAX_FLAG, '0'),0), 0, PBN.TAX_FLAG, '1')-PRC.SAL_COST_PRC)/DPS.FN_GET_SALE_PRICE('', DPS.FN_GET_ROUND_PROC(DPS.FN_GET_ROUND_FLAG(PRC.STR_CD, PBN.VEN_CD), DPS.FN_GET_SALE_PRICE(?, PRC.SALE_PRC, ?, PBN.TAX_FLAG, '0'),0), 0, PBN.TAX_FLAG, '1') * 100,3)
                                         ELSE PRC.SALE_MG_RATE
                                    END 
                        END                AS NEW_SALE_MG_RATE
                      , CASE WHEN ? > PRC.APP_S_DT AND TO_CHAR(SYSDATE,'YYYYMMDD') >= PRC.APP_S_DT THEN '1' ELSE '0' END AS EDIT_FLAG
                   FROM DPS.PC_STRSKUPRCMST PRC
                      , DPS.PC_SKUMST       SKU
                      , DPS.PC_PBNMST       PBN
                  WHERE PRC.SKU_CD    = SKU.SKU_CD
                    AND SKU.PUMBUN_CD = PBN.PUMBUN_CD
                    AND PRC.EVENT_CD  = '00000000000'
                    AND PRC.APP_E_DT  = '99991231'
                    AND SKU.PUMBUN_CD = ?
                    AND PRC.STR_CD    = ?
                    AND PRC.SKU_CD    = ?
               ) Y
            ON X.STR_CD = Y.STR_CD
           AND X.SKU_CD = Y.SKU_CD
        ]]>
    </query>
    
    <!-- 단품가격예약정보 신규입력  -->    
    <query name="INS_SKUPRC">    
        <![CDATA[
        INSERT INTO DPS.PC_STRSKUPRCMST( STR_CD       
                                       , SKU_CD     
                                       , EVENT_CD   
                                       , APP_S_DT
                                       , APP_E_DT
                                       , NORM_COST_PRC
                                       , NORM_SALE_PRC
                                       , NORM_MG_RATE
                                       , SAL_COST_PRC
                                       , SALE_PRC
                                       , SALE_MG_RATE
                                       , REDU_RATE
                                       , REG_DATE    
                                       , REG_ID         
                                       , MOD_DATE   
                                       , MOD_ID )
                                VALUES ( ?    
                                       , ?         
                                       , '00000000000'
                                       , ?
                                       , '99991231'
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , ?
                                       , 0
                                       , SYSDATE
                                       , ?
                                       , SYSDATE
                                       , ? )                                                                
        ]]>
    </query>
    
    <!-- 단품가격예약정보 적용종료일 변경  -->    
    <query name="UPD_SKUPRC">    
        <![CDATA[
        UPDATE DPS.PC_STRSKUPRCMST
               SET APP_E_DT = ?
                 , MOD_DATE = SYSDATE
                 , MOD_ID   = ?
             WHERE STR_CD   = ?
               AND SKU_CD   = ?
               AND EVENT_CD = '00000000000'
               AND APP_S_DT = ?
        ]]>
    </query>
    
    <!-- 마진율 체크  MARIO OUTLET START 2011-08-11 -->
    <query name="SEL_PC_MARGINMST_CHECK">
        <![CDATA[
            SELECT  COUNT(*) AS CNT
              FROM DPS.PC_MARGINMST
             WHERE STR_CD = ?
               AND PUMBUN_CD = ?
               AND NORM_MG_RATE = ?
               AND MG_FLAG    = '0'
               AND EVENT_CD   = '00000000000'    
               AND ? BETWEEN APP_S_DT AND APP_E_DT
        ]]>
    </query>
    
</service>