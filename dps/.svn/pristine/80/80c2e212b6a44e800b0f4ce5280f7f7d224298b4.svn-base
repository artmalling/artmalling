<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자    : 박래형
 * 회 사 명    : FKSS
 * 작 성 일    : 2010.02.10
 * 변 경 일    : 
 * 변경내용 : 
 * 개    요       :  
 --> 
<service name="/pord204.po">
    <!-- 입고/반품  리스트 -->
    <gauce name="H_LIST"> 
        <column colName="CHECK1"               colType="TB_STRING"    size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SLIP_NO"              colType="TB_STRING"    size="12"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="STR_CD"               colType="TB_STRING"    size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="STR_NM"               colType="TB_STRING"    size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SLIP_FLAG"            colType="TB_STRING"    size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SLIP_FLAG_NM"         colType="TB_STRING"    size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORD_DT"               colType="TB_STRING"    size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SLIP_PROC_STAT"       colType="TB_STRING"    size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SLIP_PROC_STAT_NM"    colType="TB_STRING"    size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REJ_CAN_FLAG"         colType="TB_STRING"    size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CHK_DT"               colType="TB_STRING"    size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_CD"           colType="TB_STRING"     size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_NM"           colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="VEN_CD"              colType="TB_STRING"     size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="VEN_NM"              colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COST_TAMT"           colType="TB_DECIMAL"    size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_TAMT"           colType="TB_DECIMAL"    size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>                                   
                                               
    <!-- 매입발주 MASTER -->                       
    <gauce name="H_MASTER">                    
        <column colName="STR_CD"               colType="TB_STRING"    size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STR_NM"               colType="TB_STRING"    size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SLIP_NO"              colType="TB_STRING"    size="12"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_CD"            colType="TB_STRING"    size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="PUMBUN_NM"            colType="TB_STRING"    size="20"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="VEN_CD"               colType="TB_STRING"    size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="VEN_NM"               colType="TB_STRING"    size="20"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="MG_APP_DT"            colType="TB_STRING"    size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="EVENT_FLAG"           colType="TB_STRING"    size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="EVENT_FLAG_NM"        colType="TB_STRING"    size="20"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="EVENT_RATE"           colType="TB_STRING"    size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="SLIP_FLAG"            colType="TB_STRING"    size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="SLIP_FLAG_NM"         colType="TB_STRING"    size="20"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="ORD_OWN_FLAG"         colType="TB_STRING"    size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="ORD_OWN_FLAG_NM"      colType="TB_STRING"    size="30"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="ORD_FLAG"             colType="TB_STRING"    size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="AFT_ORD_FLAG"         colType="TB_STRING"    size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="ORD_DT"               colType="TB_STRING"    size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="DELI_DT"              colType="TB_STRING"    size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CHK_DT"               colType="TB_STRING"    size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SM_CONF_DT"           colType="TB_STRING"    size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SM_ID"                colType="TB_STRING"    size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BUYER_CONF_ID"        colType="TB_STRING"    size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORD_CONF_DT"          colType="TB_STRING"    size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />      
        <column colName="BUYER_CD"             colType="TB_STRING"    size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BUYER_NM"             colType="TB_STRING"    size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />      
        <column colName="ACC_CONF_DT"          colType="TB_STRING"    size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />        
        <column colName="SLIP_PROC_STAT"       colType="TB_STRING"    size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />      
        <column colName="SLIP_PROC_STAT_NM"    colType="TB_STRING"    size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />      
        <column colName="DTL_CNT"              colType="TB_DECIMAL"   size="3"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORD_TOT_QTY"          colType="TB_DECIMAL"   size="9"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NEW_COST_TAMT"        colType="TB_DECIMAL"   size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NEW_SALE_TAMT"        colType="TB_DECIMAL"   size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="GAP_TOT_AMT"          colType="TB_DECIMAL"   size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NEW_GAP_RATE"         colType="TB_DECIMAL"   size="5"    dec="2" keyType="TB_NORMAL" roundMode="ROUND" />      
        <column colName="PAY_COND"             colType="TB_STRING"    size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="VAT_TAMT"             colType="TB_DECIMAL"   size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />      
        <column colName="REMARK"               colType="TB_STRING"    size="100"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />      
        <column colName="BIZ_TYPE"             colType="TB_STRING"    size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAX_FLAG"             colType="TB_STRING"    size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAX_FLAG_NM"          colType="TB_STRING"    size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REG_DATE"             colType="TB_STRING"    size="20"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REG_ID"               colType="TB_STRING"    size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_DATE"             colType="TB_STRING"    size="20"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_ID"               colType="TB_STRING"    size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORD_CF_DT"            colType="TB_STRING"    size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />         
        <column colName="MG_RATE"              colType="TB_DECIMAL"   size="5"    dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <!-- 매입발주 Detail -->   
    <gauce name="H_DETAIL"> 
         <column colName="STR_CD"              colType="TB_STRING"    size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="SLIP_NO"             colType="TB_STRING"    size="12"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="ORD_SEQ_NO"          colType="TB_DECIMAL"   size="3"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="PUMMOK_CD"           colType="TB_STRING"    size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />   
         <column colName="PUMMOK_NM"           colType="TB_STRING"    size="20"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="ORD_UNIT_CD"         colType="TB_STRING"    size="3"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                            
         <column colName="MG_RATE"             colType="TB_DECIMAL"   size="5"    dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="SLIP_FLAG"           colType="TB_STRING"    size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="ORD_QTY"             colType="TB_DECIMAL"   size="9"    dec="1" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="CHK_QTY"             colType="TB_DECIMAL"   size="9"    dec="1" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="VAT_AMT"             colType="TB_DECIMAL"   size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="NEW_GAP_RATE"        colType="TB_DECIMAL"   size="5"    dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="NEW_GAP_AMT"         colType="TB_DECIMAL"   size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="NEW_COST_PRC"        colType="TB_DECIMAL"   size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                           
         <column colName="NEW_COST_AMT"        colType="TB_DECIMAL"   size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                           
         <column colName="NEW_SALE_PRC"        colType="TB_DECIMAL"   size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                           
         <column colName="NEW_SALE_AMT"        colType="TB_DECIMAL"   size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                                
         <column colName="PUMBUN_CD"           colType="TB_STRING"    size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
         <column colName="VEN_CD"              colType="TB_STRING"    size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
         <column colName="TAG_FLAG"            colType="TB_STRING"    size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
         <column colName="TAG_FLAG_NM"         colType="TB_STRING"    size="30"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                               
         <column colName="TAG_PRT_OWN_FLAG"    colType="TB_STRING"    size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                               
         <column colName="TAG_PRT_OWN_FLAG_NM" colType="TB_STRING"    size="20"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                       
    </gauce>
    
    <gauce name="H_CHK_SLIP_FLAG"> 
        <column colName="SLIP_NO"             colType="TB_STRING"     size="12"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SLIP_PROC_STAT"      colType="TB_STRING"     size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
    </gauce>
    
    <!-- 행사구분 --> 
    <gauce name="H_MARGIN_FLAG"> 
        <column colName="EVENT_FLAG"          colType="TB_STRING"     size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="EVENT_FLAG_NM"       colType="TB_STRING"     size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
    </gauce>                                                                      
                                                                                  
    <!-- 행사율-->                                                                   
    <gauce name="H_MARGIN_RATE">                                                  
        <column colName="EVENT_RATE"          colType="TB_STRING"     size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="EVENT_RATE_NM"       colType="TB_STRING"     size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="NORM_MG_RATE"        colType="TB_STRING"     size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
    </gauce>                                                                      
    
    <!-- 품목코드 정보--> 
    <gauce name="H_PUMMOK_INFO">
        <column colName="PUMMOK_CD"           colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <gauce name="H_MG_RATE"> 
        <column colName="RETURN_INT"          colType="TB_STRING"     size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="RETURN_MESSAGE"      colType="TB_STRING"     size="100"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
    </gauce>  
    
    <!-- 대금지불 마감 체크 -->
    <gauce name="H_PAY_CLOSE_CHK"> 
        <column colName="RET_FLAG"            colType="TB_STRING"     size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
    </gauce>  
    
    <!-- 세금계산서발행여부 -->
    <gauce name="H_TAX_YN"> 
        <column colName="TAX_YN_FLAG"         colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
    </gauce>  
    
    <!-- 품목 매입발주  리스트 조회 -->
    <query name="SEL_LIST">
        <![CDATA[
	        SELECT 'F' AS CHECK1
	             , A.SLIP_NO                                                                         /* 전표번호 */
	             , A.STR_CD                                                                          /* 점코드 */
	             , DPS.FN_GET_STORE_NAME(A.STR_CD) AS STR_NM                                         /* 점명 */
	             , A.SLIP_FLAG                                                                       /* 전표구분 */
	             , COM.FN_GET_COMM_NAME('D', 'P201', A.SLIP_FLAG) AS  SLIP_FLAG_NM                   /* 전표구분명 */
	             , A.ORD_DT                                                                          /* 발주일자(점출일, 시행일) */
	             , A.SLIP_PROC_STAT                                                                  /* 전표진행상태 */
	             , COM.FN_GET_COMM_NAME('D', 'P207', A.SLIP_PROC_STAT) AS  SLIP_PROC_STAT_NM         /* 전표진행상태명 */
                 , A.REJ_CAN_FLAG  
                 , A.CHK_DT  
                 , A.PUMBUN_CD
                 , DPS.FN_GET_PUMBUN_NAME(A.PUMBUN_CD) AS PUMBUN_NM                                  /* 품번명 */
                 , A.VEN_CD
                 , DPS.FN_GET_VENDOR_NAME(A.VEN_CD)    AS VEN_NM                                     /* 협력사명 */
                 , A.COST_TAMT
                 , A.SALE_TAMT
	        FROM (    
	              SELECT SLP.SLIP_NO                                                                        
	                   , SLP.STR_CD                                                                          
	                   , SLP.SLIP_FLAG                                                                      
	                   , SLP.ORD_DT                          
	                   , SLP.DELI_DT                        
	                   , SLP.SLIP_PROC_STAT                                                                  
	                   , (CASE PBN.BIZ_TYPE WHEN '1' THEN SLP.ORD_CONF_DT 
	                                        WHEN '2' THEN SLP.BTEAM_CONF_DT END) AS CONF_DT
	                   , PBN.SALE_ORG_CD
	                   , PBN.BUY_ORG_CD
                       , SLP.REJ_CAN_FLAG
                       , DECODE(SLP.SLIP_PROC_STAT, '09',SLP.CHK_DT,DPS.FN_GET_CHK_CONF_DT( SLP.AFT_ORD_FLAG)) AS CHK_DT
                       , SLP.ORD_CF_DT
                       , SLP.PUMBUN_CD
                       , SLP.VEN_CD
                       , SUM(DECODE(SLP.SLIP_PROC_STAT, '09', SLP.CHK_COST_TAMT, SLP.NEW_COST_TAMT))    
                         *
                         (CASE WHEN SLP.SLIP_FLAG IN('A','D','F','G') THEN 1 
                                                                        ELSE (-1) 
                         END)
                       AS COST_TAMT
                       , SUM(DECODE(SLP.SLIP_PROC_STAT, '09', SLP.CHK_SALE_TAMT, SLP.NEW_SALE_TAMT))    
                         *
                         (CASE WHEN SLP.SLIP_FLAG IN('A','D','F','G') THEN 1 
                                                                        ELSE (-1) 
                         END)
                       AS SALE_TAMT
	                FROM  DPS.PO_SLPMST SLP, DPS.PC_STRPBN PBN
	               WHERE 
	               /*( ( SLP.SLIP_FLAG = 'A' 
	                 AND SLP.SLIP_PROC_STAT IN (SELECT COMM_CODE 
	                                              FROM COM.TC_COMMCODE
	                                             WHERE COMM_PART = 'P207'
	                                               AND COMM_CODE BETWEEN  DPS.FN_CONF_RANGE('2','A','09')   AND '09'  ))
	                 OR (SLP.SLIP_FLAG = 'B' 
	                 AND SLP.SLIP_PROC_STAT IN (SELECT COMM_CODE 
	                                              FROM COM.TC_COMMCODE
	                                             WHERE COMM_PART = 'P207'
	                                               AND COMM_CODE BETWEEN  DPS.FN_CONF_RANGE('2','B','09')   AND '09'  )))
	                 AND*/
	                 
	                  SLP.DEL_FLAG  = 'N'
	                 AND PBN.SKU_FLAG  = '2' 
                     AND SLP.IMPORT_FLAG  = '0'  
                     AND SLP.AUTO_SLIP_FLAG = '0'
	                 AND SLP.STR_CD    = PBN.STR_CD
	                 AND SLP.PUMBUN_CD = PBN.PUMBUN_CD
	                 AND SLP.SLIP_PROC_STAT LIKE '%' || DECODE(?,'Y','09') || '%'
	                 AND SLP.PUMBUN_CD      LIKE '%' || ? || '%'
	                 AND SLP.VEN_CD         LIKE '%' || ? || '%'
	                 AND SLP.SLIP_FLAG      LIKE '%' || ? || '%'
	                 AND EXISTS ( SELECT MYORG.USER_ID
	                                FROM COM.V_MYORG MYORG
	                               WHERE MYORG.STR_CD      = SLP.STR_CD
	                                 AND MYORG.PUMBUN_CD   = SLP.PUMBUN_CD
	                                 AND MYORG.USER_ID     = ?
	                                 AND ROWNUM            = 1
	                                 AND MYORG.ORG_FLAG    = ?
	                             )
                   GROUP BY SLP.SLIP_NO                                                                        
                          , SLP.STR_CD                                                                          
                          , SLP.SLIP_FLAG                                                                      
                          , SLP.ORD_DT                          
                          , SLP.DELI_DT                                                  
                          , SLP.SLIP_PROC_STAT                                                                  
                          , (CASE PBN.BIZ_TYPE WHEN '1' THEN SLP.ORD_CONF_DT 
                                               WHEN '2' THEN SLP.BTEAM_CONF_DT END)
                          , PBN.SALE_ORG_CD
                          , PBN.BUY_ORG_CD
                          , SLP.REJ_CAN_FLAG
                          , DECODE(SLP.SLIP_PROC_STAT, '09',SLP.CHK_DT,DPS.FN_GET_CHK_CONF_DT( SLP.AFT_ORD_FLAG)) 
                          , SLP.ORD_CF_DT
                          , SLP.PUMBUN_CD
                          , SLP.VEN_CD
	                ) A
        ]]>
    </query> 
    
    <!-- 품목 검품확정  전표 조회 -->
    <query name="SEL_SLIP_NO">
        <![CDATA[
	         SELECT 'F' AS CHECK1
	                 , A.SLIP_NO                                                                         /* 전표번호 */
	                 , A.STR_CD                                                                          /* 점코드 */
	                 , DPS.FN_GET_STORE_NAME(A.STR_CD) AS STR_NM                                         /* 점명 */
	                 , A.SLIP_FLAG                                                                       /* 전표구분 */
	                 , COM.FN_GET_COMM_NAME('D', 'P201', A.SLIP_FLAG) AS  SLIP_FLAG_NM                   /* 전표구분명 */
	                 , A.ORD_DT                                                                          /* 발주일자(점출일, 시행일) */
	                 , A.SLIP_PROC_STAT                                                                  /* 전표진행상태 */
	                 , COM.FN_GET_COMM_NAME('D', 'P207', A.SLIP_PROC_STAT) AS  SLIP_PROC_STAT_NM         /* 전표진행상태명 */
	                 , A.REJ_CAN_FLAG  
	                 , A.CHK_DT  
	                 , A.PUMBUN_CD
	                 , DPS.FN_GET_PUMBUN_NAME(A.PUMBUN_CD) AS PUMBUN_NM                                  /* 품번명 */
	                 , A.VEN_CD
	                 , DPS.FN_GET_VENDOR_NAME(A.VEN_CD)    AS VEN_NM                                     /* 협력사명 */
	                 , A.COST_TAMT
	                 , A.SALE_TAMT
	            FROM (    
	                  SELECT SLP.SLIP_NO                                                                        
	                       , SLP.STR_CD                                                                          
	                       , SLP.SLIP_FLAG                                                                      
	                       , SLP.ORD_DT                          
	                       , SLP.DELI_DT                         
	                       , SLP.SLIP_PROC_STAT                                                                  
	                       , (CASE PBN.BIZ_TYPE WHEN '1' THEN SLP.ORD_CONF_DT 
	                                            WHEN '2' THEN SLP.BTEAM_CONF_DT END) AS CONF_DT
	                       , PBN.SALE_ORG_CD
	                       , PBN.BUY_ORG_CD
	                       , SLP.REJ_CAN_FLAG
	                       , DECODE(SLP.SLIP_PROC_STAT, '09',SLP.CHK_DT,DPS.FN_GET_CHK_CONF_DT( SLP.AFT_ORD_FLAG)) AS CHK_DT
	                       , SLP.PUMBUN_CD
	                       , SLP.VEN_CD
	                       , SUM(DECODE(SLP.SLIP_PROC_STAT, '09', SLP.CHK_COST_TAMT, SLP.NEW_COST_TAMT))    
                         *
                         (CASE WHEN SLP.SLIP_FLAG IN('A','D','F','G') THEN 1 
                                                                        ELSE (-1) 
                         END)
	                       AS COST_TAMT
	                       , SUM(DECODE(SLP.SLIP_PROC_STAT, '09', SLP.CHK_SALE_TAMT, SLP.NEW_SALE_TAMT))    
                         *
                         (CASE WHEN SLP.SLIP_FLAG IN('A','D','F','G') THEN 1 
                                                                        ELSE (-1) 
                         END)
	                       AS SALE_TAMT
	                    FROM  DPS.PO_SLPMST SLP, DPS.PC_STRPBN PBN
	                   WHERE ( ( SLP.SLIP_FLAG = 'A' 
	                     AND SLP.SLIP_PROC_STAT IN (SELECT COMM_CODE 
	                                                  FROM COM.TC_COMMCODE
	                                                 WHERE COMM_PART = 'P207'
	                                                   AND COMM_CODE BETWEEN  DPS.FN_CONF_RANGE('2','A','09')   AND '09'  ))
	                     OR (SLP.SLIP_FLAG = 'B' 
	                     AND SLP.SLIP_PROC_STAT IN (SELECT COMM_CODE 
	                                                  FROM COM.TC_COMMCODE
	                                                 WHERE COMM_PART = 'P207'
	                                                   AND COMM_CODE BETWEEN  DPS.FN_CONF_RANGE('2','B','09')   AND '09'  )))
	                     AND SLP.DEL_FLAG  = 'N'
	                     AND PBN.SKU_FLAG  = '2' 
                         AND SLP.IMPORT_FLAG  = '0'  
                         AND SLP.AUTO_SLIP_FLAG = '0'
	                     AND SLP.STR_CD    = PBN.STR_CD
	                     AND SLP.PUMBUN_CD = PBN.PUMBUN_CD
	                     AND SLP.STR_CD    = ?
	                     AND SLP.SLIP_NO   = ?
	                     AND EXISTS ( SELECT MYORG.USER_ID
	                                    FROM COM.V_MYORG MYORG
	                                   WHERE MYORG.STR_CD      = SLP.STR_CD
	                                     AND MYORG.PUMBUN_CD   = SLP.PUMBUN_CD
	                                     AND MYORG.USER_ID     = ?
	                                     AND ROWNUM            = 1
	                                     AND MYORG.ORG_FLAG    = ?
	                                 )
                   GROUP BY SLP.SLIP_NO                                                                        
                          , SLP.STR_CD                                                                          
                          , SLP.SLIP_FLAG                                                                      
                          , SLP.ORD_DT                          
                          , SLP.DELI_DT                                                  
                          , SLP.SLIP_PROC_STAT                                                                  
                          , (CASE PBN.BIZ_TYPE WHEN '1' THEN SLP.ORD_CONF_DT 
                                               WHEN '2' THEN SLP.BTEAM_CONF_DT END)
                          , PBN.SALE_ORG_CD
                          , PBN.BUY_ORG_CD
                          , SLP.REJ_CAN_FLAG
                          , DECODE(SLP.SLIP_PROC_STAT, '09',SLP.CHK_DT,DPS.FN_GET_CHK_CONF_DT( SLP.AFT_ORD_FLAG)) 
                          , SLP.ORD_CF_DT
                          , SLP.PUMBUN_CD
                          , SLP.VEN_CD
	                    ) A
        ]]>
    </query>
    
     <query name="SEL_BUY_ORG_CD">
        <![CDATA[
               WHERE  A.BUY_ORG_CD   LIKE ? || '%'
        ]]>
    </query>
    <query name="SEL_SALE_ORG_CD">
        <![CDATA[
               WHERE A.SALE_ORG_CD   LIKE ? || '%'
        ]]>
    </query>
     <query name="SEL_NON_CONF">
        <![CDATA[
               AND  A.SLIP_PROC_STAT   <>  '09'
        ]]>
    </query>
    <query name="SEL_ORD_DT">
        <![CDATA[
               AND A.ORD_DT BETWEEN ? AND ?
        ]]>
    </query>
    <query name="SEL_ORD_CONF">
        <![CDATA[
               AND A.ORD_CF_DT BETWEEN ? AND ?
        ]]>
    </query>
    <query name="SEL_DELI_DT">
        <![CDATA[
               AND A.DELI_DT BETWEEN ? AND ?
        ]]>
    </query>
    <query name="SEL_CHK_DT">
        <![CDATA[
               AND A.CHK_DT BETWEEN ? AND ?
        ]]>
    </query>
    <query name="SEL_ORDERBY">
        <![CDATA[
               AND A.STR_CD = ?
          ORDER BY A.STR_CD, A.SLIP_NO DESC
        ]]>
    </query>
    
    
    <!-- 품목 매입발주  마스터 조회 -->
    <query name="SEL_MASTER">
        <![CDATA[
            SELECT A.STR_CD           
                 , DPS.FN_GET_STORE_NAME(STR_CD) AS STR_NM                  
                 , A.SLIP_NO          
                 , A.PUMBUN_CD        
                 , DPS.FN_GET_PUMBUN_NAME(A.PUMBUN_CD) AS PUMBUN_NM    
                 , A.VEN_CD           
                 , DPS.FN_GET_VENDOR_NAME(A.VEN_CD) AS VEN_NM   
                 , A.MG_APP_DT                     
                 , A.EVENT_FLAG      
                 , A.EVENT_FLAG     AS EVENT_FLAG_NM
                 , A.EVENT_RATE  
                 , A.SLIP_FLAG        
                 , COM.FN_GET_COMM_NAME('D', 'P201', A.SLIP_FLAG)  AS  SLIP_FLAG_NM                /* 전표구분명 */
                 , A.ORD_OWN_FLAG
                 , COM.FN_GET_COMM_NAME('D', 'P202', ORD_OWN_FLAG) AS ORD_OWN_FLAG_NM              /* 발주주체구분명 */
                 , A.ORD_FLAG
                 , A.AFT_ORD_FLAG   
                 , A.ORD_DT           
                 , A.DELI_DT 
                 , DECODE(A.SLIP_PROC_STAT, '09',A.CHK_DT,DPS.FN_GET_CHK_CONF_DT( A.AFT_ORD_FLAG))AS CHK_DT   /*검품확정일*/  
                 , A.SM_CONF_DT      
                 , A.SM_ID      
                 , A.BUYER_CONF_ID  
                 , A.ORD_CONF_DT  
                 , A.BUYER_CD        
                 , DPS.FN_GET_BUYER_NAME(A.BUYER_CD) AS BUYER_NM  
                 , A.ACC_CONF_DT 
                 , A.SLIP_PROC_STAT 
                 , COM.FN_GET_COMM_NAME('D', 'P207', SLIP_PROC_STAT) AS  SLIP_PROC_STAT_NM         /* 전표진행상태명 */
                 , A.DTL_CNT 
                 , DECODE(A.SLIP_PROC_STAT, '09', A.CHK_TOT_QTY, A.ORD_TOT_QTY) AS ORD_TOT_QTY               /* 발주수량합(검품확정'09'일경우 검품수량합) */
                 , DECODE(A.SLIP_PROC_STAT, '09', A.CHK_COST_TAMT, A.NEW_COST_TAMT) AS NEW_COST_TAMT         /* 신원가금액합(검품확정'09'일경우 검품원가금액합) */
                 , DECODE(A.SLIP_PROC_STAT, '09', A.CHK_SALE_TAMT, A.NEW_SALE_TAMT) AS NEW_SALE_TAMT         /* 신매가금액합(검품확정'09'일경우 검품매가금액합) */
                 , DECODE(A.SLIP_PROC_STAT, '09', A.CHK_GAP_AMT, A.GAP_TOT_AMT) AS GAP_TOT_AMT               /* 차익액합(검품확정'09'일경우 검품차익액합) */
                 , DECODE(A.SLIP_PROC_STAT, '09', A.CHK_GAP_RATE, A.NEW_GAP_RATE) AS NEW_GAP_RATE            /* 신차익율(검품확정'09'일경우 검품차익율) */          
                 , A.PAY_COND 
                 , DECODE(A.SLIP_PROC_STAT, '09', A.CHK_VAT_TAMT, A.VAT_TAMT) AS VAT_TAMT                /* 부가세합 */  
                 , A.REMARK    
                 , A.BIZ_TYPE          
                 , A.TAX_FLAG
                 , COM.FN_GET_COMM_NAME('D', 'P004', TAX_FLAG) AS TAX_FLAG_NM                      /* 과세구분명 */                   
                 , TO_CHAR(A.REG_DATE, 'YYYYMMDD')             AS REG_DATE        
                 , A.REG_ID          
                 , A.MOD_DATE        
                 , A.MOD_ID           
                 , A.ORD_CF_DT 
                 , (
                    SELECT MAX(MG_RATE)
                      FROM DPS.PO_SLPDTL B
                     WHERE B.STR_CD  = A.STR_CD
                       AND B.SLIP_NO = A.SLIP_NO  
                    )              AS MG_RATE      
              FROM DPS.PO_SLPMST   A            
             WHERE A.STR_CD  = ?
               AND A.SLIP_NO = ? 
        ]]>
    </query> 
    
    <!-- 품목 매입발주 디테일 조회 -->
    <query name="SEL_DETAIL">
        <![CDATA[
            SELECT DTL.STR_CD                                                                                  /*점코드*/
                 , DTL.SLIP_NO                                                                                 /*전표번호*/
                 , DTL.ORD_SEQ_NO                                                                              /*전표상세번호*/
                 , DTL.PUMMOK_CD                                                                               /*품목코드*/
                 , DPS.FN_GET_PUMMOK_NAME(DTL.PUMMOK_CD) AS  PUMMOK_NM                                         /*품목코드*/
                 , DTL.ORD_UNIT_CD                                                                             /*발주단위*/
                 , DTL.MG_RATE                                                                                 /*마진율*/
                 , DTL.SLIP_FLAG                                                                               /*전표구분*/
                 , ORD_QTY                                                                                     /* 발주수량 */
                 , DECODE(MST.SLIP_PROC_STAT, '09', DTL.CHK_QTY, DTL.ORD_QTY) AS CHK_QTY                       /* 검품수량*/
                 , DECODE(MST.SLIP_PROC_STAT, '09', DTL.CHK_VAT_AMT, DTL.VAT_AMT) AS VAT_AMT                   /* 부가세 */
                 , DECODE(MST.SLIP_PROC_STAT, '09', DTL.CHK_GAP_RATE, DTL.NEW_GAP_RATE) AS NEW_GAP_RATE        /* 신차익율 */
                 , DECODE(MST.SLIP_PROC_STAT, '09', DTL.CHK_GAP_AMT, DTL.NEW_GAP_AMT) AS NEW_GAP_AMT           /* 신차익액 */
                 , DTL.NEW_COST_PRC                                                                            /*신원가단가*/
                 , DECODE(MST.SLIP_PROC_STAT, '09', DTL.CHK_COST_AMT, DTL.NEW_COST_AMT) AS NEW_COST_AMT        /* 신원가금액 */
                 , DTL.NEW_SALE_PRC                                                                            /*신매가단가*/                              
                 , DECODE(MST.SLIP_PROC_STAT, '09', DTL.CHK_SALE_AMT, DTL.NEW_SALE_AMT) AS NEW_SALE_AMT        /* 신매가금액 */
                 , DTL.PUMBUN_CD                                                                               /*품번*/
                 , DTL.VEN_CD                                                                                  /*협력사*/
                 , DTL.TAG_FLAG                                                                                /*택구분*/
                 , DTL.TAG_FLAG         AS TAG_FLAG_NM                                                         /*택구분명*/
                 , DTL.TAG_PRT_OWN_FLAG                                                                        /*택발행주체*/
                 , DTL.TAG_PRT_OWN_FLAG AS TAG_PRT_OWN_FLAG_NM                                                 /*택발행주체명*/
              FROM DPS.PO_SLPDTL DTL
                 , DPS.PO_SLPMST MST
             WHERE DTL.STR_CD  = MST.STR_CD
               AND DTL.SLIP_NO = MST.SLIP_NO
               AND DTL.STR_CD = ?
               AND DTL.SLIP_NO = ?
        ]]>
    </query> 
    
      <!-- DB 현재전표진행상태 -->
    <query name="SEL_SLIP_FLAG">
        <![CDATA[
            SELECT SLIP_NO
                 , SLIP_PROC_STAT
              FROM DPS.PO_SLPMST
             WHERE STR_CD = ?
               AND SLIP_NO = ?
        ]]>
    </query>  
    
   
  <!-- 품목 매입발주 MASTER 검품 확정 업데이트  -->
    <query name="UPD_MASTER_CONF">
        <![CDATA[
             UPDATE DPS.PO_SLPMST                                   
               SET SLIP_PROC_STAT = '09'                           
                 , ORD_CF_DT    = ? /*발주확정일*/                    
                 , CHK_DT    = ? /*검품확정일*/                    
                 , CHK_CONF_ID    = ? /*검품자ID*/                 
                 , CHK_TOT_QTY    = ? /*검품수량*/                 
                 , CHK_GAP_AMT    = ? /*검품차익액*/               
                 , CHK_GAP_RATE   = ? /*검품차익율*/               
                 , CHK_COST_TAMT  = ? /*검품원가금액합*/           
                 , CHK_SALE_TAMT  = ? /*검품매가금액합*/
                 , CHK_VAT_TAMT   = ? /*검품 부가세액 합 */           
                 , CHK_SYS_DT     = TO_CHAR(SYSDATE,'YYYYMMDD') /*검품시스템일자*/ 
                 , REJ_CAN_FLAG   = DECODE(REJ_CAN_STAT, '09', '0', REJ_CAN_FLAG)   
                 , REJ_CAN_STAT   = DECODE(REJ_CAN_STAT, '09', '', REJ_CAN_STAT)
                 , MOD_ID         = ?
                 , MOD_DATE       = SYSDATE          
             WHERE STR_CD         = ?                              
               AND SLIP_NO        = ?  
        ]]>
    </query>   
    
      <!-- 품목 매입발주 MASTER 검품확정취소 업데이트  -->
    <query name="UPD_MASTER_CONF1">
        <![CDATA[
            UPDATE DPS.PO_SLPMST                                               
               SET SLIP_PROC_STAT = '00'                                     
                 , CHK_CAN_DT     = TO_CHAR(SYSDATE,'YYYYMMDD')                                          
                 , CHK_CAN_ID     = ?                                          
                 , CHK_DT         = '        '                                 
                 , CHK_CONF_ID    = NULL                                       
                 , ACC_CONF_DT    = '        '                                 
                 , ACC_CONF_ID    = NULL                                        
                 , ORD_CONF_DT    = '        '                                
                 , BUYER_CONF_ID  = NULL                                      
                 , SM_CONF_DT     = '        '                                 
                 , SM_ID          = NULL                                      
                 , CHK_TOT_QTY    = 0 /*검품수량*/                             
                 , CHK_GAP_AMT    = 0 /*검품차익액*/                           
                 , CHK_GAP_RATE   = 0 /*검품차익율*/                           
                 , CHK_COST_TAMT  = 0 /*검품원가금액합*/
                 , CHK_SALE_TAMT  = 0 /*검품매가금액합*/
                 , CHK_VAT_TAMT   = 0 /*검품 부가세액 합 */    
                 , REJ_CAN_FLAG   = DECODE(SLIP_PROC_STAT, '09', '2', '1')
                 , REJ_CAN_STAT   = '09'    
                 , ORD_CF_DT      = '        '                
                 , MOD_ID         = ?
                 , MOD_DATE       = SYSDATE   
             WHERE STR_CD         = ?    
               AND SLIP_NO        = ?    
        ]]>
    </query>  
     <!-- 품목 매입발주DETAIL 검품 확정 업데이트  -->
    <query name="UPD_DETAIL_CONF">
        <![CDATA[
             UPDATE DPS.PO_SLPDTL                                   
               SET CHK_QTY        = ? /*검품수량*/                 
                 , CHK_GAP_AMT    = ? /*검품차익액*/               
                 , CHK_GAP_RATE   = ? /*검품차익율*/               
                 , CHK_COST_AMT   = ? /*검품원가금액*/              
                 , CHK_SALE_AMT   = ? /*검품매가금액*/
                 , CHK_VAT_AMT    = ? /*검품 부가세액  */  
                 , MOD_ID         = ?
                 , MOD_DATE       = SYSDATE            
             WHERE STR_CD         = ?                              
               AND SLIP_NO        = ?                              
               AND ORD_SEQ_NO     = ?  
        ]]>
    </query>   
    
      <!-- 품목 매입발주 DETAIL 검품확정취소 업데이트  -->
    <query name="UPD_DETAIL_CONF1">
        <![CDATA[
            UPDATE DPS.PO_SLPDTL                                   
               SET BF_CHK_QTY     = ? /*검품취소전 수량*/          
                 , CHK_QTY        = 0 /*검품수량*/                 
                 , CHK_GAP_AMT    = 0 /*검품차익액*/               
                 , CHK_GAP_RATE   = 0 /*검품차익율*/               
                 , CHK_COST_AMT   = 0 /*검품원가금액*/              
                 , CHK_SALE_AMT   = 0 /*검품매가금액*/
                 , CHK_VAT_AMT    = 0 /*검품 부가세액  */ 
                 , MOD_ID          = ?
                 , MOD_DATE        = SYSDATE              
             WHERE STR_CD         = ?                              
               AND SLIP_NO        = ?                              
               AND ORD_SEQ_NO     = ?       
        ]]>
    </query>    
    
      <!-- 품목  매입발주 LOG 전표진행 업데이트 -->
    <query name="UPD_SLPMSTLG_CONF">
        <![CDATA[
            UPDATE DPS.PO_SLPMSTLG
               SET SLIP_PROC_STAT = ?
             WHERE STR_CD = ?
               AND SLIP_NO = ?
        ]]>
    </query>          
     
    <!-- 품목코드 조회-->
    <query name="SEL_PUMMOK_INFO">
        <![CDATA[
           SELECT A.PUMMOK_CD
             FROM DPS.PC_PMKMST A
                , DPS.PC_PBNPMK B
            WHERE B.PUMMOK_CD = A.PUMMOK_CD
              AND B.PUMBUN_CD = ?
              AND A.PUMMOK_CD   LIKE ? ||'%' 
        ]]>
    </query>        
     
    <!-- 대금지불 마감체크 -->
    <query name="SEL_PAY_CLOSE_CHK">
        <![CDATA[
            SELECT DPS.FN_GET_PAYCLOSE_CHK(?, ?, ?) AS RET_FLAG
              FROM DUAL
        ]]>
    </query>     
     
    <!-- 세금계산서 발행여부-->
    <query name="SEL_TAX_YN">
        <![CDATA[
			SELECT 'Y'    AS TAX_YN_FLAG 
			  FROM DPS.PO_SLPMST
			 WHERE STR_CD  = ?
			   AND SLIP_NO = ?
			   AND TAX_ISSUE_DT IS NOT NULL
        ]]>
    </query>         
</service>