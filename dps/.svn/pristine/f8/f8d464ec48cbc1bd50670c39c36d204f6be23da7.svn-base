<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 박종은
 * 회 사 명 : 한국후지쯔
 * 작 성 일 : 2010.04.08
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  
 -->
<service name="/psal425.ps">

    <gauce name="H_SEL_MASTER"> 
        <column colName="POS_NO"                  colType="TB_STRING"      size="4"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DEALCNT"                 colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_AMT_TOT"            colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REDU_PRC"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_AMT"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DC_PRC"                  colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NET_SALE_AMT"            colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_PROF_AMT"           colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_DT_S"               colType="TB_STRING"      size="8"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_DT_E"               colType="TB_STRING"      size="8"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STR_CD"                  colType="TB_STRING"      size="2"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="UNIT"    	              colType="TB_DECIMAL"     size="10"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <gauce name="H_SEL_DETAIL"> 
        <column colName="GUBUN"                   colType="TB_STRING"      size="20"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_DT"                 colType="TB_STRING"      size="8"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="POS_NO"                  colType="TB_STRING"      size="4"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TRAN_NO"                 colType="TB_STRING"      size="5"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_AMT_TOT"            colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REDU_PRC"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_AMT"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DC_PRC"                  colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NET_SALE_AMT"            colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="UNIT"    	              colType="TB_DECIMAL"     size="10"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <gauce name="H_SEL_DETAIL2"> 
    	<column colName="STR_CD"                  colType="TB_STRING"      size="2"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    	<column colName="POS_NO"                  colType="TB_STRING"      size="4"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_CD"               colType="TB_STRING"      size="6"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_NAME"             colType="TB_STRING"      size="40"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TOT_SALE_AMT"            colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REDU_AMT"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NORM_SALE_AMT"           colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DC_AMT"                  colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NET_SALE_AMT"            colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUST_CNT"                colType="TB_DECIMAL"     size="7"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUST_UNIT_PRC"           colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="UNIT"    	              colType="TB_DECIMAL"     size="10"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <gauce name="H_SEL_POSNO"> 
        <column colName="POSNO"                   colType="TB_STRING"      size="4"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <gauce name="H_SEL_POSNOMM"> 
        <column colName="POSNO_MIN"                   colType="TB_STRING"      size="4"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="POSNO_MAX"                   colType="TB_STRING"      size="4"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    
    <!-- 쿼리는 전부 대문자 -->
    
    <query name="SEL_SALE_POS_M">        
        <![CDATA[
			SELECT A.POS_NO
			     , SUM(TRAN_CNT)              AS DEALCNT
			     , SUM(A.SALE_AMT_TOT)   AS SALE_AMT_TOT
			     , SUM(A.REDU_PRC)       AS REDU_PRC
			     , SUM(A.SALE_AMT)       AS SALE_AMT
			     , SUM(A.DC_PRC)         AS DC_PRC
			     , SUM(A.NET_SALE_AMT)   AS NET_SALE_AMT
			     , SUM(A.SALE_PROF_AMT)  AS SALE_PROF_AMT
			     , ?
			     , ?
			     , A.STR_CD
			     , ? 					 AS UNIT
			  FROM (
			        SELECT /*+ index(A IX_PS_DISITEM_01) */ 
			        	   A.SALE_DT
			        	 , A.POS_NO
			             , A.TRAN_NO
			             , (CASE WHEN A.SEQ_NO = 1 THEN 1 ELSE 0 END) TRAN_CNT
			             , (CASE WHEN C.TRAN_FLAG = '0' AND C.TRAN_MODE <> '92' THEN SUM(A.TOT_SALE_AMT_TAX) ELSE  SUM(A.TOT_SALE_AMT_TAX ) *-1 END)                   AS SALE_AMT_TOT
                      	 , (CASE WHEN C.TRAN_FLAG = '0' AND C.TRAN_MODE <> '92' THEN SUM(A.REDU_PRC) ELSE   SUM(A.REDU_PRC)*-1 END)                   AS REDU_PRC
                      	 , (CASE WHEN C.TRAN_FLAG = '0' AND C.TRAN_MODE <> '92' THEN SUM(A.TOT_SALE_AMT_TAX ) - SUM(A.REDU_PRC)  
                         ELSE (SUM(A.TOT_SALE_AMT_TAX) - SUM(A.REDU_PRC))*-1 END)                                                  AS SALE_AMT
                     	 , (CASE WHEN C.TRAN_FLAG = '0' AND C.TRAN_MODE <> '92' THEN SUM(A.DC_PRC)  ELSE   SUM(A.DC_PRC) *-1 END)                     AS DC_PRC
                     	 , (CASE WHEN C.TRAN_FLAG = '0' AND C.TRAN_MODE <> '92' THEN SUM(A.NET_SALE_AMT)  ELSE SUM(A.NET_SALE_AMT)*-1  END)           AS NET_SALE_AMT
                     	 , (CASE WHEN C.TRAN_FLAG = '0' AND C.TRAN_MODE <> '92' THEN SUM(A.SALE_PROF_AMT)  ELSE SUM(A.SALE_PROF_AMT) *-1 END)         AS SALE_PROF_AMT
			             , A.STR_CD
			          FROM DPS.PS_DISITEM A
			             , DPS.PC_ORGMST B
			             , DPS.PS_DISHEADER C
			             , DPS.PC_POSMST D
			         WHERE A.ORG_CD   = B.ORG_CD
			           AND A.SALE_DT       = C.SALE_DT
			           AND A.STR_CD        = C.STR_CD
			           AND A.POS_NO        = C.POS_NO
			           AND A.TRAN_NO       = C.TRAN_NO
			           AND A.STR_CD        = D.STR_CD
			           AND A.POS_NO        = D.POS_NO
			           AND A.STR_CD        LIKE ? || '%'
			           AND D.FLOR_CD       LIKE ? || '%'
			           AND D.POS_FLAG      LIKE ? || '%'
                       AND D.HALL_CD       LIKE ? || '%'
			           AND A.POS_NO        >= ?
			           AND A.POS_NO        <= ?
			           AND A.TRAN_NO       LIKE ? || '%'
			           AND A.SALE_DT       >= ?
			           AND A.SALE_DT       <= ?
			           AND C.TRAN_MODE <> '92'
			           AND C.TRAN_TYPE not IN  ('9') 
			           AND A.REJCT_FLAG     = '0'
			           AND (A.STR_CD,A.PUMBUN_CD) IN 
			           					(SELECT MYORG.STR_CD,MYORG.PUMBUN_CD
                                          FROM COM.V_MYORG MYORG
                                         WHERE MYORG.USER_ID     = ?)
			           
			         GROUP BY 
			         		A.SALE_DT
			             , A.POS_NO
			             , A.TRAN_NO
			             , C.TRAN_FLAG
			             , C.TRAN_MODE
			             , A.STR_CD
			             , A.SEQ_NO
			       ) A
			 GROUP BY
			       A.POS_NO
			     , A.STR_CD
			 ORDER BY
			       A.POS_NO

        ]]>        
    </query>
    
    <query name="SEL_SALE_POS_D">        
        <![CDATA[
            SELECT (CASE WHEN C.TRAN_FLAG = '0' THEN '매출'
                         WHEN C.TRAN_FLAG = '1' THEN '반품'
                         WHEN C.TRAN_FLAG = '2' THEN '오타' ELSE '' END)     AS GUBUN
                 , A.SALE_DT
                 , A.POS_NO
                 , A.TRAN_NO
			     , (CASE WHEN C.TRAN_FLAG = '0' AND C.TRAN_MODE <> '92' THEN SUM(A.TOT_SALE_AMT_TAX) ELSE  SUM(A.TOT_SALE_AMT_TAX) *-1 END)           AS SALE_AMT_TOT
			     , (CASE WHEN C.TRAN_FLAG = '0' AND C.TRAN_MODE <> '92' THEN SUM(A.REDU_PRC * A.SALE_QTY) ELSE   SUM(A.REDU_PRC * A.SALE_QTY)*-1 END) AS REDU_PRC
			     , (CASE WHEN C.TRAN_FLAG = '0' AND C.TRAN_MODE <> '92' THEN SUM(A.TOT_SALE_AMT_TAX) - SUM(A.REDU_PRC * A.SALE_QTY)  
			        ELSE (SUM(A.TOT_SALE_AMT_TAX) - SUM(A.REDU_PRC * A.SALE_QTY))*-1 END)                                                             AS SALE_AMT
			     , (CASE WHEN C.TRAN_FLAG = '0' AND C.TRAN_MODE <> '92' THEN SUM(A.DC_PRC * A.SALE_QTY)  ELSE   SUM(A.DC_PRC * A.SALE_QTY) *-1 END)   AS DC_PRC
			     , (CASE WHEN C.TRAN_FLAG = '0' AND C.TRAN_MODE <> '92' THEN SUM(A.NET_SALE_AMT)  ELSE SUM(A.NET_SALE_AMT)*-1  END)                   AS NET_SALE_AMT
                 , ? AS UNIT
              FROM DPS.PS_DISITEM A
                 , DPS.PC_ORGMST B
                 , DPS.PS_DISHEADER C
                 , DPS.PC_POSMST D
             WHERE A.ORG_CD   = B.ORG_CD
               AND A.SALE_DT       = C.SALE_DT
               AND A.STR_CD        = C.STR_CD
               AND A.POS_NO        = C.POS_NO
               AND A.TRAN_NO       = C.TRAN_NO
               AND A.STR_CD        = D.STR_CD
               AND A.POS_NO        = D.POS_NO
               AND A.STR_CD        LIKE ? || '%'
               AND A.POS_NO        = ?
               AND A.SALE_DT       >= ?
               AND A.SALE_DT       <= ?
               AND C.TRAN_MODE <> '92'
               AND C.TRAN_TYPE not IN  ('9') 
			   AND A.REJCT_FLAG     = '0'
		        AND (A.STR_CD,A.PUMBUN_CD) IN 
		           					(SELECT MYORG.STR_CD,MYORG.PUMBUN_CD
	                                        FROM COM.V_MYORG MYORG
	                                       WHERE MYORG.USER_ID     = ?)
             GROUP BY 
                   C.TRAN_FLAG
                 , A.SALE_DT
                 , A.POS_NO
                 , C.TRAN_MODE
                 , A.TRAN_NO
             ORDER BY
                   A.SALE_DT
                 , A.POS_NO
                 , A.TRAN_NO
               
           
            
        ]]>        
    </query>
    <query name="SEL_SALE_POS_D2">        
        <![CDATA[
  			SELECT 
  					A.STR_CD             AS STR_CD
			     , A.POS_NO             AS POS_NO
			     , A.PUMBUN_CD          AS PUMBUN_CD
			     , MAX(B.PUMBUN_NAME)   AS PUMBUN_NAME
			     , SUM(A.TOT_SALE_AMT)  AS TOT_SALE_AMT
			     , SUM(A.REDU_AMT)      AS REDU_AMT
			     , SUM(A.NORM_SALE_AMT) AS NORM_SALE_AMT
			     , SUM(A.DC_AMT)        AS DC_AMT
			     , SUM(A.NET_SALE_AMT)  AS NET_SALE_AMT
			     , SUM(A.CUST_CNT)      AS CUST_CNT
			     , CASE WHEN SUM(CUST_CNT)= 0 THEN 0 ELSE ROUND(SUM(A.NORM_SALE_AMT)/SUM(A.CUST_CNT),0) END  AS CUST_UNIT_PRC
			     , ? AS UNIT
			  FROM DPS.PS_DAYPBNPOS A
			     , DPS.PC_STRPBN B
			 WHERE A.STR_CD LIKE ? || '%'
			   AND A.SALE_DT >= ?
			   AND A.SALE_DT <= ?
			   AND A.POS_NO = ?
			   AND B.STR_CD = A.STR_CD
			   AND B.PUMBUN_CD = A.PUMBUN_CD 
	           AND (A.STR_CD,A.PUMBUN_CD) IN 
	           					(SELECT MYORG.STR_CD,MYORG.PUMBUN_CD
                                        FROM COM.V_MYORG MYORG
                                       WHERE MYORG.USER_ID     = ?)
			 GROUP BY A.STR_CD
			        , A.POS_NO
			        , A.PUMBUN_CD
            
        ]]>        
    </query>
    
    <query name="SEL_POSNO">        
        <![CDATA[
            SELECT A.POS_NO
              FROM DPS.PC_POSMST A
             WHERE A.POS_NO = ?
        ]]>        
    </query>
    
    <query name="SEL_POSNOMM">        
        <![CDATA[
            SELECT MAX(A.POSNO_MIN) AS POSNO_MIN
                 , MAX(A.POSNO_MAX) AS POSNO_MAX
              FROM (
		            SELECT MIN(A.POS_NO) AS POSNO_MIN
		                 , ''            AS POSNO_MAX
		              FROM DPS.PC_POSMST A
		              
		            UNION ALL
		              
		            SELECT ''            AS POSNO_MIN
		                 , MAX(A.POS_NO) AS POSNO_MAX
		              FROM DPS.PC_POSMST A
		           ) A
        ]]>        
    </query>
    
    
</service>