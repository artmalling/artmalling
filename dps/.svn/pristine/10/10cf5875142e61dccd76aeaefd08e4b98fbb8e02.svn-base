<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 정지인
 * 회 사 명 : 한국후지쯔
 * 작 성 일 : 2010.12.12
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  개발팀에서 기입해주세요
 -->
<service name="/pord302.po">
 
    <!-- 코드  마스터 헤더 -->
    <gauce name="H_SEL_MASTER"> 
        <column colName="CHECK"             colType="TB_STRING"     size="1"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PRT_REQ_SEQ_NO"    colType="TB_DECIMAL"    size="5"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAG_FLAG_NM"       colType="TB_STRING"     size="20"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PRT_REQ_ID"        colType="TB_STRING"     size="10"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PROC_FLAG"         colType="TB_STRING"     size="1"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STR_CD"            colType="TB_STRING"     size="2"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PRT_REQ_DT"        colType="TB_STRING"     size="8"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAG_FLAG"          colType="TB_STRING"     size="2"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SKU_FLAG"          colType="TB_STRING"     size="1"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SKU_TYPE"          colType="TB_STRING"     size="1"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STYLE_TYPE"        colType="TB_STRING"     size="1"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce> 
    
    <!-- 품목 디테일 헤더 -->   
    <gauce name="H_SEL_DETAIL"> 
        <column colName="CHECK1"            colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STR_CD"            colType="TB_STRING"     size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STR_NM"            colType="TB_STRING"     size="50"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PRT_REQ_DT"        colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PRT_REQ_SEQ_NO"    colType="TB_STRING"     size="5"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PRT_DTL_SEQ_NO"    colType="TB_STRING"     size="3"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REQ_CNT"           colType="TB_DECIMAL"    size="9"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_PRC"          colType="TB_DECIMAL"    size="9"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_CD"         colType="TB_STRING"     size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_NM"         colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="VEN_CD"            colType="TB_STRING"     size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="VEN_NM"            colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMMOK_CD"         colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMMOK_NM"         colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PMK_RECP_NM"       colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PBN_RECP_NM"       colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAG_PRT_CNT"       colType="TB_DECIMAL"    size="12"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="EVENT_FLAG"        colType="TB_STRING"     size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="EVENT_RATE"        colType="TB_STRING"     size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMMOK_SRT_CD"     colType="TB_STRING"     size="4"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BIZ_TYPE"          colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BIZ_TYPE_NM"       colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAX_FLAG"          colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAX_FLAG_NM"       colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PRT_YYYY"          colType="TB_STRING"     size="4"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <!-- 단품 디테일 헤더 -->   
    <gauce name="H_SEL_DETAIL2"> 
        <column colName="CHECK1"            colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STR_CD"            colType="TB_STRING"     size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STR_NM"            colType="TB_STRING"     size="50"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PRT_REQ_DT"        colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PRT_REQ_SEQ_NO"    colType="TB_STRING"     size="5"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PRT_DTL_SEQ_NO"    colType="TB_STRING"     size="3"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REQ_CNT"           colType="TB_DECIMAL"    size="9"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_PRC"          colType="TB_DECIMAL"    size="9"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_CD"         colType="TB_STRING"     size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_NM"         colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="VEN_CD"            colType="TB_STRING"     size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="VEN_NM"            colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STYLE_CD"          colType="TB_STRING"     size="54"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COLOR_CD"          colType="TB_STRING"     size="3"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COLOR_NM"          colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SIZE_CD"           colType="TB_STRING"     size="3"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SIZE_NM"           colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMMOK_SRT_CD"     colType="TB_STRING"     size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMMOK_CD"         colType="TB_STRING"     size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMMOK_NM"         colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SKU_CD"            colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SKU_NM"            colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SKU_RECP_NM"       colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PBN_RECP_NM"       colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAG_PRT_CNT"       colType="TB_DECIMAL"    size="12"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SEASON_CD"         colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SEASON_NM"         colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PLAN_YEAR"         colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BIZ_TYPE"          colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BIZ_TYPE_NM"       colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAX_FLAG"          colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAX_FLAG_NM"       colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PRT_YYYY"          colType="TB_STRING"     size="4"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <!-- 코드 조회조건 마스터 조회 쿼리  -->
    <query name="searchMaster">        
        <![CDATA[
            SELECT 'F' AS CHECK1
                 , A.PRT_REQ_SEQ_NO
                 , COMM_NAME1   AS TAG_FLAG_NM
                 , USER_NAME    AS PRT_REQ_ID
                 , A.PROC_FLAG
                 , A.STR_CD
                 , A.PRT_REQ_DT
                 , A.TAG_FLAG
                 , B.SKU_FLAG
                 , NVL(B.SKU_TYPE,'') AS SKU_TYPE
                 , B.STYLE_TYPE
              FROM DPS.PO_TAGRQM A
                 , DPS.PC_PBNMST B
                 , COM.TC_COMMCODE C
                 , COM.TC_USRMST D
             WHERE A.PUMBUN_CD      = B.PUMBUN_CD
               AND A.TAG_FLAG       = C.COMM_CODE
               AND C.COMM_PART      = 'P063'
               AND A.PRT_REQ_ID     = D.USER_ID
               AND A.PROC_FLAG      = ?
               AND A.STR_CD         = ?
               AND A.PRT_REQ_DT     BETWEEN ? AND ?
               AND A.TAG_FLAG       = ?
               AND  EXISTS (
                            SELECT D.PUMBUN_CD
                              FROM COM.V_MYORG D
                             WHERE D.USER_ID = ?
                               AND D.STR_CD  = ?
                               AND D.PUMBUN_CD = A.PUMBUN_CD
                           )
        ]]>        
    </query>         
         
    <!-- 품목 디테일 조회 쿼리  -->            
    <query name="searchDetail">
        <![CDATA[
	          SELECT 'F' AS CHECK1
	                 , A.STR_CD
	                 , DPS.FN_GET_STORE_NAME(A.STR_CD) AS STR_NM
                     , A.PRT_REQ_DT
                     , A.PRT_REQ_SEQ_NO
                     , A.PRT_DTL_SEQ_NO
	                 , A.REQ_CNT 
	                 , A.SALE_PRC 
	                 , B.PUMBUN_CD 
	                 , DPS.FN_GET_PUMBUN_NAME(B.PUMBUN_CD)  AS PUMBUN_NM 
	                 , B.VEN_CD   
	                 , DPS.FN_GET_VENDOR_NAME(B.VEN_CD)     AS VEN_NM
	                 , A.PUMMOK_CD
	                 , DPS.FN_GET_PUMMOK_NAME(A.PUMMOK_CD)  AS PUMMOK_NM      
	                 , C.RECP_NAME                     AS     PMK_RECP_NM               /* 품목 영수증명 */   
	                 , SUBSTRB(D.RECP_NAME, 1, 14)     AS     PBN_RECP_NM               /* 품번 영수증명 */   
	                 , A.TAG_PRT_CNT
	                 , B.EVENT_FLAG             /* 행사구분*/
	                 , B.EVENT_RATE             /* 행사율*/
	                 , C.PUMMOK_SRT_CD          /* 품목단축코드*/
	                 , D.BIZ_TYPE
	                 , SUBSTR(COM.FN_GET_COMM_NAME('D', 'P002', D.BIZ_TYPE), 1, 1) AS BIZ_TYPE_NM  /* 거래형태*/
	                 , D.TAX_FLAG
	                 , COM.FN_GET_COMM_NAME('D', 'P004', D.TAX_FLAG) AS TAX_FLAG_NM  /* 과세구분*/
	                 , B.YYYY AS PRT_YYYY                                            /* 생산년도 */
	              FROM DPS.PO_TAGRQM   B
	                 , DPS.PO_TAGRQD   A
	                 , DPS.PC_PMKMST   C
	                 , DPS.PC_PBNMST   D
	             WHERE A.STR_CD         = B.STR_CD
	               AND A.PRT_REQ_DT     = B.PRT_REQ_DT
	               AND A.PRT_REQ_SEQ_NO = B.PRT_REQ_SEQ_NO
	               AND A.PUMMOK_CD      = C.PUMMOK_CD
	               AND B.PUMBUN_CD      = D.PUMBUN_CD
	               AND A.PRT_REQ_SEQ_NO = ?
	               AND A.STR_CD         = ?
	               AND A.PRT_REQ_DT     = ? 
        ]]>
    </query>  
    
         
    <!-- 단품 디테일 조회 쿼리  -->            
    <query name="searchDetail2">
        <![CDATA[              
             SELECT 'F' AS CHECK1
                     , A.STR_CD
	                 , DPS.FN_GET_STORE_NAME(A.STR_CD) AS STR_NM
                     , A.PRT_REQ_DT
                     , A.PRT_REQ_SEQ_NO
                     , A.PRT_DTL_SEQ_NO
                     , A.REQ_CNT 
                     , A.SALE_PRC 
                     , B.PUMBUN_CD 
                     , DPS.FN_GET_PUMBUN_NAME(B.PUMBUN_CD)  AS PUMBUN_NM 
                     , B.VEN_CD 
                     , DPS.FN_GET_VENDOR_NAME(B.VEN_CD)     AS VEN_NM 
                     , A.STYLE_CD
                     , A.COLOR_CD
                     , COM.FN_GET_COMM_NAME('D', 'P062', A.COLOR_CD) AS COLOR_NM  /* 컬러명*/
                     , A.SIZE_CD
                     , COM.FN_GET_COMM_NAME('D', 'P026', A.SIZE_CD)  AS SIZE_NM   /* 사이즈명*/
                     , A.PUMMOK_SRT_CD
                     , A.PUMMOK_CD
                     , DPS.FN_GET_PUMMOK_NAME(A.PUMMOK_CD)  AS PUMMOK_NM
                     , A.SKU_CD
                     , DPS.FN_GET_SKU_NAME(A.SKU_CD)        AS SKU_NM          
                     , C.RECP_NAME                          AS SKU_RECP_NM        /* 단품 영수증명*/                    
                     , SUBSTRB(E.RECP_NAME, 1, 12)          AS PBN_RECP_NM        /* 품번 영수증명*/            
                     , A.TAG_PRT_CNT
                     , D.SEASON_CD
                     , COM.FN_GET_COMM_NAME('D', 'P035', D.SEASON_CD) AS SEASON_NM /* 시즌명*/
                     , D.PLAN_YEAR                                                 /* 기획년월*/
                     , E.BIZ_TYPE
                     , SUBSTR(COM.FN_GET_COMM_NAME('D', 'P002', E.BIZ_TYPE), 1, 1) AS BIZ_TYPE_NM /* 거래형태*/
                     , E.TAX_FLAG
                     , SUBSTR(COM.FN_GET_COMM_NAME('D', 'P004', E.TAX_FLAG), 1, 1) AS TAX_FLAG_NM /* 과세구분*/
	                 , B.YYYY AS PRT_YYYY                                           /* 생산년도 */
                  FROM DPS.PO_TAGRQD   A 
                     , DPS.PO_TAGRQM   B               
                     , DPS.PC_SKUMST   C
                     , DPS.PC_STYLEMST D
                     , DPS.PC_PBNMST   E
                 WHERE A.STR_CD         = B.STR_CD
                   AND A.PRT_REQ_DT     = B.PRT_REQ_DT
                   AND A.PRT_REQ_SEQ_NO = B.PRT_REQ_SEQ_NO
                   AND A.SKU_CD         = C.SKU_CD
                   AND D.PUMBUN_CD      (+)= C.PUMBUN_CD
                   AND D.STYLE_CD       (+)= C.STYLE_CD
                   AND C.PUMBUN_CD      = E.PUMBUN_CD
                   AND A.PRT_REQ_SEQ_NO = ?
                   AND A.STR_CD         = ?
                   AND A.PRT_REQ_DT     = ?
        ]]>
    </query>      
         
    <!-- 마스터 정보 업데이트  -->            
    <query name="UPD_MASTER">
        <![CDATA[                               
           UPDATE DPS.PO_TAGRQM A
              SET A.PROC_FLAG      = 'N'
                , A.MOD_DATE       = SYSDATE
                , A.MOD_ID         = ?
            WHERE A.STR_CD         = ?
              AND A.PRT_REQ_DT     = ?
              AND A.PRT_REQ_SEQ_NO = ?
              
    /*          AND (
                   SELECT COUNT(B.TAG_PRT_CNT)
                     FROM DPS.PO_TAGRQD B 
                    WHERE B.STR_CD         = A.STR_CD
                      AND B.PRT_REQ_DT     = A.PRT_REQ_DT
                      AND B.PRT_REQ_SEQ_NO = A.PRT_REQ_SEQ_NO
                      AND B.TAG_PRT_CNT    = 0
                  ) = 0
    */
        ]]>
    </query>     
         
    <!-- 품목 정보 업데이트  -->            
    <query name="UPD_PMKINFO">
        <![CDATA[ 
			UPDATE DPS.PO_TAGRQD
			   SET TAG_PRT_YN     = 'N'
			     , TAG_PRT_CNT    = TAG_PRT_CNT + 1
			     , TAG_PRT_DT     = TO_CHAR(SYSDATE, 'YYYYMMDD')
			     , MOD_DATE       = SYSDATE
			     , MOD_ID         = ?
			 WHERE STR_CD         = ?
			   AND PRT_REQ_DT     = ?
			   AND PRT_REQ_SEQ_NO = ?
			   AND PRT_DTL_SEQ_NO = ?
        ]]>
    </query>    
         
    <!-- 단품 정보 업데이트  -->            
    <query name="UPD_SKUINFO">
        <![CDATA[ 
			UPDATE DPS.PO_TAGRQD
			   SET TAG_PRT_YN     = 'N'
			     , TAG_PRT_CNT    = TAG_PRT_CNT + 1
			     , TAG_PRT_DT     = TO_CHAR(SYSDATE, 'YYYYMMDD')
			     , MOD_DATE       = SYSDATE
			     , MOD_ID         = ?
			 WHERE STR_CD         = ?
			   AND PRT_REQ_DT     = ?
			   AND PRT_REQ_SEQ_NO = ?
			   AND PRT_DTL_SEQ_NO = ?
        ]]>
    </query>   
         
    <!-- 디테일 정보 업데이트  -->            
    <query name="UPD_DETAIL">
        <![CDATA[ 
            UPDATE DPS.PO_TAGRQD
               SET TAG_PRT_YN     = 'N'
                 , TAG_PRT_CNT    = TAG_PRT_CNT + 1
                 , TAG_PRT_DT     = TO_CHAR(SYSDATE, 'YYYYMMDD')
                 , MOD_DATE       = SYSDATE
                 , MOD_ID         = ?
             WHERE STR_CD         = ?
               AND PRT_REQ_DT     = ?
               AND PRT_REQ_SEQ_NO = ?
        ]]>
    </query>        
</service>