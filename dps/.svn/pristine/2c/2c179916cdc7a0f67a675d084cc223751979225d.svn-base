<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 정진영
 * 회 사 명 : FKSS
 * 작 성 일 : 2010.01.31
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  점정보를 관리한다.
 -->
<service name="/pcod001.pc">
    <!-- 점 그리드 -->  
    <gauce name="H_SEL_MASTER"> 
        <column colName="STR_CD"              colType="TB_STRING"  size="2"    dec="0" keyType="TB_KEY"    roundMode="ROUND" />
        <column colName="STR_NAME"            colType="TB_STRING"  size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CORP_FLAG"           colType="TB_STRING"  size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="FCL_FLAG"            colType="TB_STRING"  size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STR_FLAG"            colType="TB_STRING"  size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AREA_FLAG"           colType="TB_STRING"  size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MNG_FLAG"            colType="TB_STRING"  size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BSTR_FLAG"           colType="TB_STRING"  size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COMP_NO"             colType="TB_STRING"  size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CORP_NO"             colType="TB_STRING"  size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COMP_NAME"           colType="TB_STRING"  size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REP_NAME"            colType="TB_STRING"  size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BIZ_STAT"            colType="TB_STRING"  size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BIZ_CAT"             colType="TB_STRING"  size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="POST_NO"             colType="TB_STRING"  size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ADDR"                colType="TB_STRING"  size="80"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DTL_ADDR"            colType="TB_STRING"  size="80"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REP_TEL1_NO"         colType="TB_STRING"  size="4"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REP_TEL2_NO"         colType="TB_STRING"  size="4"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REP_TEL3_NO"         colType="TB_STRING"  size="4"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="FAX1_NO"             colType="TB_STRING"  size="4"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="FAX2_NO"             colType="TB_STRING"  size="4"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="FAX3_NO"             colType="TB_STRING"  size="4"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DISP_NO"             colType="TB_DECIMAL" size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="OPEN_TIME"           colType="TB_STRING"  size="4"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CLOSE_TIME"          colType="TB_STRING"  size="4"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BAL_CHK_TIME"        colType="TB_STRING"  size="4"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BSK_RFD_AMT"         colType="TB_DECIMAL" size="5"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BSK_RFD_CNT"         colType="TB_DECIMAL" size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CASH_RECP_SELF_YN"   colType="TB_STRING"  size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CASH_RECP_PSBL_AMT"  colType="TB_DECIMAL" size="9"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SMEDI_ID"            colType="TB_STRING"  size="20"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SMEDI_EMAIL"         colType="TB_STRING"  size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SMEDI_CHAR_ID"       colType="TB_STRING"  size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SMEDI_CHAR_NM"       colType="TB_STRING"  size="20"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="APP_S_DT"            colType="TB_STRING"  size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="APP_E_DT"            colType="TB_STRING"  size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="USE_YN"              colType="TB_STRING"  size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PACKET_CRYPT_YN"     colType="TB_STRING"  size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PACKET_CRYPT_KEY"    colType="TB_STRING"  size="16"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />        
        <column colName="BUPLA"               colType="TB_STRING"  size="4"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="GSBER"               colType="TB_STRING"  size="4"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BUY_ACC_VEN_CD"      colType="TB_STRING"  size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_ACC_VEN_CD"     colType="TB_STRING"  size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
   		
   		<column colName="SMEDI_TEL1_NO"         colType="TB_STRING"  size="4"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SMEDI_TEL2_NO"         colType="TB_STRING"  size="4"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SMEDI_TEL3_NO"         colType="TB_STRING"  size="4"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        
    </gauce>
    <!-- 쿼리는 전부 대문자 -->
    <!-- 마스터 조회 쿼리  -->
    <query name="SEL_STRMST">
        <![CDATA[
            SELECT STR_CD             , STR_NAME     , CORP_FLAG      , FCL_FLAG        , STR_FLAG
                 , AREA_FLAG          , MNG_FLAG     , BSTR_FLAG      , COMP_NO         , CORP_NO
                 , COMP_NAME          , REP_NAME     , BIZ_STAT       , BIZ_CAT         , POST_NO
                 , ADDR               , DTL_ADDR     , REP_TEL1_NO    , REP_TEL2_NO     , REP_TEL3_NO
                 , FAX1_NO            , FAX2_NO      , FAX3_NO        , DISP_NO         , OPEN_TIME
                 , CLOSE_TIME         , BAL_CHK_TIME , BSK_RFD_AMT    , BSK_RFD_CNT     , CASH_RECP_SELF_YN
                 , CASH_RECP_PSBL_AMT , SMEDI_ID     , SMEDI_EMAIL    , SMEDI_CHAR_ID   , COM.FN_GET_USER_NAME(SMEDI_CHAR_ID) AS USER_NAME
                 , APP_S_DT           , APP_E_DT     , USE_YN         , PACKET_CRYPT_YN , PACKET_CRYPT_KEY
                 , BUPLA              , GSBER        , BUY_ACC_VEN_CD , SALE_ACC_VEN_CD
                 , SMEDI_TEL1_NO	  , SMEDI_TEL2_NO , SMEDI_TEL3_NO
              FROM DPS.PC_STRMST
             WHERE 1 = 1
         ]]>
    </query>
    <query name="SEL_STRMST_WHERE_FCL_FLAG">
        <![CDATA[
               AND FCL_FLAG      = ?
         ]]>
    </query>
    <query name="SEL_STRMST_WHERE_BSTR_FLAG">
        <![CDATA[
               AND BSTR_FLAG     = ?
         ]]>
    </query>
    <query name="SEL_STRMST_WHERE_STR_FLAG">
        <![CDATA[
               AND STR_FLAG      = ?
         ]]>
    </query>
    <query name="SEL_STRMST_ORDER">
        <![CDATA[
             ORDER BY DISP_NO, STR_CD
         ]]>
    </query>
    
    <!-- 점코드 존재 여부 체크 -->
    <query name="SEL_STRMST_STRCD_CNT">
        <![CDATA[
            SELECT COUNT(*) AS CNT 
              FROM DPS.PC_STRMST 
             WHERE STR_CD = ?
         ]]>
    </query>
    <!-- 동일법인 동일시설내에 본사점 존재 여부 체크 -->
    <query name="SEL_STRMST_MAIN_STR_CNT">
        <![CDATA[
            SELECT COUNT(*) AS CNT 
              FROM DPS.PC_STRMST 
             WHERE CORP_FLAG = ?
               AND FCL_FLAG  = ?
               AND STR_FLAG  = '0'
         ]]>
    </query>
    <!-- 변경 저장될 하위 조직 항목 조회 -->
    <query name="SEL_ORGMSG">
        <![CDATA[
            SELECT ORG_CD
              FROM DPS.PC_ORGMST
             START WITH ORG_CD     = ?
           CONNECT BY PRIOR ORG_CD = P_ORG_CD
         ]]>
    </query>
    
    
    <!-- 변경 저장될 하위 바이어 조직 항목 조회 -->
    <query name="SEL_BUYERORG">
        <![CDATA[
            SELECT BUYER_CD
                 , APP_S_DT
              FROM DPS.PC_BUYERORG
             WHERE PC_ORG_CD IN (
                                 SELECT ORG_CD
                                   FROM DPS.PC_ORGMST
                                  START WITH ORG_CD     = ?
                                CONNECT BY PRIOR ORG_CD = P_ORG_CD
                                )
         ]]>
    </query>
    
    <!-- 점  마스터 신규 입력  -->
    <query name="INS_STRMST">
        <![CDATA[
            INSERT INTO DPS.PC_STRMST(
                                      STR_CD             , STR_NAME     , CORP_FLAG        , FCL_FLAG         , STR_FLAG
                                    , AREA_FLAG          , MNG_FLAG     , BSTR_FLAG        , COMP_NO          , CORP_NO
                                    , COMP_NAME          , REP_NAME     , BIZ_STAT         , BIZ_CAT          , POST_NO
                                    , ADDR               , DTL_ADDR     , REP_TEL1_NO      , REP_TEL2_NO      , REP_TEL3_NO
                                    , FAX1_NO            , FAX2_NO      , FAX3_NO          , DISP_NO          , OPEN_TIME
                                    , CLOSE_TIME         , BAL_CHK_TIME , BSK_RFD_AMT      , BSK_RFD_CNT      , CASH_RECP_SELF_YN
                                    , CASH_RECP_PSBL_AMT , SMEDI_ID     , SMEDI_EMAIL      , SMEDI_CHAR_ID    , APP_S_DT
                                    , APP_E_DT           , USE_YN       , PACKET_CRYPT_YN  , PACKET_CRYPT_KEY 
                                    , BUPLA              , GSBER        , BUY_ACC_VEN_CD   , SALE_ACC_VEN_CD  , REG_DATE    
                                    , REG_ID             , MOD_DATE     , MOD_ID
                                    , SMEDI_TEL1_NO	  , SMEDI_TEL2_NO , SMEDI_TEL3_NO
                                     )
                               VALUES(
                                      ?       , ?       , ?       , ?       , ?
                                    , ?       , ?       , ?       , ?       , ?
                                    , ?       , ?       , ?       , ?       , ?
                                    , ?       , ?       , ?       , ?       , ?
                                    , ?       , ?       , ?       , ?       , ?
                                    , ?       , ?       , ?       , ?       , ?
                                    , ?       , ?       , ?       , ?       , ?
                                    , ?       , ?       , ?       , ?       
                                    , ?       , ?       , ?       , ?       , SYSDATE 
                                    , ?       , SYSDATE , ?  
                                    , ?		  , ?       , ?     
                                 ) 
         ]]>
    </query>
    
    <!-- 점  마스터 수정 입력  -->
    <query name="UPD_STRMST">
        <![CDATA[
            UPDATE DPS.PC_STRMST
               SET STR_NAME           = ? , CORP_FLAG          = ? , FCL_FLAG           = ? , STR_FLAG           = ? , AREA_FLAG          = ?
                 , MNG_FLAG           = ? , BSTR_FLAG          = ? , COMP_NO            = ? , CORP_NO            = ? , COMP_NAME          = ?
                 , REP_NAME           = ? , BIZ_STAT           = ? , BIZ_CAT            = ? , POST_NO            = ? , ADDR               = ?
                 , DTL_ADDR           = ? , REP_TEL1_NO        = ? , REP_TEL2_NO        = ? , REP_TEL3_NO        = ? , FAX1_NO            = ?
                 , FAX2_NO            = ? , FAX3_NO            = ? , DISP_NO            = ? , OPEN_TIME          = ? , CLOSE_TIME         = ?
                 , BAL_CHK_TIME       = ? , BSK_RFD_AMT        = ? , BSK_RFD_CNT        = ? , CASH_RECP_SELF_YN  = ? , CASH_RECP_PSBL_AMT = ?
                 , SMEDI_ID           = ? , SMEDI_EMAIL        = ? , SMEDI_CHAR_ID      = ? , APP_S_DT           = ? , APP_E_DT           = ?
                 , USE_YN             = ? , PACKET_CRYPT_YN    = ? , PACKET_CRYPT_KEY   = ? , MOD_DATE    = SYSDATE  , MOD_ID             = ?
                 , BUPLA              = ? , GSBER              = ? , BUY_ACC_VEN_CD     = ? , SALE_ACC_VEN_CD    = ?
                 , SMEDI_TEL1_NO        = ? , SMEDI_TEL2_NO        = ? , SMEDI_TEL3_NO        = ? 
             WHERE STR_CD   = ?
         ]]>
    </query>
    
    <!-- 조직  마스터 신규 입력  -->
    <query name="INS_ORGMST">
        <![CDATA[
            INSERT INTO DPS.PC_ORGMST(
                                      ORG_CD    , ORG_NAME    , ORG_SHORT_NAME    , ORG_FLAG    , ORG_LEVEL
                                    , STR_CD    , DEPT_CD     , TEAM_CD           , PC_CD       , CORNER_CD
                                    , P_ORG_CD  , FRST_ORG_CD , SAP_ORG_CD        , BF_ORG_CD   , MNG_ORG_YN
                                                , EMP_CNT     , AREA_SIZE         , APP_S_DT    , APP_E_DT
                                    , USE_YN    , REG_DATE    , REG_ID            , MOD_DATE    , MOD_ID
                                     )
                               VALUES(
                                      ?       , ?       , SUBSTRB( ?, 1, 20)      , ?       , ?
                                    , ?       , ?       , ?                       , ?       , ?
                                    , ?       , ?       , ?                       , ?       , ?
                                              , ?       , ?                       , ?       , ?
                                    , ?       , SYSDATE , ?                       , SYSDATE , ?
                                     ) 
         ]]>
    </query>
    
    <!-- 조직  마스터 수정 입력  -->
    <query name="UPD_ORGMST">
        <![CDATA[
            UPDATE DPS.PC_ORGMST
               SET ORG_NAME       = ?
                 , ORG_SHORT_NAME = SUBSTRB( ?, 1, 20)   
                 , USE_YN         = ?
                 , MOD_DATE       = SYSDATE
                 , MOD_ID         = ?
             WHERE ORG_CD   = ?
         ]]>
    </query>   
    
    <!-- 조직  마스터 하위 항목 사용여부 수정  -->
    <query name="UPD_ORGMST_USE_YN">
        <![CDATA[
            UPDATE DPS.PC_ORGMST
               SET USE_YN         = ?
                 , MOD_DATE       = SYSDATE
                 , MOD_ID         = ?
             WHERE ORG_CD        IN (
                                     SELECT ORG_CD
                                       FROM DPS.PC_ORGMST
                                      START WITH ORG_CD     = ?
                                    CONNECT BY PRIOR ORG_CD = P_ORG_CD
                                    )
         ]]>
    </query>   
    
    <!-- 바이어  마스터 하위 항목 사용여부 수정  -->
    <query name="UPD_BUYERMST_USE_YN">
        <![CDATA[
            UPDATE DPS.PC_BUYERMST
               SET USE_YN         = ?
                 , MOD_DATE       = SYSDATE
                 , MOD_ID         = ?
             WHERE PC_ORG_CD     IN (
                                     SELECT ORG_CD
                                       FROM DPS.PC_ORGMST
                                      WHERE PC_CD NOT IN ('00')
                                        AND CORNER_CD = '00'
                                      START WITH ORG_CD     = ?
                                    CONNECT BY PRIOR ORG_CD = P_ORG_CD
                                    )
         ]]> 
    </query>   
    
    <!-- 바이어 조직 하위 항목 사용여부 수정  -->
    <query name="UPD_BUYERORG_USE_YN">
        <![CDATA[
            UPDATE DPS.PC_BUYERORG
               SET USE_YN         = ?
                 , MOD_DATE       = SYSDATE
                 , MOD_ID         = ?
             WHERE PC_ORG_CD     IN (
                                     SELECT ORG_CD
                                       FROM DPS.PC_ORGMST
                                      WHERE PC_CD NOT IN ('00')
                                        AND CORNER_CD = '00'
                                      START WITH ORG_CD     = ?
                                    CONNECT BY PRIOR ORG_CD = P_ORG_CD
                                    )
         ]]>
    </query>   
</service>