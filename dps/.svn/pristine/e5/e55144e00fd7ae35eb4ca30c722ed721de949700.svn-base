<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : DHL
 * 회 사 명 : 한국후지쯔
 * 작 성 일 : 2012.06.04
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  
 -->
<service name="/psal457.ps">
    
    <gauce name="H_SEL_MASTER1"> 
        <column colName="STR_CD"             colType="TB_STRING"      size="2"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="RANK_NO"            colType="TB_DECIMAL"     size="3"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="VEN_CD"             colType="TB_STRING"      size="6"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="VEN_NM"             colType="TB_STRING"      size="40"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REP_PUMBUN_CD"      colType="TB_STRING"      size="6"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REP_PUMBUN_NM"      colType="TB_STRING"      size="40"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />

        <column colName="MONTH_AVG"          colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TOT_NORM_SALE"      colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NORM_SALE_01"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NORM_SALE_02"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NORM_SALE_03"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NORM_SALE_04"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NORM_SALE_05"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NORM_SALE_06"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />        
        <column colName="NORM_SALE_07"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NORM_SALE_08"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NORM_SALE_09"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NORM_SALE_10"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />        
        <column colName="NORM_SALE_11"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />        
        <column colName="NORM_SALE_12"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />        
    </gauce>
    
    <gauce name="H_SEL_MASTER2"> 
        <column colName="STR_CD"             colType="TB_STRING"      size="2"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="RANK_NO"            colType="TB_DECIMAL"     size="3"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_CD"          colType="TB_STRING"      size="6"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_NM"          colType="TB_STRING"      size="40"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />

        <column colName="MONTH_AVG"          colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TOT_NORM_SALE"      colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NORM_SALE_01"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NORM_SALE_02"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NORM_SALE_03"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NORM_SALE_04"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NORM_SALE_05"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NORM_SALE_06"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />        
        <column colName="NORM_SALE_07"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NORM_SALE_08"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NORM_SALE_09"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NORM_SALE_10"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />        
        <column colName="NORM_SALE_11"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />        
        <column colName="NORM_SALE_12"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />        
    </gauce>
    
    <!-- 쿼리는 전부 대문자 -->
     
    <!-- 마스터 조회 쿼리  -->
    <query name="SEL_SALE_VEN">        
        <![CDATA[
SELECT V.STR_CD         AS STR_CD       
     , V.RANK_NO        AS RANK_NO      
     , V.VEN_CD         AS VEN_CD       
     , V.VEN_NM         AS VEN_NM       
     , V.REP_PUMBUN_CD  AS REP_PUMBUN_CD
     , V.REP_PUMBUN_NM  AS REP_PUMBUN_NM
     , V.MONTH_AVG      AS MONTH_AVG    
     , V.TOT_NORM_SALE  AS TOT_NORM_SALE
     , V.NORM_SALE_01   AS NORM_SALE_01 
     , V.NORM_SALE_02   AS NORM_SALE_02 
     , V.NORM_SALE_03   AS NORM_SALE_03 
     , V.NORM_SALE_04   AS NORM_SALE_04 
     , V.NORM_SALE_05   AS NORM_SALE_05 
     , V.NORM_SALE_06   AS NORM_SALE_06 
     , V.NORM_SALE_07   AS NORM_SALE_07 
     , V.NORM_SALE_08   AS NORM_SALE_08 
     , V.NORM_SALE_09   AS NORM_SALE_09 
     , V.NORM_SALE_10   AS NORM_SALE_10 
     , V.NORM_SALE_11   AS NORM_SALE_11 
     , V.NORM_SALE_12   AS NORM_SALE_12 
  FROM (
        SELECT Z.STR_CD                                           AS STR_CD
             , RANK() OVER (ORDER BY MAX(TOT_NORM_SALE) DESC)     AS RANK_NO
             , Z.VEN_CD                                           AS VEN_CD
             , Z.VEN_NM                                           AS VEN_NM
             , Z.REP_PUMBUN_CD                                    AS REP_PUMBUN_CD
             , Z.REP_PUMBUN_NM                                    AS REP_PUMBUN_NM
             , MAX(MONTH_AVG)                                     AS MONTH_AVG
             , MAX(TOT_NORM_SALE)                                 AS TOT_NORM_SALE
             , SUM(NORM_SALE_01)                                  AS NORM_SALE_01
             , SUM(NORM_SALE_02)                                  AS NORM_SALE_02
             , SUM(NORM_SALE_03)                                  AS NORM_SALE_03
             , SUM(NORM_SALE_04)                                  AS NORM_SALE_04
             , SUM(NORM_SALE_05)                                  AS NORM_SALE_05
             , SUM(NORM_SALE_06)                                  AS NORM_SALE_06
             , SUM(NORM_SALE_07)                                  AS NORM_SALE_07
             , SUM(NORM_SALE_08)                                  AS NORM_SALE_08
             , SUM(NORM_SALE_09)                                  AS NORM_SALE_09
             , SUM(NORM_SALE_10)                                  AS NORM_SALE_10
             , SUM(NORM_SALE_11)                                  AS NORM_SALE_11
             , SUM(NORM_SALE_12)                                  AS NORM_SALE_12
          FROM (             
                SELECT X.STR_CD                                                       AS STR_CD
                     , X.VEN_CD                                                       AS VEN_CD
                     , X.VEN_NM                                                       AS VEN_NM
                     , X.REP_PUMBUN_CD                                                AS REP_PUMBUN_CD
                     , X.REP_PUMBUN_NM                                                AS REP_PUMBUN_NM
                     , MAX(X.MONTH_AVG)                                               AS MONTH_AVG
                     , MAX(X.TOT_NORM_SALE)                                           AS TOT_NORM_SALE
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '01', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_01
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '02', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_02
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '03', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_03
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '04', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_04
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '05', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_05
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '06', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_06
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '07', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_07
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '08', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_08
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '09', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_09
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '10', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_10
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '11', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_11
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '12', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_12
                  FROM (
                        SELECT TA.STR_CD                                AS STR_CD     
                             , TA.VEN_CD                                AS VEN_CD
                             , DPS.FN_GET_VEN_NAME(TA.VEN_CD)           AS VEN_NM
                             , TA.REP_PUMBUN_CD                         AS REP_PUMBUN_CD
                             , DPS.FN_GET_PUMBUN_NAME(TA.REP_PUMBUN_CD) AS REP_PUMBUN_NM
                             , TA.SALE_YM                               AS SALE_YM
                             , SUM(TA.SALE_QTY)                         AS SALE_QTY
                             , SUM(TA.TOT_SALE_AMT)                     AS TOT_SALE_AMT
                             , SUM(TA.VAT_AMT)                          AS VAT_AMT
                             , SUM(TA.REDU_AMT)                         AS REDU_AMT
                             , SUM(TA.DC_AMT)                           AS DC_AMT
                             , SUM(TA.NORM_SALE_AMT)                    AS NORM_SALE_AMT
                             , SUM(TA.NET_SALE_AMT)                     AS NET_SALE_AMT
                             , SUM(TA.SALE_PROF_AMT)                    AS SALE_PROF_AMT
                             , SUM(TA.CUST_CNT)                         AS CUST_CNT
                             , SUM(TA.SPS_SALE_QTY)                     AS SPS_SALE_QTY
                             , SUM(TA.SPS_SALE_AMT)                     AS SPS_SALE_AMT
                             , SUM(SUM(TA.NORM_SALE_AMT)) OVER (PARTITION BY TA.STR_CD, TA.VEN_CD, TA.REP_PUMBUN_CD ORDER BY TA.STR_CD, TA.VEN_CD, TA.REP_PUMBUN_CD) AS TOT_NORM_SALE 
                             , ROUND(SUM(SUM(TA.NORM_SALE_AMT)) OVER (PARTITION BY TA.STR_CD, TA.VEN_CD, TA.REP_PUMBUN_CD ORDER BY TA.STR_CD, TA.VEN_CD, TA.REP_PUMBUN_CD) / (MONTHS_BETWEEN(?||'01',?||'01')+1), -1) AS MONTH_AVG
                          FROM DPS.PS_MONTHPBN TA
                             , DPS.PC_STRPBN   TB
                         WHERE TA.STR_CD = TB.STR_CD
                           AND TA.PUMBUN_CD = TB.PUMBUN_CD
                           AND TA.STR_CD = ?
                           AND SUBSTR((CASE WHEN ? = '1' THEN TB.SALE_ORG_CD ELSE TB.BUY_ORG_CD END), 3, 2) LIKE ?||'%'
                           AND SUBSTR((CASE WHEN ? = '1' THEN TB.SALE_ORG_CD ELSE TB.BUY_ORG_CD END), 5, 2) LIKE ?||'%'
                           AND SUBSTR((CASE WHEN ? = '1' THEN TB.SALE_ORG_CD ELSE TB.BUY_ORG_CD END), 7, 2) LIKE ?||'%'
                           AND TA.SALE_YM BETWEEN ? AND ?
                         GROUP BY   
                               TA.STR_CD
                             , TA.SALE_YM
                             , TA.VEN_CD
                             , TA.REP_PUMBUN_CD
                       ) X
                  GROUP BY
                        X.STR_CD
                      , X.VEN_CD
                      , X.VEN_NM
                      , X.REP_PUMBUN_CD
                      , X.REP_PUMBUN_NM
                      , X.MONTH_AVG
                      , X.TOT_NORM_SALE
                      , X.SALE_YM
               ) Z
          GROUP BY
                Z.STR_CD
              , Z.VEN_CD
              , Z.VEN_NM
              , Z.REP_PUMBUN_CD
              , Z.REP_PUMBUN_NM
       ) V
  WHERE V.RANK_NO <= ?
  ORDER BY
        V.RANK_NO
    ]]>        
    </query>
    
    <query name="SEL_SALE_BRAND">        
     <![CDATA[
SELECT V.STR_CD         AS STR_CD       
     , V.RANK_NO        AS RANK_NO      
     , V.PUMBUN_CD      AS PUMBUN_CD
     , V.PUMBUN_NM      AS PUMBUN_NM
     , V.MONTH_AVG      AS MONTH_AVG    
     , V.TOT_NORM_SALE  AS TOT_NORM_SALE
     , V.NORM_SALE_01   AS NORM_SALE_01 
     , V.NORM_SALE_02   AS NORM_SALE_02 
     , V.NORM_SALE_03   AS NORM_SALE_03 
     , V.NORM_SALE_04   AS NORM_SALE_04 
     , V.NORM_SALE_05   AS NORM_SALE_05 
     , V.NORM_SALE_06   AS NORM_SALE_06 
     , V.NORM_SALE_07   AS NORM_SALE_07 
     , V.NORM_SALE_08   AS NORM_SALE_08 
     , V.NORM_SALE_09   AS NORM_SALE_09 
     , V.NORM_SALE_10   AS NORM_SALE_10 
     , V.NORM_SALE_11   AS NORM_SALE_11 
     , V.NORM_SALE_12   AS NORM_SALE_12 
  FROM (
        SELECT Z.STR_CD                                           AS STR_CD
             , RANK() OVER (ORDER BY MAX(TOT_NORM_SALE) DESC)     AS RANK_NO
             , Z.PUMBUN_CD                                        AS PUMBUN_CD
             , Z.PUMBUN_NM                                        AS PUMBUN_NM
             , MAX(MONTH_AVG)                                     AS MONTH_AVG
             , MAX(TOT_NORM_SALE)                                 AS TOT_NORM_SALE
             , SUM(NORM_SALE_01)                                  AS NORM_SALE_01
             , SUM(NORM_SALE_02)                                  AS NORM_SALE_02
             , SUM(NORM_SALE_03)                                  AS NORM_SALE_03
             , SUM(NORM_SALE_04)                                  AS NORM_SALE_04
             , SUM(NORM_SALE_05)                                  AS NORM_SALE_05
             , SUM(NORM_SALE_06)                                  AS NORM_SALE_06
             , SUM(NORM_SALE_07)                                  AS NORM_SALE_07
             , SUM(NORM_SALE_08)                                  AS NORM_SALE_08
             , SUM(NORM_SALE_09)                                  AS NORM_SALE_09
             , SUM(NORM_SALE_10)                                  AS NORM_SALE_10
             , SUM(NORM_SALE_11)                                  AS NORM_SALE_11
             , SUM(NORM_SALE_12)                                  AS NORM_SALE_12
          FROM (             
                SELECT X.STR_CD                                                       AS STR_CD
                     , X.PUMBUN_CD                                                    AS PUMBUN_CD
                     , X.PUMBUN_NM                                                    AS PUMBUN_NM
                     , MAX(X.MONTH_AVG)                                               AS MONTH_AVG
                     , MAX(X.TOT_NORM_SALE)                                           AS TOT_NORM_SALE
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '01', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_01
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '02', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_02
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '03', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_03
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '04', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_04
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '05', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_05
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '06', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_06
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '07', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_07
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '08', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_08
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '09', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_09
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '10', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_10
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '11', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_11
                     , DECODE(SUBSTR(X.SALE_YM, 5, 2), '12', MAX(X.NORM_SALE_AMT), 0) AS NORM_SALE_12
                  FROM (
                        SELECT TA.STR_CD                                AS STR_CD     
                             , TA.PUMBUN_CD                             AS PUMBUN_CD
                             , DPS.FN_GET_PUMBUN_NAME(TA.PUMBUN_CD)     AS PUMBUN_NM
                             , TA.SALE_YM                               AS SALE_YM
                             , SUM(TA.SALE_QTY)                         AS SALE_QTY
                             , SUM(TA.TOT_SALE_AMT)                     AS TOT_SALE_AMT
                             , SUM(TA.VAT_AMT)                          AS VAT_AMT
                             , SUM(TA.REDU_AMT)                         AS REDU_AMT
                             , SUM(TA.DC_AMT)                           AS DC_AMT
                             , SUM(TA.NORM_SALE_AMT)                    AS NORM_SALE_AMT
                             , SUM(TA.NET_SALE_AMT)                     AS NET_SALE_AMT
                             , SUM(TA.SALE_PROF_AMT)                    AS SALE_PROF_AMT
                             , SUM(TA.CUST_CNT)                         AS CUST_CNT
                             , SUM(TA.SPS_SALE_QTY)                     AS SPS_SALE_QTY
                             , SUM(TA.SPS_SALE_AMT)                     AS SPS_SALE_AMT
                             , SUM(SUM(TA.NORM_SALE_AMT)) OVER (PARTITION BY TA.STR_CD, TA.PUMBUN_CD ORDER BY TA.STR_CD, TA.PUMBUN_CD) AS TOT_NORM_SALE 
                             , ROUND(SUM(SUM(TA.NORM_SALE_AMT)) OVER (PARTITION BY TA.STR_CD, TA.PUMBUN_CD ORDER BY TA.STR_CD, TA.PUMBUN_CD) / (MONTHS_BETWEEN(?||'01',?||'01')+1), -1) AS MONTH_AVG
                          FROM DPS.PS_MONTHPBN TA
                             , DPS.PC_STRPBN   TB
                         WHERE TA.STR_CD = TB.STR_CD
                           AND TA.PUMBUN_CD = TB.PUMBUN_CD
                           AND TA.STR_CD = ?
                           AND SUBSTR((CASE WHEN ? = '1' THEN TB.SALE_ORG_CD ELSE TB.BUY_ORG_CD END), 3, 2) LIKE ?||'%'
                           AND SUBSTR((CASE WHEN ? = '1' THEN TB.SALE_ORG_CD ELSE TB.BUY_ORG_CD END), 5, 2) LIKE ?||'%'
                           AND SUBSTR((CASE WHEN ? = '1' THEN TB.SALE_ORG_CD ELSE TB.BUY_ORG_CD END), 7, 2) LIKE ?||'%'
                           AND TA.SALE_YM BETWEEN ? AND ?
                         GROUP BY   
                               TA.STR_CD
                             , TA.SALE_YM
                             , TA.PUMBUN_CD
                       ) X
                  GROUP BY
                        X.STR_CD
                      , X.PUMBUN_CD
                      , X.PUMBUN_NM
                      , X.MONTH_AVG
                      , X.TOT_NORM_SALE
                      , X.SALE_YM
               ) Z
          GROUP BY
                Z.STR_CD
              , Z.PUMBUN_CD
              , Z.PUMBUN_NM
       ) V
  WHERE V.RANK_NO <= ?
  ORDER BY
        V.RANK_NO
        ]]>        
    </query>

</service>