<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 이재득
 * 회 사 명 : FKSS
 * 작 성 일 : 2010.05.13
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  규격/신선 단품별 장부재고 현황을 조회한다.
 -->
<service name="/pstk112.pt">
  
  <gauce name="H_SEL_MASTER">        
        <column colName="PUMBUN_CD"        colType="TB_STRING"  size="6"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_NAME"      colType="TB_STRING"  size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMMOK_CD"        colType="TB_STRING"  size="8"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMMOK_NAME"      colType="TB_STRING"  size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SKU_CD"           colType="TB_STRING"  size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SKU_NAME"         colType="TB_STRING"  size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                  
        <column colName="BASE_QTY"         colType="TB_INT"     size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BASE_AMT"         colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />        
        <column colName="SALE_1QTY"         colType="TB_INT"     size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SALE_SALE_1AMT"    colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_2QTY"         colType="TB_INT"     size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SALE_SALE_2AMT"    colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="SALE_3QTY"         colType="TB_INT"     size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SALE_SALE_3AMT"    colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="SALE_4QTY"         colType="TB_INT"     size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SALE_SALE_4AMT"    colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="SALE_5QTY"         colType="TB_INT"     size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SALE_SALE_5AMT"    colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="SALE_6QTY"         colType="TB_INT"     size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SALE_SALE_6AMT"    colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="SALE_7QTY"         colType="TB_INT"     size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SALE_SALE_7AMT"    colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="SALE_8QTY"         colType="TB_INT"     size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SALE_SALE_8AMT"    colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="SALE_9QTY"         colType="TB_INT"     size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SALE_SALE_9AMT"    colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />       
        <column colName="SALE_10QTY"         colType="TB_INT"     size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SALE_SALE_10AMT"    colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />          
        <column colName="SALE_11QTY"         colType="TB_INT"     size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SALE_SALE_11AMT"    colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />         
        <column colName="SALE_12QTY"         colType="TB_INT"     size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SALE_SALE_12AMT"    colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />          
        <column colName="SALE_13QTY"         colType="TB_INT"     size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SALE_SALE_13AMT"    colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />      
        <column colName="SALE_1QTY"         colType="TB_INT"     size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SALE_SALE_1AMT"    colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />        
        <column colName="INPUT_PLU_CD"     colType="TB_STRING"  size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />        
        <column colName="SALE_UNIT_CD"     colType="TB_STRING"  size="3"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CMP_SPEC_UNIT"    colType="TB_STRING"  size="3"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />      
  </gauce> 
  
  <!-- 품번정보조회 -->
    <gauce name="H_SEL_PBNINF">        
        <column colName="ORG_NAME"         colType="TB_STRING"  size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                             
    </gauce>
  
    <!-- 쿼리는 전부 대문자 -->
    <!-- 마스터 조회 쿼리  -->    
    <query name="SEL_MASTER">
        <![CDATA[
            SELECT A.PUMBUN_CD
                 , (SELECT PUMBUN_NAME
                      FROM DPS.PC_PBNMST X
                     WHERE A.PUMBUN_CD = X.PUMBUN_CD) AS PUMBUN_NAME
                 , A.PUMMOK_CD
                 , (SELECT PUMMOK_NAME
                      FROM DPS.PC_PMKMST X
                     WHERE A.PUMMOK_CD = X.PUMMOK_CD) AS PUMMOK_NAME
                 , A.SKU_CD
                 , (SELECT SKU_NAME
                      FROM DPS.PC_SKUMST X
                     WHERE A.SKU_CD = X.SKU_CD)            AS SKU_NAME
                 , SUM(NVL(A.BASE_QTY,0))                  AS BASE_QTY
                 , SUM(NVL(A.BASE_AMT,0))                  AS BASE_AMT
                 , SUM(NVL(A.SALE_1QTY,0))                  AS SALE_1QTY
                 , SUM(NVL(A.SALE_SALE_1AMT,0))             AS SALE_SALE_1AMT
                 , SUM(NVL(A.SALE_2QTY,0))                  AS SALE_2QTY
                 , SUM(NVL(A.SALE_SALE_2AMT,0))             AS SALE_SALE_2AMT
                 , SUM(NVL(A.SALE_3QTY,0))                  AS SALE_3QTY
                 , SUM(NVL(A.SALE_SALE_3AMT,0))             AS SALE_SALE_3AMT
                 , SUM(NVL(A.SALE_4QTY,0))                  AS SALE_4QTY
                 , SUM(NVL(A.SALE_SALE_4AMT,0))             AS SALE_SALE_4AMT
                 , SUM(NVL(A.SALE_5QTY,0))                  AS SALE_5QTY
                 , SUM(NVL(A.SALE_SALE_5AMT,0))             AS SALE_SALE_5AMT
                 , SUM(NVL(A.SALE_6QTY,0))                  AS SALE_6QTY
                 , SUM(NVL(A.SALE_SALE_6AMT,0))             AS SALE_SALE_6AMT
                 , SUM(NVL(A.SALE_7QTY,0))                  AS SALE_7QTY
                 , SUM(NVL(A.SALE_SALE_7AMT,0))             AS SALE_SALE_7AMT
                 , SUM(NVL(A.SALE_8QTY,0))                  AS SALE_8QTY
                 , SUM(NVL(A.SALE_SALE_8AMT,0))             AS SALE_SALE_8AMT
                 , SUM(NVL(A.SALE_9QTY,0))                  AS SALE_9QTY
                 , SUM(NVL(A.SALE_SALE_9AMT,0))             AS SALE_SALE_9AMT
                 , SUM(NVL(A.SALE_10QTY,0))                  AS SALE_10QTY
                 , SUM(NVL(A.SALE_SALE_10AMT,0))             AS SALE_SALE_10AMT
                 , SUM(NVL(A.SALE_11QTY,0))                  AS SALE_11QTY
                 , SUM(NVL(A.SALE_SALE_11AMT,0))             AS SALE_SALE_11AMT
                 , SUM(NVL(A.SALE_12QTY,0))                  AS SALE_12QTY
                 , SUM(NVL(A.SALE_SALE_12AMT,0))             AS SALE_SALE_12AMT
                 , SUM(NVL(A.SALE_1QTY,0)) + SUM(NVL(A.SALE_2QTY,0)) + SUM(NVL(A.SALE_3QTY,0)) + SUM(NVL(A.SALE_4QTY,0)) + SUM(NVL(A.SALE_5QTY,0)) + SUM(NVL(A.SALE_6QTY,0)) + SUM(NVL(A.SALE_7QTY,0)) + SUM(NVL(A.SALE_8QTY,0)) + SUM(NVL(A.SALE_9QTY,0)) + SUM(NVL(A.SALE_10QTY,0)) + SUM(NVL(A.SALE_11QTY,0)) + SUM(NVL(A.SALE_12QTY,0)) AS SALE_13QTY
                 , SUM(NVL(A.SALE_SALE_1AMT,0)) + SUM(NVL(A.SALE_SALE_2AMT,0)) + SUM(NVL(A.SALE_SALE_3AMT,0)) + SUM(NVL(A.SALE_SALE_4AMT,0)) + SUM(NVL(A.SALE_SALE_5AMT,0)) + SUM(NVL(A.SALE_SALE_6AMT,0)) + SUM(NVL(A.SALE_SALE_7AMT,0)) + SUM(NVL(A.SALE_SALE_8AMT,0)) + SUM(NVL(A.SALE_SALE_9AMT,0)) + SUM(NVL(A.SALE_SALE_10AMT,0)) + SUM(NVL(A.SALE_SALE_11AMT,0)) + SUM(NVL(A.SALE_SALE_12AMT,0)) AS SALE_SALE_13AMT
                 , SKU.INPUT_PLU_CD                 
                 , SKU.SALE_UNIT_CD
                 , SKU.CMP_SPEC_UNIT
              FROM DPS.PC_SKUMST SKU
                 , DPS.PC_PBNMST PBN
                 , (SELECT STR_CD
                         , PUMBUN_CD
                         , PUMMOK_CD 
                         , SKU_CD
                         , SUM(NVL(CAO_QTY,0))         AS BASE_QTY
                         , SUM(NVL(CAO_SALE_AMT,0))    AS BASE_AMT
                         ,0                       AS SALE_1QTY
                         ,0              AS SALE_SALE_1AMT
                         ,0                       AS SALE_2QTY
                         ,0           AS SALE_SALE_2AMT
                         ,0                      AS SALE_3QTY
                         ,0              AS SALE_SALE_3AMT
                         ,0                       AS SALE_4QTY
                         ,0              AS SALE_SALE_4AMT
                         ,0                       AS SALE_5QTY
                         ,0              AS SALE_SALE_5AMT
                         ,0                       AS SALE_6QTY
                         ,0              AS SALE_SALE_6AMT
                         ,0                       AS SALE_7QTY
                         ,0              AS SALE_SALE_7AMT
                         ,0                       AS SALE_8QTY
                         ,0              AS SALE_SALE_8AMT
                         ,0                       AS SALE_9QTY
                         ,0              AS SALE_SALE_9AMT
                         ,0                       AS SALE_10QTY
                         ,0              AS SALE_SALE_10AMT
                         ,0                       AS SALE_11QTY
                         ,0              AS SALE_SALE_11AMT
                         ,0                       AS SALE_12QTY
                         ,0              AS SALE_SALE_12AMT
                      FROM DPS.PT_SKUMONTH
                     WHERE STR_CD = ?
                       AND STK_YM like  ? || '%'
                       GROUP BY STR_CD
                              , PUMBUN_CD
                              , PUMMOK_CD
                              , SKU_CD
                    UNION ALL
                    SELECT STR_CD
                         , PUMBUN_CD
                         , PUMMOK_CD
                         , SKU_CD
                         , 0                           AS BASE_QTY
                         , 0                           AS BASE_AMT
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '01' THEN  SUM(NVL(SALE_QTY,0)) END                       AS SALE_1QTY
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '01' THEN  SUM(SALE_SALE_AMT) END              AS SALE_SALE_1AMT
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '02' THEN  SUM(NVL(SALE_QTY,0)) END                       AS SALE_2QTY
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '02' THEN  SUM(NVL(SALE_SALE_AMT,0)) END              AS SALE_SALE_2AMT
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '03' THEN  SUM(NVL(SALE_QTY,0)) END                       AS SALE_3QTY
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '03' THEN  SUM(NVL(SALE_SALE_AMT,0)) END              AS SALE_SALE_3AMT
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '04' THEN  SUM(NVL(SALE_QTY,0)) END                       AS SALE_4QTY
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '04' THEN  SUM(NVL(SALE_SALE_AMT,0)) END              AS SALE_SALE_4AMT
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '05' THEN  SUM(NVL(SALE_QTY,0)) END                       AS SALE_5QTY
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '05' THEN  SUM(NVL(SALE_SALE_AMT,0)) END              AS SALE_SALE_5AMT
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '06' THEN  SUM(NVL(SALE_QTY,0)) END                       AS SALE_6QTY
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '06' THEN  SUM(NVL(SALE_SALE_AMT,0)) END              AS SALE_SALE_6AMT
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '07' THEN  SUM(NVL(SALE_QTY,0)) END                       AS SALE_7QTY
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '07' THEN  SUM(NVL(SALE_SALE_AMT,0)) END              AS SALE_SALE_7AMT
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '08' THEN  SUM(NVL(SALE_QTY,0)) END                       AS SALE_8QTY
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '08' THEN  SUM(NVL(SALE_SALE_AMT,0)) END              AS SALE_SALE_8AMT
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '09' THEN  SUM(NVL(SALE_QTY,0)) END                       AS SALE_9QTY
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '09' THEN  SUM(NVL(SALE_SALE_AMT,0)) END              AS SALE_SALE_9AMT
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '10' THEN  SUM(NVL(SALE_QTY,0)) END                       AS SALE_10QTY
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '10' THEN  SUM(NVL(SALE_SALE_AMT,0)) END              AS SALE_SALE_10AMT
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '11' THEN  SUM(NVL(SALE_QTY,0)) END                       AS SALE_11QTY
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '11' THEN  SUM(NVL(SALE_SALE_AMT,0)) END              AS SALE_SALE_11AMT
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '12' THEN  SUM(NVL(SALE_QTY,0)) END                       AS SALE_12QTY
                         ,CASE WHEN SUBSTR(STK_DT,5,2) = '12' THEN  SUM(NVL(SALE_SALE_AMT,0)) END              AS SALE_SALE_12AMT
                      FROM DPS.PT_SKUDAY
                     WHERE STR_CD       = ?
                       AND STK_DT BETWEEN ? || '0101' AND ? ||'1231'
                     GROUP BY STR_CD
                            , PUMBUN_CD
                            , PUMMOK_CD
                            , SKU_CD
                            , SUBSTR(STK_DT,5,2)
                      ) A
             WHERE SKU.SKU_CD    = A.SKU_CD
               AND PBN.PUMBUN_CD = A.PUMBUN_CD
               AND PBN.PUMBUN_TYPE <> '2'
               AND PBN.SKU_TYPE  = ?               
        ]]>    
    </query>
    
     <query name="SEL_MASTER_WHERE_MAKER_CD">
        <![CDATA[
               AND SKU.MAKER_CD = ?
        ]]>    
    </query>
    
    <query name="SEL_MASTER_WHERE_PUMBUN_CD">
        <![CDATA[
               AND A.PUMBUN_CD  = ?
        ]]>    
    </query>
    
    <query name="SEL_MASTER_WHERE_PUMMOK_CD">
        <![CDATA[
               AND A.PUMMOK_CD  = ?
        ]]>    
    </query>
    
    <query name="SEL_MASTER_WHERE_SKU_CD">
        <![CDATA[
               AND SKU.SKU_CD = ?
        ]]>    
    </query>
    
    <query name="SEL_MASTER_GROUP">
        <![CDATA[
            GROUP BY A.PUMBUN_CD
                   , A.PUMMOK_CD
                   , A.SKU_CD
                   , SKU.INPUT_PLU_CD                 
                   , SKU.SALE_UNIT_CD
                   , SKU.CMP_SPEC_UNIT  
        ]]>    
    </query>
    
    <query name="SEL_MASTER_ORDER">
        <![CDATA[
            ORDER BY A.PUMBUN_CD
                   , A.PUMMOK_CD 
                   , A.SKU_CD  
        ]]>    
    </query>
    
    <!-- 품번정보조회  -->
    <query name="SEL_PBNINF">
        <![CDATA[
            SELECT ORG.ORG_SHORT_NAME AS ORG_NAME
              FROM DPS.PC_STRPBN STP
                 , DPS.PC_ORGMST ORG
            WHERE STP.SALE_ORG_CD = ORG.ORG_CD 
              AND STP.STR_CD    = ?
              AND STP.PUMBUN_CD = ?
        ]]>    
    </query>
    
</service>