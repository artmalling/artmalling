<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 
 * 회 사 명 : 한국후지쯔
 * 작 성 일 : 2010.02.15
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  개발팀에서 기입해주세요
 -->
<service name="/pord508.po">
   <gauce name="H_PO_OFFMST"> 
        <column colName="CHECK1"              colType="TB_STRING"    size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STR_CD"              colType="TB_STRING"    size="2"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="OFFER_YM"            colType="TB_STRING"    size="6"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="OFFER_SEQ_NO"        colType="TB_DECIMAL"   size="5"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="OFFER_DT"            colType="TB_STRING"    size="8"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="OFFER_SHEET_NO"      colType="TB_STRING"    size="30"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BL_NO"               colType="TB_STRING"    size="40"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="PUMBUN_CD"           colType="TB_STRING"    size="6"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="PUMBUN_NAME"         colType="TB_STRING"    size="40"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="VEN_CD"              colType="TB_STRING"    size="6"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="VEN_NAME"            colType="TB_STRING"    size="40"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="EXPNC_CLOSE_FLAG"    colType="TB_STRING"    size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="COST_CLOSE_FLAG"     colType="TB_STRING"    size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CLOSE_FLAG"          colType="TB_STRING"    size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="OFFER_TOT_QTY"       colType="TB_DECIMAL"   size="7"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="CHK_TOT_QTY"         colType="TB_DECIMAL"   size="7"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="DI_TOT_QTY"          colType="TB_DECIMAL"   size="7"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CHK_EXC_TAMT"        colType="TB_DECIMAL"   size="13"  dec="2" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="CHK_COST_TAMT"       colType="TB_DECIMAL"   size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
    </gauce>
    
     <gauce name="H_PO_EXPNCM"> 
        <column colName="CHECK1"              colType="TB_STRING"    size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STR_CD"              colType="TB_STRING"    size="2"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="OFFER_YM"            colType="TB_STRING"    size="6"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="OFFER_SEQ_NO"        colType="TB_DECIMAL"   size="5"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="OFFER_DT"            colType="TB_STRING"    size="8"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="OFFER_SHEET_NO"      colType="TB_STRING"    size="30"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="IMP_COST_CD"         colType="TB_STRING"    size="4"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="IMP_COST_NM"         colType="TB_STRING"    size="40"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SUPPLY_CD"           colType="TB_STRING"    size="6"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SUPPLY_NM"           colType="TB_STRING"    size="40"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SUP_AMT"             colType="TB_DECIMAL"   size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="VAT_AMT"             colType="TB_DECIMAL"   size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="TOT_AMT"             colType="TB_DECIMAL"   size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="REMARK"              colType="TB_STRING"    size="100" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="EXPNC_CLOSE_FLAG"    colType="TB_STRING"    size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
     <gauce name="H_COSTCD"> 
        <column colName="COMM_CODE"           colType="TB_STRING"    size="4"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COMM_NAME1"          colType="TB_STRING"    size="20"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
     <gauce name="H_CHK_COST"> 
        <column colName="EXPNC_CLOSE_FLAG"    colType="TB_STRING"    size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COST_CLOSE_FLAG"     colType="TB_STRING"    size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CLOSE_FLAG"          colType="TB_STRING"    size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
   
    <!-- 수입제경비 마스터정보 조회 -->
    <query name="SEL_PO_OFFMST">
        <![CDATA[
			SELECT 'F'               AS  CHECK1
			     , VA.STR_CD
			     , VA.OFFER_YM
			     , VA.OFFER_SEQ_NO
			     , VA.OFFER_DT
			     , VA.OFFER_SHEET_NO
			     , VA.BL_NO
			     , VA.PUMBUN_CD
			     , TA.PUMBUN_NAME
			     , VA.VEN_CD
			     , TB.VEN_NAME
			     , VA.EXPNC_CLOSE_FLAG
			     , VA.COST_CLOSE_FLAG
			     , VA.CLOSE_FLAG
			     , SUM(VA.OFFER_TOT_QTY)    AS OFFER_TOT_QTY
			     , SUM(VA.CHK_TOT_QTY)      AS CHK_TOT_QTY
			     , SUM(VA.OFFER_TOT_QTY) - SUM(VA.CHK_TOT_QTY) AS DI_TOT_QTY
			     , SUM(VA.CHK_EXC_TAMT)     AS CHK_EXC_TAMT
			     , SUM(VA.CHK_COST_TAMT)    AS CHK_COST_TAMT                            
			  FROM (
			        SELECT TA.STR_CD
			             , TA.OFFER_YM
			             , TA.OFFER_SEQ_NO
			             , TA.OFFER_DT
			             , TA.OFFER_SHEET_NO
			             , TA.BL_NO
			             , TA.PUMBUN_CD
			             , TA.VEN_CD
			             , TA.EXPNC_CLOSE_FLAG
			             , TA.COST_CLOSE_FLAG
			             , TA.CLOSE_FLAG
			             , 0 AS OFFER_TOT_QTY
			             , SUM(NVL(TC.CHK_TOT_QTY,0)) AS CHK_TOT_QTY
			             , SUM(NVL(TC.CHK_EXC_TAMT,0)) AS CHK_EXC_TAMT
			             , SUM(NVL(TC.CHK_COST_TAMT,0)) AS CHK_COST_TAMT 
			          FROM DPS.PO_OFFMST TA
			             , DPS.PO_INVMST TB
			             , DPS.PO_SLPMST TC
			         WHERE TA.STR_CD = TB.STR_CD
			           AND TA.OFFER_YM = TB.OFFER_YM
			           AND TA.OFFER_SEQ_NO = TB.OFFER_SEQ_NO
			           AND TB.STR_CD = TC.STR_CD
			           AND TB.INVOICE_YM = TC.INVOICE_YM
			           AND TB.INVOICE_SEQ_NO = TC.INVOICE_SEQ_NO
			           AND TC.SLIP_PROC_STAT = '09'      
			           AND TA.STR_CD = ?                
			           AND TA.OFFER_DT BETWEEN ? AND ?  
			           AND TA.OFFER_SHEET_NO LIKE ?||'%'   
			           AND TA.PUMBUN_CD LIKE ?||'%'        
			           AND TA.VEN_CD LIKE ?||'%'           
			           AND TA.EXPNC_CLOSE_FLAG LIKE ?||'%' 
			         GROUP BY TA.STR_CD
			             , TA.OFFER_YM
			             , TA.OFFER_SEQ_NO
			             , TA.OFFER_DT
			             , TA.OFFER_SHEET_NO
			             , TA.BL_NO
			             , TA.PUMBUN_CD
			             , TA.VEN_CD
			             , TA.EXPNC_CLOSE_FLAG
			             , TA.COST_CLOSE_FLAG
			             , TA.CLOSE_FLAG
			        UNION ALL    
			        SELECT TA.STR_CD
			             , TA.OFFER_YM
			             , TA.OFFER_SEQ_NO
			             , TA.OFFER_DT
			             , TA.OFFER_SHEET_NO
			             , TA.BL_NO
			             , TA.PUMBUN_CD
			             , TA.VEN_CD
			             , TA.EXPNC_CLOSE_FLAG
			             , TA.COST_CLOSE_FLAG
			             , TA.CLOSE_FLAG
			             , SUM(NVL(TA.OFFER_TOT_QTY,0))
			             , 0
			             , 0
			             , 0
			          FROM DPS.PO_OFFMST TA
			         WHERE TA.STR_CD = ?    
			           AND TA.OFFER_DT BETWEEN ? AND ?  
			           AND TA.OFFER_SHEET_NO LIKE ?||'%'        
			           AND TA.PUMBUN_CD LIKE ?||'%'             
			           AND TA.VEN_CD LIKE ?||'%'                
			           AND TA.EXPNC_CLOSE_FLAG LIKE ?||'%' 
			         GROUP BY TA.STR_CD
			             , TA.OFFER_YM
			             , TA.OFFER_SEQ_NO
			             , TA.OFFER_DT
			             , TA.OFFER_SHEET_NO
			             , TA.BL_NO
			             , TA.PUMBUN_CD
			             , TA.VEN_CD
			             , TA.EXPNC_CLOSE_FLAG
			             , TA.COST_CLOSE_FLAG
			             , TA.CLOSE_FLAG
			        ) VA
			        , DPS.PC_STRPBN TA
			        , DPS.PC_STRVENMST TB
			    WHERE VA.STR_CD = TA.STR_CD
			      AND VA.PUMBUN_CD = TA.PUMBUN_CD
			      AND VA.STR_CD = TB.STR_CD
			      AND VA.VEN_CD = TB.VEN_CD
			 GROUP BY VA.STR_CD
			        , VA.OFFER_YM
			        , VA.OFFER_SEQ_NO
			        , VA.OFFER_DT
			        , VA.OFFER_SHEET_NO
			        , VA.BL_NO
			        , VA.PUMBUN_CD
			        , TA.PUMBUN_NAME
			        , VA.VEN_CD
			        , TB.VEN_NAME
			        , VA.EXPNC_CLOSE_FLAG
			        , VA.COST_CLOSE_FLAG
			        , VA.CLOSE_FLAG  
             ORDER BY VA.STR_CD DESC
               ,   VA.OFFER_YM  DESC
               ,   VA.OFFER_SEQ_NO DESC
        ]]>
    </query> 
    
     <!-- 디테일 조회 -->
    <query name="SEL_PO_EXPNCM">
        <![CDATA[
			SELECT 'F'                AS  CHECK1
			     , TA.STR_CD
			     , TA.OFFER_YM
			     , TA.OFFER_SEQ_NO
			     , TA.OFFER_DT
			     , TA.OFFER_SHEET_NO
			     , TA.IMP_COST_CD
			     , TB.COMM_NAME1     AS IMP_COST_NM
			     , TA.SUPPLY_CD
			     , TC.VEN_NAME       AS SUPPLY_NM
			     , NVL(TA.SUP_AMT,0) AS SUP_AMT
			     , NVL(TA.VAT_AMT,0) AS VAT_AMT
			     , NVL(TA.TOT_AMT,0) AS TOT_AMT
			     , TA.REMARK
			     , TD.EXPNC_CLOSE_FLAG
			  FROM DPS.PO_EXPNCM    TA
			     , COM.TC_COMMCODE  TB
			     , DPS.PC_STRVENMST TC
			     , DPS.PO_OFFMST    TD
			 WHERE TA.IMP_COST_CD = TB.COMM_CODE 
			   AND TB.COMM_PART = 'P225'
			   AND TB.SYS_PART = 'D'
			   AND TA.STR_CD = TC.STR_CD(+)
			   AND TA.STR_CD = TD.STR_CD
			   AND TA.OFFER_YM = TD.OFFER_YM
			   AND TA.OFFER_SEQ_NO = TD.OFFER_SEQ_NO
			   AND TA.SUPPLY_CD = TC.VEN_CD(+)
			   AND TA.STR_CD       = ?
			   AND TA.OFFER_YM     = ?
			   AND TA.OFFER_SEQ_NO = ?     
		     ORDER BY TA.STR_CD DESC
		       ,   TA.OFFER_YM  DESC
		       ,   TA.OFFER_SEQ_NO DESC
        ]]>
    </query> 
        
    <!--등록 -->
    <query name="INS_PO_EXPNCM">
        <![CDATA[
			INSERT INTO DPS.PO_EXPNCM (
			                          STR_CD
			                        , OFFER_YM
			                        , OFFER_SEQ_NO
			                        , IMP_COST_CD
			                        , OFFER_DT
			                        , OFFER_SHEET_NO
			                        , SUPPLY_CD
			                        , VAT_RATE
			                        , SUP_AMT
			                        , VAT_AMT
			                        , TOT_AMT
			                        , REMARK
			                        , CLOSE_FLAG
			                        , REG_DATE
			                        , REG_ID
			                          )
			                  VALUES (
			                          ?
			                        , ?
			                        , ?
			                        , ?
			                        , ?
			                        , ?
			                        , ?
			                        , 0
			                        , ?
			                        , ?
			                        , ?
			                        , ?
			                        , 'N'
			                        , SYSDATE
			                        , ?
			                         )
	    ]]>
    </query>   
    
    <!--수정 -->
    <query name="UPD_PO_EXPNCM">
        <![CDATA[
			UPDATE DPS.PO_EXPNCM
			   SET 
			       SUPPLY_CD = ?
			     , SUP_AMT   = ?
			     , VAT_AMT   = ?
			     , TOT_AMT   = ?
			     , REMARK    = ?
			     , MOD_DATE  = SYSDATE
			     , MOD_ID    = ?
			 WHERE STR_CD    = ?
			   AND OFFER_YM     = ?
			   AND OFFER_SEQ_NO = ?
			   AND IMP_COST_CD  = ?
        ]]>
    </query>   
    
    <!--삭제 -->
    <query name="DEL_PO_EXPNCM">
        <![CDATA[
			DELETE FROM DPS.PO_EXPNCM
			 WHERE STR_CD   = ?
			   AND OFFER_YM = ?
			   AND OFFER_SEQ_NO = ?
			   AND IMP_COST_CD  = ?
        ]]>
    </query>   
    
    <!--삭제 -->
    <query name="UPD_CONF">
        <![CDATA[
            UPDATE DPS.PO_OFFMST
               SET EXPNC_CLOSE_FLAG = ?
             WHERE STR_CD           = ?
               AND OFFER_YM         = ?
               AND OFFER_SEQ_NO     = ?
        ]]>
    </query>   
    
    <!--삭제 -->
    <query name="SEL_COST_CD">
        <![CDATA[
            SELECT COMM_CODE
                 , COMM_NAME1 
              FROM COM.TC_COMMCODE
             WHERE COMM_CODE = ?
               AND SYS_PART  = 'D'
               AND COMM_PART = 'P225'
               AND USE_YN = 'Y'
             ORDER BY INQR_ORDER, COMM_CODE
        ]]>
    </query>   
    
    <!--수입제경비 확정시 체크사항 -->
    <query name="CHK_COST">
        <![CDATA[
            SELECT EXPNC_CLOSE_FLAG
                 , COST_CLOSE_FLAG 
                 , CLOSE_FLAG
              FROM DPS.PO_OFFMST
             WHERE STR_CD          = ?
               AND OFFER_SHEET_NO  = ?
        ]]>
    </query>       
</service>