<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 이재득
 * 회 사 명 : FKSS
 * 작 성 일 : 2010.06.22
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  품번별 기간 합계의 손익명세서를 보여준다.
 -->
<service name="/pstk308.pt">
  
  <gauce name="H_SEL_MASTER">        
        <column colName="STR_CD"                       colType="TB_STRING"  size="2"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />        
        <column colName="PUMBUN_CD"                    colType="TB_STRING"  size="6"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_NAME"                  colType="TB_STRING"  size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />        
        <column colName="TAX_FLAG"                     colType="TB_STRING"  size="1"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAX_FLAG_NAME"                colType="TB_STRING"  size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />        
        <column colName="EVENT_FLAG"                   colType="TB_STRING"  size="2"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="EVENT_RATE"                   colType="TB_STRING"  size="2"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MG_RATE"                      colType="TB_DECIMAL" size="5"  dec="2" keyType="TB_NORMAL" roundMode="ROUND" />        
        <column colName="CAO_SALE_AMT"                 colType="TB_DECIMAL" size="11" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />         
        <column colName="CAO_PROFIT_AMT"               colType="TB_DECIMAL" size="11" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />         
        <column colName="CAO_TAX_AMT"                  colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CAO_EX_VAT_SALE_AMT"          colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CAO_EX_VAT_PROFIT_AMT"        colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="BUY_SALE_AMT"                 colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />         
        <column colName="BUY_PROFIT_AMT"               colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="RFD_SALE_AMT"                 colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="RFD_PROFIT_AMT"               colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />         
        <column colName="BORROW_SALE_AMT"              colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="BORROW_PROFIT_AMT"            colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />         
        <column colName="LEND_SALE_AMT"                colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />         
        <column colName="LEND_PROFIT_AMT"              colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STRI_SALE_AMT"                colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STRI_PROFIT_AMT"              colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="STRO_SALE_AMT"                colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />         
        <column colName="STRO_PROFIT_AMT"              colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="STK_ADJ_SALE_AMT"             colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STK_ADJ_PROFIT_AMT"           colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />         
        <column colName="SALE_PRC_UP_BF_AMT"           colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SALE_PRC_DOWN_AF_AMT"         colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />         
        
        <column colName="BUY_TOT_SALE_AMT"             colType="TB_DECIMAL" size="16" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />        
        <column colName="BUY_TOT_PROFIT_AMT"           colType="TB_DECIMAL" size="16" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BUY_TOT_TAX_AMT"              colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BUY_TOT_EX_VAT_SALE_AMT"      colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="BUY_TOT_EX_VAT_PROFIT_AMT"    colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />           
        
        <column colName="SALE_SALE_AMT"                colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SALE_DC_AMT"                  colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />         
        <column colName="SALE_EX_VAT_AMT"              colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />        
        <column colName="SALE_EX_VAT_DC_AMT"           colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_NET_SALE_AMT"            colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_VAT_AMT"                 colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SALE_PROFIT_AMT"              colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />         
        <column colName="SALE_PROFIT_RATE"             colType="TB_DECIMAL" size="7"  dec="2" keyType="TB_NORMAL" roundMode="ROUND" /> 
        
        <column colName="DW_SALE_AMT"                  colType="TB_DECIMAL" size="16" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                 
        <column colName="DW_PROFIT_AMT"                colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DW_TAX_AMT"                   colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />         
        <column colName="DW_EX_VAT_SALE_AMT"           colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />         
        <column colName="DW_EX_VAT_PROFIT_AMT"         colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        
        <column colName="DW_STK_COST_AMT"              colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_COST_AMT"                colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        
        <column colName="LM_MC_PROFIT_AMT"             colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="LM_COST_AMT"                  colType="TB_DECIMAL" size="6" dec="3" keyType="TB_NORMAL" roundMode="ROUND" />
        
        <column colName="EX_VAT_PROFIT_AMT"            colType="TB_DECIMAL" size="6"  dec="3" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COST_RATE"                    colType="TB_DECIMAL" size="6"  dec="3" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NETSALE_PROFIT_RATE"          colType="TB_DECIMAL" size="6" dec="3" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STK_CYCLE_RATE"               colType="TB_DECIMAL" size="6"  dec="3" keyType="TB_NORMAL" roundMode="ROUND" />
 		<column colName="DW_BUY_SALE_AMT"              colType="TB_DECIMAL" size="16" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />        
        <column colName="DW_BUY_PROFIT_AMT"            colType="TB_DECIMAL" size="16" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
  		<column colName="SALE_DC_EX_AMT"               colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
  </gauce> 
  
    <!-- 쿼리는 전부 대문자 -->
    <!-- 마스터 조회 쿼리  -->    
    <query name="SEL_MASTER">
        <![CDATA[            
            SELECT A.STR_CD
                 , A.PUMBUN_CD
                 , A.PUMBUN_NAME
                 , A.TAX_FLAG
                 , A.TAX_FLAG_NAME  
                 , A.EVENT_FLAG
                 , A.EVENT_RATE
                 , A.MG_RATE
                 , SUM(A.CAO_SALE_AMT)                          AS CAO_SALE_AMT              
                 , SUM(A.CAO_PROFIT_AMT)                        AS CAO_PROFIT_AMT            
                 , SUM(A.CAO_TAX_AMT)                           AS CAO_TAX_AMT               
                 , SUM(A.CAO_EX_VAT_SALE_AMT)                   AS CAO_EX_VAT_SALE_AMT       
                 , SUM(A.CAO_EX_VAT_PROFIT_AMT)                 AS CAO_EX_VAT_PROFIT_AMT     
                 , SUM(A.BUY_SALE_AMT)                          AS BUY_SALE_AMT              
                 , SUM(A.BUY_PROFIT_AMT)                        AS BUY_PROFIT_AMT            
                 , SUM(A.RFD_SALE_AMT)                          AS RFD_SALE_AMT              
                 , SUM(A.RFD_PROFIT_AMT)                        AS RFD_PROFIT_AMT            
                 , SUM(A.BORROW_SALE_AMT)                       AS BORROW_SALE_AMT           
                 , SUM(A.BORROW_PROFIT_AMT)                     AS BORROW_PROFIT_AMT         
                 , SUM(A.LEND_SALE_AMT)                         AS LEND_SALE_AMT             
                 , SUM(A.LEND_PROFIT_AMT)                       AS LEND_PROFIT_AMT           
                 , SUM(A.STRI_SALE_AMT)                         AS STRI_SALE_AMT             
                 , SUM(A.STRI_PROFIT_AMT)                       AS STRI_PROFIT_AMT           
                 , SUM(A.STRO_SALE_AMT)                         AS STRO_SALE_AMT             
                 , SUM(A.STRO_PROFIT_AMT)                       AS STRO_PROFIT_AMT           
                 , SUM(A.STK_ADJ_SALE_AMT)                      AS STK_ADJ_SALE_AMT          
                 , SUM(A.STK_ADJ_PROFIT_AMT)                    AS STK_ADJ_PROFIT_AMT        
                 , SUM(A.SALE_PRC_UP_BF_AMT)                    AS SALE_PRC_UP_BF_AMT        
                 , SUM(A.SALE_PRC_DOWN_AF_AMT)                  AS SALE_PRC_DOWN_AF_AMT      
                 , SUM(A.BUY_TOT_SALE_AMT)                      AS BUY_TOT_SALE_AMT          
                 , SUM(A.BUY_TOT_PROFIT_AMT)                    AS BUY_TOT_PROFIT_AMT        
                 , SUM(A.BUY_TOT_TAX_AMT)                       AS BUY_TOT_TAX_AMT           
                 , SUM(A.BUY_TOT_EX_VAT_SALE_AMT)               AS BUY_TOT_EX_VAT_SALE_AMT   
                 , SUM(A.BUY_TOT_EX_VAT_PROFIT_AMT)             AS BUY_TOT_EX_VAT_PROFIT_AMT 
                 , SUM(A.SALE_SALE_AMT)                         AS SALE_SALE_AMT             
                 , SUM(A.SALE_DC_AMT)                           AS SALE_DC_AMT               
                 , SUM(A.SALE_EX_VAT_AMT)                       AS SALE_EX_VAT_AMT           
                 , SUM(A.SALE_EX_VAT_DC_AMT)                    AS SALE_EX_VAT_DC_AMT        
                 , SUM(A.SALE_NET_SALE_AMT)                     AS SALE_NET_SALE_AMT         
                 , SUM(A.SALE_VAT_AMT)                          AS SALE_VAT_AMT                     
                 , SUM(A.SALE_PROFIT_AMT)                      AS SALE_PROFIT_AMT
                 , CASE WHEN SUM(A.SALE_EX_VAT_AMT) = 0 THEN 0
                   ELSE (SUM(A.SALE_PROFIT_AMT)/SUM(A.SALE_EX_VAT_AMT))*100
                   END AS SALE_PROFIT_RATE
                 , SUM(A.DW_SALE_AMT)                            AS DW_SALE_AMT          
                 , SUM(A.DW_PROFIT_AMT)                          AS DW_PROFIT_AMT        
                 , SUM(A.DW_TAX_AMT)                             AS DW_TAX_AMT           
                 , SUM(A.DW_EX_VAT_SALE_AMT)                     AS DW_EX_VAT_SALE_AMT   
                 , SUM(A.DW_EX_VAT_PROFIT_AMT)                   AS DW_EX_VAT_PROFIT_AMT 
                 , SUM(A.DW_STK_COST_AMT)                        AS DW_STK_COST_AMT
                 , SUM(SALE_COST_AMT)                            AS SALE_COST_AMT
                 , SUM(LM_MC_PROFIT_AMT)						AS LM_MC_PROFIT_AMT
                 , SUM(LM_COST_AMT)						AS LM_COST_AMT
                 
                  , CASE WHEN SUM(A.BUY_TOT_EX_VAT_SALE_AMT) = 0 THEN 0
                   ELSE (SUM(A.BUY_TOT_EX_VAT_PROFIT_AMT)/SUM(A.BUY_TOT_EX_VAT_SALE_AMT))*100
                   END                                           AS EX_VAT_PROFIT_AMT   -- 세제외점출차익율 **
                 
                 , CASE WHEN 100 - (CASE WHEN SUM(A.BUY_TOT_EX_VAT_SALE_AMT) = 0 THEN 0
                                        ELSE (SUM(A.BUY_TOT_EX_VAT_PROFIT_AMT)/SUM(A.BUY_TOT_EX_VAT_SALE_AMT))*100
                                    END) > 99.9999 THEN 0
                        ELSE 100 - (CASE WHEN SUM(A.BUY_TOT_EX_VAT_SALE_AMT) = 0 THEN 0
                                        ELSE (SUM(A.BUY_TOT_EX_VAT_PROFIT_AMT)/SUM(A.BUY_TOT_EX_VAT_SALE_AMT))*100
                                    END)
                   END AS COST_RATE           -- 원가율
                   
                   , CASE WHEN SUM(A.SALE_NET_SALE_AMT) = 0 THEN 0
                        ELSE ROUND(SUM(A.SALE_PROFIT_AMT) / SUM(A.SALE_NET_SALE_AMT) * 100, 3)
                   END AS NETSALE_PROFIT_RATE -- 순매출이익율 ** 
                   
                   
                   , CASE WHEN ((SUM(A.CAO_SALE_AMT) + SUM(A.DW_SALE_AMT))/2) = 0 THEN 0
                   ELSE (SUM(A.SALE_SALE_AMT)*2)/((SUM(A.CAO_SALE_AMT) + SUM(A.DW_SALE_AMT))/2) END
                                                                 AS STK_CYCLE_RATE      -- 회전율 **  
                  , SUM(A.DW_BUY_SALE_AMT)                       AS DW_BUY_SALE_AMT          
                 , SUM(A.DW_BUY_PROFIT_AMT)                     AS DW_BUY_PROFIT_AMT 
                 , SUM(A.SALE_DC_EX_AMT)                        AS SALE_DC_EX_AMT                                               
              FROM (
                    SELECT A.STR_CD
                         , A.PUMBUN_CD
                         , DPS.FN_GET_PUMBUN_NAME(A.PUMBUN_CD)          AS PUMBUN_NAME
                         , A.TAX_FLAG
                         , COM.FN_GET_COMM_NAME('D', 'P004', A.TAX_FLAG)AS TAX_FLAG_NAME  
                         , A.EVENT_FLAG
                         , A.EVENT_RATE
                         , A.MG_RATE
                         , SUM(A.CAO_SALE_AMT)                          AS CAO_SALE_AMT              
                         , SUM(A.CAO_PROFIT_AMT)                        AS CAO_PROFIT_AMT            
                         , SUM(A.CAO_TAX_AMT)                           AS CAO_TAX_AMT               
                         , SUM(A.CAO_EX_VAT_SALE_AMT)                   AS CAO_EX_VAT_SALE_AMT       
                         , SUM(A.CAO_EX_VAT_PROFIT_AMT)                 AS CAO_EX_VAT_PROFIT_AMT     
                         , 0                                            AS BUY_SALE_AMT              
                         , 0                                            AS BUY_PROFIT_AMT            
                         , 0                                            AS RFD_SALE_AMT              
                         , 0                                            AS RFD_PROFIT_AMT            
                         , 0                                            AS BORROW_SALE_AMT           
                         , 0                                            AS BORROW_PROFIT_AMT         
                         , 0                                            AS LEND_SALE_AMT             
                         , 0                                            AS LEND_PROFIT_AMT           
                         , 0                                            AS STRI_SALE_AMT             
                         , 0                                            AS STRI_PROFIT_AMT           
                         , 0                                            AS STRO_SALE_AMT             
                         , 0                                            AS STRO_PROFIT_AMT           
                         , 0                                            AS STK_ADJ_SALE_AMT          
                         , 0                                            AS STK_ADJ_PROFIT_AMT        
                         , 0                                            AS SALE_PRC_UP_BF_AMT        
                         , 0                                            AS SALE_PRC_DOWN_AF_AMT      
                         , 0                                            AS BUY_TOT_SALE_AMT          
                         , 0                                            AS BUY_TOT_PROFIT_AMT        
                         , 0                                            AS BUY_TOT_TAX_AMT           
                         , 0                                            AS BUY_TOT_EX_VAT_SALE_AMT   
                         , 0                                            AS BUY_TOT_EX_VAT_PROFIT_AMT 
                         , 0                                            AS SALE_SALE_AMT             
                         , 0                                            AS SALE_DC_AMT               
                         , 0                                            AS SALE_EX_VAT_AMT           
                         , 0                                            AS SALE_EX_VAT_DC_AMT        
                         , 0                                            AS SALE_NET_SALE_AMT         
                         , 0                                            AS SALE_VAT_AMT              
                         , 0                                            AS SALE_PROFIT_AMT
                         , 0                                            AS SALE_PROFIT_RATE
                         , 0                                            AS DW_SALE_AMT          
                         , 0                                            AS DW_PROFIT_AMT        
                         , 0                                            AS DW_TAX_AMT           
                         , 0                                            AS DW_EX_VAT_SALE_AMT   
                         , 0                                            AS DW_EX_VAT_PROFIT_AMT 
                         , 0                                            AS DW_STK_COST_AMT
                         , 0                                            AS SALE_COST_AMT
                         , 0                                            AS STK_CYCLE_RATE
                         , 0                                            AS LM_STK_COST_AMT
                         , 0											AS LM_MC_PROFIT_AMT
                         , 0											AS LM_COST_AMT
                      	 , 0                       AS DW_BUY_SALE_AMT          
                         , 0                     AS DW_BUY_PROFIT_AMT  
                         , 0 					AS SALE_DC_EX_AMT
                    FROM DPS.PT_PBNMONPROFIT  A
                         , DPS.PC_ORGMST        B
                         , DPS.PC_PBNMST        C
                         , DPS.PC_STRPBN        D
                     WHERE (CASE WHEN ? = '1' THEN D.SALE_ORG_CD ELSE D.BUY_ORG_CD END)      = B.ORG_CD
                       AND A.PUMBUN_CD   = C.PUMBUN_CD
                       AND A.STR_CD      = D.STR_CD
                       AND A.PUMBUN_CD   = D.PUMBUN_CD
                       AND C.SKU_FLAG    LIKE '%' || '%'
                       AND A.STR_CD      = ?
                       AND A.YYYYMM      = ?   
                          
        ]]>    
    </query>
    
    <query name="SEL_MASTER_UNION">
        <![CDATA[      
                     GROUP BY 
                           A.STR_CD   
                         , A.PUMBUN_CD
                         , A.TAX_FLAG    
                         , A.EVENT_FLAG
                         , A.EVENT_RATE
                         , A.MG_RATE     
                     UNION ALL
                    SELECT A.STR_CD
                         , A.PUMBUN_CD
                         , DPS.FN_GET_PUMBUN_NAME(A.PUMBUN_CD)          AS PUMBUN_NAME
                         , A.TAX_FLAG
                         , COM.FN_GET_COMM_NAME('D', 'P004', A.TAX_FLAG)AS TAX_FLAG_NAME  
                         , A.EVENT_FLAG
                         , A.EVENT_RATE
                         , A.MG_RATE
                         , 0                                            AS CAO_SALE_AMT              
                         , 0                                            AS CAO_PROFIT_AMT            
                         , 0                                            AS CAO_TAX_AMT               
                         , 0                                            AS CAO_EX_VAT_SALE_AMT       
                         , 0                                            AS CAO_EX_VAT_PROFIT_AMT     
                         , SUM(A.BUY_SALE_AMT)                          AS BUY_SALE_AMT              
                         , SUM(A.BUY_PROFIT_AMT)                        AS BUY_PROFIT_AMT            
                         , SUM(A.RFD_SALE_AMT)                          AS RFD_SALE_AMT              
                         , SUM(A.RFD_PROFIT_AMT)                        AS RFD_PROFIT_AMT            
                         , SUM(A.BORROW_SALE_AMT)                       AS BORROW_SALE_AMT           
                         , SUM(A.BORROW_PROFIT_AMT)                     AS BORROW_PROFIT_AMT         
                         , SUM(A.LEND_SALE_AMT)                         AS LEND_SALE_AMT             
                         , SUM(A.LEND_PROFIT_AMT)                       AS LEND_PROFIT_AMT           
                         , SUM(A.STRI_SALE_AMT)                         AS STRI_SALE_AMT             
                         , SUM(A.STRI_PROFIT_AMT)                       AS STRI_PROFIT_AMT           
                         , SUM(A.STRO_SALE_AMT)                         AS STRO_SALE_AMT             
                         , SUM(A.STRO_PROFIT_AMT)                       AS STRO_PROFIT_AMT           
                         , SUM(A.STK_ADJ_SALE_AMT)                      AS STK_ADJ_SALE_AMT          
                         , SUM(A.STK_ADJ_PROFIT_AMT)                    AS STK_ADJ_PROFIT_AMT        
                         , SUM(A.SALE_PRC_UP_BF_AMT)                    AS SALE_PRC_UP_BF_AMT        
                         , SUM(A.SALE_PRC_DOWN_AF_AMT)                  AS SALE_PRC_DOWN_AF_AMT      
                         , SUM(A.BUY_TOT_SALE_AMT)                      AS BUY_TOT_SALE_AMT          
                         , SUM(A.BUY_TOT_PROFIT_AMT)                    AS BUY_TOT_PROFIT_AMT        
                         , SUM(A.BUY_TOT_TAX_AMT)                       AS BUY_TOT_TAX_AMT           
                         , SUM(A.BUY_TOT_EX_VAT_SALE_AMT)               AS BUY_TOT_EX_VAT_SALE_AMT   
                         , SUM(A.BUY_TOT_EX_VAT_PROFIT_AMT)             AS BUY_TOT_EX_VAT_PROFIT_AMT 
                         , SUM(A.SALE_SALE_AMT)                         AS SALE_SALE_AMT             
                         , SUM(A.SALE_DC_AMT)                           AS SALE_DC_AMT               
                         , SUM(A.SALE_EX_VAT_AMT)                       AS SALE_EX_VAT_AMT           
                         , SUM(A.SALE_EX_VAT_DC_AMT)                    AS SALE_EX_VAT_DC_AMT        
                         , SUM(A.SALE_NET_SALE_AMT)                     AS SALE_NET_SALE_AMT         
                         , SUM(A.SALE_VAT_AMT)                          AS SALE_VAT_AMT            
                         , SUM(A.LM_MC_PROFIT_AMT)                      AS SALE_PROFIT_AMT
                         , 0                                            AS SALE_PROFIT_RATE
                         , SUM(A.DW_SALE_AMT)                           AS DW_SALE_AMT          
                         , SUM(A.DW_PROFIT_AMT)                         AS DW_PROFIT_AMT        
                         , SUM(A.DW_TAX_AMT)                            AS DW_TAX_AMT           
                         , SUM(A.DW_EX_VAT_SALE_AMT)                    AS DW_EX_VAT_SALE_AMT   
                         , SUM(A.DW_EX_VAT_PROFIT_AMT)                  AS DW_EX_VAT_PROFIT_AMT 
                         , SUM(A.LM_STK_COST_AMT)                       AS DW_STK_COST_AMT
                         , SUM(A.LM_MC_COST_AMT)                        AS SALE_COST_AMT
                         , 0                                            AS STK_CYCLE_RATE
                         , SUM(A.LM_STK_COST_AMT)                       AS LM_STK_COST_AMT
                         , SUM(A.LM_MC_PROFIT_AMT)                       AS LM_MC_PROFIT_AMT    -- 상품매출이익액
                         , SUM(A.LM_COST_AMT)                            AS LM_COST_AMT         -- 매입원가
                         , SUM(A.DW_BUY_SALE_AMT)                       AS DW_BUY_SALE_AMT          
                 		 , SUM(A.DW_BUY_PROFIT_AMT)                     AS DW_BUY_PROFIT_AMT  
                 		 , SUM(SALE_DC_EX_AMT)						    AS SALE_DC_EX_AMT 
                       FROM DPS.PT_PBNMONPROFIT  A
                         , DPS.PC_ORGMST        B
                         , DPS.PC_PBNMST        C
                         , DPS.PC_STRPBN        D
                     WHERE (CASE WHEN ? = '1' THEN D.SALE_ORG_CD ELSE D.BUY_ORG_CD END)      = B.ORG_CD
                       AND A.PUMBUN_CD   = C.PUMBUN_CD
                       AND A.STR_CD      = D.STR_CD
                       AND A.PUMBUN_CD   = D.PUMBUN_CD
                       AND C.SKU_FLAG    LIKE '%' || '%'
                       AND A.STR_CD      = ?
                       AND A.YYYYMM      BETWEEN ? AND ?
        ]]>    
    </query>
    
    <query name="SEL_MASTER_WHERE_DEPT_CD">
        <![CDATA[
                       AND B.DEPT_CD    = ?             
        ]]>    
    </query>
    
    <query name="SEL_MASTER_WHERE_TEAM_CD">
        <![CDATA[
                       AND B.TEAM_CD    = ?             
        ]]>    
    </query>
    
    <query name="SEL_MASTER_WHERE_PC_CD">
        <![CDATA[
                       AND B.PC_CD    = ?             
        ]]>    
    </query>
    
    <query name="SEL_MASTER_WHERE_BIZFLAG">
        <![CDATA[
                       AND C.BIZ_FLAG    = ?             
        ]]>    
    </query>
    
    <query name="SEL_MASTER_WHERE_PUMBUN_CD">
        <![CDATA[
                       AND A.PUMBUN_CD    = ?             
        ]]>    
    </query>
    
    <query name="SEL_MASTER_GROUP">
        <![CDATA[         
                     GROUP BY 
                           A.STR_CD   
                         , A.PUMBUN_CD
                         , A.TAX_FLAG    
                         , A.EVENT_FLAG
                         , A.EVENT_RATE
                         , A.MG_RATE    
                   ) A
            GROUP BY
                  A.STR_CD
                , A.PUMBUN_CD
                , A.PUMBUN_NAME
                , A.TAX_FLAG
                , A.TAX_FLAG_NAME  
                , A.EVENT_FLAG
                , A.EVENT_RATE
                , A.MG_RATE              
        ]]>    
    </query>
    
    <query name="SEL_MASTER_ORDER">
        <![CDATA[
            ORDER BY 
                  A.PUMBUN_CD  
                , A.TAX_FLAG_NAME  
                , A.EVENT_FLAG
                , A.EVENT_RATE
                , A.MG_RATE                 
        ]]>    
    </query>    
   
</service>