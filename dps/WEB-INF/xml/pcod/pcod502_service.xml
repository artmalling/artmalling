<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 정진영
 * 회 사 명 : FKSS
 * 작 성 일 : 2010.03.15
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  신선담품코드를 관리한다.
 -->
<service name="/pcod502.pc">
    <!-- 신선단품 그리드 -->
    <gauce name="H_SEL_MASTER">
        <column colName="PUMBUN_CD"        colType="TB_STRING"  size="6"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_NAME"      colType="TB_STRING"  size="40"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REP_PUMBUN_NAME"  colType="TB_STRING"  size="40"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="VEN_NAME"         colType="TB_STRING"  size="40"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SKU_CD"           colType="TB_STRING"  size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PLU_FLAG"         colType="TB_STRING"  size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SKU_NAME"         colType="TB_STRING"  size="40"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="RECP_NAME"        colType="TB_STRING"  size="20"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMMOK_CD"        colType="TB_STRING"  size="8"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMMOK_NAME"      colType="TB_STRING"  size="40"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_AREA_CD"   colType="TB_STRING"  size="3"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_AREA_NAME" colType="TB_STRING"  size="40"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_UNIT_CD"     colType="TB_STRING"  size="3"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MODEL_NO"         colType="TB_STRING"  size="24"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CMP_SPEC_CD"      colType="TB_DECIMAL" size="5"   dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CMP_SPEC_UNIT"    colType="TB_STRING"  size="3"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BAS_SPEC_CD"      colType="TB_DECIMAL" size="8"   dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BAS_SPEC_UNIT"    colType="TB_STRING"  size="3"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REMARK"           colType="TB_STRING"  size="100" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SET_YN"           colType="TB_STRING"  size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="GIFT_FLAG"        colType="TB_STRING"  size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MAKER_CD"         colType="TB_STRING"  size="6"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MAKER_NAME"       colType="TB_STRING"  size="40"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="USE_YN"           colType="TB_STRING"  size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_TYPE"      colType="TB_STRING"  size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SKU_TYPE"         colType="TB_STRING"  size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STYLE_TYPE"       colType="TB_STRING"  size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BIZ_TYPE"         colType="TB_STRING"  size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAX_FLAG"         colType="TB_STRING"  size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    <gauce name="H_SEL_DETAIL">
        <column colName="SEL"             colType="TB_STRING"  size="1"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STR_CD"          colType="TB_STRING"  size="2"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SKU_CD"          colType="TB_STRING"  size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="VEN_CD"          colType="TB_STRING"  size="6"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SAL_COST_PRC"    colType="TB_INT"     size="9"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_PRC"        colType="TB_INT"     size="9"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_MG_RATE"    colType="TB_DECIMAL" size="5"  dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_S_DT"       colType="TB_STRING"  size="8"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_E_DT"       colType="TB_STRING"  size="8"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BUY_S_DT"        colType="TB_STRING"  size="8"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BUY_E_DT"        colType="TB_STRING"  size="8"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="USE_YN"          colType="TB_STRING"  size="1"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ROUND_FLAG"      colType="TB_STRING"  size="1"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="LOW_MG_RATE"     colType="TB_DECIMAL" size="5"  dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BIZ_TYPE"        colType="TB_STRING"  size="1"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_TYPE"     colType="TB_STRING"  size="1"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="GOAL_PROF_RATE"  colType="TB_DECIMAL" size="5"  dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce> 
    <!-- 쿼리는 전부 대문자 -->
    <!-- 신선단품코드 마스터 조회 -->
    <query name="SEL_SKUMST">    
        <![CDATA[
            SELECT PBN.PUMBUN_CD        , PBN.PUMBUN_NAME                   , REP.NAME      AS REP_PUMBUN_NAME  , VEN.VEN_NAME       , SKU.SKU_CD
                 , SKU.PLU_FLAG         , SKU.SKU_NAME                      , SKU.RECP_NAME                     , PMK.PUMMOK_CD      , PMK.PUMMOK_NAME
                 , SKU.ORIGIN_AREA_CD   , ORIGIN.NAME   AS ORIGIN_AREA_NAME , SKU.SALE_UNIT_CD                  , SKU.MODEL_NO       , SKU.CMP_SPEC_CD 
                 , SKU.CMP_SPEC_UNIT    , SKU.BAS_SPEC_CD                   , SKU.BAS_SPEC_UNIT                 , SKU.REMARK         , SKU.SET_YN 
                 , SKU.GIFT_FLAG        , SKU.MAKER_CD                      , MAKER.NAME   AS MAKER_NAME        , SKU.USE_YN         , SKU.PUMBUN_TYPE                   
                 , SKU.SKU_TYPE         , SKU.STYLE_TYPE                    , PBN.BIZ_TYPE                      , PBN.TAX_FLAG
              FROM DPS.PC_SKUMST SKU
                 , DPS.PC_PBNMST PBN
                 , DPS.PC_VENMST VEN
                 , DPS.PC_PMKMST PMK
                 , (SELECT COMM_CODE    AS CODE
                         , COMM_NAME1   AS NAME
                      FROM COM.TC_COMMCODE
                     WHERE SYS_PART  = 'D'
                       AND COMM_PART = 'P040'
                       AND USE_YN = 'Y'
                   ) ORIGIN
                 , (SELECT COMM_CODE    AS CODE
                         , COMM_NAME1   AS NAME
                      FROM COM.TC_COMMCODE
                     WHERE SYS_PART  = 'D'
                       AND COMM_PART = 'P019'
                       AND USE_YN = 'Y'
                   ) MAKER
                 , (SELECT PUMBUN_CD     AS CODE
                         , PUMBUN_NAME   AS NAME
                      FROM DPS.PC_PBNMST
                     WHERE PUMBUN_CD = REP_PUMBUN_CD
                   ) REP
             WHERE SKU.PUMBUN_CD      = PBN.PUMBUN_CD
               AND SKU.PUMMOK_CD      = PMK.PUMMOK_CD
               AND PBN.VEN_CD         = VEN.VEN_CD
               AND PBN.REP_PUMBUN_CD  = REP.CODE
               AND SKU.ORIGIN_AREA_CD = ORIGIN.CODE(+)
               AND SKU.MAKER_CD       = MAKER.CODE(+)
               AND SKU.PUMBUN_CD      = ?
        ]]>
    </query>
    <query name="SEL_SKUMST_WHERE_PUMMOK_CD">
        <![CDATA[
               AND SKU.PUMMOK_CD      = ?
        ]]>
    </query>
    <query name="SEL_SKUMST_WHERE_SKU_CD">
        <![CDATA[
               AND SKU.SKU_CD      LIKE ?||'%' 
        ]]>
    </query>
    <query name="SEL_SKUMST_WHERE_SKU_NAME">
        <![CDATA[
               AND SKU.SKU_NAME    LIKE '%'||?||'%'      
        ]]>  
    </query>
    <query name="SEL_SKUMST_WHERE_USE_YN">
        <![CDATA[
               AND SKU.USE_YN    LIKE '%'||?||'%'    
        ]]>    
    </query>
    <query name="SEL_SKUMST_ORDER">
        <![CDATA[
             ORDER BY SKU.SKU_CD
        ]]>
    </query>
    <!-- 점별 단품코드 조회   -->
    <query name="SEL_STRSKUMST">
        <![CDATA[
           SELECT CASE WHEN SSM.SKU_CD IS NULL THEN 'F' ELSE 'T' END   AS SEL
                 , SPN.STR_CD
                 , SSM.SKU_CD
                 , NVL(SSM.VEN_CD,SPN.VEN_CD)                      AS VEN_CD
                 , SSM.SAL_COST_PRC
                 , SSM.SALE_PRC
                 , SSM.SALE_MG_RATE
                 , NVL(SSM.SALE_S_DT,TO_CHAR(SYSDATE+1,'YYYYMMDD'))  AS SALE_S_DT
                 , NVL(SSM.SALE_E_DT,'99991231')                   AS SALE_E_DT
                 , NVL(SSM.BUY_S_DT,TO_CHAR(SYSDATE+1,'YYYYMMDD'))   AS BUY_S_DT
                 , NVL(SSM.BUY_E_DT,'99991231')                    AS BUY_E_DT
                 , NVL(SSM.USE_YN,'Y')                             AS USE_YN
                 , SVM.RUND_FLAG
                 , SPN.LOW_MG_RATE
                 , SPN.BIZ_TYPE
                 , SPN.PUMBUN_TYPE
                 , (SELECT GOAL_PROF_RATE
                      FROM DPS.PC_STRPMKPRFRT
                     WHERE STR_CD    = SPN.STR_CD
                       AND TO_CHAR(SYSDATE,'YYYYMMDD') BETWEEN APP_S_DT AND APP_E_DT
                       AND PUMMOK_CD = (SELECT PUMMOK_CD 
                                          FROM DPS.PC_SKUMST 
                                         WHERE SKU_CD = ?
                                       )
                   )                                               AS GOAL_PROF_RATE
              FROM DPS.PC_STRPBN SPN
                 , DPS.PC_STRSKUMST SSM
                 , DPS.PC_STRVENMST SVM
             WHERE SPN.STR_CD    = SVM.STR_CD
               AND SPN.VEN_CD    = SVM.VEN_CD
               AND SPN.STR_CD    = SSM.STR_CD(+)
               AND SPN.PUMBUN_CD = ?
               AND SSM.SKU_CD(+) = ?
             ORDER BY SPN.STR_CD
        ]]>
    </query>
    <!-- 단품  마스터 신규 코드 생성  -->
    <query name="SEL_SKUMST_NEW_CD">
        <![CDATA[
            SELECT '20'||LPAD(DPS.SQ_PCSKU20.NEXTVAL,5,'0')||'00000' AS NEW_SKU_CD
              FROM DUAL
        ]]>
    </query>
    <!-- 단품  마스터 중복체크  -->
    <query name="SEL_SKUMST_SKU_CD_CNT">
        <![CDATA[
            SELECT COUNT(*)  AS CNT
              FROM DPS.PC_SKUMST
             WHERE SKU_CD = ?
               AND ROWNUM = 1
        ]]>
    </query>
    <!-- 바코드  마스터 중복체크  -->
    <query name="SEL_BARCDMST_BAR_CODE_CNT">
        <![CDATA[
        SELECT COUNT(*)  AS CNT
          FROM DPS.PC_BARCDMST
         WHERE BARCODE = ?
           AND SKU_CD != ?
           AND ROWNUM  = 1
        ]]>
    </query>
    <!-- 단품  마스터 신규 입력  -->
    <query name="INS_SKUMST">
        <![CDATA[
            INSERT INTO DPS.PC_SKUMST(SKU_CD        
                                    , SKU_NAME      
                                    , RECP_NAME     
                                    , PUMBUN_TYPE   
                                    , PUMBUN_CD     
                                    , PUMMOK_CD     
                                    , SKU_TYPE      
                                    , STYLE_TYPE    
                                    , PLU_FLAG   
                                    , MODEL_NO      
                                    , SALE_UNIT_CD  
                                    , CMP_SPEC_CD   
                                    , CMP_SPEC_UNIT 
                                    , BAS_SPEC_CD   
                                    , BAS_SPEC_UNIT 
                                    , ORIGIN_AREA_CD
                                    , MAKER_CD      
                                    , SET_YN        
                                    , GIFT_FLAG     
                                    , REMARK        
                                    , USE_YN        
                                    , REG_DATE      
                                    , REG_ID        
                                    , MOD_DATE      
                                    , MOD_ID        
                                     )
                               VALUES(?   
                                    , ?   
                                    , ?     
                                    , ?     
                                    , ?      
                                    , ?    
                                    , ?      
                                    , ?  
                                    , ?      
                                    , ?  
                                    , ?   
                                    , ? 
                                    , ?
                                    , ?      
                                    , ?        
                                    , ?     
                                    , ?  
                                    , ? 
                                    , ?       
                                    , ?     
                                    , ?        
                                    , SYSDATE      
                                    , ?        
                                    , SYSDATE      
                                    , ?    
                                     ) 
        ]]>
    </query>
    
    <!-- 단품  마스터 수정 입력  -->
    <query name="UPD_SKUMST">
        <![CDATA[
            UPDATE DPS.PC_SKUMST
               SET SKU_NAME         = ?
                 , RECP_NAME        = ?
                 , PUMBUN_TYPE      = ?  
                 , PUMBUN_CD        = ?   
                 , PUMMOK_CD        = ?    
                 , SKU_TYPE         = ?   
                 , STYLE_TYPE       = ?    
                 , PLU_FLAG         = ?
                 , MODEL_NO         = ?
                 , SALE_UNIT_CD     = ?
                 , CMP_SPEC_CD      = ?
                 , CMP_SPEC_UNIT    = ?
                 , BAS_SPEC_CD      = ?
                 , BAS_SPEC_UNIT    = ?
                 , ORIGIN_AREA_CD   = ?
                 , MAKER_CD         = ?
                 , SET_YN           = ?
                 , GIFT_FLAG        = ?
                 , REMARK           = ?
                 , USE_YN           = ?
                 , MOD_DATE         = SYSDATE
                 , MOD_ID           = ?
             WHERE SKU_CD           = ?
        ]]>
    </query>   
    
    <!-- 품목단축코드를 조회  -->
    <query name="SEL_PMKMST_PMK_SRT_CD">
        <![CDATA[
            SELECT PUMMOK_SRT_CD
              FROM DPS.PC_PMKMST
             WHERE PUMMOK_CD   = ?
        ]]>
    </query>
    <!-- 점별단품 신규 입력  -->
    <query name="INS_STRSKUMST">
        <![CDATA[
            INSERT INTO DPS.PC_STRSKUMST(STR_CD        
                                       , SKU_CD    
                                       , SKU_NAME  
                                       , VEN_CD        
                                       , RECP_NAME     
                                       , PUMBUN_TYPE   
                                       , PUMBUN_CD     
                                       , SKU_TYPE      
                                       , STYLE_TYPE
                                       , SAL_COST_PRC  
                                       , SALE_PRC      
                                       , SALE_MG_RATE  
                                       , SALE_S_DT     
                                       , SALE_E_DT     
                                       , BUY_S_DT      
                                       , BUY_E_DT      
                                       , USE_YN
                                       , REG_DATE
                                       , REG_ID
                                       , MOD_DATE
                                       , MOD_ID
                                        )
                                  VALUES(?
                                       , ?  
                                       , ?  
                                       , ?      
                                       , ?  
                                       , ?
                                       , ?  
                                       , ?      
                                       , ?
                                       , ?   
                                       , ?   
                                       , ?
                                       , ?     
                                       , ?     
                                       , ?      
                                       , ?      
                                       , ?
                                       , SYSDATE
                                       , ?
                                       , SYSDATE
                                       , ?
                                        )
        ]]>
    </query>
    
    <!-- 소스마킹코드 신규 입력  -->
    <query name="INS_BARCDMST">
        <![CDATA[
            INSERT INTO DPS.PC_BARCDMST(STR_CD        
                                      , BARCODE        
                                      , SKU_CD      
                                      , PUMBUN_CD     
                                      , REG_DATE
                                      , REG_ID
                                      , MOD_DATE
                                      , MOD_ID
                                       )
                                 VALUES(?        
                                      , ?        
                                      , ?      
                                      , ?     
                                      , SYSDATE
                                      , ?
                                      , SYSDATE
                                      , ?
                                       )
        ]]>
    </query>
    
    <!-- 점별단품가격마스터 신규 입력  -->
    <query name="INS_STRSKUPRCMST">
        <![CDATA[
            INSERT INTO DPS.PC_STRSKUPRCMST(STR_CD        
                                          , SKU_CD        
                                          , EVENT_CD      
                                          , APP_S_DT        
                                          , APP_E_DT   
                                          , NORM_COST_PRC     
                                          , NORM_SALE_PRC   
                                          , NORM_MG_RATE    
                                          , SAL_COST_PRC     
                                          , SALE_PRC   
                                          , SALE_MG_RATE
                                          , REDU_RATE 
                                          , REG_DATE
                                          , REG_ID
                                          , MOD_DATE
                                          , MOD_ID
                                           )
                                     VALUES(?        
                                          , ?        
                                          , ?      
                                          , TO_CHAR(SYSDATE+1,'YYYYMMDD')        
                                          , ?   
                                          , ?     
                                          , ?   
                                          , ?    
                                          , ?     
                                          , ?   
                                          , ?
                                          , ? 
                                          , SYSDATE
                                          , ?
                                          , SYSDATE
                                          , ?
                                           )
        ]]>
    </query>
    
    <!-- 점별단품 수정 입력  -->
    <query name="UPD_STRSKUMST">
        <![CDATA[
            UPDATE DPS.PC_STRSKUMST
               SET SKU_NAME      = ?
                 , RECP_NAME     = ?
                 , SALE_S_DT     = ?
                 , SALE_E_DT     = ?
                 , BUY_S_DT      = ?
                 , BUY_E_DT      = ?
                 , USE_YN        = ?
                 , MOD_DATE      = SYSDATE
                 , MOD_ID        = ?
             WHERE STR_CD        = ?
               AND SKU_CD        = ?
        ]]>
    </query>
    
    <!-- 점별단품 수정 입력(스타일 수정시)  -->
    <query name="UPD_STRSKUMST_SKU">
        <![CDATA[
            UPDATE DPS.PC_STRSKUMST
               SET SKU_NAME         = ?
                 , RECP_NAME        = ?
                 , PUMBUN_TYPE      = ?  
                 , MOD_DATE         = SYSDATE
                 , MOD_ID           = ?
             WHERE SKU_CD           = ?
        ]]>
    </query>
    
    <!-- 소스마킹코드 수정 입력  -->
    <query name="UPD_BARCDMST">
        <![CDATA[
            UPDATE DPS.PC_BARCDMST
               SET PUMMOK_CD      = ?
                 , PUMMOK_SRT_CD  = ?
                 , MOD_DATE       = SYSDATE
                 , MOD_ID         = ?
             WHERE STR_CD         = ?
               AND BARCODE        = ?
        ]]>
    </query>
</service>