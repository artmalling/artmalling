<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 박종은
 * 회 사 명 : 한국후지쯔
 * 작 성 일 : 2010.04.08
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  
 -->
<service name="/psal436.ps">

    <gauce name="H_SEL_MASTER"> 
        <column colName="SALE_DT"                 colType="TB_STRING"      size="8"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="POS_NO"                  colType="TB_STRING"      size="4"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TRAN_NO"                 colType="TB_STRING"      size="5"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TRAN_MODE"               colType="TB_STRING"      size="20"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TRAN_FLAG"               colType="TB_STRING"      size="10"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_AMT_TOT"            colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REDU_PRC"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_AMT"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DC_PRC"                  colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NET_SALE_AMT"            colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_PROF_AMT"           colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STR_CD"                  colType="TB_STRING"      size="2"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_TIME"               colType="TB_STRING"      size="6"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="O_POS_NO"                colType="TB_STRING"      size="4"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="O_SALE_DT"               colType="TB_STRING"      size="8"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="O_TRAN_NO"               colType="TB_STRING"      size="5"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <gauce name="H_SEL_DETAIL"> 
        <column colName="SEQ_NO"                  colType="TB_DECIMAL"     size="3"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_CD"               colType="TB_STRING"      size="6"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_NAME"             colType="TB_STRING"      size="40"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMMOK_CD"               colType="TB_STRING"      size="8"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMMOK_NAME"             colType="TB_STRING"      size="40"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SKU_CD"                  colType="TB_STRING"      size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SKU_NAME"                colType="TB_STRING"      size="40"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_AMT_TOT"            colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CANCEL_FLAG"             colType="TB_STRING"      size="10"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <gauce name="H_SEL_DETAIL2"> 
        <column colName="DIS_FLAG"               colType="TB_STRING"      size="100"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DIS_NAME"               colType="TB_STRING"      size="100"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DIS_AMT"                colType="TB_DECIMAL"     size="20"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DIS_SORT"               colType="TB_STRING"      size="100"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="CARD_DATA"              colType="TB_STRING"      size="100"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="INSTALLMENT_MONTH"      colType="TB_STRING"      size="100"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="CARD_COMP"              colType="TB_STRING"      size="100"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="APPR_NO"                colType="TB_STRING"      size="100"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="APPR_TIME"              colType="TB_STRING"      size="100"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="APPR_VANID"             colType="TB_STRING"      size="100"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="INPUT_FLAG"             colType="TB_STRING"      size="100"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="INPUT_TYPE"             colType="TB_STRING"      size="100"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
          
    <gauce name="H_SEL_POSNO"> 
        <column colName="POSNO"                   colType="TB_STRING"      size="4"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <gauce name="H_SEL_POSNOMM"> 
        <column colName="POSNO_MIN"                   colType="TB_STRING"      size="4"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="POSNO_MAX"                   colType="TB_STRING"      size="4"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    
    <gauce name="H_SEL_POINT"> 
        <column colName="CUST_ID"                   colType="TB_STRING"      size="50"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUST_NAME"                 colType="TB_STRING"      size="50"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CARD_NO"                   colType="TB_STRING"      size="50"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="HP"                        colType="TB_STRING"      size="50"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="OCC_POINT"                 colType="TB_STRING"      size="50"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        
    </gauce>
    
    
    <!-- 쿼리는 전부 대문자 -->
    
    <query name="SEL_SALE_POS_M">        
        <![CDATA[
			        SELECT A.SALE_DT
			             , A.POS_NO
			             , A.TRAN_NO
			             , E.COMM_NAME1                                                                                      AS TRAN_MODE
						/*
			             , (CASE WHEN C.TRAN_FLAG = '0' THEN '정상' WHEN C.TRAN_FLAG = '1' THEN '반품' ELSE '오타' END)       AS TRAN_FLAG
			             , (CASE WHEN C.TRAN_FLAG = '0' THEN (CASE WHEN C.TRAN_MODE = '92' THEN 0 ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE 1 END * A.TOT_SALE_AMT_TAX) END) ELSE  SUM(A.TOT_SALE_AMT_TAX) *-1 END)                   AS SALE_AMT_TOT
			             , (CASE WHEN C.TRAN_FLAG = '0' THEN (CASE WHEN C.TRAN_MODE = '92' THEN 0 ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE 1 END * A.REDU_PRC * A.SALE_QTY) END) ELSE   SUM(A.REDU_PRC)*-1 END)                   AS REDU_PRC
			             , (CASE WHEN C.TRAN_FLAG = '0' THEN (CASE WHEN C.TRAN_MODE = '92' THEN 0 ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE 1 END * A.TOT_SALE_AMT_TAX)-SUM(A.REDU_PRC) END) ELSE (SUM(A.TOT_SALE_AMT_TAX)-SUM(A.REDU_PRC))*-1 END)          AS SALE_AMT
			             , (CASE WHEN C.TRAN_FLAG = '0' THEN (CASE WHEN C.TRAN_MODE = '92' THEN 0 ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE 1 END * A.DC_PRC * A.SALE_QTY) END)  ELSE   SUM(A.DC_PRC) *-1 END)                     AS DC_PRC
			             , (CASE WHEN C.TRAN_FLAG = '0' THEN (CASE WHEN C.TRAN_MODE = '92' THEN 0 ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE 1 END * A.SALE_AMT) END)  ELSE SUM(A.SALE_AMT)*-1  END)                   AS NET_SALE_AMT
			             , (CASE WHEN C.TRAN_FLAG = '0' THEN (CASE WHEN C.TRAN_MODE = '92' THEN 0 ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE 1 END * A.SALE_PROF_AMT) END)  ELSE SUM(A.SALE_PROF_AMT) *-1 END)         AS SALE_PROF_AMT

				         , (CASE WHEN C.TRAN_FLAG = '0' THEN '정상' WHEN C.TRAN_FLAG = '1' THEN '반품' ELSE '오타' END)       AS TRAN_FLAG
			             , (CASE WHEN C.TRAN_FLAG = '0' THEN (CASE WHEN C.TRAN_MODE = '92' THEN 0 ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE 1 END * A.TOT_SALE_AMT_TAX) END) ELSE  SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE -1 END * A.TOT_SALE_AMT_TAX) END)                   AS SALE_AMT_TOT
			             , (CASE WHEN C.TRAN_FLAG = '0' THEN (CASE WHEN C.TRAN_MODE = '92' THEN 0 ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE 1 END * A.REDU_PRC * A.SALE_QTY) END) ELSE   SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE -1 END * A.REDU_PRC) END)                   AS REDU_PRC
			             , (CASE WHEN C.TRAN_FLAG = '0' THEN (CASE WHEN C.TRAN_MODE = '92' THEN 0 ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE 1 END * A.TOT_SALE_AMT_TAX)-SUM(A.REDU_PRC) END) ELSE (SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE -1 END * A.TOT_SALE_AMT_TAX)-SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE -1 END * A.REDU_PRC)) END)          AS SALE_AMT
			             , (CASE WHEN C.TRAN_FLAG = '0' THEN (CASE WHEN C.TRAN_MODE = '92' THEN 0 ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE 1 END * A.DC_PRC * A.SALE_QTY) END)  ELSE   SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE -1 END * A.DC_PRC) END)                     AS DC_PRC
			             , (CASE WHEN C.TRAN_FLAG = '0' THEN (CASE WHEN C.TRAN_MODE = '92' THEN 0 ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE 1 END * A.SALE_AMT) END)  ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE -1 END * A.SALE_AMT)  END)                   AS NET_SALE_AMT
			             , (CASE WHEN C.TRAN_FLAG = '0' THEN (CASE WHEN C.TRAN_MODE = '92' THEN 0 ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE 1 END * A.SALE_PROF_AMT) END)  ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE -1 END * A.SALE_PROF_AMT) END)         AS SALE_PROF_AMT
						*/			             
			             , (CASE WHEN C.TRAN_FLAG = '0' THEN '정상' WHEN C.TRAN_FLAG = '1' THEN '반품' ELSE '오타' END)       AS TRAN_FLAG
					     , (CASE WHEN C.TRAN_FLAG = '0' THEN (CASE WHEN C.TRAN_MODE = '92' THEN 0 ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE 1 END * A.TOT_SALE_AMT_TAX) END) ELSE  SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE -1 END * A.TOT_SALE_AMT_TAX) END)                   AS SALE_AMT_TOT
					     , (CASE WHEN C.TRAN_FLAG = '0' THEN (CASE WHEN C.TRAN_MODE = '92' THEN 0 ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE 1 END * A.REDU_PRC * A.SALE_QTY) END) ELSE   SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE -1 END * (A.REDU_PRC * A.SALE_QTY)) END)                   AS REDU_PRC
					     , (CASE WHEN C.TRAN_FLAG = '0' THEN (CASE WHEN C.TRAN_MODE = '92' THEN 0 ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE 1 END * A.TOT_SALE_AMT_TAX)-SUM(A.REDU_PRC * A.SALE_QTY) END) ELSE (SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE -1 END * A.TOT_SALE_AMT_TAX)-SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE -1 END * (A.REDU_PRC * A.SALE_QTY))) END)          AS SALE_AMT
					     , (CASE WHEN C.TRAN_FLAG = '0' THEN (CASE WHEN C.TRAN_MODE = '92' THEN 0 ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE 1 END * A.DC_PRC * A.SALE_QTY) END)  ELSE   SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE -1 END * A.DC_PRC) END)                     AS DC_PRC
					     , (CASE WHEN C.TRAN_FLAG = '0' THEN (CASE WHEN C.TRAN_MODE = '92' THEN 0 ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE 1 END * A.SALE_AMT) END)  ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE -1 END * A.SALE_AMT)  END)                   AS NET_SALE_AMT
					     , (CASE WHEN C.TRAN_FLAG = '0' THEN (CASE WHEN C.TRAN_MODE = '92' THEN 0 ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE 1 END * A.SALE_PROF_AMT) END)  ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE -1 END * A.SALE_PROF_AMT) END)         AS SALE_PROF_AMT
			             , A.STR_CD
                         , C.SALE_TIME
                         , C.O_POS_NO   -- 원거래POS번호
                         , C.O_SALE_DT	-- 원거래매출일자
                         , C.O_TRAN_NO	-- 원거래거래번호
			          FROM DPS.PS_DISITEM   A
			             , DPS.PC_ORGMST    B
			             , DPS.PS_DISHEADER C
			             , DPS.PC_POSMST    D
			             , COM.TC_COMMCODE  E
			         WHERE A.ORG_CD        = B.ORG_CD
			           AND A.SALE_DT       = C.SALE_DT
			           AND A.STR_CD        = C.STR_CD
			           AND A.POS_NO        = C.POS_NO
			           AND A.TRAN_NO       = C.TRAN_NO
			           AND A.STR_CD        = D.STR_CD
			           AND A.POS_NO        = D.POS_NO
			           AND E.COMM_PART     = 'P611'
			           AND E.COMM_CODE     = C.TRAN_MODE
			           AND A.STR_CD        = ?
			           AND D.FLOR_CD       LIKE ? || '%'
			           AND D.POS_FLAG      LIKE ? || '%'
			           AND A.POS_NO        >= ?
			           AND A.POS_NO        <= ?
			           AND A.TRAN_NO       LIKE ? || '%'
			           AND A.SALE_DT       >= ?
			           AND A.SALE_DT       <= ?
			           --AND C.TRAN_MODE     <> '92'
                       --AND A.REJCT_FLAG     = '0'
			           AND A.PUMBUN_CD IN (SELECT MYORG.PUMBUN_CD
			                          FROM COM.V_MYORG MYORG
			                         WHERE MYORG.USER_ID     = ?
			                      )
			       ]]>     
    </query> 
    <query name="SEL_AND_SKU_CD">
        <![CDATA[
               AND A.SKU_CD     = ?
        ]]>
    </query>                     
			   
	<query name="SEL_AND_PUMBUN_CD">
        <![CDATA[
               AND A.PUMBUN_CD     = ?
        ]]>
    </query>  
    
    <query name="SEL_AND_SALE_AMT_FROM">
        <![CDATA[
               AND A.TOT_SALE_AMT_TAX     >= ?
        ]]>
    </query>  
    
    <query name="SEL_AND_SALE_AMT_TO">
        <![CDATA[
               AND A.TOT_SALE_AMT_TAX     <= ?
        ]]>
    </query>  	
    
     <query name="SEL_AND_SALE_TIME_FROM">
        <![CDATA[
              AND C.SALE_TIME >= ?||'00'
              
        ]]>
    </query>  
    
    <query name="SEL_AND_SALE_TIME_TO">
        <![CDATA[
              AND C.SALE_TIME <= ?||'59'
        ]]>
    </query> 
    	          
    	          
    <query name="SEL_CREDIT_CARD_NO">
        <![CDATA[
               AND (C.STR_CD, C.SALE_DT, C.POS_NO, C.TRAN_NO) IN 
                 (SELECT P.STR_CD, P.SALE_DT, P.POS_NO, P.TRAN_NO 
                    FROM DPS.PS_TRPAID P 
                   WHERE P.STR_CD   = ?
                     AND P.SALE_DT >= ?
                     AND P.SALE_DT <= ?
                     AND P.POS_NO  >= ?
			         AND P.POS_NO  <= ?
                     AND P.PAY_TYPE IN ('10', '11', '12', '13')
                     AND P.PAY_DATA_01 LIKE ? || '%')
        ]]>
    </query> 
    
    <query name="SEL_APPR_NO">
        <![CDATA[
               AND (C.STR_CD, C.SALE_DT, C.POS_NO, C.TRAN_NO) IN 
                 (SELECT P.STR_CD, P.SALE_DT, P.POS_NO, P.TRAN_NO 
                    FROM DPS.PS_TRPAID P 
                   WHERE P.STR_CD   = ?
                     AND P.SALE_DT >= ?
                     AND P.SALE_DT <= ?
                     AND P.POS_NO  >= ?
			         AND P.POS_NO  <= ?
                     AND P.PAY_TYPE IN ('00','10', '11', '12', '13')
                     AND P.PAY_DATA_03 LIKE ? || '%')
        ]]>
    </query>
    
               
	<query name="SEL_GROUP_BY">
        <![CDATA[		                      
			         GROUP BY 
			               A.SALE_DT
			             , A.POS_NO
			             , A.TRAN_NO
			             , C.TRAN_FLAG
			             , A.STR_CD
			             , E.COMM_NAME1  
			             , C.TRAN_FLAG
			             , C.TRAN_MODE
			             , C.SALE_TIME
                         , C.O_POS_NO
                         , C.O_SALE_DT
                         , C.O_TRAN_NO
			         ORDER BY
                           A.SALE_DT
                         , A.POS_NO
                         , A.TRAN_NO
                         , C.SALE_TIME

        ]]>        
    </query>
    
    <query name="SEL_SALE_POS_D">        
        <![CDATA[
            SELECT A.SEQ_NO
                 , A.PUMBUN_CD
                 , B.PUMBUN_NAME
                 , A.PUMMOK_CD
                 , C.PUMMOK_NAME
                 , A.SKU_CD
                 , D.SKU_NAME
                 --, (CASE WHEN E.TRAN_FLAG = '0' THEN (CASE WHEN E.TRAN_MODE = '92' THEN SUM(A.SALE_AMT) *-1 ELSE SUM(A.SALE_AMT) END) ELSE  SUM(A.SALE_AMT) *-1 END)                      AS SALE_AMT_TOT
                 , (CASE WHEN E.TRAN_FLAG = '0' THEN (CASE WHEN E.TRAN_MODE = '92' THEN 0 ELSE SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE 1 END * A.TOT_SALE_AMT_TAX) END) ELSE  SUM(CASE WHEN REJCT_FLAG = '1' THEN 0 ELSE -1 END * A.TOT_SALE_AMT_TAX) END)                   AS SALE_AMT_TOT
                 , (CASE WHEN A.REJCT_FLAG = '0' 
                    THEN (CASE WHEN E.TRAN_MODE = '92' THEN '일괄취소' ELSE '정상' END) 
                    WHEN A.REJCT_FLAG = '1' THEN '지정취소' ELSE '' END)               AS CANCEL_FLAG
              FROM DPS.PS_DISITEM   A
                 , DPS.PC_STRPBN    B
                 , DPS.PC_PMKMST    C
                 , DPS.PC_STRSKUMST D
                 , DPS.PS_DISHEADER E
                 , DPS.PC_ORGMST     F
             WHERE A.PUMBUN_CD     = B.PUMBUN_CD
               AND A.STR_CD        = B.STR_CD
               AND A.PUMMOK_CD     = C.PUMMOK_CD
               AND A.STR_CD        = D.STR_CD(+)
               AND A.SKU_CD        = D.SKU_CD(+)
               AND A.SALE_DT       = E.SALE_DT
               AND A.STR_CD        = E.STR_CD
               AND A.POS_NO        = E.POS_NO
               AND A.TRAN_NO       = E.TRAN_NO
               AND A.ORG_CD        = F.ORG_CD
               AND A.STR_CD        = ?
               AND A.POS_NO        = ?
               AND A.TRAN_NO       = ?
               AND A.SALE_DT       = ?
               AND EXISTS ( SELECT MYORG.USER_ID
                              FROM COM.V_MYORG MYORG
                             WHERE MYORG.STR_CD      = F.STR_CD
                               AND MYORG.DEPT_CD     = F.DEPT_CD
                               AND MYORG.TEAM_CD     = F.TEAM_CD
                               AND MYORG.PC_CD       = F.PC_CD
                               AND MYORG.PUMBUN_CD   = A.PUMBUN_CD
                               AND MYORG.USER_ID     = ?
                          )
             GROUP BY 
                   A.SEQ_NO
                 , A.PUMBUN_CD
                 , B.PUMBUN_NAME
                 , A.PUMMOK_CD
                 , C.PUMMOK_NAME
                 , A.SKU_CD
                 , D.SKU_NAME
                 , E.TRAN_FLAG
                 , A.REJCT_FLAG
                 , E.TRAN_MODE
             ORDER BY
                   A.SEQ_NO
                 , A.PUMBUN_CD
                 , A.PUMMOK_CD
                 , A.SKU_CD
               
        ]]>        
    </query>
    
    <query name="SEL_SALE_POS_DIS">        
        <![CDATA[
           
           SELECT A.DIS_FLAG   AS DIS_FLAG
			    , B.COMM_NAME1 AS DIS_NAME
			    , SUM(NVL(A.DIS_AMT,0))    AS DIS_AMT
			    , B.INQR_ORDER AS DIS_SORT
			    , A.CARD_DATA
			    , A.INSTALLMENT_MONTH
                , A.CARD_COMP
                , A.APPR_NO
                , A.APPR_TIME
                , A.APPR_VANID
                , A.INPUT_FLAG
                , A.INPUT_TYPE
			FROM (                              
			      SELECT A.PAY_FLAG    AS DIS_FLAG
			           , (CASE WHEN B.TRAN_FLAG = '0' THEN (CASE WHEN B.TRAN_MODE = '92' THEN A.SALE_AMT*-1 ELSE A.SALE_AMT END) ELSE A.SALE_AMT*-1 END)  AS DIS_AMT
                       , ''         AS CARD_DATA         -- 카드번호
                       , ''         AS INSTALLMENT_MONTH -- 할부개월
                       , ''         AS CARD_COMP         -- 카드사
                       , ''         AS APPR_NO           -- 승인번호
                       , ''         AS APPR_TIME         -- 승인일시
                       , ''         AS APPR_VANID        -- VAN-ID
                       , ''         AS INPUT_FLAG        -- 원거래승인번호
                       , ''         AS INPUT_TYPE        -- 수기입력구분
			      FROM DPS.PS_DISCASH A
			         , DPS.PS_DISHEADER B
			     WHERE A.SALE_DT = B.SALE_DT
			       AND A.STR_CD  = B.STR_CD
			       AND A.POS_NO  = B.POS_NO
			       AND A.TRAN_NO = B.TRAN_NO
			       AND A.STR_CD  = ?
			       AND A.POS_NO  = ?
			       AND A.TRAN_NO = ?
			       AND A.SALE_DT = ?
			                                       
			     UNION ALL
			                                     
			    SELECT A.CARD_FLAG    AS DIS_FLAG
			         , (CASE WHEN B.TRAN_FLAG = '0' THEN (CASE WHEN B.TRAN_MODE = '92' THEN A.PAY_AMT*-1 ELSE A.PAY_AMT END) ELSE A.PAY_AMT*-1 END)   AS DIS_AMT
                     , A.CARD_DATA          -- 카드번호
                     , A.INSTALLMENT_MONTH  -- 할부개월
                     , C.CCOMP_NM AS CARD_COMP -- 카드사
                     , A.APPR_NO            -- 승인번호
                     , A.APPR_TIME          -- 승인일시
                     , D.COMM_NAME1         -- VAN-ID
                     , A.INPUT_FLAG         -- 원거래승인번호
                     --, CASE WHEN A.INPUT_TYPE = 'S' THEN 'SCAN' ELSE '수기입력' END AS INPUT_TYPE -- 수기입력구분
                     , CASE WHEN A.INPUT_TYPE IN('I', 'A') THEN 'SCAN' 
                            WHEN A.INPUT_TYPE IN('M')      THEN 'SCAN 수기' 
                       ELSE '수기입력' END AS INPUT_TYPE
			      FROM DPS.PS_DISCARD   A
			         , DPS.PS_DISHEADER B
                     , DPS.PD_CARDCOMP  C
                     , COM.TC_COMMCODE  D
                     , DPS.PC_STRMST    E
			     WHERE A.SALE_DT = B.SALE_DT
			       AND A.STR_CD  = B.STR_CD
			       AND A.POS_NO  = B.POS_NO
			       AND A.TRAN_NO = B.TRAN_NO
                   AND C.CCOMP_CD = A.CARD_PUBLISH 
                   AND E.STR_CD   = A.STR_CD
                   AND D.SYS_PART = 'D'
                   AND D.COMM_PART = E.VANID_FLAG
                   AND D.COMM_CODE = A.APPR_VANID
			       AND A.STR_CD  = ?
			       AND A.POS_NO  = ?
			       AND A.TRAN_NO = ?
			       AND A.SALE_DT = ?

			                                       
			     UNION ALL
			                                     
			    SELECT A.SP_FLAG    AS DIS_FLAG
			         , (CASE WHEN B.TRAN_FLAG = '0' THEN (CASE WHEN B.TRAN_MODE = '92' THEN A.PAY_AMT*-1 ELSE A.PAY_AMT END) ELSE A.PAY_AMT*-1 END)   AS DIS_AMT
                     , A.GIFT_NO  AS CARD_DATA         -- 카드번호
                     , ''         AS INSTALLMENT_MONTH -- 할부개월
                     , ''         AS CARD_COMP         -- 카드사
                     --, A.APPR_NO  AS APPR_NO           -- 승인번호
                     , ''         AS APPR_NO           -- 승인번호(20161219)
                     , A.APPR_DT  AS APPR_TIME         -- 승인일시
                     , ''         AS APPR_VANID        -- VAN-ID
                     , ''         AS INPUT_FLAG        -- 원거래승인번호
                     , ''         AS INPUT_TYPE        -- 수기입력구분
			      FROM DPS.PS_DISGIFT A
			         , DPS.PS_DISHEADER B
			     WHERE A.SALE_DT = B.SALE_DT
			       AND A.STR_CD  = B.STR_CD
			       AND A.POS_NO  = B.POS_NO
			       AND A.TRAN_NO = B.TRAN_NO
			       AND A.STR_CD  = ?
			       AND A.POS_NO  = ?
			       AND A.TRAN_NO = ?
			       AND A.SALE_DT = ?
			                                     
			     UNION ALL
			                                     
			    SELECT A.COUPON_TYPE    AS DIS_FLAG
			         , (CASE WHEN B.TRAN_FLAG = '0' THEN (CASE WHEN B.TRAN_MODE = '92' THEN A.PAY_AMT*-1 ELSE A.PAY_AMT END) ELSE A.PAY_AMT*-1 END)    AS DIS_AMT
			         , A.COUPON_CD AS CARD_DATA         -- 카드번호
                     , ''          AS INSTALLMENT_MONTH -- 할부개월
                     , ''          AS CARD_COMP         -- 카드사
                     , ''          AS APPR_NO           -- 승인번호
                     , ''          AS APPR_TIME         -- 승인일시
                     , ''          AS APPR_VANID        -- VAN-ID
                     , ''          AS INPUT_FLAG        -- 원거래승인번호
                     , ''          AS INPUT_TYPE        -- 수기입력구분
			      FROM DPS.PS_DISCOUPON A
			         , DPS.PS_DISHEADER B
			     WHERE A.SALE_DT = B.SALE_DT
			       AND A.STR_CD  = B.STR_CD
			       AND A.POS_NO  = B.POS_NO
			       AND A.TRAN_NO = B.TRAN_NO
			           AND A.STR_CD  = ?
			           AND A.POS_NO  = ?
			           AND A.TRAN_NO = ?
			           AND A.SALE_DT = ?
			                                         
			         UNION ALL
			                                         
			        SELECT A.TRAN_FLAG    AS DIS_FLAG
			             , (CASE WHEN B.TRAN_FLAG = '0' THEN (CASE WHEN B.TRAN_MODE = '92' THEN A.SALE_AMT*-1 ELSE A.SALE_AMT END) ELSE A.SALE_AMT*-1 END)  AS DIS_AMT
                         , A.CARD_NO  AS CARD_DATA         -- 카드번호
                         , ''         AS INSTALLMENT_MONTH -- 할부개월
                         , ''         AS CARD_COMP         -- 카드사
                         , ''         AS APPR_NO           -- 승인번호
                         , ''         AS APPR_TIME         -- 승인일시
                         , ''         AS APPR_VANID        -- VAN-ID
                         , ''         AS INPUT_FLAG        -- 원거래승인번호
                         , ''         AS INPUT_TYPE        -- 수기입력구분
			          FROM DPS.PS_POINTUSE A
			             , DPS.PS_DISHEADER B
			         WHERE A.SALE_DT = B.SALE_DT
			           AND A.STR_CD  = B.STR_CD
			           AND A.POS_NO  = B.POS_NO
			           AND A.TRAN_NO = B.TRAN_NO
			           AND A.STR_CD  = ?
			           AND A.POS_NO  = ?
			           AND A.TRAN_NO = ?
			           AND A.SALE_DT = ?
			                                         
			         UNION ALL
			                                         
			        SELECT A.TRAN_FLAG    AS DIS_FLAG
			             , (CASE WHEN B.TRAN_FLAG = '0' THEN (CASE WHEN B.TRAN_MODE = '92' THEN A.SALE_AMT*-1 ELSE A.SALE_AMT END) ELSE A.SALE_AMT*-1 END)  AS DIS_AMT
                         , ''         AS CARD_DATA         -- 카드번호
                         , ''         AS INSTALLMENT_MONTH -- 할부개월
                         , ''         AS CARD_COMP         -- 카드사
                         , ''         AS APPR_NO           -- 승인번호
                         , ''         AS APPR_TIME         -- 승인일시
                         , ''         AS APPR_VANID        -- VAN-ID
                         , ''         AS INPUT_FLAG        -- 원거래승인번호
                         , ''         AS INPUT_TYPE        -- 수기입력구분
			          FROM DPS.PS_DISCREDIT A
			             , DPS.PS_DISHEADER B
			         WHERE A.SALE_DT = B.SALE_DT
			           AND A.STR_CD  = B.STR_CD
			           AND A.POS_NO  = B.POS_NO
			           AND A.TRAN_NO = B.TRAN_NO
			           AND A.STR_CD  = ?
			           AND A.POS_NO  = ?
			           AND A.TRAN_NO = ?
			           AND A.SALE_DT = ?
			                                         
			         UNION ALL
			                                         
			        SELECT A.PEND_FLAG    AS DIS_FLAG
			             , (CASE WHEN B.TRAN_FLAG = '0' THEN (CASE WHEN B.TRAN_MODE = '92' THEN A.SALE_AMT*-1 ELSE A.SALE_AMT END) ELSE A.SALE_AMT*-1 END)  AS DIS_AMT
                         , ''         AS CARD_DATA         -- 카드번호
                         , ''         AS INSTALLMENT_MONTH -- 할부개월
                         , ''         AS CARD_COMP         -- 카드사
                         , ''         AS APPR_NO           -- 승인번호
                         , ''         AS APPR_TIME         -- 승인일시
                         , ''         AS APPR_VANID        -- VAN-ID
                         , ''         AS INPUT_FLAG        -- 원거래승인번호
                         , ''         AS INPUT_TYPE        -- 수기입력구분
			          FROM DPS.PS_DISPENDING A
			             , DPS.PS_DISHEADER B
			         WHERE A.SALE_DT = B.SALE_DT
			           AND A.STR_CD  = B.STR_CD
			           AND A.POS_NO  = B.POS_NO
			           AND A.TRAN_NO = B.TRAN_NO
			           AND A.STR_CD  = ?
			           AND A.POS_NO  = ?
			           AND A.TRAN_NO = ?
			           AND A.SALE_DT = ?
			                                           
			         UNION ALL
			                                         
			        SELECT A.ETC_FLAG    AS DIS_FLAG
			             , (CASE WHEN B.TRAN_FLAG = '0' THEN (CASE WHEN B.TRAN_MODE = '92' THEN A.SALE_AMT*-1 ELSE A.SALE_AMT END) ELSE A.SALE_AMT*-1 END)  AS DIS_AMT
                         , ''         AS CARD_DATA         -- 카드번호
                         , ''         AS INSTALLMENT_MONTH -- 할부개월
                         , ''         AS CARD_COMP         -- 카드사
                         , ''         AS APPR_NO           -- 승인번호
                         , ''         AS APPR_TIME         -- 승인일시
                         , ''         AS APPR_VANID        -- VAN-ID
                         , ''         AS INPUT_FLAG        -- 원거래승인번호
                         , ''         AS INPUT_TYPE        -- 수기입력구분
			          FROM DPS.PS_DISETC A
			             , DPS.PS_DISHEADER B
			         WHERE A.SALE_DT = B.SALE_DT
			           AND A.STR_CD  = B.STR_CD
			           AND A.POS_NO  = B.POS_NO
			           AND A.TRAN_NO = B.TRAN_NO
			           AND A.STR_CD  = ?
			           AND A.POS_NO  = ?
			           AND A.TRAN_NO = ?
			           AND A.SALE_DT = ?
			    ) A
			    ,(SELECT * FROM COM.TC_COMMCODE
			     WHERE COMM_PART = 'D072'
			     AND   SYS_PART = 'D') B
			WHERE A.DIS_FLAG = B.COMM_CODE
			GROUP BY  A.DIS_FLAG
			         ,B.COMM_NAME1
			         ,B.INQR_ORDER 
                     ,A.CARD_DATA
                     ,A.INSTALLMENT_MONTH
                     ,A.CARD_COMP
                     ,A.APPR_NO
                     ,A.APPR_TIME
                     ,A.APPR_VANID
                     ,A.INPUT_FLAG
                     ,A.INPUT_TYPE
			ORDER BY B.INQR_ORDER


            
        ]]>        
    </query>
    
    <!-- 
    <query name="SEL_SALE_POS_DIS">        
        <![CDATA[
           
            SELECT SUM(A.CASH_AMT)         AS CASH_AMT
                 , SUM(A.JCARD_AMT)        AS JCARD_AMT
                 , SUM(A.OCARD_AMT)        AS OCARD_AMT       
                 , SUM(A.DCARD_AMT)        AS DCARD_AMT       
                 , SUM(A.CCARD_AMT)        AS CCARD_AMT       
                 , SUM(A.GIFT_DRAWL_AMT)   AS GIFT_DRAWL_AMT  
                 , SUM(A.JGIFT_AMT)        AS JGIFT_AMT       
                 , SUM(A.OGIFT_DRAWL_AMT)  AS OGIFT_DRAWL_AMT 
                 , SUM(A.COUPON_AMT)       AS COUPON_AMT        
                 , SUM(A.ENURI_AMT)        AS ENURI_AMT       
                 , SUM(A.CMS_AMT)          AS CMS_AMT         
                 , SUM(A.POINT_AMT)        AS POINT_AMT       
                 , SUM(A.GITA_AMT)         AS GITA_AMT        
                 , SUM(A.GITA_AMT2)        AS GITA_AMT2        
                 , SUM(A.COD_SALE_AMT)     AS COD_SALE_AMT       
                 , SUM(A.USE_SALE_AMT)     AS USE_SALE_AMT        
                 , SUM(A.TP_CREDIT_AMT)    AS TP_CREDIT_AMT       
                 , SUM(A.ORDER_RESULT_AMT) AS ORDER_RESULT_AMT
              FROM (
                    SELECT (CASE WHEN A.DIS_FLAG = '00' THEN SUM(NVL(A.DIS_AMT,0)) ELSE 0 END)      AS CASH_AMT
                         , (CASE WHEN A.DIS_FLAG = '11' THEN SUM(NVL(A.DIS_AMT,0)) ELSE 0 END)      AS JCARD_AMT
                         , (CASE WHEN A.DIS_FLAG = '10' THEN SUM(NVL(A.DIS_AMT,0)) ELSE 0 END)      AS OCARD_AMT
                         , (CASE WHEN A.DIS_FLAG = '12' THEN SUM(NVL(A.DIS_AMT,0)) ELSE 0 END)      AS DCARD_AMT
                         , (CASE WHEN A.DIS_FLAG = '13' THEN SUM(NVL(A.DIS_AMT,0)) ELSE 0 END)      AS CCARD_AMT
                         , (CASE WHEN A.DIS_FLAG = '20' THEN SUM(NVL(A.DIS_AMT,0)) ELSE 0 END)      AS GIFT_DRAWL_AMT
                         , (CASE WHEN A.DIS_FLAG = '21' THEN SUM(NVL(A.DIS_AMT,0)) ELSE 0 END)      AS JGIFT_AMT
                         , (CASE WHEN A.DIS_FLAG = '22' THEN SUM(NVL(A.DIS_AMT,0)) ELSE 0 END)      AS OGIFT_DRAWL_AMT
                         , (CASE WHEN A.DIS_FLAG = '30' THEN SUM(NVL(A.DIS_AMT,0)) ELSE 0 END)      AS COUPON_AMT
                         , (CASE WHEN A.DIS_FLAG = '71' THEN SUM(NVL(A.DIS_AMT,0)) ELSE 0 END)      AS ENURI_AMT
                         , (CASE WHEN A.DIS_FLAG = '31' THEN SUM(NVL(A.DIS_AMT,0)) ELSE 0 END)      AS CMS_AMT
                         , (CASE WHEN A.DIS_FLAG = '40' THEN SUM(NVL(A.DIS_AMT,0)) ELSE 0 END)      AS POINT_AMT
                         , (CASE WHEN A.DIS_FLAG = '91' THEN SUM(NVL(A.DIS_AMT,0)) ELSE 0 END)      AS GITA_AMT
                         , (CASE WHEN A.DIS_FLAG = '92' THEN SUM(NVL(A.DIS_AMT,0)) ELSE 0 END)      AS GITA_AMT2
                         , (CASE WHEN A.DIS_FLAG = '53' THEN SUM(NVL(A.DIS_AMT,0)) ELSE 0 END)      AS COD_SALE_AMT
                         , (CASE WHEN A.DIS_FLAG = '51' THEN SUM(NVL(A.DIS_AMT,0)) ELSE 0 END)      AS USE_SALE_AMT
                         , (CASE WHEN A.DIS_FLAG = '52' THEN SUM(NVL(A.DIS_AMT,0)) ELSE 0 END)      AS TP_CREDIT_AMT
                         , (CASE WHEN A.DIS_FLAG = '62' THEN SUM(NVL(A.DIS_AMT,0)) ELSE 0 END)      AS ORDER_RESULT_AMT
                      FROM (
                            SELECT A.PAY_FLAG    AS DIS_FLAG
                                 , (CASE WHEN B.TRAN_FLAG = '0' THEN (CASE WHEN B.TRAN_MODE = '92' THEN A.SALE_AMT*-1 ELSE A.SALE_AMT END) ELSE A.SALE_AMT*-1 END)  AS DIS_AMT
                              FROM DPS.PS_DISCASH A
                                 , DPS.PS_DISHEADER B
                             WHERE A.SALE_DT = B.SALE_DT
                               AND A.STR_CD  = B.STR_CD
                               AND A.POS_NO  = B.POS_NO
                               AND A.TRAN_NO = B.TRAN_NO
                               AND A.STR_CD  = ?
                               AND A.POS_NO  = ?
                               AND A.TRAN_NO = ?
                               AND A.SALE_DT = ?
                               
                             UNION ALL
                             
                            SELECT A.CARD_FLAG    AS DIS_FLAG
                                 , (CASE WHEN B.TRAN_FLAG = '0' THEN (CASE WHEN B.TRAN_MODE = '92' THEN A.PAY_AMT*-1 ELSE A.PAY_AMT END) ELSE A.PAY_AMT*-1 END)   AS DIS_AMT
                              FROM DPS.PS_DISCARD A
                                 , DPS.PS_DISHEADER B
                             WHERE A.SALE_DT = B.SALE_DT
                               AND A.STR_CD  = B.STR_CD
                               AND A.POS_NO  = B.POS_NO
                               AND A.TRAN_NO = B.TRAN_NO
                               AND A.STR_CD  = ?
                               AND A.POS_NO  = ?
                               AND A.TRAN_NO = ?
                               AND A.SALE_DT = ?
                               
                             UNION ALL
                             
                            SELECT A.SP_FLAG    AS DIS_FLAG
                                 , (CASE WHEN B.TRAN_FLAG = '0' THEN (CASE WHEN B.TRAN_MODE = '92' THEN A.PAY_AMT*-1 ELSE A.PAY_AMT END) ELSE A.PAY_AMT*-1 END)   AS DIS_AMT
                              FROM DPS.PS_DISGIFT A
                                 , DPS.PS_DISHEADER B
                             WHERE A.SALE_DT = B.SALE_DT
                               AND A.STR_CD  = B.STR_CD
                               AND A.POS_NO  = B.POS_NO
                               AND A.TRAN_NO = B.TRAN_NO
                               AND A.STR_CD  = ?
                               AND A.POS_NO  = ?
                               AND A.TRAN_NO = ?
                               AND A.SALE_DT = ?
                             
                             UNION ALL
                             
                            SELECT A.COUPON_TYPE    AS DIS_FLAG
                                 , (CASE WHEN B.TRAN_FLAG = '0' THEN (CASE WHEN B.TRAN_MODE = '92' THEN A.PAY_AMT*-1 ELSE A.PAY_AMT END) ELSE A.PAY_AMT*-1 END)    AS DIS_AMT
                              FROM DPS.PS_DISCOUPON A
                                 , DPS.PS_DISHEADER B
                             WHERE A.SALE_DT = B.SALE_DT
                               AND A.STR_CD  = B.STR_CD
                               AND A.POS_NO  = B.POS_NO
                               AND A.TRAN_NO = B.TRAN_NO
                               AND A.STR_CD  = ?

                               AND A.POS_NO  = ?
                               AND A.TRAN_NO = ?
                               AND A.SALE_DT = ?
                             
                             UNION ALL
                             
                            SELECT A.TRAN_FLAG    AS DIS_FLAG
                                 , (CASE WHEN B.TRAN_FLAG = '0' THEN (CASE WHEN B.TRAN_MODE = '92' THEN A.SALE_AMT*-1 ELSE A.SALE_AMT END) ELSE A.SALE_AMT*-1 END)  AS DIS_AMT
                              FROM DPS.PS_POINTUSE A
                                 , DPS.PS_DISHEADER B
                             WHERE A.SALE_DT = B.SALE_DT
                               AND A.STR_CD  = B.STR_CD
                               AND A.POS_NO  = B.POS_NO
                               AND A.TRAN_NO = B.TRAN_NO
                               AND A.STR_CD  = ?

                               AND A.POS_NO  = ?
                               AND A.TRAN_NO = ?
                               AND A.SALE_DT = ?
                             
                             UNION ALL
                             
                            SELECT A.TRAN_FLAG    AS DIS_FLAG
                                 , (CASE WHEN B.TRAN_FLAG = '0' THEN (CASE WHEN B.TRAN_MODE = '92' THEN A.SALE_AMT*-1 ELSE A.SALE_AMT END) ELSE A.SALE_AMT*-1 END)  AS DIS_AMT
                              FROM DPS.PS_DISCREDIT A
                                 , DPS.PS_DISHEADER B
                             WHERE A.SALE_DT = B.SALE_DT
                               AND A.STR_CD  = B.STR_CD
                               AND A.POS_NO  = B.POS_NO
                               AND A.TRAN_NO = B.TRAN_NO
                               AND A.STR_CD  = ?
                               AND A.POS_NO  = ?
                               AND A.TRAN_NO = ?
                               AND A.SALE_DT = ?
                             
                             UNION ALL
                             
                            SELECT A.PEND_FLAG    AS DIS_FLAG
                                 , (CASE WHEN B.TRAN_FLAG = '0' THEN (CASE WHEN B.TRAN_MODE = '92' THEN A.SALE_AMT*-1 ELSE A.SALE_AMT END) ELSE A.SALE_AMT*-1 END)  AS DIS_AMT
                              FROM DPS.PS_DISPENDING A
                                 , DPS.PS_DISHEADER B
                             WHERE A.SALE_DT = B.SALE_DT
                               AND A.STR_CD  = B.STR_CD
                               AND A.POS_NO  = B.POS_NO
                               AND A.TRAN_NO = B.TRAN_NO
                               AND A.STR_CD  = ?
                               AND A.POS_NO  = ?
                               AND A.TRAN_NO = ?
                               AND A.SALE_DT = ?
                               
                             UNION ALL
                             
                            SELECT A.ETC_FLAG    AS DIS_FLAG
                                 , (CASE WHEN B.TRAN_FLAG = '0' THEN (CASE WHEN B.TRAN_MODE = '92' THEN A.SALE_AMT*-1 ELSE A.SALE_AMT END) ELSE A.SALE_AMT*-1 END)  AS DIS_AMT
                              FROM DPS.PS_DISETC A
                                 , DPS.PS_DISHEADER B
                             WHERE A.SALE_DT = B.SALE_DT
                               AND A.STR_CD  = B.STR_CD
                               AND A.POS_NO  = B.POS_NO
                               AND A.TRAN_NO = B.TRAN_NO
                               AND A.STR_CD  = ?
                               AND A.POS_NO  = ?
                               AND A.TRAN_NO = ?
                               AND A.SALE_DT = ?
                           ) A
                     GROUP BY
                           A.DIS_FLAG
                   ) A
            
        ]]>        
    </query>
     -->
     
     
     
    <query name="SEL_POSNO">        
        <![CDATA[
            SELECT A.POS_NO
              FROM DPS.PC_POSMST A
             WHERE A.POS_NO = ?
        ]]>        
    </query>
    
    <query name="SEL_POSNOMM">        
        <![CDATA[
            SELECT MAX(A.POSNO_MIN) AS POSNO_MIN
                 , MAX(A.POSNO_MAX) AS POSNO_MAX
              FROM (
		            SELECT MIN(A.POS_NO) AS POSNO_MIN
		                 , ''            AS POSNO_MAX
		              FROM DPS.PC_POSMST A
		              
		            UNION ALL
		              
		            SELECT ''            AS POSNO_MIN
		                 , MAX(A.POS_NO) AS POSNO_MAX
		              FROM DPS.PC_POSMST A
		           ) A
        ]]>        
    </query>
    
    
    <query name="SEL_POINT">        
        <![CDATA[
				SELECT C.CUST_ID
				     , C.CUST_NAME
				     , DCS.SC_CRYPTO_FUN('DEC',B.CARD_NO) CARD_NO
				     , DCS.SC_CRYPTO_FUN('DEC',C.MOBILE_PH1)||'-'||DCS.SC_CRYPTO_FUN('DEC',C.MOBILE_PH2)||'-'||DCS.SC_CRYPTO_FUN('DEC',C.MOBILE_PH3) HP
				     , A.OCC_POINT 
				 FROM
				  DPS.PS_TRPOINT A
				, DCS.DM_CARD B
				, DCS.DM_CUSTOMER C
				WHERE A.STR_CD=?
				AND A.SALE_DT=?
				AND A.POS_NO=?
				AND A.TRAN_NO=?
				AND DCS.SC_CRYPTO_FUN('ENC',A.MBSH_NO) = B.CARD_NO
				AND B.CUST_ID = C.CUST_ID
        ]]>        
    </query>
    
    
    <gauce name="H_SEL_CONTENT"> 
        <column colName="RECP_CONTENT"               colType="TB_STRING"      	size="70"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CONTENT_ORDER"              colType="DECIMAL"      	size="2"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <query name="SEL_RECP_CONTENT">        
        <![CDATA[    
		/* 헤더 정보 */
		WITH TBL_HEAD AS
		(
		SELECT STR_CD
		     , SALE_DT
		     , POS_NO
		     , TRAN_NO
		     , SALE_TIME
		     , TRAN_FLAG
		     , SALE_TOT_AMT
		     , SALE_USER_ID
		     , DECODE(TRAN_FLAG,0,1,-1) BUHO
		FROM DPS.PS_DISHEADER HD
		WHERE STR_CD= ?
		  AND SALE_DT= ?
		  AND POS_NO= ?
		  AND TRAN_NO= ?
		  AND TRAN_MODE='01'
		)
		/* 디테일 정보 */
		, TBL_DTL AS
		(
		SELECT STR_CD
		     , SALE_DT
		     , POS_NO
		     , TRAN_NO
		     , SKU_CD
		     , PUMBUN_CD
		     , PUMMOK_CD
		     , SALE_PRC
		     , SALE_QTY
		     , SALE_AMT
		     , TAX_AMT
		     , NET_SALE_AMT
		FROM DPS.PS_DISITEM DT
		WHERE STR_CD= ?
		  AND SALE_DT= ?
		  AND POS_NO= ?
		  AND TRAN_NO= ?
		)
		/* 결제수단 정보 - 카드 */
		, TBL_CARD AS
		(
		SELECT STR_CD
		     , SALE_DT
		     , POS_NO
		     , TRAN_NO
		     , PAY_AMT
		     , CARD_DATA
		     , INSTALLMENT_MONTH
		     , APPR_NO
		     , APPR_VANID
		     , CARD_PUBLISH
		     , CARD_PURCHASE
		FROM DPS.PS_DISCARD A
		WHERE STR_CD= ?
		  AND SALE_DT= ?
		  AND POS_NO= ?
		  AND TRAN_NO= ?
		 ORDER BY SEQ_NO
		)
		 /* 결제수단 정보 - 현금 */
		, TBL_CASH AS
		(
		SELECT A.STR_CD
		     , A.SALE_DT
		     , A.POS_NO
		     , A.TRAN_NO
		     , A.SALE_AMT
		     , B.CASH_RECP_ID
		     , B.CASH_RECP_APPR_NO
		 FROM DPS.PS_DISCASH A
		    , DPS.PS_DISCASHRECP B
		WHERE A.STR_CD= ?
		  AND A.SALE_DT= ?
		  AND A.POS_NO= ?
		  AND A.TRAN_NO= ?
		  AND A.STR_CD = B.STR_CD(+)
		  AND A.SALE_DT = B.SALE_DT(+)
		  AND A.POS_NO = B.POS_NO(+)
		  AND A.TRAN_NO = B.TRAN_NO(+)
		  ORDER BY A.SEQ_NO
		)
		/* 결제수단 정보 - 상품권 */
		, TBL_GIFT AS
		(
		SELECT STR_CD
		     , SALE_DT
		     , POS_NO
		     , TRAN_NO
		     , GIFT_NAME
		     , PAY_AMT
		FROM DPS.PS_DISGIFT A
		WHERE STR_CD= ?
		  AND SALE_DT= ?
		  AND POS_NO= ?
		  AND TRAN_NO= ?
		 ORDER BY SEQ_NO
		)
		SELECT RECP_CONTENT
			 , CONTENT_ORDER
		  FROM (
		SELECT 'Store : '||STR_CD||' / '||SUBSTR(SALE_DT,1,4)||'-'||SUBSTR(SALE_DT,5,2)||'-'||SUBSTR(SALE_DT,7,2)
		     ||' '||SUBSTR(SALE_TIME,1,2)||':'||SUBSTR(SALE_TIME,3,2)||' [POS NO : '||POS_NO||']' AS RECP_CONTENT
		    , 1 AS CONTENT_ORDER
		FROM TBL_HEAD
		UNION ALL
		SELECT '-------------------------------------------------------' AS RECP_CONTENT
		    , 2 AS CONTENT_ORDER
		FROM DUAL
		UNION ALL
		SELECT RPAD('상품명',17,'　')||LPAD('단가',11,'　')||LPAD('수량',7,'　')||LPAD('금액',10,'　') AS RECP_CONTENT
		    , 2 AS CONTENT_ORDER
		FROM DUAL
		UNION ALL
		SELECT '-------------------------------------------------------' AS RECP_CONTENT
		    , 2 AS CONTENT_ORDER
		FROM DUAL
		UNION ALL
		SELECT RPAD(DPS.FN_GET_PUMBUN_NAME(PUMBUN_CD)||' '||DPS.FN_GET_PUMMOK_NAME(PUMMOK_CD),17,'　')
		     ||LPAD(SALE_PRC*BUHO,11,'　')||LPAD(SALE_QTY*BUHO,7,'　')||LPAD(SALE_AMT*BUHO,10,'　') AS RECP_CONTECT
		     , 3 AS CONTENT_ORDER
		FROM TBL_DTL, TBL_HEAD
		UNION ALL
		SELECT '　' AS RECP_CONTECT
		     , 4 AS CONTENT_ORDER
		FROM TBL_DTL
		UNION ALL
		SELECT RPAD('물품가액',17,'　')
		     ||LPAD('　',11,'　')||LPAD('　',7,'　')||LPAD(SUM(NET_SALE_AMT*BUHO),10,'　') AS RECP_CONTECT
		     , 5 AS CONTENT_ORDER
		FROM TBL_DTL, TBL_HEAD
		UNION ALL
		SELECT RPAD('부 가 세',17,'　')
		     ||LPAD('　',11,'　')||LPAD('　',7,'　')||LPAD(SUM(TAX_AMT*BUHO),10,'　') AS RECP_CONTECT
		     , 5 AS CONTENT_ORDER
		FROM TBL_DTL, TBL_HEAD
		UNION ALL
		SELECT '-------------------------------------------------------' AS RECP_CONTENT
		    , 6 AS CONTENT_ORDER
		FROM DUAL
		UNION ALL
		SELECT RPAD('합　　계',17,'　')
		     ||LPAD('　',11,'　')||LPAD('　',7,'　')||LPAD(SUM(SALE_AMT*BUHO),10,'　') AS RECP_CONTECT
		     , 7 AS CONTENT_ORDER
		FROM TBL_DTL, TBL_HEAD
		UNION ALL
		SELECT '<b>'||RPAD('받을금액',17,'　')
		     ||LPAD('　',11,'　')||LPAD('　',7,'　')||LPAD(SALE_TOT_AMT*BUHO,10,'　')||'</b>' AS RECP_CONTECT
		     , 8 AS CONTENT_ORDER
		FROM TBL_HEAD
		UNION ALL
		SELECT RPAD('신용카드',17,'　')
		     ||LPAD('　',11,'　')||LPAD('　',7,'　')||LPAD(PAY_AMT*BUHO,10,'　') AS RECP_CONTECT
		     , 9 AS CONTENT_ORDER
		FROM TBL_CARD, TBL_HEAD
		UNION ALL
		SELECT RPAD('현　　금',17,'　')
		     ||LPAD('　',11,'　')||LPAD('　',7,'　')||LPAD(SALE_AMT*BUHO,10,'　') AS RECP_CONTECT
		     , 9 AS CONTENT_ORDER
		FROM TBL_CASH, TBL_HEAD
		UNION ALL
		SELECT RPAD('상 품 권',17,'　')
		     ||LPAD('　',11,'　')||LPAD('　',7,'　')||LPAD(PAY_AMT*BUHO,10,'　') AS RECP_CONTECT
		     , 9 AS CONTENT_ORDER
		FROM TBL_GIFT, TBL_HEAD
		UNION ALL
		SELECT '-------------------------------------------------------' AS RECP_CONTENT
		    , 10 AS CONTENT_ORDER
		FROM DUAL
		UNION ALL
		SELECT RPAD(DPS.FN_GET_CCOMP_NM(CARD_PURCHASE),4,'　')||RPAD(CARD_DATA,16,'*')
		     ||LPAD('할부 : '||INSTALLMENT_MONTH,11,'　')||LPAD('　',5,'　')||LPAD(PAY_AMT,10,'　')
		     ||'<br>승인번호 : '||APPR_VANID||' '||APPR_NO AS RECP_CONTECT
		     , 11 AS CONTENT_ORDER
		FROM TBL_CARD
		UNION ALL
		SELECT '<CENTER>******* 현금영수증 *******</CENTER>' AS RECP_CONTENT
		    , 12 AS CONTENT_ORDER
		FROM DUAL
		UNION ALL
		SELECT RPAD('증빙번호 : ',10,'　')||RPAD(SUBSTR(CASH_RECP_ID,1,8),11,'*')
		     ||LPAD('　',8,'　')||LPAD('　',5,'　')||LPAD(SALE_AMT,10,'　')
		     ||'<br>승인번호 : '||CASH_RECP_APPR_NO AS RECP_CONTECT
		     , 13 AS CONTENT_ORDER
		FROM TBL_CASH
		UNION ALL
		SELECT '-------------------------------------------------------' AS RECP_CONTENT
		    , 14 AS CONTENT_ORDER
		FROM DUAL
		UNION ALL
		SELECT '판매자 : '||SALE_USER_ID||' ('||DECODE(DPS.FN_GET_PUMBUN_NAME(SALE_USER_ID),NULL,COM.FN_GET_USER_NAME(SALE_USER_ID),DPS.FN_GET_PUMBUN_NAME(SALE_USER_ID))||')' AS RECP_CONTENT
		    , 15 AS CONTENT_ORDER
		FROM TBL_HEAD
		ORDER BY CONTENT_ORDER
		) 
		WHERE EXISTS ( SELECT * FROM TBL_HEAD )
        ]]>        
    </query>
</service>