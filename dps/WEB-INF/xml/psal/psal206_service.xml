<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 박종은
 * 회 사 명 : 한국후지쯔
 * 작 성 일 : 2010.06.27
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  
 -->
<service name="/psal206.ps">

    <gauce name="H_SEL_MASTER"> 
        <column colName="CONF_FLAG"             colType="TB_STRING"      size="1"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STR_CD"                colType="TB_STRING"      size="2"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STR_NAME"              colType="TB_STRING"      size="40"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DEPT_CD"               colType="TB_STRING"      size="2"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TEAM_CD"               colType="TB_STRING"      size="2"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PC_CD"                 colType="TB_STRING"      size="2"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORG_NAME"              colType="TB_STRING"      size="40"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="EXE_YM"                colType="TB_STRING"      size="6"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CONF_DT"               colType="TB_STRING"      size="8"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_NORM_MG_RATE"   colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT_TOT"  colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_PROF_TAMT_TOT"  colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_CRATE_TOT" colType="TB_DECIMAL"     size="5"        dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_PROF_CRATE_TOT" colType="TB_DECIMAL"     size="5"        dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <gauce name="H_SEL_DETAIL">  
        <column colName="PUMBUN_CD"             colType="TB_STRING"      size="6"        dec="0" keyType="TB_KEY"    roundMode="ROUND" />
        <column colName="PUMBUN_NAME"           colType="TB_STRING"      size="40"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NORM_MG_RATE"          colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TOTAL"                 colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT1"     colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT2"     colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT3"     colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT4"     colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT5"     colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT6"     colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT7"     colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT8"     colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT9"     colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT10"    colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT11"    colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT12"    colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT13"    colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT14"    colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT15"    colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT16"    colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT17"    colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT18"    colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT19"    colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT20"    colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT21"    colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT22"    colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT23"    colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT24"    colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT25"    colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT26"    colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT27"    colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT28"    colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT29"    colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT30"    colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT31"    colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CONF_FLAG"             colType="TB_STRING"      size="1"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="EXE_YM"                colType="TB_STRING"      size="6"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_ORG_CD"           colType="TB_STRING"      size="10"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <gauce name="H_SEL_CONF_FLAG"> 
        <column colName="CONF_FLAG"          colType="TB_STRING"      size="1"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <gauce name="H_SEL_PC_CONF_FLAG"> 
        <column colName="CONF_FLAG"          colType="TB_STRING"      size="1"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <gauce name="H_SEL_DETAIL_CHECK"> 
        <column colName="PC_CD"             colType="TB_STRING"      size="2"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORG_NAME"          colType="TB_STRING"      size="40"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    
    <!-- 쿼리는 전부 대문자 -->
    <!-- 당초팀별월매출계획 조회 쿼리  -->
   
    <query name="SEL_PLANPC">        
        <![CDATA[
            SELECT A.CONF_FLAG
                 , A.STR_CD
                 , A.STR_NAME
                 , A.DEPT_CD
                 , A.TEAM_CD
                 , A.PC_CD
                 , A.ORG_NAME
                 , A.EXE_YM
                 , A.CONF_DT
                 , MAX(A.NORM_MG_RATE)      AS NORM_MG_RATE
                 , SUM(A.ORIGIN_SALE_TAMT ) AS ORIGIN_SALE_TAMT
                 , SUM(A.ORIGIN_PROF_TAMT)  AS ORIGIN_PROF_TAMT
                 , (CASE WHEN SUM(A.BFYY_SALE_TAMT) = 0 THEN 0
                    ELSE (SUM(A.ORIGIN_SALE_TAMT) - SUM(A.BFYY_SALE_TAMT))/SUM(A.BFYY_SALE_TAMT) END) AS ORIGIN_SALE_IRATE
                 , (CASE WHEN SUM(A.BFYY_PROF_TAMT) = 0 THEN 0
                    ELSE (SUM(A.ORIGIN_PROF_TAMT) - SUM(A.BFYY_PROF_TAMT))/SUM(A.BFYY_PROF_TAMT) END) AS ORIGIN_PROF_IRATE
              FROM (
                    SELECT (CASE WHEN A.CONF_FLAG = 'Y' THEN 'T' ELSE 'F' END) AS CONF_FLAG
                         , A.STR_CD
                         , (SELECT E.STR_NAME FROM DPS.PC_STRMST E WHERE STR_CD = A.STR_CD) AS STR_NAME
                         , B.DEPT_CD
                         , B.TEAM_CD
                         , B.PC_CD
                         , B.ORG_SHORT_NAME         AS ORG_NAME
                         , A.EXE_YM
                         , A.CONF_DT
                         , (SELECT NVL(MAX(NORM_MG_RATE),0)
                              FROM DPS.PC_MARGINMST 
                             WHERE EVENT_FLAG = '00' 
                               AND STR_CD = A.STR_CD 
                               AND PUMBUN_CD = A.PUMBUN_CD
                               AND A.EXE_DT BETWEEN APP_S_DT AND APP_E_DT
                               )                    AS NORM_MG_RATE
                         , SUM(A.ORIGIN_SALE_TAMT ) AS ORIGIN_SALE_TAMT
                         , SUM(A.ORIGIN_PROF_TAMT)  AS ORIGIN_PROF_TAMT
                         , SUM(A.BFYY_SALE_TAMT)    AS BFYY_SALE_TAMT
                         , SUM(A.BFYY_PROF_TAMT)    AS BFYY_PROF_TAMT
                      FROM DPS.PS_ACTPUMBUN   A
                           , DPS.PC_ORGMST    B
                           , DPS.PC_STRPBN    D
                     WHERE A.ORG_CD      = B.ORG_CD
                       AND A.STR_CD      = D.STR_CD
                       AND A.PUMBUN_CD   = D.PUMBUN_CD
                       AND D.BIZ_TYPE    = '5'
                       AND B.STR_CD      = ?
                       AND B.DEPT_CD     = ?
                       AND B.TEAM_CD     = ?
                       AND B.PC_CD       LIKE ? || '%'
                       AND A.PUMBUN_CD   LIKE ? || '%'
                       AND A.EXE_YM      = ?
                       AND EXISTS ( SELECT MYORG.USER_ID
                                      FROM COM.V_MYORG MYORG
                                     WHERE MYORG.STR_CD      = B.STR_CD
                                       AND MYORG.DEPT_CD     = B.DEPT_CD
                                       AND MYORG.TEAM_CD     = B.TEAM_CD
                                       AND MYORG.PC_CD       = B.PC_CD
                                       AND MYORG.PUMBUN_CD   = A.PUMBUN_CD
                                       AND MYORG.USER_ID     = ?
                                  )
                     GROUP BY
                           A.CONF_FLAG
                         , A.STR_CD
                         , B.DEPT_CD
                         , B.TEAM_CD
                         , B.PC_CD
                         , B.ORG_SHORT_NAME
                         , A.EXE_YM
                         , A.CONF_DT
                         , A.PUMBUN_CD
                         , A.EXE_DT
                   ) A
             GROUP BY
                   A.CONF_FLAG
                 , A.STR_CD
                 , A.STR_NAME
                 , A.DEPT_CD
                 , A.TEAM_CD
                 , A.PC_CD
                 , A.ORG_NAME
                 , A.EXE_YM
                 , A.CONF_DT
        ]]>        
    </query>
    
    
    
    <!-- 당초PC별월매출계획 조회 쿼리  -->
    <query name="SEL_PLANPUMBUN_SELORIGIN">        
        <![CDATA[
            SELECT A.PUMBUN_CD
                 , A.PUMBUN_NAME
                 , MAX(A.NORM_MG_RATE)        AS NORM_MG_RATE
                 , SUM(A.TOTAL)               AS TOTAL
                 , SUM(A.ORIGIN_SALE_TAMT1 )    AS ORIGIN_SALE_TAMT1
                 , SUM(A.ORIGIN_SALE_TAMT2 )    AS ORIGIN_SALE_TAMT2
                 , SUM(A.ORIGIN_SALE_TAMT3 )    AS ORIGIN_SALE_TAMT3
                 , SUM(A.ORIGIN_SALE_TAMT4 )    AS ORIGIN_SALE_TAMT4
                 , SUM(A.ORIGIN_SALE_TAMT5 )    AS ORIGIN_SALE_TAMT5
                 , SUM(A.ORIGIN_SALE_TAMT6 )    AS ORIGIN_SALE_TAMT6
                 , SUM(A.ORIGIN_SALE_TAMT7 )    AS ORIGIN_SALE_TAMT7
                 , SUM(A.ORIGIN_SALE_TAMT8 )    AS ORIGIN_SALE_TAMT8
                 , SUM(A.ORIGIN_SALE_TAMT9 )    AS ORIGIN_SALE_TAMT9
                 , SUM(A.ORIGIN_SALE_TAMT10)    AS ORIGIN_SALE_TAMT10
                 , SUM(A.ORIGIN_SALE_TAMT11)    AS ORIGIN_SALE_TAMT11
                 , SUM(A.ORIGIN_SALE_TAMT12)    AS ORIGIN_SALE_TAMT12
                 , SUM(A.ORIGIN_SALE_TAMT13)    AS ORIGIN_SALE_TAMT13
                 , SUM(A.ORIGIN_SALE_TAMT14)    AS ORIGIN_SALE_TAMT14
                 , SUM(A.ORIGIN_SALE_TAMT15)    AS ORIGIN_SALE_TAMT15
                 , SUM(A.ORIGIN_SALE_TAMT16)    AS ORIGIN_SALE_TAMT16
                 , SUM(A.ORIGIN_SALE_TAMT17)    AS ORIGIN_SALE_TAMT17
                 , SUM(A.ORIGIN_SALE_TAMT18)    AS ORIGIN_SALE_TAMT18
                 , SUM(A.ORIGIN_SALE_TAMT19)    AS ORIGIN_SALE_TAMT19
                 , SUM(A.ORIGIN_SALE_TAMT20)    AS ORIGIN_SALE_TAMT20
                 , SUM(A.ORIGIN_SALE_TAMT21)    AS ORIGIN_SALE_TAMT21
                 , SUM(A.ORIGIN_SALE_TAMT22)    AS ORIGIN_SALE_TAMT22
                 , SUM(A.ORIGIN_SALE_TAMT23)    AS ORIGIN_SALE_TAMT23
                 , SUM(A.ORIGIN_SALE_TAMT24)    AS ORIGIN_SALE_TAMT24
                 , SUM(A.ORIGIN_SALE_TAMT25)    AS ORIGIN_SALE_TAMT25
                 , SUM(A.ORIGIN_SALE_TAMT26)    AS ORIGIN_SALE_TAMT26
                 , SUM(A.ORIGIN_SALE_TAMT27)    AS ORIGIN_SALE_TAMT27
                 , SUM(A.ORIGIN_SALE_TAMT28)    AS ORIGIN_SALE_TAMT28
                 , SUM(A.ORIGIN_SALE_TAMT29)    AS ORIGIN_SALE_TAMT29
                 , SUM(A.ORIGIN_SALE_TAMT30)    AS ORIGIN_SALE_TAMT30
                 , SUM(A.ORIGIN_SALE_TAMT31)    AS ORIGIN_SALE_TAMT31
                 , A.CONF_FLAG
                 , A.EXE_YM
                 , A.SALE_ORG_CD
             FROM (      
                    SELECT A.PUMBUN_CD                                                                      
                         , D.PUMBUN_NAME                                                                        
                         , (SELECT NVL(MAX(NORM_MG_RATE),0)
                              FROM DPS.PC_MARGINMST 
                             WHERE EVENT_FLAG = '00' 
                               AND STR_CD     = A.STR_CD 
                               AND PUMBUN_CD  = A.PUMBUN_CD
                               AND EVENT_CD   = '00000000000'
                               AND A.EXE_DT   BETWEEN APP_S_DT AND APP_E_DT
                               )                                                                    AS NORM_MG_RATE  
                         , A.ORIGIN_SALE_TAMT                                                       AS TOTAL                                                                   
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '01' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT1
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '02' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT2
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '03' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT3
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '04' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT4
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '05' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT5
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '06' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT6
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '07' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT7
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '08' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT8
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '09' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT9
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '10' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT10
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '11' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT11
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '12' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT12
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '13' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT13
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '14' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT14
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '15' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT15
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '16' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT16
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '17' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT17
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '18' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT18
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '19' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT19
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '20' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT20
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '21' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT21
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '22' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT22
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '23' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT23
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '24' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT24
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '25' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT25
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '26' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT26
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '27' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT27
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '28' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT28
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '29' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT29
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '30' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT30
                         , (CASE WHEN SUBSTR(EXE_DT,7,2) = '31' THEN A.ORIGIN_SALE_TAMT ELSE 0 END) AS ORIGIN_SALE_TAMT31
                         , A.CONF_FLAG
                         , A.EXE_YM
                         , D.SALE_ORG_CD
                      FROM DPS.PS_ACTPUMBUN A                                                                       
                         , DPS.PC_ORGMST    B  
                         , DPS.PC_STRPBN    D   
                     WHERE A.ORG_CD     = B.ORG_CD
                       AND A.STR_CD     = D.STR_CD
                       AND A.PUMBUN_CD  = D.PUMBUN_CD
                       AND D.BIZ_TYPE   = '5'
                       AND B.STR_CD      = ?
                       AND B.DEPT_CD     = ?
                       AND B.TEAM_CD     = ?
                       AND B.PC_CD       = ?
                       AND A.EXE_YM      = ?
                       AND EXISTS ( SELECT MYORG.USER_ID
                                      FROM COM.V_MYORG MYORG
                                     WHERE MYORG.STR_CD      = B.STR_CD
                                       AND MYORG.DEPT_CD     = B.DEPT_CD
                                       AND MYORG.TEAM_CD     = B.TEAM_CD
                                       AND MYORG.PC_CD       = B.PC_CD
                                       AND MYORG.PUMBUN_CD   = A.PUMBUN_CD
                                       AND MYORG.USER_ID     = ?
                                  )
                     ORDER BY                                                                       
                           A.PUMBUN_CD                                                                      
                         , A.EXE_DT                                                                     
                   ) A
             GROUP BY 
                        A.PUMBUN_CD
                      , A.PUMBUN_NAME
                      , A.CONF_FLAG
                      , A.EXE_YM
                      , A.SALE_ORG_CD

        ]]>        
    </query>
    
    <!-- 당초PC별월매출계획 조회 쿼리  -->
    <query name="SEL_PLANPC_DATA_CHECK">        
        <![CDATA[
            SELECT A.PUMBUN_CD
                 , C.PUMBUN_NAME                                                             AS ORG_NAME
              FROM (
                    SELECT A.PLAN_YM
                         , A.STR_CD
                         , A.DEPT_CD
                         , A.TEAM_CD
                         , A.PC_CD
                         , A.ORG_CD
                         , A.PUMBUN_CD
                      FROM DPS.PS_PLANPUMBUN      A
                     WHERE A.STR_CD     = ?
                       AND A.DEPT_CD    = ?
                       AND A.TEAM_CD    = ?
                       AND A.PC_CD      = ?
                       AND A.ORG_LEVEL  = '4'
                       AND A.PLAN_YM    LIKE ? || '%'
                    ) A
                 , DPS.PC_ORGMST B
                 , DPS.PC_STRPBN C
             WHERE A.STR_CD             = B.STR_CD
               AND A.DEPT_CD            = B.DEPT_CD
               AND A.TEAM_CD            = B.TEAM_CD
               AND A.ORG_CD             = B.ORG_CD
               AND A.STR_CD             = C.STR_CD
               AND SUBSTR(A.ORG_CD,1,8) = SUBSTR(C.SALE_ORG_CD,1,8)
               AND B.ORG_FLAG  = ?
             ORDER BY
                   A.PUMBUN_CD
                 , C.PUMBUN_NAME
    
            
        ]]>        
    </query>
    
    
    <!-- 당초PC별월매출계획  확정구분 조회 쿼리  -->
    <query name="SEL_PLANPUMBUNCONFFLAG">        
        <![CDATA[
            SELECT CONF_FLAG
              FROM DPS.PS_PLANPUMBUN    A
                 , DPS.PC_ORGMST        B
             WHERE A.ORG_CD     = B.ORG_CD
               AND B.ORG_FLAG   = ?
               AND A.STR_CD     = ?
               AND A.DEPT_CD    = ?
               AND A.TEAM_CD    = ?
               AND A.ORG_LEVEL  = '4'
               AND A.PLAN_YM    = ? || '01'
             ORDER BY
                   A.ORG_CD
        ]]>        
    </query>
    
    <!-- 당초PC별월매출계획  확정구분 조회 쿼리  -->
    <query name="SEL_PLANPCCONFFLAG">        
        <![CDATA[
            SELECT CONF_FLAG
              FROM DPS.PS_PLANPC        A
                 , DPS.PC_ORGMST        B
             WHERE A.ORG_CD     = B.ORG_CD
               AND B.ORG_FLAG   = ?
               AND A.STR_CD     = ?
               AND A.DEPT_CD    = ?
               AND A.TEAM_CD    = ?
               AND A.PC_CD      = ?
               AND A.ORG_LEVEL  = '4'
               AND A.PLAN_YM    = ? || '01'
               AND A.CONF_FLAG  = 'Y'
             ORDER BY
                   A.ORG_CD
        ]]>        
    </query>
    <!-- 당초품번확정 수정 -->    
    <query name="UPD_ACTPUMBUN_CONF">
        <![CDATA[
            UPDATE DPS.PS_ACTPUMBUN     A
               SET A.CONF_DT              = ?
                 , A.CONF_ID              = ?
                 , A.CONF_FLAG            = ?
                 , A.MOD_DATE             = SYSDATE
                 , A.MOD_ID               = ?
             WHERE A.STR_CD               = ? 
               AND A.DEPT_CD              = ?
               AND A.TEAM_CD              = ?
               AND A.PC_CD                = ?
               AND A.ORG_LEVEL            = '4'
               AND A.EXE_YM               = ?
               AND NVL(A.CONF_FLAG,'N')   = ?
               AND EXISTS (SELECT PUMBUN_CD
                             FROM DPS.PC_STRPBN
                            WHERE STR_CD     = A.STR_CD
                              AND PUMBUN_CD  = A.PUMBUN_CD
                              AND BIZ_TYPE   = '5'
                          )
        ]]>
    </query>
    
    <query name="INS_ACTPUMBUN">        
        <![CDATA[
            INSERT INTO DPS.PS_ACTPUMBUN   (  STR_CD
											, EXE_YM
											, EXE_DT
											, PUMBUN_CD
											, ORG_CD
                                            , ORG_LEVEL
                                            , DEPT_CD
											, TEAM_CD
                                            , PC_CD
											, BFYY_NORM_SAMT
											, BFYY_EVT_SAMT
											, BFYY_SALE_TAMT
											, BFYY_PROF_TAMT
											, BFYY_PROF_CRATE
											, BFYY_SALE_CRATE
											, ORIGIN_NORM_SAMT
											, ORIGIN_EVT_SAMT
											, ORIGIN_SALE_TAMT
											, ORIGIN_PROF_TAMT
											, ORIGIN_PROF_CRATE
											, ORIGIN_SALE_CRATE
											, ORIGIN_SALE_IRATE
											, ORIGIN_PROF_IRATE
											, REG_DATE
											, REG_ID
											, MOD_DATE
											, MOD_ID
                                           )
                                    VALUES (  ?
                                            , ?
                                            , ?
                                            , ?
                                            , ?
                                            , '4'
                                            , ?
                                            , ?
                                            , ?
                                            , ?
                                            , ?
                                            , ?
                                            , ?
                                            , ROUND(?,2)
                                            , ROUND(?,2)
                                            , ?
                                            , ?
                                            , ?
                                            , ?
                                            , ROUND(?,2)
                                            , ROUND(?,2)
                                            , ROUND(?,2)
                                            , ROUND(?,2)
                                            , SYSDATE
                                            , ?
                                            , SYSDATE
                                            , ?
                                           )
            
        ]]>        
    </query>
    <!-- 당초품번 수정 -->    
    <query name="UPD_ACTPUMBUN">
        <![CDATA[
            UPDATE DPS.PS_ACTPUMBUN
               SET ORIGIN_NORM_SAMT     = ?
                 , ORIGIN_EVT_SAMT      = ?
                 , ORIGIN_SALE_TAMT     = ?
                 , ORIGIN_PROF_TAMT     = ?
                 , ORIGIN_PROF_CRATE    = ?
                 , ORIGIN_SALE_CRATE    = ?
                 , ORIGIN_SALE_IRATE    = ?
                 , ORIGIN_PROF_IRATE    = ?
                 , MOD_DATE             = SYSDATE
                 , MOD_ID               = ?
             WHERE STR_CD               = ? 
               AND DEPT_CD              = ?
               AND TEAM_CD              = ?
               AND PC_CD                = ?
               AND PUMBUN_CD            = ?
               AND ORG_LEVEL            = '4'
               AND EXE_YM               = ?
               AND EXE_DT               = ?
               AND NVL(CONF_FLAG,'N')   = 'N'
               
        ]]>
    </query>
</service>