<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 박종은
 * 회 사 명 : 한국후지쯔
 * 작 성 일 : 2010.04.14
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  
 -->
<service name="/psal306.ps">

    <gauce name="H_SEL_MASTER"> 
        <column colName="CODE"                  colType="TB_STRING"      size="10"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NAME"                  colType="TB_STRING"      size="40"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="GUBUN_TOTAL"           colType="TB_STRING"      size="10"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_TOTAL"            colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_TOTALAVG"         colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE9"                 colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE10"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE11"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE12"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE13"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE14"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE15"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE16"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE17"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE18"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE19"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE20"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE21"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE22"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE23"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
                                           
        <column colName="GUBUN_CUST_CNT"        colType="TB_STRING"      size="10"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUST_CNT_TOTAL"        colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUST_CNT_TOTALAVG"     colType="TB_DECIMAL"     size="5"        dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUSTCNT9"              colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUSTCNT10"             colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUSTCNT11"             colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUSTCNT12"             colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUSTCNT13"             colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUSTCNT14"             colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUSTCNT15"             colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUSTCNT16"             colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUSTCNT17"             colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUSTCNT18"             colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUSTCNT19"             colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUSTCNT20"             colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUSTCNT21"             colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUSTCNT22"             colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUSTCNT23"             colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
            
    </gauce>
    
    <gauce name="H_SEL_CMPRDT"> 
        <column colName="CMPR_DT"                 colType="TB_STRING"      size="8"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    
    <!-- 쿼리는 전부 대문자 -->
    <query name="SEL_TIMESALEDATE">        
        <![CDATA[
            SELECT ORG_CD                                                                                   AS CODE
                 , ORG_NAME                                                                                 AS NAME
                 , MAX(GUBUN_TOTAL)                                                                         AS GUBUN_TOTAL
                 , SUM(SALE_TOTAL)                                                                     AS SALE_TOTAL
                 , ROUND(SUM(SALE_TOTAL)/15, 0)                                                        AS SALE_TOTALAVG
                 , SUM(SALE9)                                                                          AS SALE9
                 , SUM(SALE10)                                                                         AS SALE10
                 , SUM(SALE11)                                                                         AS SALE11
                 , SUM(SALE12)                                                                         AS SALE12
                 , SUM(SALE13)                                                                         AS SALE13
                 , SUM(SALE14)                                                                         AS SALE14
                 , SUM(SALE15)                                                                         AS SALE15
                 , SUM(SALE16)                                                                         AS SALE16
                 , SUM(SALE17)                                                                         AS SALE17
                 , SUM(SALE18)                                                                         AS SALE18
                 , SUM(SALE19)                                                                         AS SALE19
                 , SUM(SALE20)                                                                         AS SALE20
                 , SUM(SALE21)                                                                         AS SALE21
                 , SUM(SALE22)                                                                         AS SALE22
                 , SUM(SALE23)                                                                         AS SALE23
                 
                 , MAX(GUBUN_CUST_CNT)                                                                      AS GUBUN_CUST_CNT
                 , SUM(CUST_CNT_TOTAL)                                                                      AS CUST_CNT_TOTAL
                 , ROUND(SUM(CUST_CNT_TOTAL)/15, 2)                                                         AS CUST_CNT_TOTAL
                 , SUM(CUSTCNT9)                                                                            AS CUSTCNT9
                 , SUM(CUSTCNT10)                                                                           AS CUSTCNT10
                 , SUM(CUSTCNT11)                                                                           AS CUSTCNT11
                 , SUM(CUSTCNT12)                                                                           AS CUSTCNT12
                 , SUM(CUSTCNT13)                                                                           AS CUSTCNT13
                 , SUM(CUSTCNT14)                                                                           AS CUSTCNT14
                 , SUM(CUSTCNT15)                                                                           AS CUSTCNT15
                 , SUM(CUSTCNT16)                                                                           AS CUSTCNT16
                 , SUM(CUSTCNT17)                                                                           AS CUSTCNT17
                 , SUM(CUSTCNT18)                                                                           AS CUSTCNT18
                 , SUM(CUSTCNT19)                                                                           AS CUSTCNT19
                 , SUM(CUSTCNT20)                                                                           AS CUSTCNT20
                 , SUM(CUSTCNT21)                                                                           AS CUSTCNT21
                 , SUM(CUSTCNT22)                                                                           AS CUSTCNT22
                 , SUM(CUSTCNT23)                                                                           AS CUSTCNT23
                 
              FROM (     
                    SELECT A.ORG_CD
                         , A.ORG_NAME
                         , '총매출'                                                                                     AS GUBUN_TOTAL
                         , SUM(A.TOT_SALE_AMT)                                                                              AS SALE_TOTAL
                         , ( CASE WHEN A.SALE_TIME < '1000' THEN SUM(A.TOT_SALE_AMT) ELSE 0 END ) AS SALE9
                         , ( CASE WHEN A.SALE_TIME >= '1000' AND A.SALE_TIME < '1100' THEN SUM(A.TOT_SALE_AMT) ELSE 0 END ) AS SALE10
                         , ( CASE WHEN A.SALE_TIME >= '1100' AND A.SALE_TIME < '1200' THEN SUM(A.TOT_SALE_AMT) ELSE 0 END ) AS SALE11
                         , ( CASE WHEN A.SALE_TIME >= '1200' AND A.SALE_TIME < '1300' THEN SUM(A.TOT_SALE_AMT) ELSE 0 END ) AS SALE12
                         , ( CASE WHEN A.SALE_TIME >= '1300' AND A.SALE_TIME < '1400' THEN SUM(A.TOT_SALE_AMT) ELSE 0 END ) AS SALE13
                         , ( CASE WHEN A.SALE_TIME >= '1400' AND A.SALE_TIME < '1500' THEN SUM(A.TOT_SALE_AMT) ELSE 0 END ) AS SALE14
                         , ( CASE WHEN A.SALE_TIME >= '1500' AND A.SALE_TIME < '1600' THEN SUM(A.TOT_SALE_AMT) ELSE 0 END ) AS SALE15
                         , ( CASE WHEN A.SALE_TIME >= '1600' AND A.SALE_TIME < '1700' THEN SUM(A.TOT_SALE_AMT) ELSE 0 END ) AS SALE16
                         , ( CASE WHEN A.SALE_TIME >= '1700' AND A.SALE_TIME < '1800' THEN SUM(A.TOT_SALE_AMT) ELSE 0 END ) AS SALE17
                         , ( CASE WHEN A.SALE_TIME >= '1800' AND A.SALE_TIME < '1900' THEN SUM(A.TOT_SALE_AMT) ELSE 0 END ) AS SALE18
                         , ( CASE WHEN A.SALE_TIME >= '1900' AND A.SALE_TIME < '2000' THEN SUM(A.TOT_SALE_AMT) ELSE 0 END ) AS SALE19
                         , ( CASE WHEN A.SALE_TIME >= '2000' AND A.SALE_TIME < '2100' THEN SUM(A.TOT_SALE_AMT) ELSE 0 END ) AS SALE20
                         , ( CASE WHEN A.SALE_TIME >= '2100' AND A.SALE_TIME < '2200' THEN SUM(A.TOT_SALE_AMT) ELSE 0 END ) AS SALE21
                         , ( CASE WHEN A.SALE_TIME >= '2200' AND A.SALE_TIME < '2300' THEN SUM(A.TOT_SALE_AMT) ELSE 0 END ) AS SALE22
                         , ( CASE WHEN A.SALE_TIME >= '2300' AND A.SALE_TIME < '2400' THEN SUM(A.TOT_SALE_AMT) ELSE 0 END ) AS SALE23
                         
                         , '객수'                                                                                       AS GUBUN_CUST_CNT
                         , SUM(A.CUST_CNT)                                                                              AS CUST_CNT_TOTAL
                         , ( CASE WHEN A.SALE_TIME < '1000' THEN SUM(A.CUST_CNT) ELSE 0 END ) AS CUSTCNT9
                         , ( CASE WHEN A.SALE_TIME >= '1000' AND A.SALE_TIME < '1100' THEN SUM(A.CUST_CNT) ELSE 0 END ) AS CUSTCNT10
                         , ( CASE WHEN A.SALE_TIME >= '1100' AND A.SALE_TIME < '1200' THEN SUM(A.CUST_CNT) ELSE 0 END ) AS CUSTCNT11
                         , ( CASE WHEN A.SALE_TIME >= '1200' AND A.SALE_TIME < '1300' THEN SUM(A.CUST_CNT) ELSE 0 END ) AS CUSTCNT12
                         , ( CASE WHEN A.SALE_TIME >= '1300' AND A.SALE_TIME < '1400' THEN SUM(A.CUST_CNT) ELSE 0 END ) AS CUSTCNT13
                         , ( CASE WHEN A.SALE_TIME >= '1400' AND A.SALE_TIME < '1500' THEN SUM(A.CUST_CNT) ELSE 0 END ) AS CUSTCNT14
                         , ( CASE WHEN A.SALE_TIME >= '1500' AND A.SALE_TIME < '1600' THEN SUM(A.CUST_CNT) ELSE 0 END ) AS CUSTCNT15
                         , ( CASE WHEN A.SALE_TIME >= '1600' AND A.SALE_TIME < '1700' THEN SUM(A.CUST_CNT) ELSE 0 END ) AS CUSTCNT16
                         , ( CASE WHEN A.SALE_TIME >= '1700' AND A.SALE_TIME < '1800' THEN SUM(A.CUST_CNT) ELSE 0 END ) AS CUSTCNT17
                         , ( CASE WHEN A.SALE_TIME >= '1800' AND A.SALE_TIME < '1900' THEN SUM(A.CUST_CNT) ELSE 0 END ) AS CUSTCNT18
                         , ( CASE WHEN A.SALE_TIME >= '1900' AND A.SALE_TIME < '2000' THEN SUM(A.CUST_CNT) ELSE 0 END ) AS CUSTCNT19
                         , ( CASE WHEN A.SALE_TIME >= '2000' AND A.SALE_TIME < '2100' THEN SUM(A.CUST_CNT) ELSE 0 END ) AS CUSTCNT20
                         , ( CASE WHEN A.SALE_TIME >= '2100' AND A.SALE_TIME < '2200' THEN SUM(A.CUST_CNT) ELSE 0 END ) AS CUSTCNT21
                         , ( CASE WHEN A.SALE_TIME >= '2200' AND A.SALE_TIME < '2300' THEN SUM(A.CUST_CNT) ELSE 0 END ) AS CUSTCNT22
                         , ( CASE WHEN A.SALE_TIME >= '2300' AND A.SALE_TIME < '2400' THEN SUM(A.CUST_CNT) ELSE 0 END ) AS CUSTCNT23
                    
                      FROM (
                            SELECT A.SALE_DT                                       AS ORG_CD
                                 , TO_CHAR( TO_DATE( A.SALE_DT, 'YYYYMMDD'),'DAY') AS ORG_NAME
                                 , A.SALE_TIME
                                 , A.NORM_SALE_AMT                                  AS TOT_SALE_AMT --  20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                 , NVL(A.SALE_PROF_AMT,0)                          AS SALE_PROF_AMT
                                 , A.CUST_CNT
                              FROM DPS.PS_TIMEPBN A
                                 , DPS.PC_ORGMST B
                                 , DPS.PC_STRPBN C
                             WHERE C.SALE_ORG_CD   = B.ORG_CD
                               AND A.PUMBUN_CD = C.PUMBUN_CD
                               AND A.STR_CD = C.STR_CD
                               AND B.STR_CD   LIKE ? || '%'
                               AND B.DEPT_CD  LIKE ? || '%'
                               AND B.TEAM_CD  LIKE ? || '%'
                               AND B.PC_CD    LIKE ? || '%'
                               AND A.SALE_DT            >= ?
                               AND A.SALE_DT            <= ?
                               AND EXISTS ( SELECT MYORG.USER_ID
                                              FROM COM.V_MYORG MYORG
                                             WHERE MYORG.STR_CD      = B.STR_CD
                                               AND MYORG.DEPT_CD     = B.DEPT_CD
                                               AND MYORG.TEAM_CD     = B.TEAM_CD
                                               AND MYORG.PC_CD       = B.PC_CD
                                               AND MYORG.USER_ID     = ?
                                           )
	                           AND NOT EXISTS (
	                                            SELECT *
	                                              FROM COM.TC_COMMCODE
	                                             WHERE SYS_PART   = 'D'
	                                               AND COMM_PART  = 'D213'
	                                               AND USE_YN     = 'Y'
	                                               AND REFER_CODE = A.STR_CD
	                                               AND COMM_CODE  = A.PUMBUN_CD
	                                          )
                           )   A
                     GROUP BY
                           A.ORG_CD
                         , A.ORG_NAME
                         , A.SALE_TIME
                   ) A
             GROUP BY 
                   A.ORG_CD
                 , A.ORG_NAME
             ORDER BY
                   A.ORG_CD
                 
        ]]>        
    </query>
    
    <query name="SEL_CMPRDT">        
        <![CDATA[
            SELECT CMPR_DT
              FROM DPS.PS_SCHEDULE
             WHERE STR_CD  = ?
               AND SALE_DT = ?
        ]]>        
    </query>
    
</service>