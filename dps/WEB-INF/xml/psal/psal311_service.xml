<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 박종은
 * 회 사 명 : 한국후지쯔
 * 작 성 일 : 2010.04.08
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  
 -->
<service name="/psal311.ps">

    <gauce name="H_SEL_MASTER"> 
        <column colName="STR_CD"                  colType="TB_STRING"      size="10"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STR_NAME"                colType="TB_STRING"      size="40"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORG_CD"                  colType="TB_STRING"      size="10"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORG_NAME"                colType="TB_STRING"      size="40"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT"        colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TOT_SALE_AMT"            colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ACHIEVERATE"             colType="TB_DECIMAL"     size="13"       dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="RATE"                    colType="TB_DECIMAL"     size="13"       dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TOT_SALE_AMT_CMPR"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALEIRATE"               colType="TB_DECIMAL"     size="13"       dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="EXPECT_AMT"              colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REDU_AMT"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_AMT"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DC_AMT"                  colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NET_SALE_AMT"            colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_PROF_AMT"           colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PROFRATE"                colType="TB_DECIMAL"     size="13"       dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUST_CNT"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUST_DANGA"              colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUST_CNT_CMPR"           colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUST_CNT_RATE"           colType="TB_DECIMAL"     size="13"       dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
    	<column colName="ORIGIN_SALE_TAMT_CHART"        colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TOT_SALE_AMT_CHART"            colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    	<column colName="EXPECT_AMT_CHART"              colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    	<column colName="TOT_SALE_AMT_CMPR_CHART"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
	<gauce name="H_SEL_MASTER2"> 
        <column colName="STR_CD"                  colType="TB_STRING"      size="10"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STR_NAME"                colType="TB_STRING"      size="40"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORG_CD"                  colType="TB_STRING"      size="10"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORG_NAME"                colType="TB_STRING"      size="40"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORIGIN_SALE_TAMT"        colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TOT_SALE_AMT"            colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ACHIEVERATE"             colType="TB_DECIMAL"     size="13"       dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="RATE"                    colType="TB_DECIMAL"     size="13"       dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TOT_SALE_AMT_CMPR"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALEIRATE"               colType="TB_DECIMAL"     size="13"       dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="EXPECT_AMT"              colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REDU_AMT"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_AMT"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DC_AMT"                  colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NET_SALE_AMT"            colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_PROF_AMT"           colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PROFRATE"                colType="TB_DECIMAL"     size="13"       dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUST_CNT"                colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUST_DANGA"              colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUST_CNT_CMPR"           colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUST_CNT_RATE"           colType="TB_DECIMAL"     size="13"       dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
    	<column colName="ORIGIN_SALE_TAMT_CHART"        colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TOT_SALE_AMT_CHART"            colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    	<column colName="EXPECT_AMT_CHART"              colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    	<column colName="TOT_SALE_AMT_CMPR_CHART"       colType="TB_DECIMAL"     size="13"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <gauce name="H_SEL_CMPRDT"> 
        <column colName="CMPR_DT"                 colType="TB_STRING"      size="8"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    
    <!-- 쿼리는 전부 대문자 -->
    <!-- 당초팀별월매출계획 조회 쿼리  -->
   
    <query name="SEL_SALE_PUMBUN">        
        <![CDATA[
             SELECT A.STR_CD, DPS.FN_GET_STORE_NAME(A.STR_CD) STR_NAME,A.PUMBUN_CD    AS ORG_CD
                  , F.PUMBUN_NAME                                                     AS ORG_NAME
                  , SUM(NVL(A.ORIGIN_SALE_TAMT,0))                                    AS ORIGIN_SALE_TAMT
                  , SUM(NVL(A.TOT_SALE_AMT,0))                                        AS TOT_SALE_AMT
                  , (CASE WHEN SUM(NVL(A.ORIGIN_SALE_TAMT,0))  = 0 THEN 0 
                     ELSE    ( SUM(NVL(A.TOT_SALE_AMT,0))/SUM(NVL(A.ORIGIN_SALE_TAMT,0)))*100 END) AS ACHIEVERATE
                  , 0.00                                                              AS RATE
                  , SUM(NVL(A.TOT_SALE_AMT_CMPR,0))                                        AS TOT_SALE_AMT_CMPR
                  , (CASE WHEN  SUM(NVL(A.TOT_SALE_AMT_CMPR,0)) = 0 THEN 0 
                     ELSE SUM(NVL(A.TOT_SALE_AMT,0))/SUM(NVL(A.TOT_SALE_AMT_CMPR,0))*100 END)   AS SALEIRATE
                  , CASE WHEN ? < TO_CHAR(SYSDATE, 'YYYYMMDD')  THEN SUM(NVL(A.TOT_SALE_AMT,0)) 
                                     ELSE CASE WHEN ? = TO_CHAR(SYSDATE, 'YYYYMMDD') THEN CASE WHEN SUM(NVL(G.TOT_SALE_AMT_CMP,0)) = 0 THEN SUM(NVL(G.TOT_SALE_AMT,0)) + SUM(NVL(G.TOT_SALE_AMT_CMP2,0)) ELSE SUM(NVL(G.TOT_SALE_AMT,0)) + (SUM(NVL(G.TOT_SALE_AMT_CMP2,0)) * (SUM(NVL(G.TOT_SALE_AMT,0)) / (SUM(NVL(G.TOT_SALE_AMT_CMP,0))))) END
                                             ELSE SUM(NVL(G.TOT_SALE_AMT,0))
                                        END 
                            END AS EXPECT_AMT
                  , SUM(NVL(A.REDU_AMT,0))                                            AS REDU_AMT
                  , SUM(NVL(A.NORM_SALE_AMT,0))                                       AS NORM_SALE_AMT
                  , SUM(NVL(A.DC_AMT,0))                                              AS DC_AMT
                  , SUM(NVL(A.NET_SALE_AMT,0))                                        AS NET_SALE_AMT
                  , SUM(NVL(A.SALE_PROF_AMT,0))                                       AS SALE_PROF_AMT
                  , (CASE WHEN SUM(NVL(A.TOT_SALE_AMT,0)) = 0 THEN 0 
                     ELSE (SUM(NVL(A.SALE_PROF_AMT,0))/SUM(NVL(A.TOT_SALE_AMT,0)))*100 END)                                 AS PROFRATE
                  , SUM(A.CUST_CNT)                                                   AS CUST_CNT
                  , (CASE WHEN SUM(A.CUST_CNT) = 0 THEN 0 ELSE SUM(A.TOT_SALE_AMT)/SUM(A.CUST_CNT) END) AS CUST_DANGA
                  , SUM(A.CUST_CNT_CMPR)                                                   AS CUST_CNT_CMPR
                  , CASE WHEN SUM(A.CUST_CNT_CMPR) = 0 THEN 0 ELSE SUM(A.CUST_CNT) / SUM(A.CUST_CNT_CMPR) * 100 END CUST_CNT_RATE
                     , CASE WHEN SUM(NVL(A.ORIGIN_SALE_TAMT,0)) = 0 THEN 0 ELSE SUM(NVL(A.ORIGIN_SALE_TAMT,0))/1000 END    AS ORIGIN_SALE_TAMT_CHART
                  , CASE WHEN SUM(NVL(A.TOT_SALE_AMT,0)) = 0 THEN 0 ELSE SUM(NVL(A.TOT_SALE_AMT,0))/1000 END    AS TOT_SALE_AMT_CHART
                  , CASE WHEN ? = TO_CHAR(SYSDATE, 'YYYYMMD') THEN CASE WHEN SUM(NVL(G.TOT_SALE_AMT_CMP,0)) = 0 THEN SUM(NVL(G.TOT_SALE_AMT,0)) + SUM(NVL(G.TOT_SALE_AMT_CMP2,0)) ELSE (SUM(NVL(G.TOT_SALE_AMT,0)) + (SUM(NVL(G.TOT_SALE_AMT_CMP2,0)) * (SUM(NVL(G.TOT_SALE_AMT,0)) / (SUM(NVL(G.TOT_SALE_AMT_CMP,0))))))/1000 END
                         ELSE SUM(NVL(G.TOT_SALE_AMT,0))/1000 
                    END AS EXPECT_AMT_CHART
                  , CASE WHEN SUM(NVL(A.TOT_SALE_AMT_CMPR,0)) = 0 THEN 0 ELSE SUM(NVL(A.TOT_SALE_AMT_CMPR,0))/1000 END    AS TOT_SALE_AMT_CMPR_CHART
               FROM (SELECT A.STR_CD                              AS STR_CD
                          , A.PUMBUN_CD                           AS PUMBUN_CD
                          , SUBSTR(C.SALE_ORG_CD,0,8) || '00'     AS ORG_CD
                          , SUM(A.NORM_SALE_AMT)                   AS TOT_SALE_AMT	--  20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                          , SUM(A.REDU_AMT)                       AS REDU_AMT
                          , SUM(A.NORM_SALE_AMT)                  AS NORM_SALE_AMT
                          , SUM(A.DC_AMT)                         AS DC_AMT
                          , SUM(A.NET_SALE_AMT)                   AS NET_SALE_AMT
                          , SUM(A.SALE_PROF_AMT)                  AS SALE_PROF_AMT
                          , SUM(A.CUST_CNT)                       AS CUST_CNT
                          , 0                                     AS TOT_SALE_AMT_CMPR
                          , 0                                     AS CUST_CNT_CMPR
                          , 0                                     AS ORIGIN_SALE_TAMT
                       FROM DPS.PS_DAYPBN    A
                              , DPS.PC_ORGMST    B
                              , DPS.PC_STRPBN    C
                      WHERE B.ORG_CD   = C.SALE_ORG_CD
                        AND A.STR_CD    = C.STR_CD
                        AND A.PUMBUN_CD = C.PUMBUN_CD
                        AND B.STR_CD   LIKE ? || '%'
                        AND B.DEPT_CD  LIKE ? || '%'
                        AND B.TEAM_CD  LIKE ? || '%'
                        AND B.PC_CD    LIKE ? || '%'
                        AND A.SALE_DT  = ?
                        AND EXISTS ( SELECT MYORG.USER_ID
                                       FROM COM.V_MYORG MYORG
                                      WHERE MYORG.STR_CD      = B.STR_CD
                                        AND MYORG.DEPT_CD     = B.DEPT_CD
                                        AND MYORG.TEAM_CD     = B.TEAM_CD
                                        AND MYORG.PC_CD       = B.PC_CD
                                        AND MYORG.PUMBUN_CD   = A.PUMBUN_CD
                                        AND MYORG.USER_ID     = ?
                                   )
                      GROUP BY
                            A.STR_CD
                          , A.PUMBUN_CD
                          , SUBSTR(C.SALE_ORG_CD,0,8) || '00'
                    UNION ALL
                    SELECT F.STR_CD                           AS STR_CD            
                         , F.PUMBUN_CD                        AS PUMBUN_CD         
                         , SUBSTR(H.SALE_ORG_CD,0,8) || '00'  AS ORG_CD            
                         , 0                                  AS TOT_SALE_AMT      
                         , 0                                  AS REDU_AMT          
                         , 0                                  AS NORM_SALE_AMT     
                         , 0                                  AS DC_AMT            
                         , 0                                  AS NET_SALE_AMT      
                         , 0                                  AS SALE_PROF_AMT     
                         , 0                                  AS CUST_CNT          
                         , SUM(F.NORM_SALE_AMT)                AS TOT_SALE_AMT_CMPR -- 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                         , SUM(F.CUST_CNT)                    AS CUST_CNT_CMPR          
                         , 0                                  AS ORIGIN_SALE_TAMT  
                       FROM DPS.PS_DAYPBN F
                               , DPS.PC_ORGMST G
                               , DPS.PC_STRPBN H
                      WHERE G.ORG_CD    = H.SALE_ORG_CD
                        AND F.STR_CD    = H.STR_CD
                        AND F.PUMBUN_CD = F.PUMBUN_CD
                        AND G.STR_CD   LIKE ? || '%'
                        AND G.DEPT_CD  LIKE ? || '%'
                        AND G.TEAM_CD  LIKE ? || '%'
                        AND G.PC_CD    LIKE ? || '%'
                        AND F.SALE_DT  = ?
                        AND EXISTS ( SELECT MYORG.USER_ID
                                       FROM COM.V_MYORG MYORG
                                      WHERE MYORG.STR_CD      = G.STR_CD
                                        AND MYORG.DEPT_CD     = G.DEPT_CD
                                        AND MYORG.TEAM_CD     = G.TEAM_CD
                                        AND MYORG.PC_CD       = G.PC_CD
                                        AND MYORG.PUMBUN_CD   = F.PUMBUN_CD
                                        AND MYORG.USER_ID     = ?
                                   )
                      GROUP BY F.STR_CD
                             , F.PUMBUN_CD
                             , SUBSTR(H.SALE_ORG_CD,0,8)
                    UNION ALL
                    SELECT F.STR_CD                          AS STR_CD 
                         , F.PUMBUN_CD                       AS PUMBUN_CD            
                         , SUBSTR(E.SALE_ORG_CD,1,8) || '00' AS ORG_CD            
                         , 0                                 AS TOT_SALE_AMT      
                         , 0                                 AS REDU_AMT          
                         , 0                                 AS NORM_SALE_AMT     
                         , 0                                 AS DC_AMT            
                         , 0                                 AS NET_SALE_AMT      
                         , 0                                 AS SALE_PROF_AMT     
                         , 0                                 AS CUST_CNT          
                         , 0                                 AS TOT_SALE_AMT_CMPR 
                         , 0                                 AS CUST_CNT_CMPR     
                         , SUM(F.ORIGIN_SALE_TAMT)           AS ORIGIN_SALE_TAMT  
                      FROM DPS.PS_ACTPUMBUN F
                             , DPS.PC_ORGMST G
                             , DPS.PC_STRPBN E
                     WHERE G.ORG_CD    = E.SALE_ORG_CD
                       AND F.STR_CD    =   E.STR_CD
                       AND F.PUMBUN_CD = E.PUMBUN_CD
                       AND G.STR_CD    LIKE ? || '%'
                       AND G.DEPT_CD   LIKE ? || '%'
                       AND G.TEAM_CD   LIKE ? || '%'
                       AND G.PC_CD     LIKE ? || '%'
                       AND F.EXE_DT   = ?
                       AND EXISTS ( SELECT MYORG.USER_ID
                                      FROM COM.V_MYORG MYORG
                                     WHERE MYORG.STR_CD      = G.STR_CD
                                       AND MYORG.DEPT_CD     = G.DEPT_CD
                                       AND MYORG.TEAM_CD     = G.TEAM_CD
                                       AND MYORG.PC_CD       = G.PC_CD
                                       AND MYORG.USER_ID     = ?
                                  )
                     GROUP BY F.STR_CD
                            , F.PUMBUN_CD
                            , SUBSTR(E.SALE_ORG_CD,1,8)
                     )      A
                  , DPS.PC_ORGMST      B
                  , (SELECT SUBSTR(H.SALE_ORG_CD,1,8) || '00'  AS ORG_CD
                          , F.PUMBUN_CD
                          , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME <= TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT      -- 매출일자  20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                          , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME <= TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP  -- 대비일자  20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                          , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME >  TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP2 -- 대비일자  20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                       FROM DPS.PS_TIMEPBN F
                              , DPS.PC_ORGMST G
                              , DPS.PC_STRPBN H
                      WHERE G.ORG_CD    = H.SALE_ORG_CD
                        AND F.STR_CD    = H.STR_CD
                        AND F.PUMBUN_CD = H.PUMBUN_CD
                        AND G.STR_CD    LIKE ? || '%'
                        AND G.DEPT_CD   LIKE ? || '%'
                        AND G.TEAM_CD   LIKE ? || '%'
                        AND G.PC_CD     LIKE ? || '%'
                        AND F.SALE_DT   IN (?, ?) -- 매출일자, 대비일자
                        AND EXISTS ( SELECT MYORG.USER_ID
                                       FROM COM.V_MYORG MYORG
                                      WHERE MYORG.STR_CD      = G.STR_CD
                                        AND MYORG.DEPT_CD     = G.DEPT_CD
                                        AND MYORG.TEAM_CD     = G.TEAM_CD
                                        AND MYORG.PC_CD       = G.PC_CD
                                        AND MYORG.USER_ID     = ?
                                        AND MYORG.PUMBUN_CD   = F.PUMBUN_CD
                                   )
                        AND ? = TO_CHAR(SYSDATE, 'YYYMMDD') -- 매출일자
                      GROUP BY
                            SUBSTR(H.SALE_ORG_CD,1,8) || '00'
                          , F.PUMBUN_CD
                     UNION ALL    
                     SELECT SUBSTR(I.SALE_ORG_CD,1,8) || '00'  AS ORG_CD
                          , F.PUMBUN_CD
                          , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT      -- 매출일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                          , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP  -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                          , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP2 -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                       FROM DPS.PS_TIMEPBN F
                              , DPS.PC_ORGMST G
                              , DPS.PC_STRPBN I
                      WHERE G.ORG_CD    = I.SALE_ORG_CD
                        AND F.STR_CD    = I.STR_CD
                        AND F.PUMBUN_CD = I.PUMBUN_CD
                        AND G.STR_CD    LIKE ? || '%'
                        AND G.DEPT_CD   LIKE ? || '%'
                        AND G.TEAM_CD   LIKE ? || '%'
                        AND G.PC_CD     LIKE ? || '%'
                        AND F.SALE_DT   IN (?, ?) -- 매출일자, 대비일자
                        AND EXISTS ( SELECT MYORG.USER_ID
                                       FROM COM.V_MYORG MYORG
                                      WHERE MYORG.STR_CD      = G.STR_CD
                                        AND MYORG.DEPT_CD     = G.DEPT_CD
                                        AND MYORG.TEAM_CD     = G.TEAM_CD
                                        AND MYORG.PC_CD       = G.PC_CD
                                        AND MYORG.USER_ID     = ?
                                        AND MYORG.PUMBUN_CD   = F.PUMBUN_CD
                                   )
                        AND ? <> TO_CHAR(SYSDATE, 'YYYMMDD') -- 매출일자
                      GROUP BY
                            SUBSTR(I.SALE_ORG_CD,1,8) || '00'
                          , F.PUMBUN_CD
                                       ) G     
                  , DPS.PC_STRPBN        F
              WHERE A.ORG_CD     = B.ORG_CD
                AND A.PUMBUN_CD  = G.PUMBUN_CD(+)
                AND A.STR_CD     =  F.STR_CD
                AND A.PUMBUN_CD  = F.PUMBUN_CD
                AND B.STR_CD     LIKE ? || '%'
                AND B.DEPT_CD    LIKE ? || '%'
                AND B.TEAM_CD    LIKE ? || '%'
                AND B.PC_CD      LIKE ? || '%'
                AND EXISTS ( SELECT MYORG.USER_ID
                               FROM COM.V_MYORG MYORG
                              WHERE MYORG.STR_CD      = B.STR_CD
                                AND MYORG.DEPT_CD     = B.DEPT_CD
                                AND MYORG.TEAM_CD     = B.TEAM_CD
                                AND MYORG.PC_CD       = B.PC_CD
                                AND MYORG.PUMBUN_CD   = A.PUMBUN_CD
                                AND MYORG.USER_ID     = ?
                           )
              GROUP BY A.STR_CD,
                    A.PUMBUN_CD
                  , F.PUMBUN_NAME
              ORDER BY
                    A.PUMBUN_CD
                    
                    -------------1
        ]]>        
    </query>
    <query name="SEL_SALE_PUMBUN2">        
        <![CDATA[
             SELECT A.STR_CD, DPS.FN_GET_STORE_NAME(A.STR_CD) STR_NAME,A.PUMBUN_CD    AS ORG_CD
                  , F.PUMBUN_NAME                                                     AS ORG_NAME
                  , SUM(NVL(A.ORIGIN_SALE_TAMT,0))                                    AS ORIGIN_SALE_TAMT
                  , SUM(NVL(A.TOT_SALE_AMT,0))                                        AS TOT_SALE_AMT
                  , (CASE WHEN SUM(NVL(A.ORIGIN_SALE_TAMT,0))  = 0 THEN 0 
                     ELSE    ( SUM(NVL(A.TOT_SALE_AMT,0))/SUM(NVL(A.ORIGIN_SALE_TAMT,0)))*100 END) AS ACHIEVERATE
                  , 0.00                                                              AS RATE
                  , SUM(NVL(A.TOT_SALE_AMT_CMPR,0))                                        AS TOT_SALE_AMT_CMPR
                  , (CASE WHEN  SUM(NVL(A.TOT_SALE_AMT_CMPR,0)) = 0 THEN 0 
                     ELSE SUM(NVL(A.TOT_SALE_AMT,0))/SUM(NVL(A.TOT_SALE_AMT_CMPR,0))*100 END)   AS SALEIRATE
                  , CASE WHEN ? < TO_CHAR(SYSDATE, 'YYYYMMDD')  THEN SUM(NVL(A.TOT_SALE_AMT,0)) 
                                     ELSE CASE WHEN ? = TO_CHAR(SYSDATE, 'YYYYMMDD') THEN CASE WHEN SUM(NVL(G.TOT_SALE_AMT_CMP,0)) = 0 THEN SUM(NVL(G.TOT_SALE_AMT,0)) + SUM(NVL(G.TOT_SALE_AMT_CMP2,0)) ELSE SUM(NVL(G.TOT_SALE_AMT,0)) + (SUM(NVL(G.TOT_SALE_AMT_CMP2,0)) * (SUM(NVL(G.TOT_SALE_AMT,0)) / (SUM(NVL(G.TOT_SALE_AMT_CMP,0))))) END
                                             ELSE SUM(NVL(G.TOT_SALE_AMT,0))
                                        END 
                            END AS EXPECT_AMT
                  , SUM(NVL(A.REDU_AMT,0))                                            AS REDU_AMT
                  , SUM(NVL(A.NORM_SALE_AMT,0))                                       AS NORM_SALE_AMT
                  , SUM(NVL(A.DC_AMT,0))                                              AS DC_AMT
                  , SUM(NVL(A.NET_SALE_AMT,0))                                        AS NET_SALE_AMT
                  , SUM(NVL(A.SALE_PROF_AMT,0))                                       AS SALE_PROF_AMT
                  , (CASE WHEN SUM(NVL(A.TOT_SALE_AMT,0)) = 0 THEN 0 
                     ELSE (SUM(NVL(A.SALE_PROF_AMT,0))/SUM(NVL(A.TOT_SALE_AMT,0)))*100 END)                                 AS PROFRATE
                  , SUM(A.CUST_CNT)                                                   AS CUST_CNT
                  , (CASE WHEN SUM(A.CUST_CNT) = 0 THEN 0 ELSE SUM(A.TOT_SALE_AMT)/SUM(A.CUST_CNT) END) AS CUST_DANGA
                  , SUM(A.CUST_CNT_CMPR)                                                   AS CUST_CNT_CMPR
                  , CASE WHEN SUM(A.CUST_CNT_CMPR) = 0 THEN 0 ELSE SUM(A.CUST_CNT) / SUM(A.CUST_CNT_CMPR) * 100 END CUST_CNT_RATE
                     , CASE WHEN SUM(NVL(A.ORIGIN_SALE_TAMT,0)) = 0 THEN 0 ELSE SUM(NVL(A.ORIGIN_SALE_TAMT,0))/1000 END    AS ORIGIN_SALE_TAMT_CHART
                  , CASE WHEN SUM(NVL(A.TOT_SALE_AMT,0)) = 0 THEN 0 ELSE SUM(NVL(A.TOT_SALE_AMT,0))/1000 END    AS TOT_SALE_AMT_CHART
                  , CASE WHEN ? = TO_CHAR(SYSDATE, 'YYYYMMD') THEN CASE WHEN SUM(NVL(G.TOT_SALE_AMT_CMP,0)) = 0 THEN SUM(NVL(G.TOT_SALE_AMT,0)) + SUM(NVL(G.TOT_SALE_AMT_CMP2,0)) ELSE (SUM(NVL(G.TOT_SALE_AMT,0)) + (SUM(NVL(G.TOT_SALE_AMT_CMP2,0)) * (SUM(NVL(G.TOT_SALE_AMT,0)) / (SUM(NVL(G.TOT_SALE_AMT_CMP,0))))))/1000 END
                         ELSE SUM(NVL(G.TOT_SALE_AMT,0))/1000 
                    END AS EXPECT_AMT_CHART
                  , CASE WHEN SUM(NVL(A.TOT_SALE_AMT_CMPR,0)) = 0 THEN 0 ELSE SUM(NVL(A.TOT_SALE_AMT_CMPR,0))/1000 END    AS TOT_SALE_AMT_CMPR_CHART
               FROM (SELECT A.STR_CD                              AS STR_CD
                          , A.PUMBUN_CD                           AS PUMBUN_CD
                          , SUBSTR(C.BUY_ORG_CD,0,8) || '00'     AS ORG_CD
                          , SUM(A.NORM_SALE_AMT)                   AS TOT_SALE_AMT -- 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                          , SUM(A.REDU_AMT)                       AS REDU_AMT
                          , SUM(A.NORM_SALE_AMT)                  AS NORM_SALE_AMT
                          , SUM(A.DC_AMT)                         AS DC_AMT
                          , SUM(A.NET_SALE_AMT)                   AS NET_SALE_AMT
                          , SUM(A.SALE_PROF_AMT)                  AS SALE_PROF_AMT
                          , SUM(A.CUST_CNT)                       AS CUST_CNT
                          , 0                                     AS TOT_SALE_AMT_CMPR
                          , 0                                     AS CUST_CNT_CMPR
                          , 0                                     AS ORIGIN_SALE_TAMT
                       FROM DPS.PS_DAYPBN    A
                              , DPS.PC_ORGMST    B
                              , DPS.PC_STRPBN    C
                      WHERE B.ORG_CD   = C.BUY_ORG_CD
                        AND A.STR_CD    = C.STR_CD
                        AND A.PUMBUN_CD = C.PUMBUN_CD
                        AND B.STR_CD   LIKE ? || '%'
                        AND B.DEPT_CD  LIKE ? || '%'
                        AND B.TEAM_CD  LIKE ? || '%'
                        AND B.PC_CD    LIKE ? || '%'
                        AND A.SALE_DT  = ?
                        AND EXISTS ( SELECT MYORG.USER_ID
                                       FROM COM.V_MYORG MYORG
                                      WHERE MYORG.STR_CD      = B.STR_CD
                                        AND MYORG.DEPT_CD     = B.DEPT_CD
                                        AND MYORG.TEAM_CD     = B.TEAM_CD
                                        AND MYORG.PC_CD       = B.PC_CD
                                        AND MYORG.PUMBUN_CD   = A.PUMBUN_CD
                                        AND MYORG.USER_ID     = ?
                                   )
                      GROUP BY
                            A.STR_CD
                          , A.PUMBUN_CD
                          , SUBSTR(C.BUY_ORG_CD,0,8) || '00'
                    UNION ALL
                    SELECT F.STR_CD                           AS STR_CD            
                         , F.PUMBUN_CD                        AS PUMBUN_CD         
                         , SUBSTR(H.BUY_ORG_CD,0,8) || '00'  AS ORG_CD            
                         , 0                                  AS TOT_SALE_AMT      
                         , 0                                  AS REDU_AMT          
                         , 0                                  AS NORM_SALE_AMT     
                         , 0                                  AS DC_AMT            
                         , 0                                  AS NET_SALE_AMT      
                         , 0                                  AS SALE_PROF_AMT     
                         , 0                                  AS CUST_CNT          
                         , SUM(F.NORM_SALE_AMT)                AS TOT_SALE_AMT_CMPR -- 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                         , SUM(F.CUST_CNT)                    AS CUST_CNT_CMPR          
                         , 0                                  AS ORIGIN_SALE_TAMT  
                       FROM DPS.PS_DAYPBN F
                               , DPS.PC_ORGMST G
                               , DPS.PC_STRPBN H
                      WHERE G.ORG_CD    = H.BUY_ORG_CD
                        AND F.STR_CD    = H.STR_CD
                        AND F.PUMBUN_CD = F.PUMBUN_CD
                        AND G.STR_CD   LIKE ? || '%'
                        AND G.DEPT_CD  LIKE ? || '%'
                        AND G.TEAM_CD  LIKE ? || '%'
                        AND G.PC_CD    LIKE ? || '%'
                        AND F.SALE_DT  = ?
                        AND EXISTS ( SELECT MYORG.USER_ID
                                       FROM COM.V_MYORG MYORG
                                      WHERE MYORG.STR_CD      = G.STR_CD
                                        AND MYORG.DEPT_CD     = G.DEPT_CD
                                        AND MYORG.TEAM_CD     = G.TEAM_CD
                                        AND MYORG.PC_CD       = G.PC_CD
                                        AND MYORG.PUMBUN_CD   = F.PUMBUN_CD
                                        AND MYORG.USER_ID     = ?
                                   )
                      GROUP BY F.STR_CD
                             , F.PUMBUN_CD
                             , SUBSTR(H.BUY_ORG_CD,0,8)
                    UNION ALL
                    SELECT F.STR_CD                          AS STR_CD 
                         , F.PUMBUN_CD                       AS PUMBUN_CD            
                         , SUBSTR(E.BUY_ORG_CD,1,8) || '00' AS ORG_CD            
                         , 0                                 AS TOT_SALE_AMT      
                         , 0                                 AS REDU_AMT          
                         , 0                                 AS NORM_SALE_AMT     
                         , 0                                 AS DC_AMT            
                         , 0                                 AS NET_SALE_AMT      
                         , 0                                 AS SALE_PROF_AMT     
                         , 0                                 AS CUST_CNT          
                         , 0                                 AS TOT_SALE_AMT_CMPR 
                         , 0                                 AS CUST_CNT_CMPR     
                         , SUM(F.ORIGIN_SALE_TAMT)           AS ORIGIN_SALE_TAMT  
                      FROM DPS.PS_ACTPUMBUN F
                             , DPS.PC_ORGMST G
                             , DPS.PC_STRPBN E
                     WHERE G.ORG_CD    = E.BUY_ORG_CD
                       AND F.STR_CD    =   E.STR_CD
                       AND F.PUMBUN_CD = E.PUMBUN_CD
                       AND G.STR_CD    LIKE ? || '%'
                       AND G.DEPT_CD   LIKE ? || '%'
                       AND G.TEAM_CD   LIKE ? || '%'
                       AND G.PC_CD     LIKE ? || '%'
                       AND F.EXE_DT   = ?
                       AND EXISTS ( SELECT MYORG.USER_ID
                                      FROM COM.V_MYORG MYORG
                                     WHERE MYORG.STR_CD      = G.STR_CD
                                       AND MYORG.DEPT_CD     = G.DEPT_CD
                                       AND MYORG.TEAM_CD     = G.TEAM_CD
                                       AND MYORG.PC_CD       = G.PC_CD
                                       AND MYORG.USER_ID     = ?
                                  )
                     GROUP BY F.STR_CD
                            , F.PUMBUN_CD
                            , SUBSTR(E.BUY_ORG_CD,1,8)
                     )      A
                  , DPS.PC_ORGMST      B
                  , (SELECT SUBSTR(H.BUY_ORG_CD,1,8) || '00'  AS ORG_CD
                          , F.PUMBUN_CD
                          , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME <= TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT      -- 매출일자  20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                          , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME <= TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP  -- 대비일자  20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                          , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME >  TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP2 -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                       FROM DPS.PS_TIMEPBN F
                              , DPS.PC_ORGMST G
                              , DPS.PC_STRPBN H
                      WHERE G.ORG_CD    = H.BUY_ORG_CD
                        AND F.STR_CD    = H.STR_CD
                        AND F.PUMBUN_CD = H.PUMBUN_CD
                        AND G.STR_CD    LIKE ? || '%'
                        AND G.DEPT_CD   LIKE ? || '%'
                        AND G.TEAM_CD   LIKE ? || '%'
                        AND G.PC_CD     LIKE ? || '%'
                        AND F.SALE_DT   IN (?, ?) -- 매출일자, 대비일자
                        AND EXISTS ( SELECT MYORG.USER_ID
                                       FROM COM.V_MYORG MYORG
                                      WHERE MYORG.STR_CD      = G.STR_CD
                                        AND MYORG.DEPT_CD     = G.DEPT_CD
                                        AND MYORG.TEAM_CD     = G.TEAM_CD
                                        AND MYORG.PC_CD       = G.PC_CD
                                        AND MYORG.USER_ID     = ?
                                        AND MYORG.PUMBUN_CD   = F.PUMBUN_CD
                                   )
                        AND ? = TO_CHAR(SYSDATE, 'YYYMMDD') -- 매출일자
                      GROUP BY
                            SUBSTR(H.BUY_ORG_CD,1,8) || '00'
                          , F.PUMBUN_CD
                     UNION ALL    
                     SELECT SUBSTR(I.BUY_ORG_CD,1,8) || '00'  AS ORG_CD
                          , F.PUMBUN_CD
                          , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT      -- 매출일자  20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                          , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP  -- 대비일자  20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                          , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP2 -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                       FROM DPS.PS_TIMEPBN F
                              , DPS.PC_ORGMST G
                              , DPS.PC_STRPBN I
                      WHERE G.ORG_CD    = I.BUY_ORG_CD
                        AND F.STR_CD    = I.STR_CD
                        AND F.PUMBUN_CD = I.PUMBUN_CD
                        AND G.STR_CD    LIKE ? || '%'
                        AND G.DEPT_CD   LIKE ? || '%'
                        AND G.TEAM_CD   LIKE ? || '%'
                        AND G.PC_CD     LIKE ? || '%'
                        AND F.SALE_DT   IN (?, ?) -- 매출일자, 대비일자
                        AND EXISTS ( SELECT MYORG.USER_ID
                                       FROM COM.V_MYORG MYORG
                                      WHERE MYORG.STR_CD      = G.STR_CD
                                        AND MYORG.DEPT_CD     = G.DEPT_CD
                                        AND MYORG.TEAM_CD     = G.TEAM_CD
                                        AND MYORG.PC_CD       = G.PC_CD
                                        AND MYORG.USER_ID     = ?
                                        AND MYORG.PUMBUN_CD   = F.PUMBUN_CD
                                   )
                        AND ? <> TO_CHAR(SYSDATE, 'YYYMMDD') -- 매출일자
                      GROUP BY
                            SUBSTR(I.BUY_ORG_CD,1,8) || '00'
                          , F.PUMBUN_CD
                                       ) G     
                  , DPS.PC_STRPBN        F
              WHERE A.ORG_CD     = B.ORG_CD
                AND A.PUMBUN_CD  = G.PUMBUN_CD(+)
                AND A.STR_CD     =  F.STR_CD
                AND A.PUMBUN_CD  = F.PUMBUN_CD
                AND B.STR_CD     LIKE ? || '%'
                AND B.DEPT_CD    LIKE ? || '%'
                AND B.TEAM_CD    LIKE ? || '%'
                AND B.PC_CD      LIKE ? || '%'
                AND EXISTS ( SELECT MYORG.USER_ID
                               FROM COM.V_MYORG MYORG
                              WHERE MYORG.STR_CD      = B.STR_CD
                                AND MYORG.DEPT_CD     = B.DEPT_CD
                                AND MYORG.TEAM_CD     = B.TEAM_CD
                                AND MYORG.PC_CD       = B.PC_CD
                                AND MYORG.PUMBUN_CD   = A.PUMBUN_CD
                                AND MYORG.USER_ID     = ?
                           )
              GROUP BY A.STR_CD,
                    A.PUMBUN_CD
                  , F.PUMBUN_NAME
              ORDER BY
                    A.PUMBUN_CD
                    -------------2
        ]]>        
    </query>
    
    <query name="SEL_SALE_PC2">        
        <![CDATA[
             SELECT STR_CD, DPS.FN_GET_STORE_NAME(STR_CD) STR_NAME,ORG_CD
                  , (SELECT ORG_SHORT_NAME FROM DPS.PC_ORGMST WHERE ORG_CD =  X.ORG_CD) AS ORG_NAME
                  , ORIGIN_SALE_TAMT    AS    ORIGIN_SALE_TAMT
                  , TOT_SALE_AMT        AS    TOT_SALE_AMT
                  , ACHIEVERATE            AS    ACHIEVERATE
                  , 0.00                AS  RATE
                  , TOT_SALE_AMT_CMPR    AS    TOT_SALE_AMT_CMPR
                  , SALEIRATE            AS    SALEIRATE
                  , EXPECT_AMT          AS  EXPECT_AMT
                  , REDU_AMT            AS    REDU_AMT
                  , NORM_SALE_AMT        AS    NORM_SALE_AMT
                  , DC_AMT                AS    DC_AMT
                  , NET_SALE_AMT        AS    NET_SALE_AMT
                  , SALE_PROF_AMT        AS    SALE_PROF_AMT
                  , PROFRATE            AS    PROFRATE
                  , CUST_CNT            AS    CUST_CNT
                  , CUST_DANGA            AS    CUST_DANGA
                  , CUST_CNT_CMPR       AS  CUST_CNT_CMPR
                  , CUST_CNT_RATE       AS  CUST_CNT_RATE
                  , CASE WHEN ORIGIN_SALE_TAMT = 0 THEN 0 ELSE ORIGIN_SALE_TAMT/1000 END AS ORIGIN_SALE_TAMT_CHART
                  , CASE WHEN TOT_SALE_AMT = 0 THEN 0 ELSE TOT_SALE_AMT/1000 END AS TOT_SALE_AMT_CHART
                  , CASE WHEN EXPECT_AMT = 0 THEN 0 ELSE EXPECT_AMT/1000 END AS EXPECT_AMT_CHART
                  , CASE WHEN TOT_SALE_AMT_CMPR = 0 THEN 0 ELSE TOT_SALE_AMT_CMPR/1000 END AS TOT_SALE_AMT_CMPR_CHART
               FROM (
                     SELECT A.STR_CD,LPAD(A.ORG_CD, 8) || '00'                                       AS ORG_CD
                          , SUM(NVL(A.ORIGIN_SALE_TAMT,0))                                        AS ORIGIN_SALE_TAMT
                          , SUM(NVL(A.TOT_SALE_AMT,0))                                            AS TOT_SALE_AMT
                          , (CASE WHEN SUM(NVL(A.ORIGIN_SALE_TAMT,0))  = 0 THEN 0 
                             ELSE    ( SUM(NVL(A.TOT_SALE_AMT,0))/SUM(NVL(A.ORIGIN_SALE_TAMT,0)))*100 END)                          AS ACHIEVERATE
                          , SUM(NVL(A.TOT_SALE_AMT_CMPR,0))                                        AS TOT_SALE_AMT_CMPR
                          , (CASE WHEN  SUM(NVL(A.TOT_SALE_AMT_CMPR,0)) = 0 THEN 0 
                             ELSE SUM(NVL(A.TOT_SALE_AMT,0))/SUM(NVL(A.TOT_SALE_AMT_CMPR,0))*100 END) AS SALEIRATE
                          , CASE WHEN ? < TO_CHAR(SYSDATE, 'YYYYMMDD')  THEN SUM(NVL(A.TOT_SALE_AMT,0)) 
                                     ELSE CASE WHEN ? = TO_CHAR(SYSDATE, 'YYYYMMDD') THEN CASE WHEN SUM(NVL(G.TOT_SALE_AMT_CMP,0)) = 0 THEN SUM(NVL(G.TOT_SALE_AMT,0)) + SUM(NVL(G.TOT_SALE_AMT_CMP2,0)) ELSE SUM(NVL(G.TOT_SALE_AMT,0)) + (SUM(NVL(G.TOT_SALE_AMT_CMP2,0)) * (SUM(NVL(G.TOT_SALE_AMT,0)) / (SUM(NVL(G.TOT_SALE_AMT_CMP,0))))) END
                                             ELSE SUM(NVL(G.TOT_SALE_AMT,0))
                                        END 
                            END AS EXPECT_AMT
                          , SUM(NVL(A.REDU_AMT,0))                                            AS REDU_AMT
                          , SUM(NVL(A.NORM_SALE_AMT,0))                                       AS NORM_SALE_AMT
                          , SUM(NVL(A.DC_AMT,0))                                              AS DC_AMT
                          , SUM(NVL(A.NET_SALE_AMT,0))                                        AS NET_SALE_AMT
                          , SUM(NVL(A.SALE_PROF_AMT,0))                                       AS SALE_PROF_AMT
                          , (CASE WHEN SUM(NVL(A.TOT_SALE_AMT,0)) = 0 THEN 0 
                             ELSE (SUM(NVL(A.SALE_PROF_AMT,0))/SUM(NVL(A.TOT_SALE_AMT,0)))*100 END)                                 AS PROFRATE
                          , SUM(A.CUST_CNT)                                                   AS CUST_CNT
                          , (CASE WHEN SUM(A.CUST_CNT) = 0 THEN 0 ELSE SUM(A.TOT_SALE_AMT)/SUM(A.CUST_CNT) END)                             AS CUST_DANGA
                          , SUM(A.CUST_CNT_CMPR)                                                   AS CUST_CNT_CMPR
                          , CASE WHEN SUM(A.CUST_CNT_CMPR) = 0 THEN 0 ELSE SUM(A.CUST_CNT) / SUM(A.CUST_CNT_CMPR) * 100 END CUST_CNT_RATE
                       FROM (SELECT A.STR_CD                                 AS STR_CD
                                  , SUBSTR(C.BUY_ORG_CD,1,8) || '00'        AS ORG_CD
                                  , SUM(A.NORM_SALE_AMT)                      AS TOT_SALE_AMT -- 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(A.REDU_AMT)                          AS REDU_AMT
                                  , SUM(A.NORM_SALE_AMT)                     AS NORM_SALE_AMT
                                  , SUM(A.DC_AMT)                            AS DC_AMT
                                  , SUM(A.NET_SALE_AMT)                      AS NET_SALE_AMT
                                  , SUM(A.SALE_PROF_AMT)                     AS SALE_PROF_AMT
                                  , SUM(A.CUST_CNT)                          AS CUST_CNT
                                  , 0                                        AS TOT_SALE_AMT_CMPR
                                  , 0                                        AS CUST_CNT_CMPR
                                  , 0                                        AS ORIGIN_SALE_TAMT
                               FROM DPS.PS_DAYPBN    A
                                      , DPS.PC_ORGMST    B
                                      , DPS.PC_STRPBN    C
                              WHERE B.ORG_CD   = C.BUY_ORG_CD
                                AND A.STR_CD    = C.STR_CD
                                AND A.PUMBUN_CD = C.PUMBUN_CD
                                AND B.STR_CD   LIKE ? || '%'
                                AND B.DEPT_CD  LIKE ? || '%'
                                AND B.TEAM_CD  LIKE ? || '%'
                                AND B.PC_CD    LIKE ? || '%'
                                AND A.SALE_DT  = ?
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = B.STR_CD
                                                AND MYORG.DEPT_CD     = B.DEPT_CD
                                                AND MYORG.TEAM_CD     = B.TEAM_CD
                                                AND MYORG.PC_CD       = B.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                              GROUP BY
                                    A.STR_CD
                                  , SUBSTR(C.BUY_ORG_CD,1,8) 
                             UNION ALL
                             SELECT F.STR_CD                          AS STR_CD            
                                  , SUBSTR(E.BUY_ORG_CD,1,8) || '00' AS ORG_CD            
                                  , 0                                 AS TOT_SALE_AMT      
                                  , 0                                 AS REDU_AMT          
                                  , 0                                 AS NORM_SALE_AMT     
                                  , 0                                 AS DC_AMT            
                                  , 0                                 AS NET_SALE_AMT      
                                  , 0                                 AS SALE_PROF_AMT     
                                  , 0                                 AS CUST_CNT          
                                  , SUM(F.NORM_SALE_AMT )               AS TOT_SALE_AMT_CMPR  -- 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(F.CUST_CNT )                  AS CUST_CNT_CMPR     
                                  , 0                                 AS ORIGIN_SALE_TAMT  
                               FROM DPS.PS_DAYPBN F
                                      , DPS.PC_ORGMST G
                                      , DPS.PC_STRPBN E
                              WHERE G.ORG_CD    = E.BUY_ORG_CD
                                AND F.STR_CD    =   E.STR_CD
                                AND F.PUMBUN_CD = E.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.SALE_DT   = ?
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                              GROUP BY F.STR_CD
                                    , SUBSTR(E.BUY_ORG_CD,1,8) || '00'
                            UNION ALL
                             SELECT F.STR_CD                          AS STR_CD            
                                  , SUBSTR(E.BUY_ORG_CD,1,8) || '00' AS ORG_CD            
                                  , 0                                 AS TOT_SALE_AMT      
                                  , 0                                 AS REDU_AMT          
                                  , 0                                 AS NORM_SALE_AMT     
                                  , 0                                 AS DC_AMT            
                                  , 0                                 AS NET_SALE_AMT      
                                  , 0                                 AS SALE_PROF_AMT     
                                  , 0                                 AS CUST_CNT          
                                  , 0                                 AS TOT_SALE_AMT_CMPR 
                                  , 0                                 AS CUST_CNT_CMPR     
                                  , SUM(F.ORIGIN_SALE_TAMT)           AS ORIGIN_SALE_TAMT  
                               FROM DPS.PS_ACTPUMBUN F
                                      , DPS.PC_ORGMST G
                                      , DPS.PC_STRPBN E
                              WHERE G.ORG_CD    = E.BUY_ORG_CD
                                AND F.STR_CD    =   E.STR_CD
                                AND F.PUMBUN_CD = E.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.EXE_DT   = ?
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                              GROUP BY F.STR_CD
                                     , SUBSTR(E.BUY_ORG_CD,1,8) || '00'
                             )      A
                          , DPS.PC_ORGMST      B
                          , (SELECT SUBSTR(H.BUY_ORG_CD,1,8) || '00'  AS ORG_CD
                                  , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME <= TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT      -- 매출일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME <= TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP  -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME >  TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP2 -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                               FROM DPS.PS_TIMEPBN F
                                       , DPS.PC_ORGMST G
                                       , DPS.PC_STRPBN H
                              WHERE G.ORG_CD    = H.BUY_ORG_CD
                                AND F.STR_CD    =  H.STR_CD
                                AND F.PUMBUN_CD = H.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.SALE_DT   IN (?, ?) -- 매출일자, 대비일자
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                                AND ? = TO_CHAR(SYSDATE, 'YYYMMDD') -- 매출일자
                              GROUP BY
                                    SUBSTR(H.BUY_ORG_CD,1,8) || '00'
                              UNION ALL
                             SELECT SUBSTR(H.BUY_ORG_CD,1,8) || '00'  AS ORG_CD
                                  , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT      -- 매출일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP  -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP2 -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                               FROM DPS.PS_TIMEPBN F
                                       , DPS.PC_ORGMST G
                                       , DPS.PC_STRPBN H
                              WHERE G.ORG_CD    = H.BUY_ORG_CD
                                AND F.STR_CD    =  H.STR_CD
                                AND F.PUMBUN_CD = H.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.SALE_DT   IN (?, ?) -- 매출일자, 대비일자
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                                AND ? <> TO_CHAR(SYSDATE, 'YYYMMDD') -- 매출일자
                              GROUP BY
                                    SUBSTR(H.BUY_ORG_CD,1,8) || '00'
                                               ) G  
                      WHERE A.ORG_CD     = B.ORG_CD
                        AND A.ORG_CD     = G.ORG_CD(+)
                        AND B.STR_CD     LIKE ? || '%'
                        AND B.DEPT_CD    LIKE ? || '%'
                        AND B.TEAM_CD    LIKE ? || '%'
                        AND B.PC_CD      LIKE ? || '%'
                        AND EXISTS ( SELECT MYORG.USER_ID
                                       FROM COM.V_MYORG MYORG
                                      WHERE MYORG.STR_CD      = B.STR_CD
                                        AND MYORG.DEPT_CD     = B.DEPT_CD
                                        AND MYORG.TEAM_CD     = B.TEAM_CD
                                        AND MYORG.PC_CD       = B.PC_CD
                                        AND MYORG.USER_ID     = ?
                                   )
                      GROUP BY A.STR_CD,
                            LPAD(A.ORG_CD, 8)
                    ) X
              ORDER BY
                    X.ORG_CD
                    -------------3
        ]]>        
    </query>
    
    <query name="SEL_SALE_PC">        
        <![CDATA[
            SELECT STR_CD, DPS.FN_GET_STORE_NAME(STR_CD) STR_NAME,ORG_CD
                  , (SELECT ORG_SHORT_NAME FROM DPS.PC_ORGMST WHERE ORG_CD =  X.ORG_CD) AS ORG_NAME
                  , ORIGIN_SALE_TAMT    AS    ORIGIN_SALE_TAMT
                  , TOT_SALE_AMT        AS    TOT_SALE_AMT
                  , ACHIEVERATE            AS    ACHIEVERATE
                  , 0.00                AS  RATE
                  , TOT_SALE_AMT_CMPR    AS    TOT_SALE_AMT_CMPR
                  , SALEIRATE            AS    SALEIRATE
                  , EXPECT_AMT          AS  EXPECT_AMT
                  , REDU_AMT            AS    REDU_AMT
                  , NORM_SALE_AMT        AS    NORM_SALE_AMT
                  , DC_AMT                AS    DC_AMT
                  , NET_SALE_AMT        AS    NET_SALE_AMT
                  , SALE_PROF_AMT        AS    SALE_PROF_AMT
                  , PROFRATE            AS    PROFRATE
                  , CUST_CNT            AS    CUST_CNT
                  , CUST_DANGA            AS    CUST_DANGA
                  , CUST_CNT_CMPR       AS  CUST_CNT_CMPR
                  , CUST_CNT_RATE       AS  CUST_CNT_RATE
                  , CASE WHEN ORIGIN_SALE_TAMT = 0 THEN 0 ELSE ORIGIN_SALE_TAMT/1000 END AS ORIGIN_SALE_TAMT_CHART
                  , CASE WHEN TOT_SALE_AMT = 0 THEN 0 ELSE TOT_SALE_AMT/1000 END AS TOT_SALE_AMT_CHART
                  , CASE WHEN EXPECT_AMT = 0 THEN 0 ELSE EXPECT_AMT/1000 END AS EXPECT_AMT_CHART
                  , CASE WHEN TOT_SALE_AMT_CMPR = 0 THEN 0 ELSE TOT_SALE_AMT_CMPR/1000 END AS TOT_SALE_AMT_CMPR_CHART
               FROM (
                     SELECT A.STR_CD,LPAD(A.ORG_CD, 6) || '0000'                                       AS ORG_CD
                          , SUM(NVL(A.ORIGIN_SALE_TAMT,0))                                        AS ORIGIN_SALE_TAMT
                          , SUM(NVL(A.TOT_SALE_AMT,0))                                            AS TOT_SALE_AMT
                          , (CASE WHEN SUM(NVL(A.ORIGIN_SALE_TAMT,0))  = 0 THEN 0 
                             ELSE    ( SUM(NVL(A.TOT_SALE_AMT,0))/SUM(NVL(A.ORIGIN_SALE_TAMT,0)))*100 END)                          AS ACHIEVERATE
                          , SUM(NVL(A.TOT_SALE_AMT_CMPR,0))                                        AS TOT_SALE_AMT_CMPR
                          , (CASE WHEN  SUM(NVL(A.TOT_SALE_AMT_CMPR,0)) = 0 THEN 0 
                             ELSE SUM(NVL(A.TOT_SALE_AMT,0))/SUM(NVL(A.TOT_SALE_AMT_CMPR,0))*100 END) AS SALEIRATE
                          , CASE WHEN ? < TO_CHAR(SYSDATE, 'YYYYMMDD')  THEN SUM(NVL(A.TOT_SALE_AMT,0)) 
                                     ELSE CASE WHEN ? = TO_CHAR(SYSDATE, 'YYYYMMDD') THEN CASE WHEN SUM(NVL(G.TOT_SALE_AMT_CMP,0)) = 0 THEN SUM(NVL(G.TOT_SALE_AMT,0)) + SUM(NVL(G.TOT_SALE_AMT_CMP2,0)) ELSE SUM(NVL(G.TOT_SALE_AMT,0)) + (SUM(NVL(G.TOT_SALE_AMT_CMP2,0)) * (SUM(NVL(G.TOT_SALE_AMT,0)) / (SUM(NVL(G.TOT_SALE_AMT_CMP,0))))) END
                                             ELSE SUM(NVL(G.TOT_SALE_AMT,0))
                                        END 
                            END AS EXPECT_AMT
                          , SUM(NVL(A.REDU_AMT,0))                                            AS REDU_AMT
                          , SUM(NVL(A.NORM_SALE_AMT,0))                                       AS NORM_SALE_AMT
                          , SUM(NVL(A.DC_AMT,0))                                              AS DC_AMT
                          , SUM(NVL(A.NET_SALE_AMT,0))                                        AS NET_SALE_AMT
                          , SUM(NVL(A.SALE_PROF_AMT,0))                                       AS SALE_PROF_AMT
                          , (CASE WHEN SUM(NVL(A.TOT_SALE_AMT,0)) = 0 THEN 0 
                             ELSE (SUM(NVL(A.SALE_PROF_AMT,0))/SUM(NVL(A.TOT_SALE_AMT,0)))*100 END)                                 AS PROFRATE
                          , SUM(A.CUST_CNT)                                                   AS CUST_CNT
                          , (CASE WHEN SUM(A.CUST_CNT) = 0 THEN 0 ELSE SUM(A.TOT_SALE_AMT)/SUM(A.CUST_CNT) END)                             AS CUST_DANGA
                          , SUM(A.CUST_CNT_CMPR)                                                   AS CUST_CNT_CMPR
                          , CASE WHEN SUM(A.CUST_CNT_CMPR) = 0 THEN 0 ELSE SUM(A.CUST_CNT) / SUM(A.CUST_CNT_CMPR) * 100 END CUST_CNT_RATE
                       FROM (SELECT A.STR_CD                                 AS STR_CD
                                  , SUBSTR(C.SALE_ORG_CD,1,8) || '00'        AS ORG_CD
                                  , SUM(A.NORM_SALE_AMT)                      AS TOT_SALE_AMT -- 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(A.REDU_AMT)                          AS REDU_AMT
                                  , SUM(A.NORM_SALE_AMT)                     AS NORM_SALE_AMT
                                  , SUM(A.DC_AMT)                            AS DC_AMT
                                  , SUM(A.NET_SALE_AMT)                      AS NET_SALE_AMT
                                  , SUM(A.SALE_PROF_AMT)                     AS SALE_PROF_AMT
                                  , SUM(A.CUST_CNT)                          AS CUST_CNT
                                  , 0                                        AS TOT_SALE_AMT_CMPR
                                  , 0                                        AS CUST_CNT_CMPR
                                  , 0                                        AS ORIGIN_SALE_TAMT
                               FROM DPS.PS_DAYPBN    A
                                      , DPS.PC_ORGMST    B
                                      , DPS.PC_STRPBN    C
                              WHERE B.ORG_CD   = C.SALE_ORG_CD
                                AND A.STR_CD    = C.STR_CD
                                AND A.PUMBUN_CD = C.PUMBUN_CD
                                AND B.STR_CD   LIKE ? || '%'
                                AND B.DEPT_CD  LIKE ? || '%'
                                AND B.TEAM_CD  LIKE ? || '%'
                                AND B.PC_CD    LIKE ? || '%'
                                AND A.SALE_DT  = ?
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = B.STR_CD
                                                AND MYORG.DEPT_CD     = B.DEPT_CD
                                                AND MYORG.TEAM_CD     = B.TEAM_CD
                                                AND MYORG.PC_CD       = B.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                              GROUP BY
                                    A.STR_CD
                                  , SUBSTR(C.SALE_ORG_CD,1,8) 
                             UNION ALL
                             SELECT F.STR_CD                          AS STR_CD            
                                  , SUBSTR(E.SALE_ORG_CD,1,8) || '00' AS ORG_CD            
                                  , 0                                 AS TOT_SALE_AMT      
                                  , 0                                 AS REDU_AMT          
                                  , 0                                 AS NORM_SALE_AMT     
                                  , 0                                 AS DC_AMT            
                                  , 0                                 AS NET_SALE_AMT      
                                  , 0                                 AS SALE_PROF_AMT     
                                  , 0                                 AS CUST_CNT          
                                  , SUM(F.NORM_SALE_AMT)               AS TOT_SALE_AMT_CMPR -- 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(F.CUST_CNT )                  AS CUST_CNT_CMPR     
                                  , 0                                 AS ORIGIN_SALE_TAMT  
                               FROM DPS.PS_DAYPBN F
                                      , DPS.PC_ORGMST G
                                      , DPS.PC_STRPBN E
                              WHERE G.ORG_CD    = E.SALE_ORG_CD
                                AND F.STR_CD    =   E.STR_CD
                                AND F.PUMBUN_CD = E.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.SALE_DT   = ?
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                              GROUP BY F.STR_CD
                                    , SUBSTR(E.SALE_ORG_CD,1,8) || '00'
                            UNION ALL
                             SELECT F.STR_CD                          AS STR_CD            
                                  , SUBSTR(E.SALE_ORG_CD,1,8) || '00' AS ORG_CD            
                                  , 0                                 AS TOT_SALE_AMT      
                                  , 0                                 AS REDU_AMT          
                                  , 0                                 AS NORM_SALE_AMT     
                                  , 0                                 AS DC_AMT            
                                  , 0                                 AS NET_SALE_AMT      
                                  , 0                                 AS SALE_PROF_AMT     
                                  , 0                                 AS CUST_CNT          
                                  , 0                                 AS TOT_SALE_AMT_CMPR 
                                  , 0                                 AS CUST_CNT_CMPR     
                                  , SUM(F.ORIGIN_SALE_TAMT)           AS ORIGIN_SALE_TAMT  
                               FROM DPS.PS_ACTPUMBUN F
                                      , DPS.PC_ORGMST G
                                      , DPS.PC_STRPBN E
                              WHERE G.ORG_CD    = E.SALE_ORG_CD
                                AND F.STR_CD    =   E.STR_CD
                                AND F.PUMBUN_CD = E.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.EXE_DT   = ?
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                              GROUP BY F.STR_CD
                                     , SUBSTR(E.SALE_ORG_CD,1,8) || '00'
                             )      A
                          , DPS.PC_ORGMST      B
                          , (SELECT SUBSTR(H.SALE_ORG_CD,1,8) || '00'  AS ORG_CD
                                  , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME <= TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT      -- 매출일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME <= TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP  -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME >  TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP2 -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                               FROM DPS.PS_TIMEPBN F
                                       , DPS.PC_ORGMST G
                                       , DPS.PC_STRPBN H
                              WHERE G.ORG_CD    = H.SALE_ORG_CD
                                AND F.STR_CD    =  H.STR_CD
                                AND F.PUMBUN_CD = H.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.SALE_DT   IN (?, ?) -- 매출일자, 대비일자
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                                AND ? = TO_CHAR(SYSDATE, 'YYYMMDD') -- 매출일자
                              GROUP BY
                                    SUBSTR(H.SALE_ORG_CD,1,8) || '00'
                              UNION ALL
                             SELECT SUBSTR(H.SALE_ORG_CD,1,8) || '00'  AS ORG_CD
                                  , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT      -- 매출일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP  -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP2 -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                               FROM DPS.PS_TIMEPBN F
                                       , DPS.PC_ORGMST G
                                       , DPS.PC_STRPBN H
                              WHERE G.ORG_CD    = H.SALE_ORG_CD
                                AND F.STR_CD    =  H.STR_CD
                                AND F.PUMBUN_CD = H.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.SALE_DT   IN (?, ?) -- 매출일자, 대비일자
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                                AND ? <> TO_CHAR(SYSDATE, 'YYYMMDD') -- 매출일자
                              GROUP BY
                                    SUBSTR(H.SALE_ORG_CD,1,8) || '00'
                                               ) G  
                      WHERE A.ORG_CD     = B.ORG_CD
                        AND A.ORG_CD     = G.ORG_CD(+)
                        AND B.STR_CD     LIKE ? || '%'
                        AND B.DEPT_CD    LIKE ? || '%'
                        AND B.TEAM_CD    LIKE ? || '%'
                        AND B.PC_CD      LIKE ? || '%'
                        AND EXISTS ( SELECT MYORG.USER_ID
                                       FROM COM.V_MYORG MYORG
                                      WHERE MYORG.STR_CD      = B.STR_CD
                                        AND MYORG.DEPT_CD     = B.DEPT_CD
                                        AND MYORG.TEAM_CD     = B.TEAM_CD
                                        AND MYORG.PC_CD       = B.PC_CD
                                        AND MYORG.USER_ID     = ?
                                   )
                      GROUP BY A.STR_CD,
                            LPAD(A.ORG_CD, 6)
                    ) X
              ORDER BY
                    X.ORG_CD
                    -------------4
        ]]>        
    </query>
    <query name="SEL_SALE_TEAM2">        
        <![CDATA[
        	SELECT STR_CD, DPS.FN_GET_STORE_NAME(STR_CD) STR_NAME,ORG_CD
                  , (SELECT ORG_SHORT_NAME FROM DPS.PC_ORGMST WHERE ORG_CD =  X.ORG_CD) AS ORG_NAME
                  , ORIGIN_SALE_TAMT    AS    ORIGIN_SALE_TAMT
                  , TOT_SALE_AMT        AS    TOT_SALE_AMT
                  , ACHIEVERATE            AS    ACHIEVERATE
                  , 0.00                AS  RATE
                  , TOT_SALE_AMT_CMPR    AS    TOT_SALE_AMT_CMPR
                  , SALEIRATE            AS    SALEIRATE
                  , EXPECT_AMT          AS  EXPECT_AMT
                  , REDU_AMT            AS    REDU_AMT
                  , NORM_SALE_AMT        AS    NORM_SALE_AMT
                  , DC_AMT                AS    DC_AMT
                  , NET_SALE_AMT        AS    NET_SALE_AMT
                  , SALE_PROF_AMT        AS    SALE_PROF_AMT
                  , PROFRATE            AS    PROFRATE
                  , CUST_CNT            AS    CUST_CNT
                  , CUST_DANGA            AS    CUST_DANGA
                  , CUST_CNT_CMPR       AS  CUST_CNT_CMPR
                  , CUST_CNT_RATE       AS  CUST_CNT_RATE
                  , CASE WHEN ORIGIN_SALE_TAMT = 0 THEN 0 ELSE ORIGIN_SALE_TAMT/1000 END AS ORIGIN_SALE_TAMT_CHART
                  , CASE WHEN TOT_SALE_AMT = 0 THEN 0 ELSE TOT_SALE_AMT/1000 END AS TOT_SALE_AMT_CHART
                  , CASE WHEN EXPECT_AMT = 0 THEN 0 ELSE EXPECT_AMT/1000 END AS EXPECT_AMT_CHART
                  , CASE WHEN TOT_SALE_AMT_CMPR = 0 THEN 0 ELSE TOT_SALE_AMT_CMPR/1000 END AS TOT_SALE_AMT_CMPR_CHART
               FROM (
                     SELECT A.STR_CD,LPAD(A.ORG_CD, 6) || '0000'                                       AS ORG_CD
                          , SUM(NVL(A.ORIGIN_SALE_TAMT,0))                                        AS ORIGIN_SALE_TAMT
                          , SUM(NVL(A.TOT_SALE_AMT,0))                                            AS TOT_SALE_AMT
                          , (CASE WHEN SUM(NVL(A.ORIGIN_SALE_TAMT,0))  = 0 THEN 0 
                             ELSE    ( SUM(NVL(A.TOT_SALE_AMT,0))/SUM(NVL(A.ORIGIN_SALE_TAMT,0)))*100 END)                          AS ACHIEVERATE
                          , SUM(NVL(A.TOT_SALE_AMT_CMPR,0))                                        AS TOT_SALE_AMT_CMPR
                          , (CASE WHEN  SUM(NVL(A.TOT_SALE_AMT_CMPR,0)) = 0 THEN 0 
                             ELSE SUM(NVL(A.TOT_SALE_AMT,0))/SUM(NVL(A.TOT_SALE_AMT_CMPR,0))*100 END) AS SALEIRATE
                          , CASE WHEN ? < TO_CHAR(SYSDATE, 'YYYYMMDD')  THEN SUM(NVL(A.TOT_SALE_AMT,0)) 
                                     ELSE CASE WHEN ? = TO_CHAR(SYSDATE, 'YYYYMMDD') THEN CASE WHEN SUM(NVL(G.TOT_SALE_AMT_CMP,0)) = 0 THEN SUM(NVL(G.TOT_SALE_AMT,0)) + SUM(NVL(G.TOT_SALE_AMT_CMP2,0)) ELSE SUM(NVL(G.TOT_SALE_AMT,0)) + (SUM(NVL(G.TOT_SALE_AMT_CMP2,0)) * (SUM(NVL(G.TOT_SALE_AMT,0)) / (SUM(NVL(G.TOT_SALE_AMT_CMP,0))))) END
                                             ELSE SUM(NVL(G.TOT_SALE_AMT,0))
                                        END 
                            END AS EXPECT_AMT
                          , SUM(NVL(A.REDU_AMT,0))                                            AS REDU_AMT
                          , SUM(NVL(A.NORM_SALE_AMT,0))                                       AS NORM_SALE_AMT
                          , SUM(NVL(A.DC_AMT,0))                                              AS DC_AMT
                          , SUM(NVL(A.NET_SALE_AMT,0))                                        AS NET_SALE_AMT
                          , SUM(NVL(A.SALE_PROF_AMT,0))                                       AS SALE_PROF_AMT
                          , (CASE WHEN SUM(NVL(A.TOT_SALE_AMT,0)) = 0 THEN 0 
                             ELSE (SUM(NVL(A.SALE_PROF_AMT,0))/SUM(NVL(A.TOT_SALE_AMT,0)))*100 END)                                 AS PROFRATE
                          , SUM(A.CUST_CNT)                                                   AS CUST_CNT
                          , (CASE WHEN SUM(A.CUST_CNT) = 0 THEN 0 ELSE SUM(A.TOT_SALE_AMT)/SUM(A.CUST_CNT) END)                             AS CUST_DANGA
                          , SUM(A.CUST_CNT_CMPR)                                                   AS CUST_CNT_CMPR
                          , CASE WHEN SUM(A.CUST_CNT_CMPR) = 0 THEN 0 ELSE SUM(A.CUST_CNT) / SUM(A.CUST_CNT_CMPR) * 100 END CUST_CNT_RATE
                       FROM (SELECT A.STR_CD                                 AS STR_CD
                                  , SUBSTR(C.BUY_ORG_CD,1,8) || '00'        AS ORG_CD
                                  , SUM(A.NORM_SALE_AMT)                      AS TOT_SALE_AMT -- 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(A.REDU_AMT)                          AS REDU_AMT
                                  , SUM(A.NORM_SALE_AMT)                     AS NORM_SALE_AMT
                                  , SUM(A.DC_AMT)                            AS DC_AMT
                                  , SUM(A.NET_SALE_AMT)                      AS NET_SALE_AMT
                                  , SUM(A.SALE_PROF_AMT)                     AS SALE_PROF_AMT
                                  , SUM(A.CUST_CNT)                          AS CUST_CNT
                                  , 0                                        AS TOT_SALE_AMT_CMPR
                                  , 0                                        AS CUST_CNT_CMPR
                                  , 0                                        AS ORIGIN_SALE_TAMT
                               FROM DPS.PS_DAYPBN    A
                                      , DPS.PC_ORGMST    B
                                      , DPS.PC_STRPBN    C
                              WHERE B.ORG_CD   = C.BUY_ORG_CD
                                AND A.STR_CD    = C.STR_CD
                                AND A.PUMBUN_CD = C.PUMBUN_CD
                                AND B.STR_CD   LIKE ? || '%'
                                AND B.DEPT_CD  LIKE ? || '%'
                                AND B.TEAM_CD  LIKE ? || '%'
                                AND B.PC_CD    LIKE ? || '%'
                                AND A.SALE_DT  = ?
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = B.STR_CD
                                                AND MYORG.DEPT_CD     = B.DEPT_CD
                                                AND MYORG.TEAM_CD     = B.TEAM_CD
                                                AND MYORG.PC_CD       = B.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                              GROUP BY
                                    A.STR_CD
                                  , SUBSTR(C.BUY_ORG_CD,1,8) 
                             UNION ALL
                             SELECT F.STR_CD                          AS STR_CD            
                                  , SUBSTR(E.BUY_ORG_CD,1,8) || '00' AS ORG_CD            
                                  , 0                                 AS TOT_SALE_AMT      
                                  , 0                                 AS REDU_AMT          
                                  , 0                                 AS NORM_SALE_AMT     
                                  , 0                                 AS DC_AMT            
                                  , 0                                 AS NET_SALE_AMT      
                                  , 0                                 AS SALE_PROF_AMT     
                                  , 0                                 AS CUST_CNT          
                                  , SUM(F.NORM_SALE_AMT)               AS TOT_SALE_AMT_CMPR  --20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(F.CUST_CNT )                  AS CUST_CNT_CMPR     
                                  , 0                                 AS ORIGIN_SALE_TAMT  
                               FROM DPS.PS_DAYPBN F
                                      , DPS.PC_ORGMST G
                                      , DPS.PC_STRPBN E
                              WHERE G.ORG_CD    = E.BUY_ORG_CD
                                AND F.STR_CD    =   E.STR_CD
                                AND F.PUMBUN_CD = E.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.SALE_DT   = ?
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                              GROUP BY F.STR_CD
                                    , SUBSTR(E.BUY_ORG_CD,1,8) || '00'
                            UNION ALL
                             SELECT F.STR_CD                          AS STR_CD            
                                  , SUBSTR(E.BUY_ORG_CD,1,8) || '00' AS ORG_CD            
                                  , 0                                 AS TOT_SALE_AMT      
                                  , 0                                 AS REDU_AMT          
                                  , 0                                 AS NORM_SALE_AMT     
                                  , 0                                 AS DC_AMT            
                                  , 0                                 AS NET_SALE_AMT      
                                  , 0                                 AS SALE_PROF_AMT     
                                  , 0                                 AS CUST_CNT          
                                  , 0                                 AS TOT_SALE_AMT_CMPR 
                                  , 0                                 AS CUST_CNT_CMPR     
                                  , SUM(F.ORIGIN_SALE_TAMT)           AS ORIGIN_SALE_TAMT  
                               FROM DPS.PS_ACTPUMBUN F
                                      , DPS.PC_ORGMST G
                                      , DPS.PC_STRPBN E
                              WHERE G.ORG_CD    = E.BUY_ORG_CD
                                AND F.STR_CD    =   E.STR_CD
                                AND F.PUMBUN_CD = E.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.EXE_DT   = ?
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                              GROUP BY F.STR_CD
                                     , SUBSTR(E.BUY_ORG_CD,1,8) || '00'
                             )      A
                          , DPS.PC_ORGMST      B
                          , (SELECT SUBSTR(H.BUY_ORG_CD,1,8) || '00'  AS ORG_CD
                                  , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME <= TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT      -- 매출일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME <= TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP  -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME >  TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP2 -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                               FROM DPS.PS_TIMEPBN F
                                       , DPS.PC_ORGMST G
                                       , DPS.PC_STRPBN H
                              WHERE G.ORG_CD    = H.BUY_ORG_CD
                                AND F.STR_CD    =  H.STR_CD
                                AND F.PUMBUN_CD = H.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.SALE_DT   IN (?, ?) -- 매출일자, 대비일자
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                                AND ? = TO_CHAR(SYSDATE, 'YYYMMDD') -- 매출일자
                              GROUP BY
                                    SUBSTR(H.BUY_ORG_CD,1,8) || '00'
                              UNION ALL
                             SELECT SUBSTR(H.BUY_ORG_CD,1,8) || '00'  AS ORG_CD
                                  , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT      -- 매출일자20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP  -- 대비일자20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP2 -- 대비일자20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                               FROM DPS.PS_TIMEPBN F
                                       , DPS.PC_ORGMST G
                                       , DPS.PC_STRPBN H
                              WHERE G.ORG_CD    = H.BUY_ORG_CD
                                AND F.STR_CD    =  H.STR_CD
                                AND F.PUMBUN_CD = H.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.SALE_DT   IN (?, ?) -- 매출일자, 대비일자
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                                AND ? <> TO_CHAR(SYSDATE, 'YYYMMDD') -- 매출일자
                              GROUP BY
                                    SUBSTR(H.BUY_ORG_CD,1,8) || '00'
                                               ) G  
                      WHERE A.ORG_CD     = B.ORG_CD
                        AND A.ORG_CD     = G.ORG_CD(+)
                        AND B.STR_CD     LIKE ? || '%'
                        AND B.DEPT_CD    LIKE ? || '%'
                        AND B.TEAM_CD    LIKE ? || '%'
                        AND B.PC_CD      LIKE ? || '%'
                        AND EXISTS ( SELECT MYORG.USER_ID
                                       FROM COM.V_MYORG MYORG
                                      WHERE MYORG.STR_CD      = B.STR_CD
                                        AND MYORG.DEPT_CD     = B.DEPT_CD
                                        AND MYORG.TEAM_CD     = B.TEAM_CD
                                        AND MYORG.PC_CD       = B.PC_CD
                                        AND MYORG.USER_ID     = ?
                                   )
                      GROUP BY A.STR_CD,
                            LPAD(A.ORG_CD, 6)
                    ) X
              ORDER BY
                    X.ORG_CD
                    -------------5
        ]]>        
    </query>
    <query name="SEL_SALE_TEAM">        
        <![CDATA[
            SELECT STR_CD, DPS.FN_GET_STORE_NAME(STR_CD) STR_NAME,ORG_CD
                  , (SELECT ORG_SHORT_NAME FROM DPS.PC_ORGMST WHERE ORG_CD =  X.ORG_CD) AS ORG_NAME
                  , ORIGIN_SALE_TAMT    AS    ORIGIN_SALE_TAMT
                  , TOT_SALE_AMT        AS    TOT_SALE_AMT
                  , ACHIEVERATE            AS    ACHIEVERATE
                  , 0.00                AS  RATE
                  , TOT_SALE_AMT_CMPR    AS    TOT_SALE_AMT_CMPR
                  , SALEIRATE            AS    SALEIRATE
                  , EXPECT_AMT          AS  EXPECT_AMT
                  , REDU_AMT            AS    REDU_AMT
                  , NORM_SALE_AMT        AS    NORM_SALE_AMT
                  , DC_AMT                AS    DC_AMT
                  , NET_SALE_AMT        AS    NET_SALE_AMT
                  , SALE_PROF_AMT        AS    SALE_PROF_AMT
                  , PROFRATE            AS    PROFRATE
                  , CUST_CNT            AS    CUST_CNT
                  , CUST_DANGA            AS    CUST_DANGA
                  , CUST_CNT_CMPR       AS  CUST_CNT_CMPR
                  , CUST_CNT_RATE       AS  CUST_CNT_RATE
                  , CASE WHEN ORIGIN_SALE_TAMT = 0 THEN 0 ELSE ORIGIN_SALE_TAMT/1000 END AS ORIGIN_SALE_TAMT_CHART
                  , CASE WHEN TOT_SALE_AMT = 0 THEN 0 ELSE TOT_SALE_AMT/1000 END AS TOT_SALE_AMT_CHART
                  , CASE WHEN EXPECT_AMT = 0 THEN 0 ELSE EXPECT_AMT/1000 END AS EXPECT_AMT_CHART
                  , CASE WHEN TOT_SALE_AMT_CMPR = 0 THEN 0 ELSE TOT_SALE_AMT_CMPR/1000 END AS TOT_SALE_AMT_CMPR_CHART
               FROM (
                     SELECT A.STR_CD,LPAD(A.ORG_CD, 6) || '0000'                                       AS ORG_CD
                          , SUM(NVL(A.ORIGIN_SALE_TAMT,0))                                        AS ORIGIN_SALE_TAMT
                          , SUM(NVL(A.TOT_SALE_AMT,0))                                            AS TOT_SALE_AMT
                          , (CASE WHEN SUM(NVL(A.ORIGIN_SALE_TAMT,0))  = 0 THEN 0 
                             ELSE    ( SUM(NVL(A.TOT_SALE_AMT,0))/SUM(NVL(A.ORIGIN_SALE_TAMT,0)))*100 END)                          AS ACHIEVERATE
                          , SUM(NVL(A.TOT_SALE_AMT_CMPR,0))                                        AS TOT_SALE_AMT_CMPR
                          , (CASE WHEN  SUM(NVL(A.TOT_SALE_AMT_CMPR,0)) = 0 THEN 0 
                             ELSE SUM(NVL(A.TOT_SALE_AMT,0))/SUM(NVL(A.TOT_SALE_AMT_CMPR,0))*100 END) AS SALEIRATE
                          , CASE WHEN ? < TO_CHAR(SYSDATE, 'YYYYMMDD')  THEN SUM(NVL(A.TOT_SALE_AMT,0)) 
                                     ELSE CASE WHEN ? = TO_CHAR(SYSDATE, 'YYYYMMDD') THEN CASE WHEN SUM(NVL(G.TOT_SALE_AMT_CMP,0)) = 0 THEN SUM(NVL(G.TOT_SALE_AMT,0)) + SUM(NVL(G.TOT_SALE_AMT_CMP2,0)) ELSE SUM(NVL(G.TOT_SALE_AMT,0)) + (SUM(NVL(G.TOT_SALE_AMT_CMP2,0)) * (SUM(NVL(G.TOT_SALE_AMT,0)) / (SUM(NVL(G.TOT_SALE_AMT_CMP,0))))) END
                                             ELSE SUM(NVL(G.TOT_SALE_AMT,0))
                                        END 
                            END AS EXPECT_AMT
                          , SUM(NVL(A.REDU_AMT,0))                                            AS REDU_AMT
                          , SUM(NVL(A.NORM_SALE_AMT,0))                                       AS NORM_SALE_AMT
                          , SUM(NVL(A.DC_AMT,0))                                              AS DC_AMT
                          , SUM(NVL(A.NET_SALE_AMT,0))                                        AS NET_SALE_AMT
                          , SUM(NVL(A.SALE_PROF_AMT,0))                                       AS SALE_PROF_AMT
                          , (CASE WHEN SUM(NVL(A.TOT_SALE_AMT,0)) = 0 THEN 0 
                             ELSE (SUM(NVL(A.SALE_PROF_AMT,0))/SUM(NVL(A.TOT_SALE_AMT,0)))*100 END)                                 AS PROFRATE
                          , SUM(A.CUST_CNT)                                                   AS CUST_CNT
                          , (CASE WHEN SUM(A.CUST_CNT) = 0 THEN 0 ELSE SUM(A.TOT_SALE_AMT)/SUM(A.CUST_CNT) END)                             AS CUST_DANGA
                          , SUM(A.CUST_CNT_CMPR)                                                   AS CUST_CNT_CMPR
                          , CASE WHEN SUM(A.CUST_CNT_CMPR) = 0 THEN 0 ELSE SUM(A.CUST_CNT) / SUM(A.CUST_CNT_CMPR) * 100 END CUST_CNT_RATE
                       FROM (SELECT A.STR_CD                                 AS STR_CD
                                  , SUBSTR(C.SALE_ORG_CD,1,8) || '00'        AS ORG_CD
                                  , SUM(A.NORM_SALE_AMT)                      AS TOT_SALE_AMT --20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(A.REDU_AMT)                          AS REDU_AMT
                                  , SUM(A.NORM_SALE_AMT)                     AS NORM_SALE_AMT
                                  , SUM(A.DC_AMT)                            AS DC_AMT
                                  , SUM(A.NET_SALE_AMT)                      AS NET_SALE_AMT
                                  , SUM(A.SALE_PROF_AMT)                     AS SALE_PROF_AMT
                                  , SUM(A.CUST_CNT)                          AS CUST_CNT
                                  , 0                                        AS TOT_SALE_AMT_CMPR
                                  , 0                                        AS CUST_CNT_CMPR
                                  , 0                                        AS ORIGIN_SALE_TAMT
                               FROM DPS.PS_DAYPBN    A
                                      , DPS.PC_ORGMST    B
                                      , DPS.PC_STRPBN    C
                              WHERE B.ORG_CD   = C.SALE_ORG_CD
                                AND A.STR_CD    = C.STR_CD
                                AND A.PUMBUN_CD = C.PUMBUN_CD
                                AND B.STR_CD   LIKE ? || '%'
                                AND B.DEPT_CD  LIKE ? || '%'
                                AND B.TEAM_CD  LIKE ? || '%'
                                AND B.PC_CD    LIKE ? || '%'
                                AND A.SALE_DT  = ?
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = B.STR_CD
                                                AND MYORG.DEPT_CD     = B.DEPT_CD
                                                AND MYORG.TEAM_CD     = B.TEAM_CD
                                                AND MYORG.PC_CD       = B.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                              GROUP BY
                                    A.STR_CD
                                  , SUBSTR(C.SALE_ORG_CD,1,8) 
                             UNION ALL
                             SELECT F.STR_CD                          AS STR_CD            
                                  , SUBSTR(E.SALE_ORG_CD,1,8) || '00' AS ORG_CD            
                                  , 0                                 AS TOT_SALE_AMT      
                                  , 0                                 AS REDU_AMT          
                                  , 0                                 AS NORM_SALE_AMT     
                                  , 0                                 AS DC_AMT            
                                  , 0                                 AS NET_SALE_AMT      
                                  , 0                                 AS SALE_PROF_AMT     
                                  , 0                                 AS CUST_CNT          
                                  , SUM(F.NORM_SALE_AMT)               AS TOT_SALE_AMT_CMPR --20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(F.CUST_CNT )                  AS CUST_CNT_CMPR     
                                  , 0                                 AS ORIGIN_SALE_TAMT  
                               FROM DPS.PS_DAYPBN F
                                      , DPS.PC_ORGMST G
                                      , DPS.PC_STRPBN E
                              WHERE G.ORG_CD    = E.SALE_ORG_CD
                                AND F.STR_CD    =   E.STR_CD
                                AND F.PUMBUN_CD = E.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.SALE_DT   = ?
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                              GROUP BY F.STR_CD
                                    , SUBSTR(E.SALE_ORG_CD,1,8) || '00'
                            UNION ALL
                             SELECT F.STR_CD                          AS STR_CD            
                                  , SUBSTR(E.SALE_ORG_CD,1,8) || '00' AS ORG_CD            
                                  , 0                                 AS TOT_SALE_AMT      
                                  , 0                                 AS REDU_AMT          
                                  , 0                                 AS NORM_SALE_AMT     
                                  , 0                                 AS DC_AMT            
                                  , 0                                 AS NET_SALE_AMT      
                                  , 0                                 AS SALE_PROF_AMT     
                                  , 0                                 AS CUST_CNT          
                                  , 0                                 AS TOT_SALE_AMT_CMPR 
                                  , 0                                 AS CUST_CNT_CMPR     
                                  , SUM(F.ORIGIN_SALE_TAMT)           AS ORIGIN_SALE_TAMT  
                               FROM DPS.PS_ACTPUMBUN F
                                      , DPS.PC_ORGMST G
                                      , DPS.PC_STRPBN E
                              WHERE G.ORG_CD    = E.SALE_ORG_CD
                                AND F.STR_CD    =   E.STR_CD
                                AND F.PUMBUN_CD = E.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.EXE_DT   = ?
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                              GROUP BY F.STR_CD
                                     , SUBSTR(E.SALE_ORG_CD,1,8) || '00'
                             )      A
                          , DPS.PC_ORGMST      B
                          , (SELECT SUBSTR(H.SALE_ORG_CD,1,8) || '00'  AS ORG_CD
                                  , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME <= TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT      -- 매출일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME <= TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP  -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME >  TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP2 -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                               FROM DPS.PS_TIMEPBN F
                                       , DPS.PC_ORGMST G
                                       , DPS.PC_STRPBN H
                              WHERE G.ORG_CD    = H.SALE_ORG_CD
                                AND F.STR_CD    =  H.STR_CD
                                AND F.PUMBUN_CD = H.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.SALE_DT   IN (?, ?) -- 매출일자, 대비일자
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                                AND ? = TO_CHAR(SYSDATE, 'YYYMMDD') -- 매출일자
                              GROUP BY
                                    SUBSTR(H.SALE_ORG_CD,1,8) || '00'
                              UNION ALL
                             SELECT SUBSTR(H.SALE_ORG_CD,1,8) || '00'  AS ORG_CD
                                  , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT      -- 매출일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP  -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP2 -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                               FROM DPS.PS_TIMEPBN F
                                       , DPS.PC_ORGMST G
                                       , DPS.PC_STRPBN H
                              WHERE G.ORG_CD    = H.SALE_ORG_CD
                                AND F.STR_CD    =  H.STR_CD
                                AND F.PUMBUN_CD = H.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.SALE_DT   IN (?, ?) -- 매출일자, 대비일자
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                                AND ? <> TO_CHAR(SYSDATE, 'YYYMMDD') -- 매출일자
                              GROUP BY
                                    SUBSTR(H.SALE_ORG_CD,1,8) || '00'
                                               ) G  
                      WHERE A.ORG_CD     = B.ORG_CD
                        AND A.ORG_CD     = G.ORG_CD(+)
                        AND B.STR_CD     LIKE ? || '%'
                        AND B.DEPT_CD    LIKE ? || '%'
                        AND B.TEAM_CD    LIKE ? || '%'
                        AND B.PC_CD      LIKE ? || '%'
                        AND EXISTS ( SELECT MYORG.USER_ID
                                       FROM COM.V_MYORG MYORG
                                      WHERE MYORG.STR_CD      = B.STR_CD
                                        AND MYORG.DEPT_CD     = B.DEPT_CD
                                        AND MYORG.TEAM_CD     = B.TEAM_CD
                                        AND MYORG.PC_CD       = B.PC_CD
                                        AND MYORG.USER_ID     = ?
                                   )
                      GROUP BY A.STR_CD,
                            LPAD(A.ORG_CD, 6)
                    ) X
              ORDER BY
                    X.ORG_CD
                    -------------6
        ]]>        
    </query>
    <query name="SEL_SALE_DEPT">        
        <![CDATA[
             SELECT STR_CD, DPS.FN_GET_STORE_NAME(STR_CD) STR_NAME, ORG_CD
                  , (SELECT ORG_SHORT_NAME FROM DPS.PC_ORGMST WHERE ORG_CD =  X.ORG_CD) AS ORG_NAME
                  , ORIGIN_SALE_TAMT    AS    ORIGIN_SALE_TAMT
                  , TOT_SALE_AMT        AS    TOT_SALE_AMT
                  , ACHIEVERATE            AS    ACHIEVERATE
                  , 0.00                AS  RATE
                  , TOT_SALE_AMT_CMPR    AS    TOT_SALE_AMT_CMPR
                  , SALEIRATE            AS    SALEIRATE
                  , EXPECT_AMT          AS  EXPECT_AMT
                  , REDU_AMT            AS    REDU_AMT
                  , NORM_SALE_AMT        AS    NORM_SALE_AMT
                  , DC_AMT                AS    DC_AMT
                  , NET_SALE_AMT        AS    NET_SALE_AMT
                  , SALE_PROF_AMT        AS    SALE_PROF_AMT
                  , PROFRATE            AS    PROFRATE
                  , CUST_CNT            AS    CUST_CNT
                  , CUST_DANGA            AS    CUST_DANGA
                  , CUST_CNT_CMPR       AS  CUST_CNT_CMPR
                  , CUST_CNT_RATE       AS  CUST_CNT_RATE
                  , CASE WHEN ORIGIN_SALE_TAMT = 0 THEN 0 ELSE ORIGIN_SALE_TAMT/1000 END AS ORIGIN_SALE_TAMT_CHART
                  , CASE WHEN TOT_SALE_AMT = 0 THEN 0 ELSE TOT_SALE_AMT/1000 END AS TOT_SALE_AMT_CHART
                  , CASE WHEN EXPECT_AMT = 0 THEN 0 ELSE EXPECT_AMT/1000 END AS EXPECT_AMT_CHART
                  , CASE WHEN TOT_SALE_AMT_CMPR = 0 THEN 0 ELSE TOT_SALE_AMT_CMPR/1000 END AS TOT_SALE_AMT_CMPR_CHART
               FROM (
                     SELECT A.STR_CD,LPAD(A.ORG_CD, 4) || '000000'                                       AS ORG_CD
                          , SUM(NVL(A.ORIGIN_SALE_TAMT,0))                                        AS ORIGIN_SALE_TAMT
                          , SUM(NVL(A.TOT_SALE_AMT,0))                                            AS TOT_SALE_AMT
                          , (CASE WHEN SUM(NVL(A.ORIGIN_SALE_TAMT,0))  = 0 THEN 0 
                             ELSE    ( SUM(NVL(A.TOT_SALE_AMT,0))/SUM(NVL(A.ORIGIN_SALE_TAMT,0)))*100 END)                          AS ACHIEVERATE
                          , SUM(NVL(A.TOT_SALE_AMT_CMPR,0))                                        AS TOT_SALE_AMT_CMPR
                          , (CASE WHEN  SUM(NVL(A.TOT_SALE_AMT_CMPR,0)) = 0 THEN 0 
                             ELSE SUM(NVL(A.TOT_SALE_AMT,0))/SUM(NVL(A.TOT_SALE_AMT_CMPR,0))*100 END) AS SALEIRATE
                          , CASE WHEN ? < TO_CHAR(SYSDATE, 'YYYYMMDD')  THEN SUM(NVL(A.TOT_SALE_AMT,0)) 
                                     ELSE CASE WHEN ? = TO_CHAR(SYSDATE, 'YYYYMMDD') THEN CASE WHEN SUM(NVL(G.TOT_SALE_AMT_CMP,0)) = 0 THEN SUM(NVL(G.TOT_SALE_AMT,0)) + SUM(NVL(G.TOT_SALE_AMT_CMP2,0)) ELSE SUM(NVL(G.TOT_SALE_AMT,0)) + (SUM(NVL(G.TOT_SALE_AMT_CMP2,0)) * (SUM(NVL(G.TOT_SALE_AMT,0)) / (SUM(NVL(G.TOT_SALE_AMT_CMP,0))))) END
                                             ELSE SUM(NVL(G.TOT_SALE_AMT,0))
                                        END 
                            END AS EXPECT_AMT
                          , SUM(NVL(A.REDU_AMT,0))                                            AS REDU_AMT
                          , SUM(NVL(A.NORM_SALE_AMT,0))                                       AS NORM_SALE_AMT
                          , SUM(NVL(A.DC_AMT,0))                                              AS DC_AMT
                          , SUM(NVL(A.NET_SALE_AMT,0))                                        AS NET_SALE_AMT
                          , SUM(NVL(A.SALE_PROF_AMT,0))                                       AS SALE_PROF_AMT
                          , (CASE WHEN SUM(NVL(A.TOT_SALE_AMT,0)) = 0 THEN 0 
                             ELSE (SUM(NVL(A.SALE_PROF_AMT,0))/SUM(NVL(A.TOT_SALE_AMT,0)))*100 END)                                 AS PROFRATE
                          , SUM(A.CUST_CNT)                                                   AS CUST_CNT
                          , (CASE WHEN SUM(A.CUST_CNT) = 0 THEN 0 ELSE SUM(A.TOT_SALE_AMT)/SUM(A.CUST_CNT) END)                             AS CUST_DANGA
                          , SUM(A.CUST_CNT_CMPR)                                                   AS CUST_CNT_CMPR
                          , CASE WHEN SUM(A.CUST_CNT_CMPR) = 0 THEN 0 ELSE SUM(A.CUST_CNT) / SUM(A.CUST_CNT_CMPR) * 100 END CUST_CNT_RATE
                       FROM (SELECT A.STR_CD                                 AS STR_CD
                                  , SUBSTR(C.SALE_ORG_CD,1,8) || '00'        AS ORG_CD
                                  , SUM(A.NORM_SALE_AMT)                      AS TOT_SALE_AMT --20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(A.REDU_AMT)                          AS REDU_AMT
                                  , SUM(A.NORM_SALE_AMT)                     AS NORM_SALE_AMT
                                  , SUM(A.DC_AMT)                            AS DC_AMT
                                  , SUM(A.NET_SALE_AMT)                      AS NET_SALE_AMT
                                  , SUM(A.SALE_PROF_AMT)                     AS SALE_PROF_AMT
                                  , SUM(A.CUST_CNT)                          AS CUST_CNT
                                  , 0                                        AS TOT_SALE_AMT_CMPR
                                  , 0                                        AS CUST_CNT_CMPR
                                  , 0                                        AS ORIGIN_SALE_TAMT
                               FROM DPS.PS_DAYPBN    A
                                      , DPS.PC_ORGMST    B
                                      , DPS.PC_STRPBN    C
                              WHERE B.ORG_CD   = C.SALE_ORG_CD
                                AND A.STR_CD    = C.STR_CD
                                AND A.PUMBUN_CD = C.PUMBUN_CD
                                AND B.STR_CD   LIKE ? || '%'
                                AND B.DEPT_CD  LIKE ? || '%'
                                AND B.TEAM_CD  LIKE ? || '%'
                                AND B.PC_CD    LIKE ? || '%'
                                AND A.SALE_DT  = ?
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = B.STR_CD
                                                AND MYORG.DEPT_CD     = B.DEPT_CD
                                                AND MYORG.TEAM_CD     = B.TEAM_CD
                                                AND MYORG.PC_CD       = B.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                              GROUP BY
                                    A.STR_CD
                                  , SUBSTR(C.SALE_ORG_CD,1,8) 
                             UNION ALL
                             SELECT F.STR_CD                          AS STR_CD            
                                  , SUBSTR(E.SALE_ORG_CD,1,8) || '00' AS ORG_CD            
                                  , 0                                 AS TOT_SALE_AMT      
                                  , 0                                 AS REDU_AMT          
                                  , 0                                 AS NORM_SALE_AMT     
                                  , 0                                 AS DC_AMT            
                                  , 0                                 AS NET_SALE_AMT      
                                  , 0                                 AS SALE_PROF_AMT     
                                  , 0                                 AS CUST_CNT          
                                  , SUM(F.NORM_SALE_AMT)               AS TOT_SALE_AMT_CMPR -- 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(F.CUST_CNT )                  AS CUST_CNT_CMPR     
                                  , 0                                 AS ORIGIN_SALE_TAMT  
                               FROM DPS.PS_DAYPBN F
                                      , DPS.PC_ORGMST G
                                      , DPS.PC_STRPBN E
                              WHERE G.ORG_CD    = E.SALE_ORG_CD
                                AND F.STR_CD    =   E.STR_CD
                                AND F.PUMBUN_CD = E.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.SALE_DT   = ?
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                              GROUP BY F.STR_CD
                                    , SUBSTR(E.SALE_ORG_CD,1,8) || '00'
                            UNION ALL
                             SELECT F.STR_CD                          AS STR_CD            
                                  , SUBSTR(E.SALE_ORG_CD,1,8) || '00' AS ORG_CD            
                                  , 0                                 AS TOT_SALE_AMT      
                                  , 0                                 AS REDU_AMT          
                                  , 0                                 AS NORM_SALE_AMT     
                                  , 0                                 AS DC_AMT            
                                  , 0                                 AS NET_SALE_AMT      
                                  , 0                                 AS SALE_PROF_AMT     
                                  , 0                                 AS CUST_CNT          
                                  , 0                                 AS TOT_SALE_AMT_CMPR 
                                  , 0                                 AS CUST_CNT_CMPR     
                                  , SUM(F.ORIGIN_SALE_TAMT)           AS ORIGIN_SALE_TAMT  
                               FROM DPS.PS_ACTPUMBUN F
                                      , DPS.PC_ORGMST G
                                      , DPS.PC_STRPBN E
                              WHERE G.ORG_CD    = E.SALE_ORG_CD
                                AND F.STR_CD    =   E.STR_CD
                                AND F.PUMBUN_CD = E.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.EXE_DT   = ?
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                              GROUP BY F.STR_CD
                                     , SUBSTR(E.SALE_ORG_CD,1,8) || '00'
                             )      A
                          , DPS.PC_ORGMST      B
                          , (SELECT SUBSTR(H.SALE_ORG_CD,1,8) || '00'  AS ORG_CD
                                  , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME <= TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT      -- 매출일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME <= TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP  -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME >  TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP2 -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                               FROM DPS.PS_TIMEPBN F
                                       , DPS.PC_ORGMST G
                                       , DPS.PC_STRPBN H
                              WHERE G.ORG_CD    = H.SALE_ORG_CD
                                AND F.STR_CD    =  H.STR_CD
                                AND F.PUMBUN_CD = H.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.SALE_DT   IN (?, ?) -- 매출일자, 대비일자
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                                AND ? = TO_CHAR(SYSDATE, 'YYYMMDD') -- 매출일자
                              GROUP BY
                                    SUBSTR(H.SALE_ORG_CD,1,8) || '00'
                              UNION ALL
                             SELECT SUBSTR(H.SALE_ORG_CD,1,8) || '00'  AS ORG_CD
                                  , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT      -- 매출일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP  -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP2 -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                               FROM DPS.PS_TIMEPBN F
                                       , DPS.PC_ORGMST G
                                       , DPS.PC_STRPBN H
                              WHERE G.ORG_CD    = H.SALE_ORG_CD
                                AND F.STR_CD    =  H.STR_CD
                                AND F.PUMBUN_CD = H.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.SALE_DT   IN (?, ?) -- 매출일자, 대비일자
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                                AND ? <> TO_CHAR(SYSDATE, 'YYYMMDD') -- 매출일자
                              GROUP BY
                                    SUBSTR(H.SALE_ORG_CD,1,8) || '00'
                                               ) G  
                      WHERE A.ORG_CD     = B.ORG_CD
                        AND A.ORG_CD     = G.ORG_CD(+)
                        AND B.STR_CD     LIKE ? || '%'
                        AND B.DEPT_CD    LIKE ? || '%'
                        AND B.TEAM_CD    LIKE ? || '%'
                        AND B.PC_CD      LIKE ? || '%'
                        AND EXISTS ( SELECT MYORG.USER_ID
                                       FROM COM.V_MYORG MYORG
                                      WHERE MYORG.STR_CD      = B.STR_CD
                                        AND MYORG.DEPT_CD     = B.DEPT_CD
                                        AND MYORG.TEAM_CD     = B.TEAM_CD
                                        AND MYORG.PC_CD       = B.PC_CD
                                        AND MYORG.USER_ID     = ?
                                   )
                      GROUP BY A.STR_CD,
                            LPAD(A.ORG_CD, 4)
                    ) X
              ORDER BY
                    X.ORG_CD
					-------------7
                    
        ]]>        
    </query>
    <query name="SEL_SALE_DEPT2">        
        <![CDATA[
             SELECT STR_CD, DPS.FN_GET_STORE_NAME(STR_CD) STR_NAME,ORG_CD
                  , (SELECT ORG_SHORT_NAME FROM DPS.PC_ORGMST WHERE ORG_CD =  X.ORG_CD) AS ORG_NAME
                  , ORIGIN_SALE_TAMT    AS    ORIGIN_SALE_TAMT
                  , TOT_SALE_AMT        AS    TOT_SALE_AMT
                  , ACHIEVERATE            AS    ACHIEVERATE
                  , 0.00                AS  RATE
                  , TOT_SALE_AMT_CMPR    AS    TOT_SALE_AMT_CMPR
                  , SALEIRATE            AS    SALEIRATE
                  , EXPECT_AMT          AS  EXPECT_AMT
                  , REDU_AMT            AS    REDU_AMT
                  , NORM_SALE_AMT        AS    NORM_SALE_AMT
                  , DC_AMT                AS    DC_AMT
                  , NET_SALE_AMT        AS    NET_SALE_AMT
                  , SALE_PROF_AMT        AS    SALE_PROF_AMT
                  , PROFRATE            AS    PROFRATE
                  , CUST_CNT            AS    CUST_CNT
                  , CUST_DANGA            AS    CUST_DANGA
                  , CUST_CNT_CMPR       AS  CUST_CNT_CMPR
                  , CUST_CNT_RATE       AS  CUST_CNT_RATE
                  , CASE WHEN ORIGIN_SALE_TAMT = 0 THEN 0 ELSE ORIGIN_SALE_TAMT/1000 END AS ORIGIN_SALE_TAMT_CHART
                  , CASE WHEN TOT_SALE_AMT = 0 THEN 0 ELSE TOT_SALE_AMT/1000 END AS TOT_SALE_AMT_CHART
                  , CASE WHEN EXPECT_AMT = 0 THEN 0 ELSE EXPECT_AMT/1000 END AS EXPECT_AMT_CHART
                  , CASE WHEN TOT_SALE_AMT_CMPR = 0 THEN 0 ELSE TOT_SALE_AMT_CMPR/1000 END AS TOT_SALE_AMT_CMPR_CHART
               FROM (
                     SELECT A.STR_CD,LPAD(A.ORG_CD, 4) || '000000'                                       AS ORG_CD
                          , SUM(NVL(A.ORIGIN_SALE_TAMT,0))                                        AS ORIGIN_SALE_TAMT
                          , SUM(NVL(A.TOT_SALE_AMT,0))                                            AS TOT_SALE_AMT
                          , (CASE WHEN SUM(NVL(A.ORIGIN_SALE_TAMT,0))  = 0 THEN 0 
                             ELSE    ( SUM(NVL(A.TOT_SALE_AMT,0))/SUM(NVL(A.ORIGIN_SALE_TAMT,0)))*100 END)                          AS ACHIEVERATE
                          , SUM(NVL(A.TOT_SALE_AMT_CMPR,0))                                        AS TOT_SALE_AMT_CMPR
                          , (CASE WHEN  SUM(NVL(A.TOT_SALE_AMT_CMPR,0)) = 0 THEN 0 
                             ELSE SUM(NVL(A.TOT_SALE_AMT,0))/SUM(NVL(A.TOT_SALE_AMT_CMPR,0))*100 END) AS SALEIRATE
                          , CASE WHEN ? < TO_CHAR(SYSDATE, 'YYYYMMDD')  THEN SUM(NVL(A.TOT_SALE_AMT,0)) 
                                     ELSE CASE WHEN ? = TO_CHAR(SYSDATE, 'YYYYMMDD') THEN CASE WHEN SUM(NVL(G.TOT_SALE_AMT_CMP,0)) = 0 THEN SUM(NVL(G.TOT_SALE_AMT,0)) + SUM(NVL(G.TOT_SALE_AMT_CMP2,0)) ELSE SUM(NVL(G.TOT_SALE_AMT,0)) + (SUM(NVL(G.TOT_SALE_AMT_CMP2,0)) * (SUM(NVL(G.TOT_SALE_AMT,0)) / (SUM(NVL(G.TOT_SALE_AMT_CMP,0))))) END
                                             ELSE SUM(NVL(G.TOT_SALE_AMT,0))
                                        END 
                            END AS EXPECT_AMT
                          , SUM(NVL(A.REDU_AMT,0))                                            AS REDU_AMT
                          , SUM(NVL(A.NORM_SALE_AMT,0))                                       AS NORM_SALE_AMT
                          , SUM(NVL(A.DC_AMT,0))                                              AS DC_AMT
                          , SUM(NVL(A.NET_SALE_AMT,0))                                        AS NET_SALE_AMT
                          , SUM(NVL(A.SALE_PROF_AMT,0))                                       AS SALE_PROF_AMT
                          , (CASE WHEN SUM(NVL(A.TOT_SALE_AMT,0)) = 0 THEN 0 
                             ELSE (SUM(NVL(A.SALE_PROF_AMT,0))/SUM(NVL(A.TOT_SALE_AMT,0)))*100 END)                                 AS PROFRATE
                          , SUM(A.CUST_CNT)                                                   AS CUST_CNT
                          , (CASE WHEN SUM(A.CUST_CNT) = 0 THEN 0 ELSE SUM(A.TOT_SALE_AMT)/SUM(A.CUST_CNT) END)                             AS CUST_DANGA
                          , SUM(A.CUST_CNT_CMPR)                                                   AS CUST_CNT_CMPR
                          , CASE WHEN SUM(A.CUST_CNT_CMPR) = 0 THEN 0 ELSE SUM(A.CUST_CNT) / SUM(A.CUST_CNT_CMPR) * 100 END CUST_CNT_RATE
                       FROM (SELECT A.STR_CD                                 AS STR_CD
                                  , SUBSTR(C.BUY_ORG_CD,1,8) || '00'        AS ORG_CD
                                  , SUM(A.NORM_SALE_AMT)                      AS TOT_SALE_AMT -- 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(A.REDU_AMT)                          AS REDU_AMT
                                  , SUM(A.NORM_SALE_AMT)                     AS NORM_SALE_AMT
                                  , SUM(A.DC_AMT)                            AS DC_AMT
                                  , SUM(A.NET_SALE_AMT)                      AS NET_SALE_AMT
                                  , SUM(A.SALE_PROF_AMT)                     AS SALE_PROF_AMT
                                  , SUM(A.CUST_CNT)                          AS CUST_CNT
                                  , 0                                        AS TOT_SALE_AMT_CMPR
                                  , 0                                        AS CUST_CNT_CMPR
                                  , 0                                        AS ORIGIN_SALE_TAMT
                               FROM DPS.PS_DAYPBN    A
                                      , DPS.PC_ORGMST    B
                                      , DPS.PC_STRPBN    C
                              WHERE B.ORG_CD   = C.BUY_ORG_CD
                                AND A.STR_CD    = C.STR_CD
                                AND A.PUMBUN_CD = C.PUMBUN_CD
                                AND B.STR_CD   LIKE ? || '%'
                                AND B.DEPT_CD  LIKE ? || '%'
                                AND B.TEAM_CD  LIKE ? || '%'
                                AND B.PC_CD    LIKE ? || '%'
                                AND A.SALE_DT  = ?
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = B.STR_CD
                                                AND MYORG.DEPT_CD     = B.DEPT_CD
                                                AND MYORG.TEAM_CD     = B.TEAM_CD
                                                AND MYORG.PC_CD       = B.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                              GROUP BY
                                    A.STR_CD
                                  , SUBSTR(C.BUY_ORG_CD,1,8) 
                             UNION ALL
                             SELECT F.STR_CD                          AS STR_CD            
                                  , SUBSTR(E.BUY_ORG_CD,1,8) || '00' AS ORG_CD            
                                  , 0                                 AS TOT_SALE_AMT      
                                  , 0                                 AS REDU_AMT          
                                  , 0                                 AS NORM_SALE_AMT     
                                  , 0                                 AS DC_AMT            
                                  , 0                                 AS NET_SALE_AMT      
                                  , 0                                 AS SALE_PROF_AMT     
                                  , 0                                 AS CUST_CNT          
                                  , SUM(F.NORM_SALE_AMT)               AS TOT_SALE_AMT_CMPR -- 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(F.CUST_CNT )                  AS CUST_CNT_CMPR     
                                  , 0                                 AS ORIGIN_SALE_TAMT  
                               FROM DPS.PS_DAYPBN F
                                      , DPS.PC_ORGMST G
                                      , DPS.PC_STRPBN E
                              WHERE G.ORG_CD    = E.BUY_ORG_CD
                                AND F.STR_CD    =   E.STR_CD
                                AND F.PUMBUN_CD = E.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.SALE_DT   = ?
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                              GROUP BY F.STR_CD
                                    , SUBSTR(E.BUY_ORG_CD,1,8) || '00'
                            UNION ALL
                             SELECT F.STR_CD                          AS STR_CD            
                                  , SUBSTR(E.BUY_ORG_CD,1,8) || '00' AS ORG_CD            
                                  , 0                                 AS TOT_SALE_AMT      
                                  , 0                                 AS REDU_AMT          
                                  , 0                                 AS NORM_SALE_AMT     
                                  , 0                                 AS DC_AMT            
                                  , 0                                 AS NET_SALE_AMT      
                                  , 0                                 AS SALE_PROF_AMT     
                                  , 0                                 AS CUST_CNT          
                                  , 0                                 AS TOT_SALE_AMT_CMPR 
                                  , 0                                 AS CUST_CNT_CMPR     
                                  , SUM(F.ORIGIN_SALE_TAMT)           AS ORIGIN_SALE_TAMT  
                               FROM DPS.PS_ACTPUMBUN F
                                      , DPS.PC_ORGMST G
                                      , DPS.PC_STRPBN E
                              WHERE G.ORG_CD    = E.BUY_ORG_CD
                                AND F.STR_CD    =   E.STR_CD
                                AND F.PUMBUN_CD = E.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.EXE_DT   = ?
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                              GROUP BY F.STR_CD
                                     , SUBSTR(E.BUY_ORG_CD,1,8) || '00'
                             )      A
                          , DPS.PC_ORGMST      B
                          , (SELECT SUBSTR(H.BUY_ORG_CD,1,8) || '00'  AS ORG_CD
                                  , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME <= TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT      -- 매출일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME <= TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP  -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? AND F.SALE_TIME >  TO_CHAR(SYSDATE, 'HH24MI') THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP2 -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                               FROM DPS.PS_TIMEPBN F
                                       , DPS.PC_ORGMST G
                                       , DPS.PC_STRPBN H
                              WHERE G.ORG_CD    = H.BUY_ORG_CD
                                AND F.STR_CD    =  H.STR_CD
                                AND F.PUMBUN_CD = H.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.SALE_DT   IN (?, ?) -- 매출일자, 대비일자
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                                AND ? = TO_CHAR(SYSDATE, 'YYYMMDD') -- 매출일자
                              GROUP BY
                                    SUBSTR(H.BUY_ORG_CD,1,8) || '00'
                              UNION ALL
                             SELECT SUBSTR(H.BUY_ORG_CD,1,8) || '00'  AS ORG_CD
                                  , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT      -- 매출일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP  -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                                  , SUM(CASE WHEN F.SALE_DT = ? THEN F.NORM_SALE_AMT ELSE 0 END) AS TOT_SALE_AMT_CMP2 -- 대비일자 20180314 TOT_SALE_AMT >> NORM_SALE_AMT 로 변경
                               FROM DPS.PS_TIMEPBN F
                                       , DPS.PC_ORGMST G
                                       , DPS.PC_STRPBN H
                              WHERE G.ORG_CD    = H.BUY_ORG_CD
                                AND F.STR_CD    =  H.STR_CD
                                AND F.PUMBUN_CD = H.PUMBUN_CD
                                AND G.STR_CD    LIKE ? || '%'
                                AND G.DEPT_CD   LIKE ? || '%'
                                AND G.TEAM_CD   LIKE ? || '%'
                                AND G.PC_CD     LIKE ? || '%'
                                AND F.SALE_DT   IN (?, ?) -- 매출일자, 대비일자
                                AND EXISTS ( SELECT MYORG.USER_ID
                                               FROM COM.V_MYORG MYORG
                                              WHERE MYORG.STR_CD      = G.STR_CD
                                                AND MYORG.DEPT_CD     = G.DEPT_CD
                                                AND MYORG.TEAM_CD     = G.TEAM_CD
                                                AND MYORG.PC_CD       = G.PC_CD
                                                AND MYORG.USER_ID     = ?
                                           )
                                AND ? <> TO_CHAR(SYSDATE, 'YYYMMDD') -- 매출일자
                              GROUP BY
                                    SUBSTR(H.BUY_ORG_CD,1,8) || '00'
                                               ) G  
                      WHERE A.ORG_CD     = B.ORG_CD
                        AND A.ORG_CD     = G.ORG_CD(+)
                        AND B.STR_CD     LIKE ? || '%'
                        AND B.DEPT_CD    LIKE ? || '%'
                        AND B.TEAM_CD    LIKE ? || '%'
                        AND B.PC_CD      LIKE ? || '%'
                        AND EXISTS ( SELECT MYORG.USER_ID
                                       FROM COM.V_MYORG MYORG
                                      WHERE MYORG.STR_CD      = B.STR_CD
                                        AND MYORG.DEPT_CD     = B.DEPT_CD
                                        AND MYORG.TEAM_CD     = B.TEAM_CD
                                        AND MYORG.PC_CD       = B.PC_CD
                                        AND MYORG.USER_ID     = ?
                                   )
                      GROUP BY A.STR_CD,
                            LPAD(A.ORG_CD, 4)
                    ) X
              ORDER BY
                    X.ORG_CD
                    -------------8
        ]]>        
    </query>
    <query name="SEL_CMPRDT">        
        <![CDATA[
            SELECT NVL(MAX(CMPR_DT), TO_CHAR(ADD_MONTHS(TO_DATE(?, 'YYYYMMDD'),-12), 'YYYYMMDD'))
              FROM DPS.PS_SCHEDULE
             WHERE STR_CD  = ?
               AND SALE_DT = ?
        ]]>        
    </query>
    
</service>