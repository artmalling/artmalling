<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 박종은
 * 회 사 명 : 한국후지쯔
 * 작 성 일 : 2010.04.08
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  
 -->
<service name="/psal532.ps">
	<gauce name="CHECK"> 
		<column colName="CHECK"             colType="TB_STRING"      size="1"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="SALE_YM"              colType="TB_STRING"      size="6"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="STR_CD"               colType="TB_STRING"      size="2"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="ORDERER_CD"           colType="TB_STRING"      size="8"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="PUMBUN_CD"            colType="TB_STRING"      size="6"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
	</gauce>
	
    <gauce name="H_SEL_MASTER"> 
    	<column colName="SEL"                  colType="TB_STRING"      size="1"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CONF_FLAG"            colType="TB_DECIMAL"     size="1"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_YM"              colType="TB_STRING"      size="6"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STR_CD"               colType="TB_STRING"      size="2"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORDERER_CD"           colType="TB_STRING"      size="8"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORDERER_NM"           colType="TB_STRING"      size="20"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_CD"            colType="TB_STRING"      size="6"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_NAME"          colType="TB_STRING"      size="20"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MARIO_COMIS_RATE"     colType="TB_DECIMAL"     size="5"        dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORDERER_COMIS_RATE"   colType="TB_DECIMAL"     size="5"       dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MARIO_PROF_RATE"      colType="TB_DECIMAL"     size="5"        dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AGENCY_PROF_RATE"     colType="TB_DECIMAL"     size="5"       dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REG_DATE"             colType="TB_STRING"      size="20"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REG_ID"               colType="TB_STRING"      size="10"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_DATE"             colType="TB_DECIMAL"     size="20"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_ID"               colType="TB_DECIMAL"     size="10"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        
    </gauce>
    
    <gauce name="MAIN_MASTER"> 
    
		<column colName="ORDERER_NM"           colType="TB_STRING"       size="30"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="ORDERER_NM2"          colType="TB_STRING"       size="30"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="INQR_ORDER"           colType="TB_DECIMAL"      size="3"         dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="TITLE_NM1"            colType="TB_STRING"       size="20"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="TITLE_NM2"            colType="TB_STRING"       size="20"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="PUMBUN_CD"            colType="TB_STRING"       size="6"         dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="PUMBUN_NM"            colType="TB_STRING"       size="20"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="ORDERER_COMIS_RATE"   colType="TB_DECIMAL"      size="5"         dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="AGENCY_PROF_RATE"     colType="TB_DECIMAL"      size="5"         dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
		
	</gauce>
	
	<gauce name="H_SEL_DETAIL"> 
    	<column colName="SEL"                  colType="TB_STRING"      size="1"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="STR_CD"               colType="TB_STRING"      size="2"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="PUMBUN_CD"            colType="TB_STRING"      size="6"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_NAME"          colType="TB_STRING"      size="20"       dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="SALE_YM"              colType="TB_STRING"      size="6"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="MARIO_PROF_RATE"      colType="TB_DECIMAL"     size="5"        dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="CONF_FLAG"            colType="TB_DECIMAL"     size="1"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
	</gauce>
	
	<gauce name="SEARCHCHARGE"> 
		<column colName="MARIO_COMIS_RATE"      colType="TB_DECIMAL"     size="5"        dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
		
	</gauce>
	<gauce name="MARIOPROFRATE"> 
	    <column colName="SEL"                  colType="TB_STRING"      size="1"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="STR_CD"               colType="TB_STRING"      size="2"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="PUMBUN_CD"            colType="TB_STRING"      size="6"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="PUMBUN_NAME"          colType="TB_STRING"       size="30"      dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="SALE_YM"              colType="TB_STRING"      size="6"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="MARIO_PROF_RATE"      colType="TB_DECIMAL"     size="5"        dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="CONF_FLAG"            colType="TB_DECIMAL"     size="1"        dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
	</gauce>
	<gauce name="MARIOPROFRATE2">
		<column colName="MARIO_PROF_RATE"       colType="TB_DECIMAL"     size="5"       dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
	</gauce> 
    
    <gauce name="H_SETVAT">  
        <column colName="COMM_CODE"      colType="TB_STRING"  size="2"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REFER_CODE"     colType="TB_STRING"  size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    <!-- 쿼리는 전부 대문자 -->
    <query name="CHECK_JUNGBOK">        
        <![CDATA[
			SELECT SALE_YM
	             , STR_CD
	             , ORDERER_CD
	             , PUMBUN_CD
	          FROM DPS.PS_COMMISONLINE
	         WHERE SALE_YM= ?
	           AND STR_CD = ?
	           AND ORDERER_CD = '00000000'
	           AND PUMBUN_CD = ?
        ]]>        
    </query>
    
    <query name="CHECK_JUNGBOK2">        
        <![CDATA[
		    SELECT SALE_YM
		         , STR_CD
		         , ORDERER_CD
		         , PUMBUN_CD
		      FROM DPS.PS_COMMISONLINE
		     WHERE SALE_YM= ?
		       AND STR_CD = ?
		       AND ORDERER_CD = ?
		       AND PUMBUN_CD = ?
     ]]>        
    </query>
    
    <query name="SEL_DITAIL">        
        <![CDATA[
		    SELECT 'F' AS SEL
		         , '1'                              AS CONF_FLAG
			     , A.SALE_YM                        AS SALE_YM
		         , A.STR_CD                         AS STR_CD
			     , A.ORDERER_CD                     AS ORDERER_CD
			     , C.COMM_NAME1                     AS ORDERER_NM
			     , A.PUMBUN_CD                      AS PUMBUN_CD
			     , B.PUMBUN_NAME                    AS PUMBUN_NM
			     , (SELECT NVL(D.NORM_MG_RATE,0)
			          FROM DPS.PC_MARGINMST D
			         WHERE D.STR_CD = A.STR_CD
			           AND D.PUMBUN_CD = A.PUMBUN_CD
			           AND D.EVENT_FLAG = '00'         
			           AND D.EVENT_RATE = '00'
			           AND D.EVENT_CD = '00000000000'
			           AND D.APP_S_DT <= TO_CHAR(LAST_DAY(TO_DATE(A.SALE_YM, 'YYYYMM')), 'YYYYMMDD') 
			           AND D.APP_E_DT >= TO_CHAR(LAST_DAY(TO_DATE(A.SALE_YM, 'YYYYMM')), 'YYYYMMDD') 
			           AND ROWNUM = 1
			       )                                   AS MARIO_COMIS_RATE
			     , A.ORDERER_COMIS_RATE                AS ORDERER_COMIS_RATE
			     , A.MARIO_PROF_RATE                   AS MARIO_PROF_RATE
			     , A.AGENCY_PROF_RATE                  AS AGENCY_PROF_RATE
			  FROM DPS.PS_COMMISONLINE A
			     , DPS.PC_STRPBN B
			     , (
			        SELECT C.COMM_CODE
			             , C.COMM_NAME1
			          FROM COM.TC_COMMCODE C
			         WHERE C.SYS_PART = 'D'
			           AND C.COMM_PART = 'P613'
			           AND C.USE_YN = 'Y'
			       ) C
			 WHERE A.SALE_YM = ?             -- 매출월 
			   AND A.STR_CD = ?                  -- 점
			   AND A.PUMBUN_CD  LIKE ? || '%'          -- 브랜드
			   AND B.STR_CD = A.STR_CD
			   AND B.PUMBUN_CD = A.PUMBUN_CD
			   AND C.COMM_CODE = A.ORDERER_CD
    
    ]]>        
    </query>
   
    <query name="SEL_MARIO_PROF_RATE2">
        <![CDATA[
		    SELECT 'F' AS SEL
		         , A.STR_CD
			     , A.PUMBUN_CD
			     , B.PUMBUN_NAME
			     , A.SALE_YM
			     , A.MARIO_PROF_RATE
			     , '1' AS CONF_FLAG
			  FROM DPS.PS_COMMISONLINE A
			     , DPS.PC_STRPBN B
			 WHERE A.SALE_YM = ?        -- 매출월 
			   AND A.STR_CD = ?             -- 점
			   AND A.ORDERER_CD = '00000000'   
			   AND A.PUMBUN_CD  LIKE ? || '%'    -- 브랜드 
			   AND B.STR_CD = A.STR_CD
			   AND B.PUMBUN_CD = A.PUMBUN_CD
     ]]>
    </query>
    
    <query name="SEL_MASTER">        
        <![CDATA[
			 SELECT X.ORDERER_CD  AS ORDERER_NM
		          , X.ORDERER_NM  AS ORDERER_NM
		          , X.INQR_ORDER
		          , X.TITLE_NM1
		          , X.TITLE_NM2
		          , X.PUMBUN_CD
		          , X.PUMBUN_NM
		          , X.ORDERER_COMIS_RATE
		          , X.AGENCY_PROF_RATE
		       FROM (
		             SELECT A.ORDERER_CD     AS ORDERER_CD
		                  , ' 마리오'         AS ORDERER_NM
		                  , 0                AS INQR_ORDER
		                  , '수수료'         AS TITLE_NM1
		                  , '이익율'         AS TITLE_NM2
		                  , A.PUMBUN_CD      AS PUMBUN_CD 
		                  , B.PUMBUN_NAME    AS PUMBUN_NM
		                  , (
		                     SELECT NVL(C.NORM_MG_RATE,0)
								 				   FROM DPS.PC_MARGINMST C
								 				  WHERE C.STR_CD     = A.STR_CD            -- 점 
								 				    AND C.PUMBUN_CD  = A.PUMBUN_CD     -- 브랜드
		                         AND C.EVENT_FLAG = '00'         
		                         AND C.EVENT_RATE = '00'
		                         AND C.EVENT_CD   = '00000000000'
		                         AND C.APP_S_DT   <= TO_CHAR(LAST_DAY(TO_DATE(A.SALE_YM, 'YYYYMM')), 'YYYYMMDD') 
		                         AND C.APP_E_DT   >= TO_CHAR(LAST_DAY(TO_DATE(A.SALE_YM, 'YYYYMM')), 'YYYYMMDD') 
		                         AND ROWNUM = 1
		                    )                 AS ORDERER_COMIS_RATE
		                  , A.MARIO_PROF_RATE AS AGENCY_PROF_RATE
		               FROM DPS.PS_COMMISONLINE A
		                  , DPS.PC_STRPBN B
		              WHERE A.SALE_YM = ?
		                AND A.STR_CD = ?
		                AND A.ORDERER_CD = '00000000'
		                AND A.PUMBUN_CD  LIKE ? || '%'
		                AND B.STR_CD = A.STR_CD
		                AND B.PUMBUN_CD = A.PUMBUN_CD
		             UNION ALL
		             SELECT A.ORDERER_CD     AS ORDERER_CD
		                  , C.COMM_NAME1     AS ORDERER_NM
		                  , C.INQR_ORDER     AS INQR_ORDER 
		                  , '수수료'         AS TITLE_NM1
		                  , '인터파크이익율' AS TITLE_NM2
		                  , A.PUMBUN_CD      AS PUMBUN_CD
		                  , B.PUMBUN_NAME    AS PUMBUN_NM
		                  , A.ORDERER_COMIS_RATE AS ORDERER_COMIS_RATE
		                  , A.AGENCY_PROF_RATE   AS AGENCY_PROF_RATE
		               FROM DPS.PS_COMMISONLINE A
		                  , DPS.PC_STRPBN B
		                  , (
		                     SELECT C.COMM_CODE
		                          , C.COMM_NAME1
		                          , C.INQR_ORDER
		                       FROM COM.TC_COMMCODE C
		                      WHERE C.SYS_PART = 'D'
		                        AND C.COMM_PART = 'P613'
		                        AND C.USE_YN = 'Y'
		                    ) C
		              WHERE A.SALE_YM = ?
		                AND A.STR_CD = ?
		                AND A.ORDERER_CD LIKE ? || '%'
		                AND A.PUMBUN_CD  LIKE ? || '%'
		                AND B.STR_CD = A.STR_CD
		                AND B.PUMBUN_CD = A.PUMBUN_CD
		                AND C.COMM_CODE = A.ORDERER_CD
		          ) X
		      ORDER BY X.INQR_ORDER 
		             , X.PUMBUN_CD  
        ]]>        
    </query>
    <!-- KEYVALUE 체크 -->
    <query name="SEL_VATXYN">
        <![CDATA[
			SELECT COMM_CODE
			     , REFER_CODE
			  FROM COM.TC_COMMCODE 
			 WHERE SYS_PART  = 'D' 
			   AND COMM_PART = 'P618' 
			   AND COMM_CODE = ?
        ]]>
    </query>
    
  
    <query name="INS_MASTER">
        <![CDATA[
		   INSERT INTO DPS.PS_COMMISONLINE(                SALE_YM
                                                         , STR_CD
                                                         , ORDERER_CD
                                                         , PUMBUN_CD
                                                         , ORDERER_COMIS_RATE
                                                         , MARIO_PROF_RATE
                                                         , AGENCY_PROF_RATE
                                                         , REG_DATE
                                                         , REG_ID
                                                         , MOD_DATE
                                                         , MOD_ID
                                                         ) VALUES (
                                                            ?
                                                          , ?
                                                          , ?
                                                          , ?
                                                          , ?
                                                          , ?
                                                          , ?
                                                          , SYSDATE
                                                          , ?
                                                          , SYSDATE
                                                          , ?
                                                          )
		]]>
    </query>
    
    <query name="INS_DETAIL">
        <![CDATA[
    		INSERT INTO DPS.PS_COMMISONLINE(   SALE_YM
                                                         , STR_CD
                                                         , ORDERER_CD
                                                         , PUMBUN_CD
                                                         , ORDERER_COMIS_RATE
                                                         , MARIO_PROF_RATE
                                                         , AGENCY_PROF_RATE
                                                         , REG_DATE
                                                         , REG_ID
                                                         , MOD_DATE
                                                         , MOD_ID
                                                         ) VALUES (
                                                            ?
                                                          , ?
                                                          , '00000000'
                                                          , ?
                                                          , 0
                                                          , ?
                                                          , 0
                                                          , SYSDATE
                                                          , ?
                                                          , SYSDATE
                                                          , ?
                                                          )
    ]]>
    </query>
    
    
    <query name="UPD_MASTER">
        <![CDATA[
		    UPDATE  DPS.PS_COMMISONLINE
                SET ORDERER_CD = ?
                  , ORDERER_COMIS_RATE = ? 
                  , MARIO_PROF_RATE = ?
                  , AGENCY_PROF_RATE = ?
                  , MOD_DATE = SYSDATE
                  , MOD_ID = ?
              WHERE SALE_YM = ?
                AND STR_CD = ?
                AND ORDERER_CD = ?
                AND PUMBUN_CD =  ? 
    ]]>
    </query>
    
    <query name="UPD_DETAIL">
        <![CDATA[
        
		    UPDATE  DPS.PS_COMMISONLINE
                SET MARIO_PROF_RATE = ?
                  , MOD_DATE = SYSDATE
                  , MOD_ID = ?
              WHERE SALE_YM = ?
                AND STR_CD = ?
                AND ORDERER_CD = '00000000'
                AND PUMBUN_CD =  ?  
    
    ]]>
    </query>
    
    <query name="SEL_CHARGE">
        <![CDATA[
		    SELECT A.NORM_MG_RATE AS MARIO_COMIS_RATE
			  FROM DPS.PC_MARGINMST A
			 WHERE A.STR_CD = ?            -- 점 
			   AND A.PUMBUN_CD = ?     -- 브랜드
			   AND A.EVENT_FLAG = '00'         
			   AND A.EVENT_RATE = '00'
			   AND A.EVENT_CD = '00000000000'
			   AND A.APP_S_DT <= TO_CHAR(LAST_DAY(TO_DATE(?, 'YYYYMM')), 'YYYYMMDD') -- 매출월
			   AND A.APP_E_DT >= TO_CHAR(LAST_DAY(TO_DATE(?, 'YYYYMM')), 'YYYYMMDD') -- 매출월
			   AND ROWNUM = 1
    ]]>
    </query>
   
   
   <query name="SEL_MARIO_PROF_RATE">
        <![CDATA[
        	SELECT A.MARIO_PROF_RATE
			  FROM DPS.PS_COMMISONLINE A
			 WHERE A.SALE_YM = ?       -- 매출월 
			   AND A.STR_CD = ?             -- 점
			   AND A.ORDERER_CD = '00000000'   
			   AND A.PUMBUN_CD LIKE ? || '%'      -- 브랜드 
			   AND ROWNUM = 1
     ]]>
    </query>
    
    <query name="DEL_MASTER">
        <![CDATA[
        	DELETE DPS.PS_COMMISONLINE
                 WHERE SALE_YM = ?
                 AND  STR_CD= ?
                 AND ORDERER_CD = ?
                 AND PUMBUN_CD = ?
     ]]>
    </query>
    
    <query name="DEL_DETAIL">
        <![CDATA[
        	DELETE DPS.PS_COMMISONLINE
                 WHERE SALE_YM = ?
                 AND  STR_CD= ?
                 AND ORDERER_CD = '00000000'
                 AND PUMBUN_CD = ?
     ]]>
    </query>
    
</service>