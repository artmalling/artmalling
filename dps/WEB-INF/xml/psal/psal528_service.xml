<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 정진영
 * 회 사 명 : FKSS
 * 작 성 일 : 2010.03.29
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  단품엑셀업로드
 -->
<service name="/psal527.ps">
		
		
	<gauce name="CHECK"> 
        <column colName="ERR_CD"                 colType="TB_STRING"  size="10" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
       
    </gauce>
    <!-- 규격단품 그리드 -->
    <gauce name="H_MASTER"> 
    	
        <column colName="SEL"                      colType="TB_STRING"  size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORDERER_NM"               colType="TB_STRING"  size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_NAME"              colType="TB_STRING"  size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_YM"                  colType="TB_STRING"  size="6" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORDER_NO"                 colType="TB_STRING"  size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORDER_SEQ"                colType="TB_STRING"  size="3" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="RECIEVER"                 colType="TB_STRING"  size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUCHASER"                 colType="TB_STRING"  size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PRODUCT_CD"               colType="TB_STRING"  size="200" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PRODUCT_NM"               colType="TB_STRING"  size="200" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY"                      colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT"                      colType="TB_STRING"  size="18" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ERR_YN"                   colType="TB_STRING"  size="1" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ERR_MSG"                  colType="TB_STRING"  size="100" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CONF_FLAG"                colType="TB_STRING"  size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MAPPING_YN"               colType="TB_STRING"  size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SEQ_NO"                   colType="TB_DECIMAL" size="6"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SAVECHECK"                colType="TB_STRING"  size="1"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        
    </gauce>
                                              
    <gauce name="H_SKU2"> 
    	<column colName="SALE_YM"                  colType="TB_STRING"  size="6" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    	<column colName="STR_CD"                   colType="TB_STRING"  size="2"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    	<column colName="SEQ_NO"                   colType="TB_DECIMAL"  size="6"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />        
        <column colName="ORDERER_CD"               colType="TB_STRING"  size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORDERER_NM"               colType="TB_STRING"  size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORDER_NO"                 colType="TB_STRING"  size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORDER_SEQ"                colType="TB_STRING"  size="3" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_CD"                colType="TB_STRING"  size="6" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_NAME"              colType="TB_STRING"  size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUCHASER"                 colType="TB_STRING"  size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="RECIEVER"                 colType="TB_STRING"  size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PRODUCT_CD"               colType="TB_STRING"  size="200" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PRODUCT_NM"               colType="TB_STRING"  size="200" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY"                      colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT"                      colType="TB_STRING"  size="18" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ERR_YN"                 colType="TB_STRING"  size="1" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ERR_MSG"                colType="TB_STRING"  size="100" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REG_DATE"                 colType="TB_STRING"  size="100" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REG_ID"                   colType="TB_STRING"  size="100" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_DATE"                 colType="TB_STRING"  size="100" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_ID"                   colType="TB_STRING"  size="10" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    	 
    </gauce> 
    
    
    <!--  -->
    <query name="SEL_STN_SKU">
        <![CDATA[                                        
            SELECT CASE  WHEN (SELECT COUNT(1) 
                                      FROM COM.TC_COMMCODE 
                                    WHERE COMM_PART='P613'
                                         AND COMM_NAME1 = ? 
                             ) = 0                               THEN '001'                   /*주문처  검증*/
                        WHEN (SELECT COUNT(1)
                                     FROM COM.TC_COMMCODE 
                                   WHERE COMM_PART= 'P614' 
                                       AND COMM_NAME2 = ?
                             ) = 0                               THEN '002'                   /*브랜드 검증*/
                        WHEN ( SELECT COUNT(*)
                                    FROM  DPS.PS_MONTHONLINE A
                                   WHERE STR_CD = ?
                                     AND   SALE_YM = ?
                                     AND   ORDERER_CD =  ( SELECT COMM_CODE
                                                                              FROM COM.TC_COMMCODE 
                                                                            WHERE COMM_PART='P613'
                                                                              AND COMM_NAME1 = ? )
                                     AND   ORDER_NO = ?
                                     AND   PRODUCT_CD = ? 
                                      ) !=0 THEN   '003'
                        ELSE '000'
                   END                               AS ERR_CD
             FROM DUAL
        ]]>
    </query>
    <query name="SEL_STN_SKU_ORDER">
        <![CDATA[
             ORDER BY ERR_YN, BARCODE
        ]]>
    </query>
    <query name="INS_ONLINE">
        <![CDATA[
			INSERT INTO DPS.PS_MONTHONLINE  (              SALE_YM      --매출일자                         
                                                         , STR_CD      --점코드                            
                                                         , SEQ_NO                                          
                                                         , ORDERER_CD  --주문처명으로 코드 가져오          
                                                         , ORDERER_NM       --주문처명                     
                                                         , ORDER_NO         --주문번호                     
                                                         , ORDER_SEQ        --주문순번                     
                                                         , PUMBUN_CD        --품번코드                     
                                                         , PUMBUN_NAME      --품번명                       
                                                         , PUCHASER         --구매자                       
                                                         , RECIEVER         --수취인                       
                                                         , PRODUCT_CD   --                                 
                                                         , PRODUCT_NM      --상품 명                       
                                                         , QTY              --수량                         
                                                         , AMT               --금액                        
                                                         , ERR_YN                                          
                                                         , ERR_MSG   
                                                         , CONF_FLAG                               
                                                         , REG_DATE        --등록일시                      
                                                         , REG_ID             --등록자                     
                                                         , MOD_DATE           --수정일시                   
                                                         , MOD_ID                --수정자                  
                                                         ) VALUES       --38   
                                                        (                                                                                                                                                                    
                                                           ?                                                                                                                                                        
                                                         , ?                                                                                                                                                            
                                                         , ?                                                                                                                                                             
                                                         , ( SELECT COMM_CODE FROM COM.TC_COMMCODE WHERE COMM_PART='P613' AND COMM_NAME1= ? )                                                                         
                                                         , ?                                                                                                                                                          
                                                         , ?                                                                                                                                                      
                                                         , NVL(? , 1)                                                                                                                                                                       
                                                         , ( SELECT REFER_CODE   FROM COM.TC_COMMCODE   WHERE COMM_PART='P614' AND COMM_NAME2=? )                                                                 
                                                         , ?                                                                                                                                                      
                                                         , ?                                                                                                                                                        
                                                         , ?                                                                                                                                                        
                                                         , ?                                                                                                                                                  
                                                         , ?                                                                                                                                        
                                                         , ?                                                                                                                                                             
                                                         , ?  
                                                         , ?                                                                                                                                                       
                                                         , ?                                                                                                                                                             
                                                         , ?                                                                                                                                                               
                                                         , SYSDATE                                                                                                                                                         
                                                         , ?                                                                                                                                                               
                                                         , SYSDATE                                                                                                                                                         
                                                         , ?                                                                                                                                                              
                                                         )       
        ]]>
    </query>
     
    <query name="DEL_MASTER">
        <![CDATA[
		    DELETE  DPS.PS_MONTHONLINE WHERE STR_CD = ?
                                               AND SALE_YM= ?
                                               AND SEQ_NO = ?
                                               AND ORDERER_NM= ?
                                               AND PRODUCT_CD= ?
                                               AND PUMBUN_NAME= ?
                                               AND ORDER_SEQ = ?
        ]]>
    </query>
     <!-- 단품  마스터 신규 입력  -->
    <query name="SEL_SEQNO">
        <![CDATA[
	    SELECT NVL(MAX(SEQ_NO) + 1,1) AS SEQ_NO  
	      FROM DPS.PS_MONTHONLINE
        
        ]]>
    </query>
    
     <!-- 확정 처리  -->
    <query name="UPDATECONFFLAG">
        <![CDATA[
		    UPDATE DPS.PS_MONTHONLINE SET CONF_FLAG = ?
							        WHERE STR_CD = ?
							          AND SALE_YM= ?
							          AND SEQ_NO = ?
							          AND ORDERER_NM= ?
							          AND PRODUCT_CD= ?
							          AND PUMBUN_NAME= ?
							          AND ORDER_SEQ = ?
        ]]>
    </query>
    
    
    <query name="SEL_PLANTEAMYY">
        <![CDATA[
	    SELECT 'F'  AS SEL                                        
                 , ORDERER_NM       --주문처명                     
                 , PUMBUN_NAME      --품번명                       
                 , SALE_YM          --매출일자    
                 , ORDER_NO                                        
                 , ORDER_SEQ        --주문번호                     
                 , RECIEVER         --수취인                       
                 , PUCHASER         --구매자                       
                 , PRODUCT_CD        --품번코드                     
                 , PRODUCT_NM      --상품 명                       
                 , QTY              --수량                         
                 , AMT               --금액                       
                 , ERR_YN                                          
                 , ERR_MSG 
                 , CONF_FLAG  
                 , MAPPING_YN
                 , SEQ_NO     
                 , 'Y' AS SAVECHEK           
          FROM DPS.PS_MONTHONLINE
           WHERE   STR_CD= ?
             AND   SALE_YM=?
             AND   ERR_YN LIKE ?||'%'
        ]]>
    </query>
    
        
</service>

