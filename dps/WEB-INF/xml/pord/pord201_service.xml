<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자    : 박래형
 * 회 사 명    : FKSS
 * 작 성 일    : 2010.02.10
 * 변 경 일    : 
 * 변경내용 : 
 * 개    요       :  
 --> 
<service name="/pord201.po">
    <!-- 입고/반품  리스트 -->
    <gauce name="H_LIST"> 
        <column colName="CHECK1"              colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SLIP_NO"             colType="TB_STRING"     size="12"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="STR_CD"              colType="TB_STRING"     size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="STR_NM"              colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SLIP_FLAG"           colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SLIP_FLAG_NM"        colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORD_DT"              colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SLIP_PROC_STAT"      colType="TB_STRING"     size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SLIP_PROC_STAT_NM"   colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REJ_CAN_FLAG"        colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_CD"           colType="TB_STRING"     size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_NM"           colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="VEN_CD"              colType="TB_STRING"     size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="VEN_NM"              colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COST_TAMT"           colType="TB_DECIMAL"    size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_TAMT"           colType="TB_DECIMAL"    size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>

    <!-- 매입발주 MASTER --> 
    <gauce name="H_MASTER"> 
        <column colName="STR_CD"              colType="TB_STRING"     size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STR_NM"              colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SLIP_NO"             colType="TB_STRING"     size="12"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_CD"           colType="TB_STRING"     size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="PUMBUN_NM"           colType="TB_STRING"     size="20"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="VEN_CD"              colType="TB_STRING"     size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="VEN_NM"              colType="TB_STRING"     size="20"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="MG_APP_DT"           colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="EVENT_FLAG"          colType="TB_STRING"     size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="EVENT_FLAG_NM"       colType="TB_STRING"     size="20"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="EVENT_RATE"          colType="TB_STRING"     size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="SLIP_FLAG"           colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="SLIP_FLAG_NM"        colType="TB_STRING"     size="20"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="ORD_OWN_FLAG"        colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="ORD_OWN_FLAG_NM"     colType="TB_STRING"     size="30"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="ORD_FLAG"            colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="AFT_ORD_FLAG"        colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="ORD_DT"              colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="DELI_DT"             colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SM_CONF_DT"          colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="SM_ID"               colType="TB_STRING"     size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BUYER_CONF_ID"       colType="TB_STRING"     size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORD_CONF_DT"         colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />      
        <column colName="BUYER_CD"            colType="TB_STRING"     size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="BUYER_NM"            colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />      
        <column colName="ACC_CONF_DT"         colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />        
        <column colName="SLIP_PROC_STAT"      colType="TB_STRING"     size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />      
        <column colName="SLIP_PROC_STAT_NM"   colType="TB_STRING"     size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />      
        <column colName="DTL_CNT"             colType="TB_DECIMAL"    size="3"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORD_TOT_QTY"         colType="TB_DECIMAL"    size="9"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NEW_COST_TAMT"       colType="TB_DECIMAL"    size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NEW_SALE_TAMT"       colType="TB_DECIMAL"    size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="GAP_TOT_AMT"         colType="TB_DECIMAL"    size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="NEW_GAP_RATE"        colType="TB_DECIMAL"    size="5"    dec="2" keyType="TB_NORMAL" roundMode="ROUND" />      
        <column colName="PAY_COND"            colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />      
        <column colName="REMARK"              colType="TB_STRING"     size="100"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />      
        <column colName="BIZ_TYPE"            colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAX_FLAG"            colType="TB_STRING"     size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAX_FLAG_NM"         colType="TB_STRING"     size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REG_DATE"            colType="TB_STRING"     size="20"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REG_ID"              colType="TB_STRING"     size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_DATE"            colType="TB_STRING"     size="20"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_ID"              colType="TB_STRING"     size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="ORD_CF_DT"           colType="TB_STRING"     size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="MG_RATE"             colType="TB_DECIMAL"    size="5"    dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <!-- 매입발주 Detail -->   
    <gauce name="H_DETAIL"> 
         <column colName="CHECK1"              colType="TB_STRING"    size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="STR_CD"              colType="TB_STRING"    size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="SLIP_NO"             colType="TB_STRING"    size="12"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="ORD_SEQ_NO"          colType="TB_DECIMAL"   size="3"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="PUMMOK_CD"           colType="TB_STRING"    size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />   
         <column colName="PUMMOK_NM"           colType="TB_STRING"    size="20"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="ORD_UNIT_CD"         colType="TB_STRING"    size="3"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                            
         <column colName="MG_RATE"             colType="TB_DECIMAL"   size="5"    dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="SLIP_FLAG"           colType="TB_STRING"    size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="ORD_QTY"             colType="TB_DECIMAL"   size="9"    dec="1" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="NEW_GAP_RATE"        colType="TB_DECIMAL"   size="5"    dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="NEW_GAP_AMT"         colType="TB_DECIMAL"   size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
         <column colName="NEW_COST_PRC"        colType="TB_DECIMAL"   size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                           
         <column colName="NEW_COST_AMT"        colType="TB_DECIMAL"   size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                           
         <column colName="NEW_SALE_PRC"        colType="TB_DECIMAL"   size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                           
         <column colName="NEW_SALE_AMT"        colType="TB_DECIMAL"   size="13"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                                
         <column colName="PUMBUN_CD"           colType="TB_STRING"    size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
         <column colName="VEN_CD"              colType="TB_STRING"    size="6"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
         <column colName="TAG_FLAG"            colType="TB_STRING"    size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
         <column colName="TAG_FLAG_NM"         colType="TB_STRING"    size="30"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                               
         <column colName="TAG_PRT_OWN_FLAG"    colType="TB_STRING"    size="1"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                               
         <column colName="TAG_PRT_OWN_FLAG_NM" colType="TB_STRING"    size="20"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                       
         <column colName="REG_DATE"            colType="TB_STRING"    size="20"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                               
         <column colName="REG_ID"              colType="TB_STRING"    size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                                 
         <column colName="MOD_DATE"            colType="TB_STRING"    size="20"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                                               
         <column colName="MOD_ID"              colType="TB_STRING"    size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
    </gauce>
    
    <!-- 행사구분 --> 
    <gauce name="H_MARGIN_FLAG"> 
        <column colName="EVENT_FLAG"           colType="TB_STRING"    size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="EVENT_FLAG_NM"        colType="TB_STRING"    size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
    </gauce>                                                                      
                                                                                  
    <!-- 행사율-->                                                                   
    <gauce name="H_MARGIN_RATE">                                                  
        <column colName="EVENT_RATE"           colType="TB_STRING"    size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="EVENT_RATE_NM"        colType="TB_STRING"    size="10"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="NORM_MG_RATE"         colType="TB_STRING"    size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
    </gauce>                                                                      
                                                                                  
    <!-- 품목코드 정보-->                                                               
    <gauce name="H_PUMMOK_INFO">                                                  
        <column colName="PUMMOK_CD"            colType="TB_STRING"    size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>                                                                  
                                                                                  
    <!-- 품목코드 정보-->                                                               
    <gauce name="H_PUMMOK_INFO">                                                  
        <column colName="PUMMOK_CD"            colType="TB_STRING"    size="8"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>                                                              
                                                                                  
    <!-- 현재전표상태-->                                                               
    <gauce name="H_CHK_STRPROCSTAT">                                                  
        <column colName="SLIP_PROC_STAT"       colType="TB_STRING"    size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SLP_LN_STAT"          colType="TB_STRING"    size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SLIP_PROC_STAT_NM"    colType="TB_STRING"    size="40"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CONF_YN"              colType="TB_STRING"    size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CANCEL_CONF_YN"       colType="TB_STRING"    size="2"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <!-- 품목 매입발주  리스트 조회 -->
    <query name="SEL_LIST">
        <![CDATA[
            SELECT 'F'               AS  CHECK1
                 , A.SLIP_NO                                                                         /* 전표번호 */
                 , A.STR_CD                                                                          /* 점코드 */
                 , DPS.FN_GET_STORE_NAME(A.STR_CD) AS STR_NM                                         /* 점명 */
                 , A.SLIP_FLAG                                                                       /* 전표구분 */
                 , COM.FN_GET_COMM_NAME('D', 'P201', A.SLIP_FLAG) AS  SLIP_FLAG_NM                   /* 전표구분명 */
                 , A.ORD_DT                                                                          /* 발주일자(점출일, 시행일) */
                 , A.SLIP_PROC_STAT                                                                  /* 전표진행상태 */
                 , COM.FN_GET_COMM_NAME('D', 'P207', A.SLIP_PROC_STAT) AS  SLIP_PROC_STAT_NM         /* 전표진행상태명 */
                 , A.REJ_CAN_FLAG  
                 , A.PUMBUN_CD
                 , DPS.FN_GET_PUMBUN_NAME(A.PUMBUN_CD) AS PUMBUN_NM                                  /* 품번명 */
                 , A.VEN_CD
                 , DPS.FN_GET_VENDOR_NAME(A.VEN_CD)    AS VEN_NM                                     /* 협력사명 */
                 , A.COST_TAMT
                 , A.SALE_TAMT
            FROM (    
                  SELECT SLP.SLIP_NO                                                                        
                       , SLP.STR_CD                                                                          
                       , SLP.SLIP_FLAG                                                                      
                       , SLP.ORD_DT                          
                       , SLP.DELI_DT                          
                       , SLP.CHK_DT                         
                       , SLP.SLIP_PROC_STAT                                                                  
                       , (CASE PBN.BIZ_TYPE WHEN '1' THEN SLP.ORD_CONF_DT 
                                            WHEN '2' THEN SLP.BTEAM_CONF_DT END) AS CONF_DT
                       , PBN.SALE_ORG_CD
                       , PBN.BUY_ORG_CD
                       , SLP.REJ_CAN_FLAG
                       , SLP.ORD_CF_DT
                       , SLP.PUMBUN_CD
                       , SLP.VEN_CD
                       , SUM(DECODE(SLP.SLIP_PROC_STAT, '09', SLP.CHK_COST_TAMT, SLP.NEW_COST_TAMT))    
                         *
                         (CASE WHEN SLP.SLIP_FLAG IN('A','D','F','G') THEN 1 
                                                                        ELSE (-1) 
                         END)
                       AS COST_TAMT
                       , SUM(DECODE(SLP.SLIP_PROC_STAT, '09', SLP.CHK_SALE_TAMT, SLP.NEW_SALE_TAMT))    
                         *
                         (CASE WHEN SLP.SLIP_FLAG IN('A','D','F','G') THEN 1 
                                                                        ELSE (-1) 
                         END)
                       AS SALE_TAMT
                    FROM  DPS.PO_SLPMST SLP, DPS.PC_STRPBN PBN
                   WHERE ( ( SLP.SLIP_FLAG = 'A' 
                     AND SLP.SLIP_PROC_STAT IN (SELECT COMM_CODE 
                                                  FROM COM.TC_COMMCODE
                                                 WHERE COMM_PART = 'P207'
                                                   AND COMM_CODE BETWEEN  DPS.FN_CONF_RANGE('2','A','01')   AND '01'  ))
                     OR (SLP.SLIP_FLAG = 'B' 
                     AND SLP.SLIP_PROC_STAT IN (SELECT COMM_CODE 
                                                  FROM COM.TC_COMMCODE
                                                 WHERE COMM_PART = 'P207'
                                                   AND COMM_CODE BETWEEN  DPS.FN_CONF_RANGE('2','B','01')   AND '01'  )))
                     AND SLP.DEL_FLAG  = 'N'
                     AND PBN.SKU_FLAG  = '2'   
                     AND SLP.IMPORT_FLAG  = '0'
                     AND SLP.AUTO_SLIP_FLAG = '0'
                     AND SLP.STR_CD    = PBN.STR_CD
                     AND SLP.PUMBUN_CD = PBN.PUMBUN_CD
                     AND SLP.SLIP_PROC_STAT LIKE '%' || DECODE(?,'Y','01') || '%'
                     AND SLP.PUMBUN_CD      LIKE ? || '%'
                     AND SLP.VEN_CD         LIKE ? || '%'
                     AND SLP.SLIP_FLAG      LIKE ? || '%'
                     AND EXISTS ( SELECT MYORG.USER_ID
                                    FROM COM.V_MYORG MYORG
                                   WHERE MYORG.STR_CD      = SLP.STR_CD
                                     AND MYORG.PUMBUN_CD   = SLP.PUMBUN_CD
                                     AND MYORG.USER_ID     = ?
                                     AND ROWNUM            = 1
                                     AND MYORG.ORG_FLAG    = ?
                                 )
                   GROUP BY SLP.SLIP_NO                                                                        
                          , SLP.STR_CD                                                                          
                          , SLP.SLIP_FLAG                                                                      
                          , SLP.ORD_DT                          
                          , SLP.DELI_DT                          
                          , SLP.CHK_DT                         
                          , SLP.SLIP_PROC_STAT                                                                  
                          , (CASE PBN.BIZ_TYPE WHEN '1' THEN SLP.ORD_CONF_DT 
                                               WHEN '2' THEN SLP.BTEAM_CONF_DT END)
                          , PBN.SALE_ORG_CD
                          , PBN.BUY_ORG_CD
                          , SLP.REJ_CAN_FLAG
                          , SLP.ORD_CF_DT
                          , SLP.PUMBUN_CD
                          , SLP.VEN_CD
                    ) A
        ]]>
    </query> 
    
    <!-- 품목 SM승인  리스트 조회 -->
    <query name="SEL_SLIP_NO">
        <![CDATA[
	        SELECT 'F'               AS  CHECK1
                 , A.SLIP_NO                                                                         /* 전표번호 */
                 , A.STR_CD                                                                          /* 점코드 */
                 , DPS.FN_GET_STORE_NAME(A.STR_CD) AS STR_NM                                         /* 점명 */
                 , A.SLIP_FLAG                                                                       /* 전표구분 */
                 , COM.FN_GET_COMM_NAME('D', 'P201', A.SLIP_FLAG) AS  SLIP_FLAG_NM                   /* 전표구분명 */
                 , A.ORD_DT                                                                          /* 발주일자(점출일, 시행일) */
                 , A.SLIP_PROC_STAT                                                                  /* 전표진행상태 */
                 , COM.FN_GET_COMM_NAME('D', 'P207', A.SLIP_PROC_STAT) AS  SLIP_PROC_STAT_NM         /* 전표진행상태명 */
                 , A.REJ_CAN_FLAG  
                 , A.PUMBUN_CD
                 , DPS.FN_GET_PUMBUN_NAME(A.PUMBUN_CD) AS PUMBUN_NM                                  /* 품번명 */
                 , A.VEN_CD
                 , DPS.FN_GET_VENDOR_NAME(A.VEN_CD)    AS VEN_NM                                     /* 협력사명 */
                 , A.COST_TAMT
                 , A.SALE_TAMT
	        FROM (    
	              SELECT SLP.SLIP_NO                                                                        
	                   , SLP.STR_CD                                                                          
	                   , SLP.SLIP_FLAG                                                                      
	                   , SLP.ORD_DT                          
	                   , SLP.DELI_DT                          
	                   , SLP.CHK_DT                         
	                   , SLP.SLIP_PROC_STAT                                                                  
	                   , (CASE PBN.BIZ_TYPE WHEN '1' THEN SLP.ORD_CONF_DT 
	                                        WHEN '2' THEN SLP.BTEAM_CONF_DT END) AS CONF_DT
	                   , PBN.SALE_ORG_CD
	                   , PBN.BUY_ORG_CD
                       , SLP.REJ_CAN_FLAG
                       , SLP.PUMBUN_CD
                       , SLP.VEN_CD
                       , SUM(DECODE(SLP.SLIP_PROC_STAT, '09', SLP.CHK_COST_TAMT, SLP.NEW_COST_TAMT))    
                         *
                         (CASE WHEN SLP.SLIP_FLAG IN('A','D','F','G') THEN 1 
                                                                        ELSE (-1) 
                         END)
                       AS COST_TAMT
                       , SUM(DECODE(SLP.SLIP_PROC_STAT, '09', SLP.CHK_SALE_TAMT, SLP.NEW_SALE_TAMT))    
                         *
                         (CASE WHEN SLP.SLIP_FLAG IN('A','D','F','G') THEN 1 
                                                                        ELSE (-1) 
                         END)
                       AS SALE_TAMT
	                FROM  DPS.PO_SLPMST SLP, DPS.PC_STRPBN PBN
	               WHERE ( ( SLP.SLIP_FLAG = 'A' 
	                 AND SLP.SLIP_PROC_STAT IN (SELECT COMM_CODE 
	                                              FROM COM.TC_COMMCODE
	                                             WHERE COMM_PART = 'P207'
	                                               AND COMM_CODE BETWEEN  DPS.FN_CONF_RANGE('2','A','01')   AND '01'  ))
	                 OR (SLP.SLIP_FLAG = 'B' 
	                 AND SLP.SLIP_PROC_STAT IN (SELECT COMM_CODE 
	                                              FROM COM.TC_COMMCODE
	                                             WHERE COMM_PART = 'P207'
	                                               AND COMM_CODE BETWEEN  DPS.FN_CONF_RANGE('2','B','01')   AND '01'  )))
	                 AND SLP.DEL_FLAG  = 'N'
	                 AND PBN.SKU_FLAG  = '2'   
	                 AND SLP.IMPORT_FLAG  = '0'
                     AND SLP.AUTO_SLIP_FLAG = '0'
	                 AND SLP.STR_CD    = PBN.STR_CD
	                 AND SLP.PUMBUN_CD = PBN.PUMBUN_CD
	                 AND SLP.STR_CD    = ?
	                 AND SLP.SLIP_NO   = ?
	                 AND EXISTS ( SELECT MYORG.USER_ID
	                                FROM COM.V_MYORG MYORG
	                               WHERE MYORG.STR_CD      = SLP.STR_CD
	                                 AND MYORG.PUMBUN_CD   = SLP.PUMBUN_CD
	                                 AND MYORG.USER_ID     = ?
	                                 AND ROWNUM            = 1
	                                 AND MYORG.ORG_FLAG    = ?
	                             )
                   GROUP BY SLP.SLIP_NO                                                                        
                          , SLP.STR_CD                                                                          
                          , SLP.SLIP_FLAG                                                                      
                          , SLP.ORD_DT                          
                          , SLP.DELI_DT                          
                          , SLP.CHK_DT                         
                          , SLP.SLIP_PROC_STAT                                                                  
                          , (CASE PBN.BIZ_TYPE WHEN '1' THEN SLP.ORD_CONF_DT 
                                               WHEN '2' THEN SLP.BTEAM_CONF_DT END)
                          , PBN.SALE_ORG_CD
                          , PBN.BUY_ORG_CD
                          , SLP.REJ_CAN_FLAG
                          , SLP.ORD_CF_DT
                          , SLP.PUMBUN_CD
                          , SLP.VEN_CD
	                ) A
        ]]>
    </query>
    
     <query name="SEL_BUY_ORG_CD">
        <![CDATA[
               WHERE  A.BUY_ORG_CD   LIKE ? || '%'
        ]]>
    </query>
    <query name="SEL_SALE_ORG_CD">
        <![CDATA[
               WHERE A.SALE_ORG_CD   LIKE ? || '%'
        ]]>
    </query>
     <query name="SEL_NON_CONF">
        <![CDATA[
               AND  A.SLIP_PROC_STAT   <>  '01'
        ]]>
    </query>
    <query name="SEL_ORD_DT">
        <![CDATA[
               AND A.ORD_DT BETWEEN ? AND ?
        ]]>
    </query>
    <query name="SEL_ORD_CONF">
        <![CDATA[
               AND A.ORD_CF_DT BETWEEN ? AND ?
        ]]>
    </query>
    <query name="SEL_DELI_DT">
        <![CDATA[
               AND A.DELI_DT BETWEEN ? AND ?
        ]]>
    </query>
    <query name="SEL_CHK_DT">
        <![CDATA[
               AND A.CHK_DT BETWEEN ? AND ?
        ]]>
    </query>
    
    <query name="SEL_ORDERBY">
        <![CDATA[
               AND A.STR_CD = ?
          ORDER BY A.STR_CD, A.SLIP_NO DESC
        ]]>
    </query>
    
    
    <!-- 품목 매입발주  마스터 조회 -->
    <query name="SEL_MASTER">
        <![CDATA[
            SELECT A.STR_CD           
                 , DPS.FN_GET_STORE_NAME(STR_CD) AS STR_NM                  
                 , A.SLIP_NO          
                 , A.PUMBUN_CD        
                 , DPS.FN_GET_PUMBUN_NAME(A.PUMBUN_CD) AS PUMBUN_NM    
                 , A.VEN_CD           
                 , DPS.FN_GET_VENDOR_NAME(A.VEN_CD) AS VEN_NM   
                 , A.MG_APP_DT                     
                 , A.EVENT_FLAG      
                 , A.EVENT_FLAG     AS EVENT_FLAG_NM
                 , A.EVENT_RATE  
                 , A.SLIP_FLAG        
                 , COM.FN_GET_COMM_NAME('D', 'P201', A.SLIP_FLAG)  AS  SLIP_FLAG_NM                /* 전표구분명 */
                 , A.ORD_OWN_FLAG
                 , COM.FN_GET_COMM_NAME('D', 'P202', ORD_OWN_FLAG) AS ORD_OWN_FLAG_NM              /* 발주주체구분명 */
                 , A.ORD_FLAG
                 , A.AFT_ORD_FLAG   
                 , A.ORD_DT           
                 , A.DELI_DT      
                 , A.SM_CONF_DT      
                 , A.SM_ID      
                 , A.BUYER_CONF_ID  
                 , A.ORD_CONF_DT  
                 , A.BUYER_CD        
                 , DPS.FN_GET_BUYER_NAME(A.BUYER_CD) AS BUYER_NM  
                 , A.ACC_CONF_DT 
                 , A.SLIP_PROC_STAT 
                 , COM.FN_GET_COMM_NAME('D', 'P207', SLIP_PROC_STAT) AS  SLIP_PROC_STAT_NM         /* 전표진행상태명 */
                 , A.DTL_CNT           
                 , A.ORD_TOT_QTY
                 , A.NEW_COST_TAMT     
                 , A.NEW_SALE_TAMT 
                 , A.GAP_TOT_AMT     
                 , A.NEW_GAP_RATE 
                 , A.PAY_COND   
                 , A.REMARK    
                 , A.BIZ_TYPE          
                 , A.TAX_FLAG
                 , COM.FN_GET_COMM_NAME('D', 'P004', TAX_FLAG) AS TAX_FLAG_NM                      /* 과세구분명 */                   
                 , TO_CHAR(A.REG_DATE, 'YYYYMMDD')             AS REG_DATE        
                 , A.REG_ID          
                 , A.MOD_DATE        
                 , A.MOD_ID 
                 , A.ORD_CF_DT             
                 , (
                    SELECT MAX(MG_RATE)
                      FROM DPS.PO_SLPDTL B
                     WHERE B.STR_CD  = A.STR_CD
                       AND B.SLIP_NO = A.SLIP_NO  
                    )              AS MG_RATE    
              FROM DPS.PO_SLPMST   A            
             WHERE A.STR_CD = ?
               AND A.SLIP_NO = ? 
        ]]>
    </query> 
    
    <!-- 품목 매입발주 디테일 조회 -->
    <query name="SEL_DETAIL">
        <![CDATA[
            SELECT ''               AS  CHECK1
                 , STR_CD                                           /*점코드*/
                 , SLIP_NO                                          /*전표번호*/
                 , ORD_SEQ_NO                                       /*전표상세번호*/
                 , PUMMOK_CD                                        /*품목코드*/
                 , DPS.FN_GET_PUMMOK_NAME(PUMMOK_CD) AS  PUMMOK_NM                   /*품목코드*/
                 , ORD_UNIT_CD                                      /*발주단위*/
                 , MG_RATE                                          /*마진율*/
                 , SLIP_FLAG                                        /*전표구분*/
                 , ORD_QTY                                          /*발주수량*/
                 , NEW_GAP_RATE                                     /*신차익율*/
                 , NEW_GAP_AMT                                      /*신차익액*/
                 , NEW_COST_PRC                                     /*신원가단가*/
                 , NEW_COST_AMT                                     /*신원가금액*/
                 , NEW_SALE_PRC                                     /*신매가단가*/
                 , NEW_SALE_AMT                                     /*신매가금액*/
                 , PUMBUN_CD                                        /**/
                 , VEN_CD                                           /**/
                 , TAG_FLAG                                         /*택구분*/
                 , TAG_FLAG         AS TAG_FLAG_NM                  /*택구분명*/
                 , TAG_PRT_OWN_FLAG                                 /*택발행주체*/
                 , TAG_PRT_OWN_FLAG AS TAG_PRT_OWN_FLAG_NM          /*택발행주체명*/
                 , REG_DATE                                         /*등록일시*/
                 , REG_ID                                           /*등록자*/
                 , MOD_DATE                                         /*수정일시*/
                 , MOD_ID                                           /*수정자*/
              FROM DPS.PO_SLPDTL      
             WHERE STR_CD  = ?
               AND SLIP_NO = ? 
        ]]>
    </query> 
    
   
    <!-- 품목 매입발주 MASTER SM확정 업데이트  -->
    <query name="UPD_MASTER_CONF">
        <![CDATA[
            UPDATE DPS.PO_SLPMST 
               SET SM_CONF_DT     = ?
                 , SM_ID          = ?
                 , SLIP_PROC_STAT = ?
                 , REJ_CAN_FLAG   = DECODE(REJ_CAN_STAT, '01', '0', REJ_CAN_FLAG)   
                 , REJ_CAN_STAT   = DECODE(REJ_CAN_STAT, '01', '', REJ_CAN_STAT)
                 , ORD_CF_DT      = DECODE('01', DPS.FN_GET_ORDCONF_CHK('2', ?), ?, '        ')
                 , MOD_ID         = ?
                 , MOD_DATE       = SYSDATE
             WHERE STR_CD         = ?
               AND SLIP_NO        = ?
        ]]>
    </query>   
    
   
    <!-- 품목 매입발주 MASTER SM취소반려 업데이트  -->
    <query name="UPD_MASTER_CAN">
        <![CDATA[
            UPDATE DPS.PO_SLPMST 
               SET SM_CONF_DT     = ?
                 , SM_ID          = ?
                 , ORD_CF_DT      = '        '    /*발주확정일*/
                 , SLIP_PROC_STAT = ?
                 , REJ_CAN_FLAG   = DECODE(SLIP_PROC_STAT, '01', '2', '1')
                 , REJ_CAN_STAT   = ?
                 , MOD_ID         = ?
                 , MOD_DATE       = SYSDATE
             WHERE STR_CD         = ?
               AND SLIP_NO        = ?
        ]]>
    </query>   
    
      <!-- 품목  매입발주 LOG 전표진행 업데이트 -->
    <query name="UPD_SLPMSTLG_CONF">
        <![CDATA[
            UPDATE DPS.PO_SLPMSTLG
               SET SLIP_PROC_STAT = ?
             WHERE STR_CD = ?
               AND SLIP_NO = ?
        ]]>
    </query>          
    
     
    <!-- 품목코드 조회-->
    <query name="SEL_PUMMOK_INFO">
        <![CDATA[
           SELECT A.PUMMOK_CD
             FROM DPS.PC_PMKMST A
                , DPS.PC_PBNPMK B
            WHERE B.PUMMOK_CD = A.PUMMOK_CD
              AND B.PUMBUN_CD = ?
              AND A.PUMMOK_CD   LIKE ? ||'%' 
        ]]>
    </query>         
    
     
    <!-- 현재전표상태-->
    <query name="SEL_CHK_STRPROCSTAT">
        <![CDATA[
			SELECT A.SLIP_PROC_STAT
			     , DPS.FN_CONF_RANGE(A.BIZ_TYPE, A.SLIP_FLAG, '01')    AS SLP_LN_STAT
			     , COM.FN_GET_COMM_NAME('D', 'P207', A.SLIP_PROC_STAT) AS SLIP_PROC_STAT_NM
			     , CASE WHEN A.SLIP_PROC_STAT >= DPS.FN_CONF_RANGE(A.BIZ_TYPE, A.SLIP_FLAG, '01')
			             AND A.SLIP_PROC_STAT < 01 THEN 'Y'
			             ELSE 'N'
			       END   AS CONF_YN
			     , CASE WHEN A.SLIP_PROC_STAT = '01' THEN 'Y'
			             ELSE 'N'
			       END   AS CANCEL_CONF_YN
			  FROM DPS.PO_SLPMST A
			 WHERE A.STR_CD  = ?
			   AND A.SLIP_NO = ?
        ]]>
    </query>         
   
</service>