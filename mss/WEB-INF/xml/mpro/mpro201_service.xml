<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 정지인
 * 회 사 명 : 한국후지쯔
 * 작 성 일 : 2011.03.03
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  개발팀에서 기입해주세요
 -->
<service name="/mpro201.mp">
    <!-- 약속대장  -->
    <gauce name="H_PROMI_CALENDAL">
        <column colName="DAYS" colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PROMISS" colType="TB_STRING" size="10" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <!-- 약속 목록 -->
    <gauce name="H_MASTER"> 
        <column colName="TAKE_DT"           colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STR_CD"            colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAKE_SEQ"          colType="TB_STRING" size="5" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAKE_USER_ID"      colType="TB_STRING" size="10" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAKE_USER_NM"      colType="TB_STRING" size="10" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUST_NM"           colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="POST_NO"           colType="TB_STRING" size="6" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUST_POST_SEQ"     colType="TB_STRING" size="5" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ADDR"              colType="TB_STRING" size="100" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DTL_ADDR"          colType="TB_STRING" size="100" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOBILE_PH1"        colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOBILE_PH2"        colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOBILE_PH3"        colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="HOME_PH1"          colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="HOME_PH2"          colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="HOME_PH3"          colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="FRST_PROM_DT"      colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="FRST_PROM_HH"      colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="FRST_PROM_MM"      colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="LAST_PROM_DT"      colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="LAST_PROM_HH"      colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="LAST_PROM_MM"      colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PROM_TYPE"         colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PROM_DTL"          colType="TB_STRING" size="4000" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DELI_TYPE"         colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DELI_STR"          colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_CD"         colType="TB_STRING" size="6" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_NM"         colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORG_CD"            colType="TB_STRING" size="10" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORG_NM"            colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SKU_NM"            colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="IN_DELI_DT"        colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SMS_YN"            colType="TB_STRING" size="1" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_CUST_NM"      colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_POST_NO"      colType="TB_STRING" size="6" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_POST_SEQ"     colType="TB_INT" size="5" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_ADDR"         colType="TB_STRING" size="100" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_DTL_ADDR"     colType="TB_STRING" size="100" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_MOBILE_PH1"   colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_MOBILE_PH2"   colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_MOBILE_PH3"   colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_HOME_PH1"     colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_HOME_PH2"     colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_HOME_PH3"     colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_COMP_NM"      colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_SEND_NO"      colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PROC_STAT"         colType="TB_STRING" size="1" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PROC_STAT_NM"      colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="HAPPY_CALL_YN"     colType="TB_STRING" size="1" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
        
    
    <query name="SEL_PROMISS">
        <![CDATA[
        SELECT TO_CHAR(TO_DATE(YYYYMMDD), 'DD') DAYS
             , SUM(AA)||'('||SUM(BB)||'/'||SUM(CC)||')' AS PROMISS
          FROM (
		        SELECT STR_CD
		             , PUMBUN_CD
		             , LAST_PROM_DT AS YYYYMMDD 
		             , 0 AS AA
		             , COUNT(1) AS BB
		             , SUM(CASE WHEN proc_stat = '4' THEN 1 ELSE 0 END) AS CC
		          FROM MSS.MP_PROMISECERT 
		         WHERE LAST_PROM_DT like ? || '%'
		      GROUP BY STR_CD, PUMBUN_CD, LAST_PROM_DT
		     UNION ALL
		        SELECT STR_CD, PUMBUN_CD, TAKE_DT AS YYYYMMDD
		             , COUNT(1) AS AA
		             , 0 AS BB
		             , 0 AS CC
		          FROM MSS.MP_PROMISECERT                             
		         WHERE TAKE_DT like ? || '%'
		      GROUP BY STR_CD, PUMBUN_CD, TAKE_DT
	           ) A,
	          (
	           SELECT STR_CD
	                , PUMBUN_CD  
	             FROM DPS.PC_STRPBN
	            WHERE SALE_ORG_CD LIKE ? || '%'        
	          ) B
       WHERE A.STR_CD = B.STR_CD AND A.PUMBUN_CD = B.PUMBUN_CD
    GROUP BY YYYYMMDD
    ORDER BY YYYYMMDD
        ]]>
    </query>
    
    <!-- 약속 대장 조회-->
    <query name="SEL_MASTER">
        <![CDATA[
        SELECT TAKE_DT                      
             , A.STR_CD                     
             , TAKE_SEQ                   
             , TAKE_USER_ID               
             , COM.FN_GET_USER_NAME(TAKE_USER_ID) AS TAKE_USER_NM                       
             , CUST_NM                    
             , POST_NO                    
             , CUST_POST_SEQ              
             , ADDR                       
             , DTL_ADDR                   
             , DCS.SC_Crypto_FUN('DEC', MOBILE_PH1) AS MOBILE_PH1                  
             , DCS.SC_Crypto_FUN('DEC', MOBILE_PH2) AS MOBILE_PH2                  
             , DCS.SC_Crypto_FUN('DEC', MOBILE_PH3) AS MOBILE_PH3                  
             , DCS.SC_Crypto_FUN('DEC', HOME_PH1) AS HOME_PH1                    
             , DCS.SC_Crypto_FUN('DEC', HOME_PH2) AS HOME_PH2                   
             , DCS.SC_Crypto_FUN('DEC', HOME_PH3) AS HOME_PH3                   
             , FRST_PROM_DT               
             , SUBSTR(FRST_PROM_TIME, 0,2) AS FRST_PROM_HH               
             , SUBSTR(FRST_PROM_TIME, 3,2) AS FRST_PROM_MM               
             , LAST_PROM_DT                
             , SUBSTR(LAST_PROM_TIME, 0,2) AS LAST_PROM_HH                
             , SUBSTR(LAST_PROM_TIME, 3,2) AS LAST_PROM_MM                
             , PROM_TYPE                  
             , PROM_DTL                   
             , DELI_TYPE                  
             , DELI_STR                   
             , A.PUMBUN_CD                  
             , (SELECT PUMBUN_NAME FROM DPS.PC_PBNMST WHERE PUMBUN_CD = A.PUMBUN_CD) AS PUMBUN_NM                  
             , COM.FN_GET_ORG_INFO(A.TAKE_USER_ID, 'CODE') AS ORG_CD                     
             , COM.FN_GET_ORG_INFO(A.TAKE_USER_ID, 'NAME') AS ORG_NM                     
             , SKU_NM                     
             , IN_DELI_DT                 
             , SMS_YN                     
             , COUR_CUST_NM               
             , COUR_POST_NO               
             , COUR_POST_SEQ              
             , COUR_ADDR                  
             , COUR_DTL_ADDR              
             , DCS.SC_Crypto_FUN('DEC', COUR_MOBILE_PH1) AS COUR_MOBILE_PH1  
             , DCS.SC_Crypto_FUN('DEC', COUR_MOBILE_PH2) AS COUR_MOBILE_PH2            
             , DCS.SC_Crypto_FUN('DEC', COUR_MOBILE_PH3) AS COUR_MOBILE_PH3            
             , DCS.SC_Crypto_FUN('DEC', COUR_HOME_PH1) AS COUR_HOME_PH1              
             , DCS.SC_Crypto_FUN('DEC', COUR_HOME_PH2) AS COUR_HOME_PH2              
             , DCS.SC_Crypto_FUN('DEC', COUR_HOME_PH3) AS COUR_HOME_PH3              
             , COUR_COMP_NM               
             , COUR_SEND_NO               
             , PROC_STAT   
             , COM.FN_GET_COMM_NAME('D','M024',PROC_STAT) AS PROC_STAT_NM   
             , (SELECT COUNT(*) FROM MSS.MP_HAPPYCALLMGR B 
                WHERE A.TAKE_DT = B.TAKE_DT 
                AND A.STR_CD = B.STR_CD 
                AND A.TAKE_SEQ = B.TAKE_SEQ) AS HAPPY_CALL_YN               
          FROM MSS.MP_PROMISECERT A
             , (
               SELECT STR_CD, PUMBUN_CD  
                 FROM DPS.PC_STRPBN
                WHERE SALE_ORG_CD LIKE ? || '%'   
               ) B
         WHERE (A.TAKE_DT = ? OR A.LAST_PROM_DT = ? )
           AND A.STR_CD = B.STR_CD AND A.PUMBUN_CD = B.PUMBUN_CD            
        ]]>
    </query>
    
    
    

</service>