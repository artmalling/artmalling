<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 김성미
 * 회 사 명 : 
 * 작 성 일 : 2011.02.09
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  약속 관리
 -->
<service name="/mpro107.mp">
    <!-- 약속 목록 -->
    <gauce name="H_MASTER"> 
        <column colName="TAKE_DT"           colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STR_CD"            colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAKE_SEQ"          colType="TB_STRING" size="5" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAKE_USER_ID"      colType="TB_STRING" size="10" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAKE_USER_NM"      colType="TB_STRING" size="10" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUST_NM"           colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="POST_NO"           colType="TB_STRING" size="6" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUST_POST_SEQ"     colType="TB_STRING" size="5" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ADDR"              colType="TB_STRING" size="80" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DTL_ADDR"          colType="TB_STRING" size="80" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOBILE_PH1"        colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOBILE_PH2"        colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOBILE_PH3"        colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="HOME_PH1"          colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="HOME_PH2"          colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="HOME_PH3"          colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="FRST_PROM_DT"      colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="FRST_PROM_HH"      colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="FRST_PROM_MM"      colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="LAST_PROM_DT"      colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="LAST_PROM_HH"      colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="LAST_PROM_MM"      colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PROM_TYPE"         colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PROM_DTL"          colType="TB_STRING" size="4000" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DELI_TYPE"         colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DELI_STR"          colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_CD"         colType="TB_STRING" size="6" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PUMBUN_NM"         colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORG_CD"            colType="TB_STRING" size="10" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ORG_NM"            colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SKU_NM"            colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="IN_DELI_DT"        colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SMS_YN"            colType="TB_STRING" size="1" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_CUST_NM"      colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_POST_NO"      colType="TB_STRING" size="6" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_POST_SEQ"     colType="TB_INT" size="5" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_ADDR"         colType="TB_STRING" size="80" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_DTL_ADDR"     colType="TB_STRING" size="80" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_MOBILE_PH1"   colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_MOBILE_PH2"   colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_MOBILE_PH3"   colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_HOME_PH1"     colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_HOME_PH2"     colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_HOME_PH3"     colType="TB_STRING" size="32" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_COMP_NM"      colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COUR_SEND_NO"      colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PROC_STAT"         colType="TB_STRING" size="1" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="PROC_STAT_NM"      colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="HAPPY_CALL_YN"     colType="TB_STRING" size="1" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
     <!-- 약속 변경 목록  HISTORY-->
     <gauce name="H_HISTORY"> 
        <column colName="TAKE_DT"           colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="STR_CD"            colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TAKE_SEQ"          colType="TB_INT" size="5" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="LAST_PROM_DT"      colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="LAST_PROM_TIME"      colType="TB_STRING" size="4" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="IN_DELI_DT"          colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DELI_STR"          colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DELI_STR_NM"          colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DELI_TYPE"         colType="TB_STRING" size="4" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DELI_TYPE_NM"         colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>  
    
     <!-- 약속 변경 내용-->
    <gauce name="H_CHANGE"> 
        <column colName="MOD_PROM_DT"       colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_PROM_HH"       colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_PROM_MM"       colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_REASON01"       colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_REASON_DTL01"         colType="TB_STRING" size="100" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_TAKE_DT01"          colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_DELI_TYPE"       colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_REASON02"       colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_REASON_DTL02"         colType="TB_STRING" size="100" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_TAKE_DT02"          colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_DELI_STR"       colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_REASON03"       colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_REASON_DTL03"         colType="TB_STRING" size="100" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_TAKE_DT03"          colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_IN_DELI_DT"       colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_REASON04"       colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_REASON_DTL04"         colType="TB_STRING" size="100" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_TAKE_DT04"          colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_CANCEL"       colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_REASON05"       colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_REASON_DTL05"         colType="TB_STRING" size="100" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_TAKE_DT05"          colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    
        <!-- -->
    <gauce name="H_HIS_MASTER"> 
        <column colName="MOD_ITEM"           colType="TB_STRING" size="10" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_CONTENTS"            colType="TB_STRING" size="20" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_REASON"          colType="TB_STRING" size="10" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_REASON_DTL"      colType="TB_STRING" size="100" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_TAKE_DT"      colType="TB_STRING" size="10" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        
    </gauce>
    <!-- 약속 대장 조회-->
    <query name="SEL_MASTER">
        <![CDATA[
           SELECT TAKE_DT                      
                , STR_CD                     
                , LPAD(TAKE_SEQ, 3, '0')    AS TAKE_SEQ               
                , TAKE_USER_ID               
                , COM.FN_GET_USER_NAME(TAKE_USER_ID) AS TAKE_USER_NM                       
                , CUST_NM                    
                , POST_NO                    
                , CUST_POST_SEQ              
                , ADDR                       
                , DTL_ADDR                   
                , DCS.SC_Crypto_FUN('DEC', MOBILE_PH1) AS MOBILE_PH1               
                , DCS.SC_Crypto_FUN('DEC', MOBILE_PH2) AS MOBILE_PH2       
                , DCS.SC_Crypto_FUN('DEC', MOBILE_PH3) AS MOBILE_PH3                  
                , DCS.SC_Crypto_FUN('DEC', HOME_PH1)   AS HOME_PH1                    
                , DCS.SC_Crypto_FUN('DEC', HOME_PH2)   AS HOME_PH2                    
                , DCS.SC_Crypto_FUN('DEC', HOME_PH3)   AS HOME_PH3                    
                , FRST_PROM_DT               
                , SUBSTR(FRST_PROM_TIME, 0,2) AS FRST_PROM_HH               
                , SUBSTR(FRST_PROM_TIME, 3,2) AS FRST_PROM_MM               
                , LAST_PROM_DT                
                , SUBSTR(LAST_PROM_TIME, 0,2) AS LAST_PROM_HH                
                , SUBSTR(LAST_PROM_TIME, 3,2) AS LAST_PROM_MM                
                , PROM_TYPE                  
                , PROM_DTL                   
                , DELI_TYPE                  
                , DELI_STR                   
                , PUMBUN_CD                  
                , (SELECT PUMBUN_NAME FROM DPS.PC_PBNMST WHERE PUMBUN_CD = A.PUMBUN_CD) AS PUMBUN_NM                  
                , COM.FN_GET_ORG_INFO(A.TAKE_USER_ID, 'CODE') AS ORG_CD                     
                , COM.FN_GET_ORG_INFO(A.TAKE_USER_ID, 'NAME') AS ORG_NM                     
                , SKU_NM                     
                , IN_DELI_DT                 
                , SMS_YN                     
                , COUR_CUST_NM               
                , COUR_POST_NO               
                , COUR_POST_SEQ              
                , COUR_ADDR                  
                , COUR_DTL_ADDR              
                , DCS.SC_Crypto_FUN('DEC', COUR_MOBILE_PH1) AS COUR_MOBILE_PH1      
                , DCS.SC_Crypto_FUN('DEC', COUR_MOBILE_PH2) AS COUR_MOBILE_PH2            
                , DCS.SC_Crypto_FUN('DEC', COUR_MOBILE_PH3) AS COUR_MOBILE_PH3            
                , DCS.SC_Crypto_FUN('DEC', COUR_HOME_PH1) AS COUR_HOME_PH1               
                , DCS.SC_Crypto_FUN('DEC', COUR_HOME_PH2) AS COUR_HOME_PH2               
                , DCS.SC_Crypto_FUN('DEC', COUR_HOME_PH3) AS COUR_HOME_PH3              
                , COUR_COMP_NM               
                , COUR_SEND_NO               
                , PROC_STAT   
                , COM.FN_GET_COMM_NAME('D','M024',PROC_STAT) AS PROC_STAT_NM   
                , DECODE((SELECT COUNT(*) FROM MSS.MP_HAPPYCALLMGR B 
                    WHERE A.TAKE_DT = B.TAKE_DT 
                      AND A.STR_CD = B.STR_CD 
                      AND A.TAKE_SEQ = B.TAKE_SEQ),1,'T','F') AS HAPPY_CALL_YN               
        FROM MSS.MP_PROMISECERT A
       WHERE A.STR_CD LIKE ? || '%'
         AND A.CUST_NM LIKE ? || '%'
         AND A.PUMBUN_CD LIKE ? || '%'
         AND A.PROM_TYPE LIKE ? || '%'
         AND A.STR_CD IN (SELECT DISTINCT STR_CD FROM COM.V_MYORG 
                            WHERE USER_ID = ? AND ORG_FLAG = ?)
        ]]>
    </query>    
    
    <!-- 약속 대장 조회 추가 조건 : 조회구분 접수일자-->
    <query name="ADD_TAKE_DT">
        <![CDATA[
              AND A.TAKE_DT BETWEEN ? AND ?
         ORDER BY A.TAKE_SEQ
        ]]>
    </query>  
    
    <!-- 약속 대장 조회 추가 조건 : 조회구분 입고예정일자-->
    <query name="ADD_IN_DELI_DT">
        <![CDATA[
              AND A.IN_DELI_DT BETWEEN ? AND ?
         ORDER BY A.TAKE_SEQ
        ]]>
    </query>
    
    <!-- 약속 대장 조회 추가 조건 : 조회구분 약속일자(변경내용이 없는 경우 최초약속일자 조회 )-->
    <query name="ADD_PROM_DT">
        <![CDATA[
              AND A.LAST_PROM_DT BETWEEN ? AND ?
         ORDER BY A.TAKE_SEQ
        ]]>
    </query>
    
    <!-- 약속대장 등록-->
    <query name="INS_PROMISECERT">
        <![CDATA[
         INSERT INTO MSS.MP_PROMISECERT(TAKE_DT         , STR_CD            , TAKE_SEQ          , TAKE_USER_ID  , CUST_NM
                                      , POST_NO         , CUST_POST_SEQ     , ADDR              , DTL_ADDR
                                      , MOBILE_PH1      , MOBILE_PH2        , MOBILE_PH3
                                      , HOME_PH1        , HOME_PH2          , HOME_PH3
                                      , FRST_PROM_DT    , FRST_PROM_TIME    , LAST_PROM_DT    , LAST_PROM_TIME    
                                      , PROM_TYPE       , PROM_DTL          , DELI_TYPE
                                      , DELI_STR        , PUMBUN_CD         , SKU_NM            , IN_DELI_DT    , SMS_YN
                                      , COUR_CUST_NM    , COUR_POST_NO      , COUR_POST_SEQ     , COUR_ADDR     , COUR_DTL_ADDR
                                      , COUR_MOBILE_PH1 , COUR_MOBILE_PH2   , COUR_MOBILE_PH3   
                                      , COUR_HOME_PH1   , COUR_HOME_PH2     , COUR_HOME_PH3
                                      , COUR_COMP_NM    , COUR_SEND_NO      , PROC_STAT                             
                                      , REG_ID          , REG_DATE          , MOD_ID          , MOD_DATE)
                                VALUES( ?               , ?                 , MSS.SQ_MP_PROMISECERT.NEXTVAL                  , ?             , ?
                                      , ?               , ?                 , ?                 , ?    
                                      , DCS.SC_Crypto_FUN('ENC',?)               , DCS.SC_Crypto_FUN('ENC',?)                 , DCS.SC_Crypto_FUN('ENC',?) 
                                      , DCS.SC_Crypto_FUN('ENC',?)               , DCS.SC_Crypto_FUN('ENC',?)                 , DCS.SC_Crypto_FUN('ENC',?) 
                                      , ?               , ?                 , ?                 , ?             
                                      , ?               , ?                 , ?                 
                                      , ?               , ?                 , ?                  , ?               , ?                 
                                      , ?               , ?                 , ?                  , ?               , ?                 
                                      , DCS.SC_Crypto_FUN('ENC',?)               , DCS.SC_Crypto_FUN('ENC',?)                 , DCS.SC_Crypto_FUN('ENC',?)                 
                                      , DCS.SC_Crypto_FUN('ENC',?)               , DCS.SC_Crypto_FUN('ENC',?)                 , DCS.SC_Crypto_FUN('ENC',?)                 
                                      , ?               , ?                  , ?
                                      , ?               , SYSDATE            , ?                 , SYSDATE)
        ]]>
    </query> 
    
      <!-- 약속 대장 내용 수정-->
    <query name="UPD_PROMISECERT">
        <![CDATA[
            UPDATE MSS.MP_PROMISECERT
               SET   CUST_NM = ?
                   , POST_NO = ?
                   , CUST_POST_SEQ = ?
                   , ADDR = ?
                   , DTL_ADDR = ?
                   , MOBILE_PH1 = DCS.SC_Crypto_FUN('ENC',?)
                   , MOBILE_PH2 = DCS.SC_Crypto_FUN('ENC',?)
                   , MOBILE_PH3 = DCS.SC_Crypto_FUN('ENC',?)
                   , HOME_PH1 = DCS.SC_Crypto_FUN('ENC',?)
                   , HOME_PH2 = DCS.SC_Crypto_FUN('ENC',?)
                   , HOME_PH3 = DCS.SC_Crypto_FUN('ENC',?)
                   , FRST_PROM_DT = ?
                   , FRST_PROM_TIME = ?
                   , PROM_TYPE = ?
                   , PROM_DTL = ?
                   , DELI_TYPE = ?
                   , DELI_STR = ?
                   , PUMBUN_CD = ?
                   , SKU_NM = ?
                   , IN_DELI_DT = ?
                   , SMS_YN = ?
                   , COUR_CUST_NM = ?
                   , COUR_POST_NO = ?
                   , COUR_POST_SEQ = ?
                   , COUR_ADDR = ?
                   , COUR_DTL_ADDR = ?
                   , COUR_MOBILE_PH1 = DCS.SC_Crypto_FUN('ENC',?)
                   , COUR_MOBILE_PH2 = DCS.SC_Crypto_FUN('ENC',?)
                   , COUR_MOBILE_PH3 = DCS.SC_Crypto_FUN('ENC',?)
                   , COUR_HOME_PH1 = DCS.SC_Crypto_FUN('ENC',?)
                   , COUR_HOME_PH2 = DCS.SC_Crypto_FUN('ENC',?)
                   , COUR_HOME_PH3 = DCS.SC_Crypto_FUN('ENC',?)
                   , COUR_COMP_NM = ?
                   , COUR_SEND_NO = ?
                   , PROC_STAT = ?
                   , MOD_ID = ?
                   , MOD_DATE = SYSDATE
             WHERE TAKE_DT = ?
               AND STR_CD = ?
               AND TAKE_SEQ = ?  
        ]]>
    </query> 
    
    <!-- 약속대장 변경내용 조회-->
    <query name="SEL_PROMISEHIS">
        <![CDATA[
        SELECT TAKE_DT
             , STR_CD
             , TAKE_SEQ
             , LAST_PROM_DT
             , LAST_PROM_TIME
             , IN_DELI_DT
             , DELI_STR
             , DPS.FN_GET_STORE_NAME(DELI_STR) AS DELI_STR_NM
             , DELI_TYPE
             , COM.FN_GET_COMM_NAME('D','M022',DELI_TYPE) AS DELI_TYPE_NM
        FROM MSS.MP_PROMISECERT
        WHERE TAKE_DT = ?
          AND STR_CD = ?
          AND TAKE_SEQ = ?
        ]]>
    </query> 
    
    <!-- 약속대장 변경내용 저장 :약속일-->
    <query name="INS_PROMISEHIS01">
        <![CDATA[
        INSERT INTO MSS.MP_PROMISEHIS  (TAKE_DT         , STR_CD            , TAKE_SEQ          , SEQ_NO                    , MOD_LIST
                                      , MOD_REASON      , MOD_REASON_DTL    , MOD_TAKE_DT       
                                      , ORG_PROM_DT     , MOD_PROM_DT       , ORG_PROM_TIME     , MOD_PROM_TIME
                                      , REG_ID          , REG_DATE)
                                VALUES( ?               , ?                 , ?                 , MSS.SQ_MP_PROMISEHIS.NEXTVAL    , ?
                                      , ?               , ?                 , ?                     
                                      , ?               , ?                 , ?                 , ? 
                                      , ?               , SYSDATE)   
        ]]>
    </query> 
    
    <!-- 약속대장 변경내용 저장 : 입고예정일-->
    <query name="INS_PROMISEHIS02">
        <![CDATA[
        INSERT INTO MSS.MP_PROMISEHIS  (TAKE_DT         , STR_CD            , TAKE_SEQ          , SEQ_NO                    , MOD_LIST
                                      , MOD_REASON      , MOD_REASON_DTL    , MOD_TAKE_DT       
                                      , ORG_IN_DELI_DT  , MOD_IN_DELI_DT                         
                                      , REG_ID          , REG_DATE)
                                VALUES( ?               , ?                 , ?                 , MSS.SQ_MP_PROMISEHIS.NEXTVAL    , ?
                                      , ?               , ?                 , ?                     
                                      , ?               , ?                 
                                      , ?               , SYSDATE)   
        ]]>
    </query> 
    
    <!-- 약속대장 변경내용 저장 : 인도점-->
    <query name="INS_PROMISEHIS03">
        <![CDATA[
        INSERT INTO MSS.MP_PROMISEHIS  (TAKE_DT         , STR_CD            , TAKE_SEQ          , SEQ_NO                    , MOD_LIST
                                      , MOD_REASON      , MOD_REASON_DTL    , MOD_TAKE_DT       
                                      , ORG_DELI_STR    , MOD_DELI_STR
                                      , REG_ID          , REG_DATE)
                                VALUES( ?               , ?                 , ?                 , MSS.SQ_MP_PROMISEHIS.NEXTVAL    , ?
                                      , ?               , ?                 , ?                     
                                      , ?               , ?                 
                                      , ?               , SYSDATE)   
        ]]>
    </query> 
    
    <!-- 약속대장 변경내용 저장 : 인도방식-->
    <query name="INS_PROMISEHIS04">
        <![CDATA[
        INSERT INTO MSS.MP_PROMISEHIS  (TAKE_DT         , STR_CD            , TAKE_SEQ          , SEQ_NO                    , MOD_LIST
                                      , MOD_REASON      , MOD_REASON_DTL    , MOD_TAKE_DT       
                                      , ORG_DELI_TYPE   , MOD_DELI_TYPE
                                      , REG_ID          , REG_DATE)
                                VALUES( ?               , ?                 , ?                 , MSS.SQ_MP_PROMISEHIS.NEXTVAL    , ?
                                      , ?               , ?                 , ?                     
                                      , ?               , ?                 
                                      , ?               , SYSDATE)   
        ]]>
    </query> 
    
    <!-- 약속대장 변경내용 저장 : 취소-->
    <query name="INS_PROMISEHIS05">
        <![CDATA[
        INSERT INTO MSS.MP_PROMISEHIS  (TAKE_DT         , STR_CD            , TAKE_SEQ          , SEQ_NO                    , MOD_LIST
                                      , MOD_REASON      , MOD_REASON_DTL    , MOD_TAKE_DT       
                                      , REG_ID          , REG_DATE)
                                VALUES( ?               , ?                 , ?                 , MSS.SQ_MP_PROMISEHIS.NEXTVAL    , ?
                                      , ?               , ?                 , ?                     
                                      , ?               , SYSDATE)   
        ]]>
    </query> 
    
      <!-- 약속대장 변경내용 저장 시 마스터 내용 UPDATE -->
    <query name="UPD_PROMISECERT_HEAD">
        <![CDATA[
         UPDATE MSS.MP_PROMISECERT  
        ]]>
    </query> 
    
     <!-- 약속대장 변경내용 저장 시 마스터 내용 UPDATE -->
    <query name="UPD_PROMISECERT_01">
        <![CDATA[
         SET LAST_PROM_DT = ?
           , LAST_PROM_TIME = ?
        ]]>
    </query> 
    
     <!-- 약속대장 변경내용 저장 시 마스터 내용 UPDATE -->
    <query name="UPD_PROMISECERT_02">
        <![CDATA[
         SET IN_DELI_DT = ?
        ]]>
    </query> 
    
     <!-- 약속대장 변경내용 저장 시 마스터 내용 UPDATE -->
    <query name="UPD_PROMISECERT_03">
        <![CDATA[
         SET DELI_STR = ?
        ]]>
    </query> 
    
     <!-- 약속대장 변경내용 저장 시 마스터 내용 UPDATE -->
    <query name="UPD_PROMISECERT_04">
        <![CDATA[
         SET DELI_TYPE = ?
        ]]>
    </query> 
    
     <!-- 약속대장 변경내용 저장 시 마스터 내용 UPDATE -->
    <query name="UPD_PROMISECERT_05">
        <![CDATA[
         SET PROC_STAT = ?
        ]]>
    </query> 
    
     <!-- 약속대장 변경내용 저장 시 마스터 내용 UPDATE -->
    <query name="UPD_PROMISECERT_TAIL">
        <![CDATA[
               , MOD_ID = ?
               , MOD_DATE = SYSDATE
           WHERE TAKE_DT = ?
             AND STR_CD = ?
             AND TAKE_SEQ = ?
        ]]>
    </query> 
    
    <!-- 약속 대장  변경 히스토리 조회-->
    <query name="SEL_HIS_MASTER">
        <![CDATA[
        SELECT CASE WHEN MOD_LIST = '01' THEN '약속일'
                    WHEN MOD_LIST = '02' THEN '입고예정일'
                    WHEN MOD_LIST = '03' THEN '인도점'
                    WHEN MOD_LIST = '04' THEN '인도방식'
                    WHEN MOD_LIST = '05' THEN '취소' END AS MOD_ITEM
             , CASE WHEN MOD_LIST = '01' THEN TO_CHAR(TO_DATE(MOD_PROM_DT),'YYYY/MM/DD') 
                                || '  ' || SUBSTR(MOD_PROM_TIME,0,2) || ':' || SUBSTR(MOD_PROM_TIME,3,4)
                    WHEN MOD_LIST = '02' THEN TO_CHAR(TO_DATE(MOD_IN_DELI_DT),'YYYY/MM/DD')
                    WHEN MOD_LIST = '03' THEN DPS.FN_GET_STORE_NAME(MOD_DELI_STR)
                    WHEN MOD_LIST = '04' THEN COM.FN_GET_COMM_NAME('D','M022',MOD_DELI_TYPE)
                    WHEN MOD_LIST = '05' THEN '취소' END AS MOD_CONTENTS
             , COM.FN_GET_COMM_NAME('D','M023',MOD_REASON) AS MOD_REASON
             , MOD_REASON_DTL
             , TO_CHAR(MOD_TAKE_DT, 'YYYY/MM/DD') AS MOD_TAKE_DT
          FROM MSS.MP_PROMISEHIS
         WHERE TAKE_DT = ?
           AND TAKE_SEQ = ?
           AND STR_CD = ?
         ORDER BY SEQ_NO  
        ]]>
    </query>    
    
</service>