<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 정지인
 * 회 사 명 : 한국후지쯔
 * 작 성 일 : 2010.12.12
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  개발팀에서 기입해주세요
 -->
<service name="/mgif311.mg">
    <!-- 자사상품권 회수 비교표 마스터  조회  -->
    <gauce name="H_MASTER"> 
        <column colName="DRAWL_STR"         colType="TB_STRING"  size="2"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DRAWL_DT"          colType="TB_STRING"  size="8"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY_1"             colType="TB_DECIMAL" size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT_1"             colType="TB_DECIMAL" size="14" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY_2"             colType="TB_DECIMAL" size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT_2"             colType="TB_DECIMAL" size="14" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY_3"             colType="TB_DECIMAL" size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT_3"             colType="TB_DECIMAL" size="14" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY_4"             colType="TB_DECIMAL" size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT_4"             colType="TB_DECIMAL" size="14" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY_5"             colType="TB_DECIMAL" size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT_5"             colType="TB_DECIMAL" size="14" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY_6"             colType="TB_DECIMAL" size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT_6"             colType="TB_DECIMAL" size="14" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY_7"             colType="TB_DECIMAL" size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT_7"             colType="TB_DECIMAL" size="14" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY_A"             colType="TB_DECIMAL" size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT_A"             colType="TB_DECIMAL" size="14" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        
    </gauce>
    
     <!-- 지자사상품권 회수 비교표  디테일  조회  -->
    <gauce name="H_DETAIL"> 
        <column colName="GIFT_TYPE_CD"      colType="TB_STRING"  size="4"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="GIFT_TYPE_NAME"    colType="TB_STRING"  size="40"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="GIFT_AMT_TYPE"     colType="TB_STRING"  size="4"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="GIFT_AMT_NAME"     colType="TB_STRING"  size="40"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="GIFTCARD_NO"       colType="TB_STRING"  size="20" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DRAWL_AMT"         colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DRAWL_FLAG"        colType="TB_STRING"  size="2"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="POUT_TYPE"         colType="TB_STRING"  size="2"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SALE_FLAG"         colType="TB_STRING"  size="2"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
     <!-- 지자사상품권 회수 비교표  팝업  조회  -->
    <gauce name="H_POPUP"> 
        <column colName="GIFT_TYPE_CD"      colType="TB_STRING"  size="4"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="GIFT_TYPE_NAME"    colType="TB_STRING"  size="40"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="GIFT_AMT_TYPE"     colType="TB_STRING"  size="4"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="GIFT_AMT_NAME"     colType="TB_STRING"  size="40"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY_1"             colType="TB_DECIMAL" size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT_1"             colType="TB_DECIMAL" size="14" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY_2"             colType="TB_DECIMAL" size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT_2"             colType="TB_DECIMAL" size="14" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY_3"             colType="TB_DECIMAL" size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT_3"             colType="TB_DECIMAL" size="14" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY_4"             colType="TB_DECIMAL" size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT_4"             colType="TB_DECIMAL" size="14" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY_5"             colType="TB_DECIMAL" size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT_5"             colType="TB_DECIMAL" size="14" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY_6"             colType="TB_DECIMAL" size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT_6"             colType="TB_DECIMAL" size="14" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY_7"             colType="TB_DECIMAL" size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT_7"             colType="TB_DECIMAL" size="14" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY_A"             colType="TB_DECIMAL" size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT_A"             colType="TB_DECIMAL" size="14" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>

    <!-- 자사상품권 회수 비교표  마스터  조회 -->
	<query name="SEL_GIFTDRAWL_MASTER">
	    <![CDATA[
	       SELECT DRAWL_STR
	            , DRAWL_DT
	            , SUM(QTY_1)       AS QTY_1
	            , SUM(AMT_1)       AS AMT_1
	            , SUM(QTY_2)       AS QTY_2
	            , SUM(AMT_2)       AS AMT_2
	            , SUM(QTY_3)       AS QTY_3
	            , SUM(AMT_3)       AS AMT_3
	            , SUM(QTY_4)       AS QTY_4
	            , SUM(AMT_4)       AS AMT_4
	            , SUM(QTY_5)       AS QTY_5
                , SUM(AMT_5)       AS AMT_5
	            , SUM(QTY_6)       AS QTY_6
                , SUM(AMT_6)       AS AMT_6
	            , SUM(QTY_7)       AS QTY_7
                , SUM(AMT_7)       AS AMT_7
	            , COUNT(1)         AS QTY_A
	            , SUM(DRAWL_AMT)   AS AMT_A
	         FROM (SELECT DRAWL_STR
	                    , DRAWL_DT
	                    --, CASE WHEN DRAWL_FLAG = '1' THEN 1 ELSE 0 END         AS QTY_1
	                    --, CASE WHEN DRAWL_FLAG = '1' THEN DRAWL_AMT ELSE 0 END AS AMT_1
	                    --, CASE WHEN DRAWL_FLAG IN ('1','6') THEN 1 ELSE 0 END         AS QTY_1  -- 1정상, 6강제 회수 == 정상회수
	                    --, CASE WHEN DRAWL_FLAG IN ('1','6) THEN DRAWL_AMT ELSE 0 END AS AMT_1
	                    , CASE WHEN DRAWL_FLAG = '1'  THEN 1 ELSE 0 END         AS QTY_1  -- 1정상, 6강제 회수 == 정상회수
	                    , CASE WHEN DRAWL_FLAG = '1'  THEN DRAWL_AMT ELSE 0 END AS AMT_1
	                    , CASE WHEN DRAWL_FLAG = '6' THEN 1 ELSE 0 END         AS QTY_2      --6:강제회수
	                    , CASE WHEN DRAWL_FLAG = '6' THEN DRAWL_AMT ELSE 0 END AS AMT_2  
	                    , CASE WHEN DRAWL_FLAG = '2' THEN 1 ELSE 0 END         AS QTY_3     --2:교환회수 
	                    , CASE WHEN DRAWL_FLAG = '2' THEN DRAWL_AMT ELSE 0 END AS AMT_3
	                    , CASE WHEN DRAWL_FLAG = '3' THEN 1 ELSE 0 END         AS QTY_4      --3:반품회수 
	                    , CASE WHEN DRAWL_FLAG = '3' THEN DRAWL_AMT ELSE 0 END AS AMT_4
	                    , CASE WHEN DRAWL_FLAG = '4' THEN 1 ELSE 0 END         AS QTY_5      --4:가맹점회수 
                        , CASE WHEN DRAWL_FLAG = '4' THEN DRAWL_AMT ELSE 0 END AS AMT_5
	                    , CASE WHEN DRAWL_FLAG = '7' THEN 1 ELSE 0 END         AS QTY_6      --7:포인트반품회수 
                        , CASE WHEN DRAWL_FLAG = '7' THEN DRAWL_AMT ELSE 0 END AS AMT_6
	                    , CASE WHEN DRAWL_FLAG = '8' THEN 1 ELSE 0 END         AS QTY_7      --8:사은품반품회수 
                        , CASE WHEN DRAWL_FLAG = '8' THEN DRAWL_AMT ELSE 0 END AS AMT_7
	                    , DRAWL_AMT
	                 FROM MSS.MG_GIFTDRAWL GDRA
	                    , COM.TC_COMMCODE COMM
	                WHERE GDRA.DRAWL_FLAG = COMM.COMM_CODE
	                  AND COMM.COMM_PART = 'M076' /*회수구분*/
	                  AND GDRA.DRAWL_STR  IN ( SELECT STR_CD
	                                             FROM COM.V_MYORG
	                                            WHERE USE_YN = 'Y'
	                                              AND USER_ID = ?
	                                              AND ORG_FLAG = ?
	                                              AND STR_CD LIKE ?||'%'
	                                            GROUP BY STR_CD )	                                            
               		  --AND GDRA.DRAWL_FLAG <> '7'
	                  AND DRAWL_STR LIKE ?||'%'
	                  AND DRAWL_DT BETWEEN ? AND ?)
	       GROUP BY DRAWL_STR, DRAWL_DT
	       ORDER BY DRAWL_STR, DRAWL_DT
	    ]]>
	</query>  
     
    <!-- 자사상품권 회수 비교표  디테일  조회 -->
	<query name="SEL_GIFTDRAWL_DETAIL">
	    <![CDATA[
            SELECT A.GIFT_TYPE_CD
                 , B.GIFT_TYPE_NAME
                 , A.GIFT_AMT_TYPE
                 , C.GIFT_AMT_NAME
                 , A.GIFTCARD_NO
                 , A.DRAWL_AMT 
                 , A.DRAWL_FLAG     --회수구분 (D, M076)
                 , D.POUT_TYPE      --불출유형 (D, M014)
                 , D.SALE_FLAG      --판매구분  (D, M067)
              FROM MSS.MG_GIFTDRAWL A
                 , MSS.MG_GIFTTPMST B
                 , MSS.MG_GIFTAMTMST C
                 , MSS.MG_GIFTMST D
             WHERE A.GIFT_TYPE_CD = B.GIFT_TYPE_CD
               AND A.GIFT_TYPE_CD = C.GIFT_TYPE_CD
               AND A.ISSUE_TYPE = C.ISSUE_TYPE
               AND A.GIFTCARD_NO = D.GIFTCARD_NO
               AND A.GIFT_AMT_TYPE = C.GIFT_AMT_TYPE
               --AND A.DRAWL_FLAG <> '7'
               AND A.DRAWL_STR LIKE ?||'%'
               AND A.DRAWL_DT = ?
            ORDER BY A.DRAWL_FLAG, A.GIFT_TYPE_CD, A.GIFT_AMT_TYPE, A.GIFTCARD_NO
	      ]]>
	</query>  
     
    <!-- 자사상품권 회수 비교표  팝업  조회 -->
	<query name="SEL_GIFTDRAWL_POP">
	    <![CDATA[
		SELECT A.GIFT_TYPE_CD
             , GIFT_TYPE_NAME
             , A.GIFT_AMT_TYPE
             , GIFT_AMT_NAME
             , SUM(QTY_1) AS QTY_1
             , SUM(AMT_1) AS QTY_1
             , SUM(QTY_2) AS QTY_2
             , SUM(AMT_2) AS AMT_2
             , SUM(QTY_3) AS QTY_3
             , SUM(AMT_3) AS AMT_3
             , SUM(QTY_4) AS QTY_4
             , SUM(AMT_4) AS AMT_4
             , SUM(QTY_5) AS QTY_5
             , SUM(AMT_5) AS AMT_5
             , SUM(QTY_6) AS QTY_6
             , SUM(AMT_6) AS AMT_6
             , SUM(QTY_7) AS QTY_7
             , SUM(AMT_7) AS AMT_7
             , COUNT(1)     AS QTY_A
             , SUM(DRAWL_AMT)   AS AMT_A
          FROM (SELECT GIFT_TYPE_CD
                     , GIFT_AMT_TYPE
                     , ISSUE_TYPE
                     --, CASE WHEN DRAWL_FLAG = '1' THEN 1 ELSE 0 END         AS QTY_1
                     --, CASE WHEN DRAWL_FLAG = '1' THEN DRAWL_AMT ELSE 0 END AS AMT_1
	                 --, CASE WHEN DRAWL_FLAG IN ('1','6') THEN 1 ELSE 0 END         AS QTY_1
	                 --, CASE WHEN DRAWL_FLAG IN ('1','6') THEN DRAWL_AMT ELSE 0 END AS AMT_1
                     , CASE WHEN DRAWL_FLAG = '1'  THEN 1 ELSE 0 END         AS QTY_1  -- 1정상, 6강제 회수 == 정상회수
                     , CASE WHEN DRAWL_FLAG = '1'  THEN DRAWL_AMT ELSE 0 END AS AMT_1
                     , CASE WHEN DRAWL_FLAG = '6' THEN 1 ELSE 0 END         AS QTY_2      --6:강제회수
                     , CASE WHEN DRAWL_FLAG = '6' THEN DRAWL_AMT ELSE 0 END AS AMT_2  
                     , CASE WHEN DRAWL_FLAG = '2' THEN 1 ELSE 0 END         AS QTY_3
                     , CASE WHEN DRAWL_FLAG = '2' THEN DRAWL_AMT ELSE 0 END AS AMT_3
                     , CASE WHEN DRAWL_FLAG = '3' THEN 1 ELSE 0 END         AS QTY_4
                     , CASE WHEN DRAWL_FLAG = '3' THEN DRAWL_AMT ELSE 0 END AS AMT_4
                     , CASE WHEN DRAWL_FLAG = '4' THEN 1 ELSE 0 END         AS QTY_5
                     , CASE WHEN DRAWL_FLAG = '4' THEN DRAWL_AMT ELSE 0 END AS AMT_5
                     , CASE WHEN DRAWL_FLAG = '7' THEN 1 ELSE 0 END         AS QTY_6
                     , CASE WHEN DRAWL_FLAG = '7' THEN DRAWL_AMT ELSE 0 END AS AMT_6
                     , CASE WHEN DRAWL_FLAG = '8' THEN 1 ELSE 0 END         AS QTY_7
                     , CASE WHEN DRAWL_FLAG = '8' THEN DRAWL_AMT ELSE 0 END AS AMT_7
                     , DRAWL_AMT
                  FROM MSS.MG_GIFTDRAWL GDRA
                     , COM.TC_COMMCODE COMM
                 WHERE GDRA.DRAWL_FLAG = COMM.COMM_CODE
                   AND COMM.COMM_PART = 'M076'	                                            
               	   --AND GDRA.DRAWL_FLAG <> '7'
                   AND GDRA.DRAWL_STR LIKE ?||'%'
                   AND GDRA.DRAWL_DT = ?
                   ) A
                 , MSS.MG_GIFTTPMST B
                 , MSS.MG_GIFTAMTMST C
             WHERE A.GIFT_TYPE_CD = B.GIFT_TYPE_CD 
               AND A.GIFT_TYPE_CD = C.GIFT_TYPE_CD
               AND A.ISSUE_TYPE = C.ISSUE_TYPE
               AND A.GIFT_AMT_TYPE = C.GIFT_AMT_TYPE
        GROUP BY A.GIFT_TYPE_CD, A.GIFT_AMT_TYPE, GIFT_TYPE_NAME, GIFT_AMT_NAME
        ORDER BY A.GIFT_TYPE_CD, A.GIFT_AMT_TYPE, GIFT_TYPE_NAME, GIFT_AMT_NAME
	    ]]>
	</query>  
</service>