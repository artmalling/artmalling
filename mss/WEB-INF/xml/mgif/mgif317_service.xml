<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 정지인
 * 회 사 명 : 한국후지쯔
 * 작 성 일 : 2010.12.12
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  개발팀에서 기입해주세요
 -->
<service name="/mgif317.mg">
    <!-- 자사상품권 회수 비교표 마스터  조회  -->
    <gauce name="H_MASTER"> 
       <column colName="DRAWL_STR"         colType="TB_STRING"  size="2"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
       <column colName="STR_NM"            colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
       <column colName="DRAWL_DT"          colType="TB_STRING"  size="8"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
       <column colName="DRAWL_FLAG"        colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
       <column colName="DRAWL_FLAG_NM"     colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
       <column colName="GIFT_AMT_TYPE"     colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
       <column colName="GIFT_AMT_NAME"     colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
       <column colName="GIFTCERT_AMT"      colType="TB_DECIMAL" size="7" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
       <column colName="DRAWL_QTY"         colType="TB_DECIMAL" size="7" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
       <column colName="DRAWL_AMT"         colType="TB_DECIMAL" size="13" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        
    </gauce>
    
     <!-- 지자사상품권 회수 비교표  디테일  조회  -->
    <gauce name="H_DETAIL"> 
       <column colName="DRAWL_CD"           colType="TB_STRING" size="2" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
       <column colName="STR_NM"            	colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
       <column colName="DRAWL_DT"           colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
       <column colName="DRAWL_FLAG"         colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
       <column colName="DRAWL_FLAG_NM"      colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
       <column colName="DRAWL_QTY"          colType="TB_DECIMAL" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
       <column colName="DRAWL_AMT"          colType="TB_DECIMAL" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
       <column colName="GIFTCARD_NO"        colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
       <column colName="GIFT_AMT_TYPE"      colType="TB_STRING" size="8" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
       <column colName="GIFT_AMT_NAME"      colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
       <column colName="GIFTCERT_AMT"       colType="TB_DECIMAL" size="7" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />      
       <column colName="POS_TRAN"        	colType="TB_STRING" size="40" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />     
    </gauce>
    
     <!-- 지자사상품권 회수 비교표  팝업  조회  -->
    <gauce name="H_POPUP"> 
        <column colName="GIFT_TYPE_CD"      colType="TB_STRING"  size="4"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="GIFT_TYPE_NAME"    colType="TB_STRING"  size="40"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="GIFT_AMT_TYPE"     colType="TB_STRING"  size="4"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="GIFT_AMT_NAME"     colType="TB_STRING"  size="40"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY_1"             colType="TB_DECIMAL" size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT_1"             colType="TB_DECIMAL" size="14" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY_2"             colType="TB_DECIMAL" size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT_2"             colType="TB_DECIMAL" size="14" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY_3"             colType="TB_DECIMAL" size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT_3"             colType="TB_DECIMAL" size="14" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY_4"             colType="TB_DECIMAL" size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT_4"             colType="TB_DECIMAL" size="14" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY_5"             colType="TB_DECIMAL" size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT_5"             colType="TB_DECIMAL" size="14" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="QTY_A"             colType="TB_DECIMAL" size="7"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="AMT_A"             colType="TB_DECIMAL" size="14" dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>

    <!-- 자사상품권 회수 비교표  마스터  조회 -->
	<query name="SEL_GIFTDRAWL_MASTER">
	    <![CDATA[
			SELECT
					DRAWL_STR,
					STR_NM,
					DRAWL_DT,
					DRAWL_FLAG,
					DRAWL_FLAG_NM,
					GIFT_AMT_TYPE,
					GIFT_AMT_NAME,
					GIFTCERT_AMT,
	                COUNT(*) AS DRAWL_QTY,
	                COUNT(*) * GIFTCERT_AMT AS DRAWL_AMT
				FROM (
						SELECT TA.DRAWL_STR,
						       DPS.FN_GET_STORE_NAME(TA.DRAWL_STR) AS STR_NM,
						       TA.DRAWL_DT,
						       --TA.SALE_SLIP_NO,
						       --TA.STR_CD||TA.SALE_DT||TA.SALE_SLIP_NO||SALE_CD AS SALE_NO,
						       --TA.STR_CD||'-'||TA.SALE_DT||'-'||TA.SALE_SLIP_NO||SALE_CD AS SALE_NO1,
						       TA.DRAWL_FLAG,
						       (SELECT COMM_NAME1 FROM COM.TC_COMMCODE WHERE COMM_PART = 'M076' AND SYS_PART = 'D' AND COMM_CODE = TA.DRAWL_FLAG) AS DRAWL_FLAG_NM,
						       TA.DRAWL_TYPE,
						       TA.DRAWL_AMT,
						       TA.GIFTCARD_NO,
						       GIFT_TYPE_NAME,
						       TC.GIFT_AMT_TYPE,
						       TC.GIFT_AMT_NAME,
						       TC.GIFTCERT_AMT
		                 FROM MSS.MG_GIFTDRAWL TA ,
						     MSS.MG_GIFTAMTMST TC,
						     MSS.MG_GIFTTPMST TD,
						     MSS.MG_GIFTMST TE
		                WHERE TA.DRAWL_STR LIKE ?||'%'
		                  AND TA.DRAWL_DT BETWEEN ? AND ?
		                  AND TA.DRAWL_FLAG LIKE ? || '%'
						AND TA.GIFTCARD_NO = TE.GIFTCARD_NO
						AND TC.GIFT_TYPE_CD = TE.GIFT_TYPE_CD
						AND TC.GIFT_AMT_TYPE = TE.GIFT_AMT_TYPE
						AND TD.GIFT_TYPE_CD = TE.GIFT_TYPE_CD
						ORDER BY DRAWL_STR,
							DRAWL_DT,
							DRAWL_FLAG,
							DRAWL_FLAG_NM,
							DRAWL_TYPE,
							GIFTCARD_NO
			) GROUP BY
					DRAWL_STR,
					STR_NM,
					DRAWL_DT,
					DRAWL_FLAG,
					DRAWL_FLAG_NM,
					GIFT_AMT_TYPE,
					GIFT_AMT_NAME,
					GIFTCERT_AMT
			ORDER BY
					DRAWL_STR,
					STR_NM,
					DRAWL_DT,
					DRAWL_FLAG,
					DRAWL_FLAG_NM,
					GIFT_AMT_TYPE,
					GIFT_AMT_NAME,
					GIFTCERT_AMT		
	    ]]>
	</query>  
 	<query name="SEL_GIFTDRAWL_MASTER_OLD">
	    <![CDATA[
	       SELECT DRAWL_STR
	            , DRAWL_DT
	            , SUM(QTY_1)       AS QTY_1
	            , SUM(AMT_1)       AS AMT_1
	            , SUM(QTY_2)       AS QTY_2
	            , SUM(AMT_2)       AS AMT_2
	            , SUM(QTY_3)       AS QTY_3
	            , SUM(AMT_3)       AS AMT_3
	            , SUM(QTY_4)       AS QTY_4
	            , SUM(AMT_4)       AS AMT_4
	            , SUM(QTY_5)       AS QTY_5
                , SUM(AMT_5)       AS AMT_5
	            , COUNT(1)         AS QTY_A
	            , SUM(DRAWL_AMT)   AS AMT_A
	         FROM (SELECT DRAWL_STR
	                    , DRAWL_DT
	                    , CASE WHEN DRAWL_FLAG = '1' THEN 1 ELSE 0 END         AS QTY_1
	                    , CASE WHEN DRAWL_FLAG = '1' THEN DRAWL_AMT ELSE 0 END AS AMT_1
	                    , CASE WHEN DRAWL_FLAG = '5' THEN 1 ELSE 0 END         AS QTY_2
	                    , CASE WHEN DRAWL_FLAG = '5' THEN DRAWL_AMT ELSE 0 END AS AMT_2
	                    , CASE WHEN DRAWL_FLAG = '2' THEN 1 ELSE 0 END         AS QTY_3
	                    , CASE WHEN DRAWL_FLAG = '2' THEN DRAWL_AMT ELSE 0 END AS AMT_3
	                    , CASE WHEN DRAWL_FLAG = '3' THEN 1 ELSE 0 END         AS QTY_4
	                    , CASE WHEN DRAWL_FLAG = '3' THEN DRAWL_AMT ELSE 0 END AS AMT_4
	                    , CASE WHEN DRAWL_FLAG = '4' THEN 1 ELSE 0 END         AS QTY_5
                        , CASE WHEN DRAWL_FLAG = '4' THEN DRAWL_AMT ELSE 0 END AS AMT_5
	                    , DRAWL_AMT
	                 FROM MSS.MG_GIFTDRAWL GDRA
	                    , COM.TC_COMMCODE COMM
	                WHERE GDRA.DRAWL_FLAG = COMM.COMM_CODE
	                  AND COMM.COMM_PART = 'M076' /*회수구분*/
	                  AND GDRA.DRAWL_STR  IN ( SELECT STR_CD
	                                             FROM COM.V_MYORG
	                                            WHERE USE_YN = 'Y'
	                                              AND USER_ID = ?
	                                              AND ORG_FLAG = ?
	                                              AND STR_CD LIKE ?||'%'
	                                            GROUP BY STR_CD )
	                  AND DRAWL_STR = ?
	                  AND DRAWL_DT BETWEEN ? AND ?)
	       GROUP BY DRAWL_STR, DRAWL_DT
	    ]]>
	</query>    
	  
    <!-- 자사상품권 회수 비교표  디테일  조회 -->
	<query name="SEL_GIFTDRAWL_DETAIL">
	    <![CDATA[
			SELECT TA.DRAWL_STR,
			       DPS.FN_GET_STORE_NAME(TA.DRAWL_STR) AS STR_NM,
			       TA.DRAWL_DT,
			       --TA.SALE_SLIP_NO,
			       --TA.STR_CD||TA.SALE_DT||TA.SALE_SLIP_NO||SALE_CD AS SALE_NO,
			       --TA.STR_CD||'-'||TA.SALE_DT||'-'||TA.SALE_SLIP_NO||SALE_CD AS SALE_NO1,
			       TA.DRAWL_FLAG,
			       (SELECT COMM_NAME1 FROM COM.TC_COMMCODE WHERE COMM_PART = 'M076' AND SYS_PART = 'D' AND COMM_CODE = TA.DRAWL_FLAG) AS DRAWL_FLAG_NM,
			       --TA.DRAWL_TYPE,
			       1 AS DRAWL_QTY,
			       TA.DRAWL_AMT,
			       TA.GIFTCARD_NO,
			       --GIFT_TYPE_NAME,
			       TC.GIFT_AMT_TYPE,
			       TC.GIFT_AMT_NAME,
			       TC.GIFTCERT_AMT,
			       (SELECT MAX(DRAWL_STR||'-'||DRAWL_DT||'-'||POS_NO||'-'||TRAN_NO) FROM MSS.MG_POSDRAWL WHERE GIFTCARD_NO = TA.GIFTCARD_NO) AS POS_TRAN
                FROM MSS.MG_GIFTDRAWL TA ,
			     MSS.MG_GIFTAMTMST TC,
			     MSS.MG_GIFTTPMST TD,
			     MSS.MG_GIFTMST TE
               WHERE TA.DRAWL_STR LIKE ?||'%'
		        AND TA.DRAWL_DT BETWEEN ? AND ?
		        AND TA.DRAWL_FLAG LIKE ?||'%'
				AND TA.GIFTCARD_NO = TE.GIFTCARD_NO
				AND TC.GIFT_TYPE_CD = TE.GIFT_TYPE_CD
				AND TC.GIFT_AMT_TYPE = TE.GIFT_AMT_TYPE
				AND TD.GIFT_TYPE_CD = TE.GIFT_TYPE_CD
			ORDER BY DRAWL_STR,
				DRAWL_DT,
				DRAWL_FLAG,
				DRAWL_FLAG_NM,
				DRAWL_TYPE,
				GIFTCARD_NO
	      ]]>
	</query>  

	<query name="SEL_GIFTDRAWL_DETAIL_OLD">
	    <![CDATA[
            SELECT A.GIFT_TYPE_CD
                 , GIFT_TYPE_NAME
                 , A.GIFT_AMT_TYPE
                 , GIFT_AMT_NAME
                 , GIFTCARD_NO
                 , DRAWL_AMT 
                 , DRAWL_FLAG
              FROM MSS.MG_GIFTDRAWL A
                 , MSS.MG_GIFTTPMST B
                 , MSS.MG_GIFTAMTMST C
             WHERE A.GIFT_TYPE_CD = B.GIFT_TYPE_CD
               AND A.GIFT_TYPE_CD = C.GIFT_TYPE_CD
               AND A.ISSUE_TYPE = C.ISSUE_TYPE
               AND A.GIFT_AMT_TYPE = C.GIFT_AMT_TYPE
               AND DRAWL_STR = ?
               AND DRAWL_DT = ?
	      ]]>
	</query>  
          
    <!-- 자사상품권 회수 비교표  팝업  조회 -->
	<query name="SEL_GIFTDRAWL_POP">
	    <![CDATA[
		SELECT A.GIFT_TYPE_CD
             , GIFT_TYPE_NAME
             , A.GIFT_AMT_TYPE
             , GIFT_AMT_NAME
             , SUM(QTY_1) AS QTY_1
             , SUM(AMT_1) AS QTY_1
             , SUM(QTY_2) AS QTY_2
             , SUM(AMT_2) AS AMT_2
             , SUM(QTY_3) AS QTY_3
             , SUM(AMT_3) AS AMT_3
             , SUM(QTY_4) AS QTY_4
             , SUM(AMT_4) AS AMT_4
             , SUM(QTY_5) AS QTY_5
             , SUM(AMT_5) AS AMT_5
             , COUNT(1)     AS QTY_A
             , SUM(DRAWL_AMT)   AS AMT_A
          FROM (SELECT GIFT_TYPE_CD
                     , GIFT_AMT_TYPE
                     , ISSUE_TYPE
                     , CASE WHEN DRAWL_FLAG = '1' THEN 1 ELSE 0 END         AS QTY_1
                     , CASE WHEN DRAWL_FLAG = '1' THEN DRAWL_AMT ELSE 0 END AS AMT_1
                     , CASE WHEN DRAWL_FLAG = '5' THEN 1 ELSE 0 END         AS QTY_2
                     , CASE WHEN DRAWL_FLAG = '5' THEN DRAWL_AMT ELSE 0 END AS AMT_2
                     , CASE WHEN DRAWL_FLAG = '2' THEN 1 ELSE 0 END         AS QTY_3
                     , CASE WHEN DRAWL_FLAG = '2' THEN DRAWL_AMT ELSE 0 END AS AMT_3
                     , CASE WHEN DRAWL_FLAG = '3' THEN 1 ELSE 0 END         AS QTY_4
                     , CASE WHEN DRAWL_FLAG = '3' THEN DRAWL_AMT ELSE 0 END AS AMT_4
                     , CASE WHEN DRAWL_FLAG = '4' THEN 1 ELSE 0 END         AS QTY_5
                     , CASE WHEN DRAWL_FLAG = '4' THEN DRAWL_AMT ELSE 0 END AS AMT_5
                     , DRAWL_AMT
                  FROM MSS.MG_GIFTDRAWL GDRA
                     , COM.TC_COMMCODE COMM
                 WHERE GDRA.DRAWL_FLAG = COMM.COMM_CODE
                   AND COMM.COMM_PART = 'M076'
                   AND GDRA.DRAWL_STR = ?
                   AND GDRA.DRAWL_DT = ?
                   ) A
                 , MSS.MG_GIFTTPMST B
                 , MSS.MG_GIFTAMTMST C
             WHERE A.GIFT_TYPE_CD = B.GIFT_TYPE_CD 
               AND A.GIFT_TYPE_CD = C.GIFT_TYPE_CD
               AND A.ISSUE_TYPE = C.ISSUE_TYPE
               AND A.GIFT_AMT_TYPE = C.GIFT_AMT_TYPE
        GROUP BY A.GIFT_TYPE_CD, A.GIFT_AMT_TYPE, GIFT_TYPE_NAME, GIFT_AMT_NAME
	    ]]>
	</query>  
</service>