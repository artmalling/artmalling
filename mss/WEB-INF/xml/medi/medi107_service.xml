<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 조승배
 * 회 사 명 : FKSS
 * 작 성 일 : 2012.07.05
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 : 협력사 사원 관리
 -->
<service name="/medi107.md">

    <gauce name="H_SEL_LIST">
    	<column colName="STR_CD"				colType="TB_STRING"		size="2"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="VEN_CD"				colType="TB_STRING"		size="6"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="PUMBUN_CD"				colType="TB_STRING"		size="6"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="CUST_NAME"				colType="TB_STRING"		size="40"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="CARD_NO"				colType="TB_STRING"		size="64"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="SEX_CD"				colType="TB_STRING"		size="1"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="BIRTH_DT"				colType="TB_STRING"		size="10"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="BIRTH_LUNAR_FLAG"		colType="TB_STRING"		size="1"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="WED_DT"				colType="TB_STRING"		size="10"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="WED_LUNAR_FLAG"		colType="TB_STRING"		size="1"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="HOME_ZIP_CD1"			colType="TB_STRING"		size="3"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="HOME_ZIP_CD2"			colType="TB_STRING"		size="3"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="HOME_ADDR1"			colType="TB_STRING"		size="200"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="HOME_ADDR2"			colType="TB_STRING"		size="200"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="HOME_PH1"				colType="TB_STRING"		size="3"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="HOME_PH2"				colType="TB_STRING"		size="4"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="HOME_PH3"				colType="TB_STRING"		size="4"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="MOBILE_PH1"			colType="TB_STRING"		size="3"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="MOBILE_PH2"			colType="TB_STRING"		size="4"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="MOBILE_PH3"			colType="TB_STRING"		size="4"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="OFFI_ZIP_CD1"			colType="TB_STRING"		size="3"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="OFFI_ZIP_CD2"			colType="TB_STRING"		size="3"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="OFFI_ADDR1"			colType="TB_STRING"		size="200"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="OFFI_ADDR2"			colType="TB_STRING"		size="200"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="OFFI_PH1"				colType="TB_STRING"		size="3"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="OFFI_PH2"				colType="TB_STRING"		size="4"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="OFFI_PH3"				colType="TB_STRING"		size="4"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="OFFI_FAX1"				colType="TB_STRING"		size="3"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="OFFI_FAX2"				colType="TB_STRING"		size="4"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="OFFI_FAX3"				colType="TB_STRING"		size="4"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="EMAIL1"				colType="TB_STRING"		size="50"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="EMAIL2"				colType="TB_STRING"		size="50"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="DOMAIN_FLAG"			colType="TB_STRING"		size="2"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="HOBBY"					colType="TB_STRING"		size="100"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="RELIGION"				colType="TB_STRING"		size="100"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="REG_DATE"				colType="TB_STRING"		size="10"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="ETC"					colType="TB_STRING"		size="200"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column	colName="SALE_AMT"				colType="TB_DECIMAL"	size="13"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column colName="REGUCUST_ID"			colType="TB_STRING"		size="9"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="SEQ_NO"				colType="TB_DECIMAL"	size="5"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="FAMILY1"				colType="TB_STRING"		size="40"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="FAMILY1_NM"			colType="TB_STRING"		size="40"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="FAMILY2"				colType="TB_STRING"		size="40"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="FAMILY2_NM"			colType="TB_STRING"		size="40"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="FAMILY3"				colType="TB_STRING"		size="40"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="FAMILY3_NM"			colType="TB_STRING"		size="40"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="FAMILY4"				colType="TB_STRING"		size="40"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="FAMILY4_NM"			colType="TB_STRING"		size="40"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="ETC2"					colType="TB_STRING"		size="200"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />		
		<column colName="GRADE"					colType="TB_STRING"		size="200"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />		
		<column colName="SMS_FLAG"				colType="TB_STRING"		size="200"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />		
		<column colName="EMAIL_FLAG"			colType="TB_STRING"		size="200"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />		
		<column colName="WED_FLAG"				colType="TB_STRING"		size="200"	dec="0" keyType="TB_NORMAL" roundMode="ROUND" />		
    </gauce>

    <!-- 쿼리는 전부 대문자 -->
    <!-- 마스터 조회 쿼리  -->
    <query name="SEL_LIST">
        <![CDATA[
            SELECT B.STR_CD				AS STR_CD
            	 , B.VEN_CD				AS VEN_CD 
                 , B.PUMBUN_CD			AS PUMBUN_CD
                 , A.CUST_NAME			AS CUST_NAME
                 , DCS.SC_Crypto_FUN('DEC', A.CARD_NO)			AS CARD_NO
                 , A.SEX_CD				AS SEX_CD				-- 'M':남자, 'F':여자 (D002)
                 , TO_CHAR(TO_DATE(A.BIRTH_DT, 'YYYYMMDD'), 'YYYY/MM/DD') AS BIRTH_DT
                 , A.BIRTH_LUNAR_FLAG	AS BIRTH_LUNAR_FLAG		-- 'S':양력, 'L':음력 (D001)
                 , TO_CHAR(TO_DATE(A.WED_DT, 'YYYYMMDD'), 'YYYY/MM/DD') AS WED_DT
                 , A.WED_LUNAR_FLAG		AS WED_LUNAR_FLAG		-- 'S':양력, 'L':음력 (D001)
                 , A.HOME_ZIP_CD1		AS HOME_ZIP_CD1
                 , A.HOME_ZIP_CD2		AS HOME_ZIP_CD2
                 , A.HOME_ADDR1			AS HOME_ADDR1
                 , A.HOME_ADDR2			AS HOME_ADDR2
                 , DCS.SC_Crypto_FUN('DEC', A.HOME_PH1)			AS HOME_PH1
                 , DCS.SC_Crypto_FUN('DEC', A.HOME_PH2)			AS HOME_PH2
                 , DCS.SC_Crypto_FUN('DEC', A.HOME_PH3)			AS HOME_PH3
                 , DCS.SC_Crypto_FUN('DEC', A.MOBILE_PH1)			AS MOBILE_PH1
                 , DCS.SC_Crypto_FUN('DEC', A.MOBILE_PH2)			AS MOBILE_PH2
                 , DCS.SC_Crypto_FUN('DEC', A.MOBILE_PH3)			AS MOBILE_PH3
                 , A.OFFI_ZIP_CD1		AS OFFI_ZIP_CD1
                 , A.OFFI_ZIP_CD2		AS OFFI_ZIP_CD2
                 , A.OFFI_ADDR1			AS OFFI_ADDR1
                 , A.OFFI_ADDR2			AS OFFI_ADDR2
                 , A.OFFI_PH1			AS OFFI_PH1
                 , A.OFFI_PH2			AS OFFI_PH2
                 , A.OFFI_PH3			AS OFFI_PH3
                 , A.OFFI_FAX1			AS OFFI_FAX1
                 , A.OFFI_FAX2			AS OFFI_FAX2
                 , A.OFFI_FAX3			AS OFFI_FAX3
                 , DCS.SC_Crypto_FUN('DEC', A.EMAIL1)				AS EMAIL1
                 , DCS.SC_Crypto_FUN('DEC', A.EMAIL2)				AS EMAIL2
                 , A.DOMAIN_FLAG		AS DOMAIN_FLAG
                 , A.HOBBY				AS HOBBY
                 , A.RELIGION			AS RELIGION
                 , TO_CHAR(A.REG_DATE, 'YYYY/MM/DD') AS REG_DATE
                 , A.ETC				AS ETC
				 , (SELECT SUM(NVL(C.SALE_AMT, 0)) - SUM(NVL(C.RETURN_AMT,0)) AS SALE_AMT
                      FROM DPS.PS_DAYCUST C
                         , DPS.PC_STRPBN  D
                     WHERE C.SALE_DT BETWEEN TO_CHAR(ADD_MONTHS(SYSDATE, -3), 'YYYYMMDD') AND TO_CHAR(SYSDATE, 'YYYYMMDD')
                       AND C.STR_CD    = B.STR_CD
                       AND C.CUST_NO   = A.CUST_ID
                       AND D.STR_CD    = B.STR_CD
                       AND C.PUMBUN_CD = B.PUMBUN_CD
                       AND D.PUMBUN_CD = B.PUMBUN_CD
                       AND D.VEN_CD    = B.VEN_CD
                   ) AS SALE_AMT
                 , A.REGUCUST_ID		AS REGUCUST_ID
                 , B.SEQ_NO				AS SEQ_NO                   
                 , A.FAMILY1			AS FAMILY1
                 , A.FAMILY1_NM			AS FAMILY1_NM
                 , A.FAMILY2			AS FAMILY2
                 , A.FAMILY2_NM			AS FAMILY2_NM
                 , A.FAMILY3			AS FAMILY3
                 , A.FAMILY3_NM			AS FAMILY3_NM
                 , A.FAMILY4			AS FAMILY4
                 , A.FAMILY4_NM			AS FAMILY4_NM
                 , A.ETC2				AS ETC2
                 , A.GRADE
	             , A.SMS_FLAG
	             , A.EMAIL_FLAG
	             , A.WED_FLAG
              FROM DPS.PC_REGUCUSTMST A
                 , DPS.PC_REGUCUSTDTL B
             WHERE B.STR_CD = ?
               AND B.VEN_CD = ?
               AND B.PUMBUN_CD = ?
               AND A.REGUCUST_ID = B.REGUCUST_ID
        ]]>
    </query>

    <query name="SEL_LIST_CUST_NAME">
        <![CDATA[
			AND A.CUST_NAME LIKE '%' || ? || '%'
        ]]>
    </query>
    
	<query name="SEL_LIST_CARD_NO">
        <![CDATA[
			AND A.CARD_NO = DCS.SC_Crypto_FUN('ENC',?) 
        ]]>
    </query>

    <query name="SEL_LIST_REG_DATE">
        <![CDATA[
			AND TO_CHAR(A.REG_DATE ,'YYYYMMDD') BETWEEN ? AND ?
        ]]>
	</query>
</service>