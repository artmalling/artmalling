<?xml version="1.0"	encoding="euc-kr"?>
<!-- XML 버전 1.0을	사용하며 encoding 타입은 ‘euc-kr’로 한다.	-->
<!-- 
* 작 성	자 : KHJ	
* 회 사	명 : 한국후지쯔	
* 작 성	일 : 2016.11.15	
* 변 경	일 : 
* 변경내용:	
* 개 요	: 사은품 지급 등록	-->
<service name="/mcae434.mc">
	<!-- 화면 로딩시 행사 정보 조회	-->
	<gauce name="H_EVENT_INFO">
		<column	colName="STR_CD"			colType="TB_STRING"  size="2"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="STR_NM"			colType="TB_STRING"  size="40"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="EVENT_TYPE"		colType="TB_STRING"  size="30"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="EVENT_TYPE_NM"		colType="TB_STRING"  size="30"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="EVENT_CD"			colType="TB_STRING"  size="11"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="EVENT_NAME"		colType="TB_STRING"  size="40"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="EVENT_S_DT"		colType="TB_STRING"  size="8"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="EVENT_E_DT"		colType="TB_STRING"  size="8"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="PC_EVENT_TYPE_NM"		colType="TB_STRING"  size="30"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="EVENT_GIFT_CYC"	colType="TB_STRING"  size="10"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="CUST_ONLY_YN"		colType="TB_STRING"  size="10"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="CARD_ONLY_YN"		colType="TB_STRING"  size="10"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="RECP_ADD_YN"		colType="TB_STRING"  size="10"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="RECP_TODAY_YN"		colType="TB_STRING"  size="10"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="RECP_YN"			colType="TB_STRING"  size="10"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="CYC_DPN"			colType="TB_STRING"  size="10"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="TODAY_YN"			colType="TB_STRING"  size="10"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
	</gauce>   
	    
	<!-- 브랜드 사은행사 조회 -->
	<gauce name="H_PB_EVENT">
		<column	colName="STR_CD"			colType="TB_STRING"  size="2"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="EVENT_CD"			colType="TB_STRING"  size="11"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="SALE_AMT_TAX"		colType="TB_DECIMAL" size="12"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="APP_RATE_AMT"		colType="TB_DECIMAL" size="12"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="DBL_PAID_YN"		colType="TB_STRING"  size="2"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="RECEIPT_CNT"		colType="TB_DECIMAL" size="3"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="F_RECEIPT_NO"		colType="TB_STRING"  size="200"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="EVENT_NM"			colType="TB_STRING"	 size="40"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />		
	</gauce>
	              
	<!-- 결제유형별 사은행사 조회 -->
	<gauce name="H_PAID_EVENT">
		<column	colName="STR_CD"			colType="TB_STRING"  size="2"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="EVENT_CD"			colType="TB_STRING"  size="11"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="PAY_TYPE_CASH"		colType="TB_STRING"  size="2"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="PAY_TYPE_CARD"		colType="TB_STRING"  size="2"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="PAY_TYPE_GIFT"		colType="TB_STRING"  size="2"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="SALE_AMT_TAX"		colType="TB_DECIMAL" size="12"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="DBL_PAID_YN"		colType="TB_STRING"  size="2"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="RECEIPT_CNT"		colType="TB_DECIMAL" size="3"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="F_RECEIPT_NO"		colType="TB_STRING"  size="200"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="EVENT_NM"			colType="TB_STRING"	 size="40"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />		
	</gauce>
	                                                                                   	
	                 
	<!-- 제휴카드 사은행사 조회 -->
	<gauce name="H_CARD_EVENT">
		<column	colName="STR_CD"			colType="TB_STRING"  size="2"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="EVENT_CD"			colType="TB_STRING"  size="11"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="CARD_PUBLISH"   	colType="TB_STRING"  size="2"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="SALE_AMT_TAX"		colType="TB_DECIMAL" size="12"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="DBL_PAID_YN"		colType="TB_STRING"  size="2"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="RECEIPT_CNT"		colType="TB_DECIMAL" size="3"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="F_RECEIPT_NO"		colType="TB_STRING"  size="200"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="EVENT_NM"			colType="TB_STRING"	 size="40"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
	</gauce>
	
	
	<!-- 스캔영수증 조회 -->
	<gauce name="H_RECEIPT">
		<column	colName="STR_CD"			colType="TB_STRING"  size="2"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="SALE_DT"			colType="TB_STRING"  size="8"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="RECEIPT_NO"		colType="TB_STRING"  size="20"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="SALE_AMT_TAX"		colType="TB_DECIMAL" size="12"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="F_RECEIPT_NO"		colType="TB_STRING"  size="24"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
	</gauce>	 
	          
	
	<!-- 영수증 정보 조회 -->
	<gauce name="H_SALE_INFO">
		<column	colName="CHK"				colType="TB_STRING"  size="1"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="PROVIDE_GB_NM"		colType="TB_STRING"  size="40"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="PROVIDE_GB"		colType="TB_STRING"  size="1"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="STR_CD"			colType="TB_STRING"  size="2"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="SALE_DT"			colType="TB_STRING"  size="8"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="POS_NO"			colType="TB_STRING"  size="4"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="TRAN_NO"			colType="TB_STRING"  size="5"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="TOT_SALE_AMT"		colType="TB_DECIMAL" size="12"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="SALE_AMT"			colType="TB_DECIMAL" size="12"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="DIV_AMT"			colType="TB_DECIMAL" size="12"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="CUST_NO"			colType="TB_STRING"	 size="20"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="PRE_PRSNT_YN"		colType="TB_STRING"	 size="1"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
	</gauce>

	<!-- 고객카드 정보 조회-->
	<gauce name="H_CARD_INFO">
		<column	colName="SCED_YN"			colType="TB_STRING"  size="1"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="RETURN"			colType="TB_STRING"  size="10"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="MESSAGE"			colType="TB_STRING"  size="100"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="CUST_ID"			colType="TB_STRING"  size="9"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
	</gauce>

	<!-- 지급품정보(중복지급)  사은품 조회 SEL_SKU_LIST  -->   
	<gauce name="H_SKU_LIST_ALL">
		<column	colName="CHK"				colType="TB_STRING"  size="1"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="TRG_CD"			colType="TB_STRING"  size="2"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="TRG_NAME"			colType="TB_STRING"  size="40"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="SKU_CD"			colType="TB_STRING"  size="13"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="SKU_NAME"			colType="TB_STRING"	 size="40"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="BUY_COST_PRC"		colType="TB_DECIMAL" size="9"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="SKU_GB"			colType="TB_STRING"  size="1"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="EVENT_CD"			colType="TB_STRING"  size="11"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="SALE_AMT_TAX"		colType="TB_DECIMAL" size="12"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="APP_RATE_AMT"		colType="TB_DECIMAL" size="12"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="RECEIPT_CNT"		colType="TB_DECIMAL" size="3"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="F_RECEIPT_NO"		colType="TB_STRING"  size="200"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="EVENT_NM"			colType="TB_STRING"	 size="40"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />	
		<column	colName="GIFTCARD_NO"		colType="TB_STRING"  size="20"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />	
		<column	colName="GIFTCERT_AMT"		colType="TB_DECIMAL" size="9"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />	
		<column	colName="GIFTCARD_CNT"		colType="TB_DECIMAL" size="9"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />	
		<column	colName="GIFTCARD_LIST"		colType="TB_STRING"  size="200"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />					
	</gauce>                    
	
	<!-- 지급품정보(중복불가) 사은품 조회 SEL_SKU_LIST  -->
	<gauce name="H_SKU_LIST">
		<column	colName="CHK"				colType="TB_STRING"  size="1"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="TRG_CD"			colType="TB_STRING"  size="2"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="TRG_NAME"			colType="TB_STRING"  size="40"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="SKU_CD"			colType="TB_STRING"  size="13"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="SKU_NAME"			colType="TB_STRING"	 size="40"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="BUY_COST_PRC"		colType="TB_DECIMAL" size="9"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="SKU_GB"			colType="TB_STRING"  size="1"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="EVENT_CD"			colType="TB_STRING"  size="11"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="SALE_AMT_TAX"		colType="TB_DECIMAL" size="12"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="APP_RATE_AMT"		colType="TB_DECIMAL" size="12"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="RECEIPT_CNT"		colType="TB_DECIMAL" size="3"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="F_RECEIPT_NO"		colType="TB_STRING"  size="200"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />	
		<column	colName="EVENT_NM"			colType="TB_STRING"	 size="40"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />	
		<column	colName="GIFTCARD_NO"		colType="TB_STRING"  size="20"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />		
		<column	colName="GIFTCERT_AMT"		colType="TB_DECIMAL" size="9"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />	
		<column	colName="GIFTCARD_CNT"		colType="TB_DECIMAL" size="9"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />	
		<column	colName="GIFTCARD_LIST"		colType="TB_STRING"  size="200"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />	
	</gauce>
	
	
	<!-- 제휴카드행사 사은품 조회      SEL_SKU_LIST   -->
	<gauce name="H_SKU_LIST_CARD">
		<column	colName="CHK"				colType="TB_STRING"  size="1"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="TRG_CD"			colType="TB_STRING"  size="2"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="TRG_NAME"			colType="TB_STRING"  size="40"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="SKU_CD"			colType="TB_STRING"  size="13"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="SKU_NAME"			colType="TB_STRING"	 size="40"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="BUY_COST_PRC"		colType="TB_DECIMAL" size="9"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="SKU_GB"			colType="TB_STRING"  size="1"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="EVENT_CD"			colType="TB_STRING"  size="11"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="SALE_AMT_TAX"		colType="TB_DECIMAL" size="12"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="APP_RATE_AMT"		colType="TB_DECIMAL" size="12"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="RECEIPT_CNT"		colType="TB_DECIMAL" size="3"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="F_RECEIPT_NO"		colType="TB_STRING"  size="200"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="EVENT_NM"			colType="TB_STRING"	 size="40"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="GIFTCARD_NO"		colType="TB_STRING"  size="20"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />	
		<column	colName="GIFTCERT_AMT"		colType="TB_DECIMAL" size="9"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />	
		<column	colName="GIFTCARD_CNT"		colType="TB_DECIMAL" size="9"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />	
		<column	colName="GIFTCARD_LIST"		colType="TB_STRING"  size="200"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />			
	</gauce>
	
	<!-- 상품권 번호조회 -->
	<gauce name="H_GIFTCARD_NO_CHK">
		<column	colName="GIFTCARD_NO"		colType="TB_STRING"  size="18"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="GIFTCERT_AMT"		colType="TB_DECIMAL" size="9"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
	</gauce>

	<!-- 상품권 조회 -->
	<gauce name="H_GIFTCARD_NO">
		<column	colName="GIFTCARD_NO"		colType="TB_STRING"  size="18"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="GIFTCERT_AMT"		colType="TB_DECIMAL" size="9"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
	</gauce>
		
	<!-- 사은행사 콤보 조회	-->
	<gauce name="H_COMBO">
		<column	colName="CODE"				colType="TB_STRING"  size="11"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
		<column	colName="NAME"				colType="TB_STRING"  size="50"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
	</gauce>

	<!-- 매출정보 유무 확인	-->
	<gauce name="H_SALECHK">
		<column	colName="CNT"				colType="TB_STRING"  size="1"	dec="0"	keyType="TB_NORMAL"	roundMode="ROUND" />
	</gauce>


	<!-- 화면 로딩시 행사 정보 조회	 (콤보조회)-->
	<query name="SEL_EVENT_COMBO">
		<![CDATA[
			SELECT B.EVENT_CD AS CODE
				 , A.EVENT_NAME	AS NAME
			  FROM DPS.PC_EVTMST A,	DPS.PC_STREVT B, MSS.MC_EVTMST C
			 WHERE A.EVENT_CD =	B.EVENT_CD
			   AND B.STR_CD	= C.STR_CD
			   AND B.EVENT_CD =	C.EVENT_CD
			   AND A.EVENT_TYPE	= 4
			   AND B.STR_CD	= ?	
			   AND ? BETWEEN B.EVENT_S_DT AND B.EVENT_E_DT
			   AND ( ( C.EVENT_TYPE = '03' -- 보너스카드 고객 만
			         AND C.EVENT_GIFT_TYPE <> '01') -- 상품권 만
                     OR ( C.EVENT_TYPE = '01')) 
		]]>
	</query>
	
	<!-- 영수증	정보 조회전	매출정보 유무 확인 -->
	<query name="SEL_SALECHK">
		<![CDATA[
		SELECT COUNT(*)	AS CNT 
		  FROM DPS.PS_TRHEADER
		 WHERE STR_CD =	?
		   AND SALE_DT = ?
		   AND POS_NO =?
		   AND TRAN_NO = ?
		]]>
	</query>
	
	
    <!-- 영수증 반품여부 체크  -->
    <query name="SEL_TRHEADER_CHK">
        <![CDATA[    
            SELECT STR_CD
                 , SALE_DT
                 , POS_NO 
                 , TRAN_NO
              FROM DPS.PS_TRHEADER 
             WHERE TRAN_FLAG = '1' --거래형태(1:반품) 
               AND STR_CD 	 = SUBSTR(? ,  12, 2)
               AND O_SALE_DT = SUBSTR(? ,  1 , 8)
               AND O_POS_NO  = SUBSTR(? ,  14, 4)
               AND O_TRAN_NO = SUBSTR(? ,  18, 5)
         ]]>
    </query>
	
	<!-- 영수증의 사은품지급여부 확인 -->
	<query name="SEL_CHECK_RECEIPT">
		<![CDATA[
			SELECT A.PRSNT_DT
	          FROM MSS.MC_PRSNTRECP A
	             , MSS.MC_EVTSKUPRSNT B   
			 WHERE  A.PRSNT_DT  = B.PRSNT_DT
			    AND A.STR_CD    = B.STR_CD 
			    AND A.PRSNT_NO  = B.PRSNT_NO
			    AND B.PRSNT_FLAG IN ('1', '2')    -- 지급구분(M004) 1:정상지급, 2:예외지급  -- 예외지급발생없음(영수증단위처리가 안됨)
			    AND B.CANCEL_GB = '1'             -- 취소구분= 1:정상  2:취소 -지급취소시 원전표는 2로 변경, 지급취소 NEW생성시 1:정상으로 생성
			    AND A.STR_CD   = ?
			    AND A.SALE_DT  = ?
			    AND A.POS_NO   = ?
			    AND A.TRAN_NO  = ?
		]]>
	</query>
	
	
	<!-- 영수증 내역 조회 -->
	<query name="SEL_RECEIPT_LIST">
		<![CDATA[
			SELECT A.STR_CD
			     , A.SALE_DT
			     , ( A.SALE_DT || A.POS_NO || A.TRAN_NO ) AS RECEIPT_NO
			     , A.SALE_TOT_AMT AS SALE_AMT_TAX
		      FROM DPS.PS_TRHEADER A
		     WHERE A.STR_CD = ?
		       AND A.SALE_DT = ?
		       AND A.POS_NO = ?
		       AND A.TRAN_NO = ?
		       AND A.TRAN_FLAG = '0'   -- 거래구분 = 정상
		]]>
	</query>
		
		
	<query name="SEL_EVENT_INFO">
		<![CDATA[
			SELECT C.STR_CD
                 , DPS.FN_GET_STORE_NAME(C.STR_CD) AS STR_NM
                 , C.EVENT_TYPE AS EVENT_TYPE				--사은행사유형                 
                 , COM.FN_GET_COMM_NAME('D','M002',C.EVENT_TYPE) AS EVENT_TYPE_NM				--사은행사유형                 
                 , B.EVENT_CD
                 , A.EVENT_NAME
                 , B.EVENT_S_DT
                 , B.EVENT_E_DT
                 , D.COMM_NAME1 AS PC_EVENT_TYPE_NM											--행사종류
                 , COM.FN_GET_COMM_NAME('D','M201',C.EVENT_GIFT_CYC)	AS EVENT_GIFT_CYC	--사은품지급주기
                 , COM.FN_GET_COMM_NAME('D','M206',C.CUST_ONLY_YN)		AS CUST_ONLY_YN		--보너스카드 ONLY    
                 , COM.FN_GET_COMM_NAME('D','M207',C.CARD_ONLY_YN)		AS CARD_ONLY_YN		--신용카드 ONLY                 
                 , COM.FN_GET_COMM_NAME('D','M202',C.RECP_ADD_YN)		AS RECP_ADD_YN		--영수증합산
                 , COM.FN_GET_COMM_NAME('D','M203',C.RECP_TODAY_YN)		AS RECP_TODAY_YN	--영수증당일여부
                 , C.RECP_ADD_YN AS RECP_YN
                 , C.EVENT_GIFT_CYC AS CYC_DPN
                 , C.RECP_TODAY_YN AS TODAY_YN
			  FROM DPS.PC_EVTMST A
				 , DPS.PC_STREVT B
				 , MSS.MC_EVTMST C 
				 , COM.TC_COMMCODE D 
             WHERE A.EVENT_CD	= B.EVENT_CD
               AND B.STR_CD		= C.STR_CD
               AND B.EVENT_CD	= C.EVENT_CD
               AND A.EVENT_TYPE	IN ('4', '6')  -- 사은행사, 제휴사은행사
               AND B.STR_CD		= ?   
               AND D.COMM_PART	= 'P072'
               AND ? BETWEEN B.EVENT_S_DT AND B.EVENT_E_DT
               AND D.COMM_CODE	= A.EVENT_TYPE
		]]>
	</query>

	<!-- 전점 행사 여부	체크 -->
	<query name="SEL_CHK_ALLBRAND">
		<![CDATA[
		SELECT SUM(PUMBUN_CD) AS PUMBUN_CD
		  FROM (SELECT DECODE(PUMBUN_CD, '******', 0 , 1) AS PUMBUN_CD 
				  FROM MSS.MC_EVTPUMBUN	
				 WHERE STR_CD =	? 
				   AND EVENT_CD	= ?) 
		]]>
	</query>
	
	
	<!-- 영수증	브랜드 사은 정보 조회 -->
	<query name="SEL_PB_SALE_INFO">
		<![CDATA[
		  -- 브랜드사은행사에 인정율 적용한 인정금액 내역 [당일영수증:지급일기준]
			SELECT A.STR_CD
			       --, A.SALE_DT
		           , A.EVENT_CD
		           , SUM(A.SALE_AMT_TAX) AS SALE_AMT_TAX            --세포함순매줄
		           , SUM(A.APP_RATE_AMT) AS APP_RATE_AMT            --인정금액
		           --, SUM(A.SALE_AMT_TAX_PER) AS SALE_AMT_TAX_PER    --세포함순매줄
		           --, SUM(A.APP_RATE_AMT_PER) AS APP_RAT
			       , A.DBL_PAID_YN    --중복지급여부
		           , 1  AS RECEIPT_CNT      -- 영수증건수
                   , ?  AS F_RECEIPT_NO     --영수증번호                                     
                   , DPS.FN_GET_EVENT_NAME(A.EVENT_CD) AS EVENT_NM    
			FROM(           
			     SELECT A.STR_CD 
			           , A.SALE_DT
			           , A.POS_NO
			           , A.TRAN_NO
			           , A.PUMBUN_CD
			           , F.EVENT_CD
			           , F.APP_RATE
			           , F.DBL_PAID_YN    --중복지급여부
			           , F.RECP_TODAY_YN
			           , A.NET_SALE_AMT_TAX  AS SALE_AMT_TAX                       --세포함순매줄
			           , (A.NET_SALE_AMT_TAX * APP_RATE/100) AS APP_RATE_AMT       --인정금액
			           --, CASE WHEN F.RECP_TODAY_YN = 'Y' THEN A.NET_SALE_AMT_TAX ELSE 0 END  AS SALE_AMT_TAX                      --세포함순매줄
			           --, CASE WHEN F.RECP_TODAY_YN = 'Y' THEN A.NET_SALE_AMT_TAX * APP_RATE/100 ELSE 0 END  AS APP_RATE_AMT       --인정금액
			           --, CASE WHEN F.RECP_TODAY_YN = 'N' THEN A.NET_SALE_AMT_TAX ELSE 0 END  AS SALE_AMT_TAX_PER                  --세포함순매줄
			           --, CASE WHEN F.RECP_TODAY_YN = 'N' THEN A.NET_SALE_AMT_TAX * APP_RATE/100 ELSE 0 END  AS APP_RATE_AMT_PER   --인정금액
			          FROM DPS.PS_DISITEM A   --판매상품정보
			           , (
			               SELECT               
			                    A.EVENT_CD 
			                    , C.PUMBUN_CD
			                    , nvl(A.CAL_YN, 'F') CAL_YN
			                     , A.RECP_TODAY_YN
                                , A.DBL_PAID_YN   -- 중복지급여부
			                    --, (CASE NVL(A.CAL_YN, 'F') WHEN 'T' THEN C.APP_RATE ELSE 100 END) AS APP_RATE
			                    , C.APP_RATE AS APP_RATE
			               FROM MSS.MC_EVTMST A    --사은행사마스터
			                    , DPS.PC_STREVT B   --점별행사
			                    , MSS.MC_EVTPUMBUN C
			               WHERE A.STR_CD = B.STR_CD
			                 AND A.EVENT_CD = B.EVENT_CD
			                 AND A.STR_CD = C.STR_CD
			                 AND A.EVENT_CD = C.EVENT_CD 
			                 AND A.EVENT_TYPE = '01'   --브랜드사은행사
			                 --AND A.EVENT_TYPE <> '02'   --제휴카드행사를 제외
			                 --AND A.RECP_TODAY_YN = 'Y'  --당일영수증
			                 AND A.RECP_ADD_YN = 'Y'    --합산가능
			                 --AND NVL(A.CAL_YN, 'F') = 'T'  -- 정산을 하는것 = 브랜드사은행사
			                 AND A.STR_CD   = ?                           --1  '01'
			                 AND C.PUMBUN_CD <> '******' 
			                 AND ? BETWEEN B.EVENT_S_DT AND B.EVENT_E_DT  --2  '20161123'
			              UNION ALL            
			               SELECT               
			                    A.EVENT_CD 
			                    , CASE C.PUMBUN_CD WHEN '******' THEN D.PUMBUN_CD ELSE C.PUMBUN_CD END
			                    , nvl(A.CAL_YN, 'F') CAL_YN
			                    , A.RECP_TODAY_YN
                                , A.DBL_PAID_YN   -- 중복지급여부
			                    --, (CASE NVL(A.CAL_YN, 'F') WHEN 'T' THEN D.APP_RATE ELSE 100 END) AS APP_RATE
                   				, (CASE C.PUMBUN_CD WHEN '******' THEN D.APP_RATE ELSE 0 END) AS APP_RATE
			               FROM MSS.MC_EVTMST A    --사은행사마스터
			                    , DPS.PC_STREVT B   --점별행사
			                    , MSS.MC_EVTPUMBUN  C
			                    , MSS.MC_APPRATE  D
			               WHERE A.STR_CD = B.STR_CD
			                 AND A.EVENT_CD = B.EVENT_CD
			                 AND A.STR_CD = C.STR_CD
			                 AND A.EVENT_CD = C.EVENT_CD
			                 AND C.STR_CD = D.STR_CD(+)
			                 AND A.EVENT_TYPE = '01'   --브랜드사은행사
			                 --AND A.EVENT_TYPE <> '02'   --제휴카드행사를 제외
			                 --AND A.RECP_TODAY_YN = 'Y'  --당일영수증
			                 AND A.RECP_ADD_YN = 'Y'    --합산가능
			                 --AND NVL(A.CAL_YN, 'F') = 'T'  -- 정산을 하는것 = 브랜드사은행사
			                 AND A.STR_CD   =  ?                             --3  '01'
			                 AND C.PUMBUN_CD = '******' 
			                 AND ? BETWEEN B.EVENT_S_DT AND B.EVENT_E_DT     --4 '20161123'
			                 ) F
			         WHERE  A.PUMBUN_CD = F.PUMBUN_CD
			           AND A.STR_CD  = ?     --5 '01'
			           AND A.SALE_DT = ?     --6 '20161117'
			           AND A.POS_NO  = ?     --7 '1001'
			           AND A.TRAN_NO = ?     --8'00002'
			    ORDER BY  F.EVENT_CD , A.PUMBUN_CD
			                 
			    ) A			    
			GROUP BY A.STR_CD
			        --, A.SALE_DT
			        , A.EVENT_CD 
			        , A.DBL_PAID_YN
		 ]]>
	</query>
	
	
	<!-- 영수증	결제유형별 사은 정보 조회 -->
	<query name="SEL_PAID_SALE_INFO">
		<![CDATA[
		  -- 결제유형별사은행사  : 브랜드 인정율 적용 불가/정산 불가 [당일영수증:지급일기준]
			SELECT A.STR_CD
			     , A.EVENT_CD
			     , A.PAY_TYPE_CASH
			     , A.PAY_TYPE_CARD
			     , A.PAY_TYPE_GIFT
			     , SUM(A.CASH_AMT)+SUM(A.CARD_AMT)+SUM(A.GIFT_AMT)  AS SALE_AMT_TAX            -- 매출금액
			     , A.DBL_PAID_YN          --중복지급여부
		         , 1  AS RECEIPT_CNT      -- 영수증건수
                 , ?  AS F_RECEIPT_NO     --영수증번호                       
                 , DPS.FN_GET_EVENT_NAME(A.EVENT_CD) AS EVENT_NM    
			 FROM (               
			  	SELECT DISTINCT A.STR_CD 
					 , A.SALE_DT
				 	 , A.POS_NO
					 , A.TRAN_NO
					 , F.EVENT_CD
					 , F.DBL_PAID_YN    --중복지급여부
					 , F.PAY_TYPE_CASH
					 , F.PAY_TYPE_CARD
					 , F.PAY_TYPE_GIFT
					 , CASE WHEN F.PAY_TYPE_CASH = 'T' THEN NVL(B.SALE_AMT, 0) ELSE 0 END AS CASH_AMT
					 , CASE WHEN F.PAY_TYPE_CARD = 'T' THEN NVL(C.PAY_AMT, 0) ELSE 0 END AS CARD_AMT
					 , CASE WHEN F.PAY_TYPE_GIFT = 'T' THEN NVL(D.PAY_AMT, 0) ELSE 0 END AS GIFT_AMT
			      FROM DPS.PS_DISITEM A   --판매상품정보
			         --, DPS.PS_DISCASH B   --현금매출집계
			         --, DPS.PS_DISCARD C   --카드매출집계
			         --, DPS.PS_DISGIFT D   --상품권매출집계, 
					    , (SELECT B.STR_CD, B.SALE_DT, B.POS_NO, B.TRAN_NO, SUM(B.SALE_AMT) AS SALE_AMT
		                    FROM DPS.PS_DISCASH B   							 --현금매출집계                   
		                   WHERE B.STR_CD    = ?       				     	 --5 '01'
		                     AND B.SALE_DT   = ?         				     --6 '20161123'
		                     AND B.POS_NO    = ?         					 --7 '1001'
		                     AND B.TRAN_NO   = ?          					 --8 '00002'
		                  GROUP BY B.STR_CD, B.SALE_DT, B.POS_NO, B.TRAN_NO
		                    ) B                    
		               , (SELECT C.STR_CD, C.SALE_DT, C.POS_NO, C.TRAN_NO, SUM(C.PAY_AMT) AS PAY_AMT
		                   FROM DPS.PS_DISCARD C  								 --카드매출집계        
		                  WHERE C.STR_CD    = ?          					 --5 '01'
		                    AND C.SALE_DT   = ?          				     --6 '20161123'
		                    AND C.POS_NO    = ?          					 --7 '1001'
		                    AND C.TRAN_NO   = ?         					 --8 '00002'
		                  GROUP BY C.STR_CD, C.SALE_DT, C.POS_NO, C.TRAN_NO
		                 ) C
		               , (SELECT D.STR_CD, D.SALE_DT, D.POS_NO, D.TRAN_NO, SUM(D.PAY_AMT) AS PAY_AMT
		                    FROM DPS.PS_DISGIFT D   							 --상품권매출집계
		                   WHERE D.STR_CD    = ?          					 --5 '01'
		                     AND D.SALE_DT   = ?          				     --6 '20161123'
		                     AND D.POS_NO    = ?          					 --7 '1001'
		                     AND D.TRAN_NO   = ?        					 --8 '00002'
		                  GROUP BY D.STR_CD, D.SALE_DT, D.POS_NO, D.TRAN_NO
		                 ) D
			         , (   
			         	SELECT A.EVENT_CD 
			                 , C.PUMBUN_CD
			                 , A.DBL_PAID_YN     -- 중복지급여부
			                 , A.PAY_TYPE_CASH
			                 , A.PAY_TYPE_CARD
			                 , A.PAY_TYPE_GIFT
			              FROM MSS.MC_EVTMST A    --사은행사마스터
			                 , DPS.PC_STREVT B   --점별행사
			                 , MSS.MC_EVTPUMBUN C
			             WHERE A.STR_CD   = B.STR_CD
			               AND A.EVENT_CD = B.EVENT_CD
			               AND A.STR_CD   = C.STR_CD
			               AND A.EVENT_CD = C.EVENT_CD 
			               AND A.EVENT_TYPE = '03'   --결제유형별사은행사
			               AND A.STR_CD     = ?                           --1  '01' 
			               AND C.PUMBUN_CD <> '******' 
			               AND ? BETWEEN B.EVENT_S_DT AND B.EVENT_E_DT    --2  '20161123'
			              
			            UNION ALL
			            
			            SELECT A.EVENT_CD 
			                 , CASE C.PUMBUN_CD WHEN '******' THEN D.PUMBUN_CD ELSE C.PUMBUN_CD END AS PUMBUN_CD
			                 , A.DBL_PAID_YN         -- 중복지급여부
			                 , A.PAY_TYPE_CASH
			                 , A.PAY_TYPE_CARD
			                 , A.PAY_TYPE_GIFT
			              FROM MSS.MC_EVTMST A       --사은행사마스터
			                 , DPS.PC_STREVT B       --점별행사
			                 , MSS.MC_EVTPUMBUN  C
			                 , MSS.MC_APPRATE  D
			             WHERE A.STR_CD   = B.STR_CD
			               AND A.EVENT_CD = B.EVENT_CD
			               AND A.STR_CD   = C.STR_CD
			               AND A.EVENT_CD = C.EVENT_CD
			               AND C.STR_CD   = D.STR_CD(+)
			               AND A.EVENT_TYPE  = '03'   --결제유형별사은행사
			               AND A.STR_CD      = ?                           --3  '01'
			               AND C.PUMBUN_CD   = '******' 
			               AND ? BETWEEN B.EVENT_S_DT AND B.EVENT_E_DT     --4 '20161123'     
			          ) F                
			      WHERE A.PUMBUN_CD = F.PUMBUN_CD
			        AND A.STR_CD    = B.STR_CD(+)
			        AND A.SALE_DT   = B.SALE_DT(+)
			        AND A.POS_NO    = B.POS_NO(+)
			        AND A.TRAN_NO   = B.TRAN_NO(+)
			        AND A.STR_CD    = C.STR_CD(+)
			        AND A.SALE_DT   = C.SALE_DT(+)
			        AND A.POS_NO    = C.POS_NO(+)
			        AND A.TRAN_NO   = C.TRAN_NO(+)
			        AND A.STR_CD    = D.STR_CD(+)
			        AND A.SALE_DT   = D.SALE_DT(+)
			        AND A.POS_NO    = D.POS_NO(+)
			        AND A.TRAN_NO   = D.TRAN_NO(+)
			        AND A.STR_CD    = ?          --5 '01'
			        AND A.SALE_DT   = ?          --6 '20161123'
			        AND A.POS_NO    = ?          --7 '1001'
			        AND A.TRAN_NO   = ?          --8 '00002'
			    ) A
	         WHERE A.CASH_AMT > 0
	            OR A.CARD_AMT > 0
	            OR A.GIFT_AMT > 0
			GROUP BY A.STR_CD
			       , A.EVENT_CD
			       , A.PAY_TYPE_CASH
			       , A.PAY_TYPE_CARD
			       , A.PAY_TYPE_GIFT
	               , A.DBL_PAID_YN 
		 ]]>
	</query>
	
	
	<!-- 영수증 제휴카드행사 사은 정보 조회 -->
	<query name="SEL_CARD_SALE_INFO">
		<![CDATA[
		      -- 제휴카드사은행사  : 브랜드 인정율 적용 불가/정산 불가 [당일영수증:지급일기준]
		      SELECT A.STR_CD
		           , A.EVENT_CD
		           , A.CARD_PUBLISH
		           , SUM(A.CARD_AMT) AS SALE_AMT_TAX             -- 매출금액
		           , A.DBL_PAID_YN   							 --중복지급여부
		           , 1  AS RECEIPT_CNT      -- 영수증건수
                   , ?  AS F_RECEIPT_NO     --영수증번호                       
                   , DPS.FN_GET_EVENT_NAME(A.EVENT_CD) AS EVENT_NM    
		       FROM (               
		          SELECT DISTINCT A.STR_CD 
		                , A.SALE_DT
		                , A.POS_NO
		                , A.TRAN_NO
		                , F.EVENT_CD
		                , B.CARD_PUBLISH
		                , F.DBL_PAID_YN    --중복지급여부
		                , NVL(B.PAY_AMT, 0) AS CARD_AMT
		            FROM DPS.PS_DISITEM A   --판매상품정보
		               --, DPS.PS_DISCARD B   --카드매출집계                  
		               , (SELECT C.STR_CD, C.SALE_DT, C.POS_NO, C.TRAN_NO, C.CARD_PUBLISH, SUM(C.PAY_AMT) AS PAY_AMT
		                   FROM DPS.PS_DISCARD C  								 --카드매출집계        
		                  WHERE C.STR_CD    = ?          					 --5 '01'
		                    AND C.SALE_DT   = ?          				     --6 '20161123'
		                    AND C.POS_NO    = ?          					 --7 '1001'
		                    AND C.TRAN_NO   = ?         					 --8 '00002'
		                  GROUP BY C.STR_CD, C.SALE_DT, C.POS_NO, C.TRAN_NO, C.CARD_PUBLISH
		                 ) B
		               ,(   
		                SELECT A.EVENT_CD 
		                       , C.PUMBUN_CD
		                       , A.DBL_PAID_YN     -- 중복지급여부
		                       , A.PAY_TYPE_CASH
		                       , A.PAY_TYPE_CARD
		                       , A.PAY_TYPE_GIFT
		                    FROM MSS.MC_EVTMST A    --사은행사마스터
		                       , DPS.PC_STREVT B   --점별행사
		                       , MSS.MC_EVTPUMBUN C
		                   WHERE A.STR_CD   = B.STR_CD
		                     AND A.EVENT_CD = B.EVENT_CD
		                     AND A.STR_CD   = C.STR_CD
		                     AND A.EVENT_CD = C.EVENT_CD 
		                     AND A.EVENT_TYPE = '02'   --재휴카드별사은행사
		                     AND A.STR_CD     = ?                           --1  '01' 
		                     AND C.PUMBUN_CD <> '******' 
		                     AND ? BETWEEN B.EVENT_S_DT AND B.EVENT_E_DT    --2  '20161123'
		                    
		                  UNION ALL
		                  
		                  SELECT A.EVENT_CD 
		                       , CASE C.PUMBUN_CD WHEN '******' THEN D.PUMBUN_CD ELSE C.PUMBUN_CD END AS PUMBUN_CD
		                       , A.DBL_PAID_YN         -- 중복지급여부
		                       , A.PAY_TYPE_CASH
		                       , A.PAY_TYPE_CARD
		                       , A.PAY_TYPE_GIFT
		                    FROM MSS.MC_EVTMST A       --사은행사마스터
		                       , DPS.PC_STREVT B       --점별행사
		                       , MSS.MC_EVTPUMBUN  C
		                       , MSS.MC_APPRATE  D
		                   WHERE A.STR_CD   = B.STR_CD
		                     AND A.EVENT_CD = B.EVENT_CD
		                     AND A.STR_CD   = C.STR_CD
		                     AND A.EVENT_CD = C.EVENT_CD
		                     AND C.STR_CD   = D.STR_CD(+)
		                     AND A.EVENT_TYPE = '02'   --재휴카드별사은행사
		                     AND A.STR_CD      = ?                            --3  '01'
		                     AND C.PUMBUN_CD   = '******' 
		                     AND ?  BETWEEN B.EVENT_S_DT AND B.EVENT_E_DT     --4 '20161123'     
		                ) F                
		            WHERE A.PUMBUN_CD = F.PUMBUN_CD
		              AND A.STR_CD    = B.STR_CD(+)
		              AND A.SALE_DT   = B.SALE_DT(+)
		              AND A.POS_NO    = B.POS_NO(+)
		              AND A.TRAN_NO   = B.TRAN_NO(+)
		              AND A.STR_CD    = ?          --5 '01'
		              AND A.SALE_DT   = ?          --6 '20161123'
		              AND A.POS_NO    = ?          --7 '1001'
		              AND A.TRAN_NO   = ?          --8 '00002'
		          ) A
                  , MSS.MC_EVTMST B
              WHERE A.EVENT_CD     = B.EVENT_CD
                AND A.CARD_PUBLISH = B.CARD_COMP
		      GROUP BY A.STR_CD
		             , A.EVENT_CD
		             , A.CARD_PUBLISH
		             , A.DBL_PAID_YN 
		 ]]>
	</query>
	
	<!-- 영수증	브랜드 사은 합산 불가 정보 조회 -->
	<query name="SEL_PB_SALE_EACH_INFO">
		<![CDATA[
		  -- 사은행사별 인정율 적용한 인정금액 내역
			SELECT  A.STR_CD
			       --, A.SALE_DT
		           , A.EVENT_CD
		           , SUM(A.SALE_AMT_TAX) AS SALE_AMT_TAX            --세포함순매줄
		           , SUM(A.APP_RATE_AMT) AS APP_RATE_AMT            --인정금액
		           --, SUM(A.SALE_AMT_TAX_PER) AS SALE_AMT_TAX_PER    --세포함순매줄
		           --, SUM(A.APP_RATE_AMT_PER) AS APP_RATE_AMT_PER    --인정금액
			FROM(           
			     SELECT A.STR_CD 
			           , A.SALE_DT
			           , A.POS_NO
			           , A.TRAN_NO
			           , A.PUMBUN_CD
			           , F.EVENT_CD
			           , F.APP_RATE
			           , F.RECP_TODAY_YN
			           , A.NET_SALE_AMT_TAX  AS SALE_AMT_TAX                       --세포함순매줄
			           , (A.NET_SALE_AMT_TAX * APP_RATE/100) AS APP_RATE_AMT       --인정금액
			           --, CASE WHEN F.RECP_TODAY_YN = 'Y' THEN A.NET_SALE_AMT_TAX ELSE 0 END  AS SALE_AMT_TAX                      --세포함순매줄
			           --, CASE WHEN F.RECP_TODAY_YN = 'Y' THEN A.NET_SALE_AMT_TAX * APP_RATE/100 ELSE 0 END  AS APP_RATE_AMT       --인정금액
			           --, CASE WHEN F.RECP_TODAY_YN = 'N' THEN A.NET_SALE_AMT_TAX ELSE 0 END  AS SALE_AMT_TAX_PER                  --세포함순매줄
			           --, CASE WHEN F.RECP_TODAY_YN = 'N' THEN A.NET_SALE_AMT_TAX * APP_RATE/100 ELSE 0 END  AS APP_RATE_AMT_PER   --인정금액
			          FROM DPS.PS_DISITEM A   --판매상품정보
			           , (
			               SELECT               
			                    A.EVENT_CD 
			                    , C.PUMBUN_CD
			                    , nvl(A.CAL_YN, 'F') CAL_YN
			                    , A.RECP_TODAY_YN
			                    --, (CASE NVL(A.CAL_YN, 'F') WHEN 'T' THEN C.APP_RATE ELSE 100 END) AS APP_RATE
			                    , C.APP_RATE AS APP_RATE
			               FROM MSS.MC_EVTMST A    --사은행사마스터
			                    , DPS.PC_STREVT B   --점별행사
			                    , MSS.MC_EVTPUMBUN C
			               WHERE A.STR_CD = B.STR_CD
			                 AND A.EVENT_CD = B.EVENT_CD
			                 AND A.STR_CD = C.STR_CD
			                 AND A.EVENT_CD = C.EVENT_CD 
			                 AND A.EVENT_TYPE <> '02'   --제휴카드행사를 제외
			                 --AND A.RECP_TODAY_YN = 'Y'  --당일영수증
                			 AND A.RECP_ADD_YN = 'N'    --합산불가능
			                 AND NVL(A.CAL_YN, 'F') = 'T'  -- 정산을 하는것 = 브랜드사은행사
			                 AND A.STR_CD   = '01' 
			                 AND C.PUMBUN_CD <> '******' 
			                 AND ? BETWEEN B.EVENT_S_DT AND B.EVENT_E_DT  --1  '20161117'
			              UNION ALL            
			               SELECT               
			                    A.EVENT_CD 
			                    , CASE C.PUMBUN_CD WHEN '******' THEN D.PUMBUN_CD ELSE C.PUMBUN_CD END
			                    , nvl(A.CAL_YN, 'F') CAL_YN
			                    , A.RECP_TODAY_YN
			                    --, (CASE NVL(A.CAL_YN, 'F') WHEN 'T' THEN D.APP_RATE ELSE 100 END) AS APP_RATE
                   				, (CASE C.PUMBUN_CD WHEN '******' THEN D.APP_RATE ELSE 0 END) AS APP_RATE
			               FROM MSS.MC_EVTMST A    --사은행사마스터
			                    , DPS.PC_STREVT B   --점별행사
			                    , MSS.MC_EVTPUMBUN  C
			                    , MSS.MC_APPRATE  D
			               WHERE A.STR_CD = B.STR_CD
			                 AND A.EVENT_CD = B.EVENT_CD
			                 AND A.STR_CD = C.STR_CD
			                 AND A.EVENT_CD = C.EVENT_CD
			                 AND C.STR_CD = D.STR_CD(+)
			                 AND A.EVENT_TYPE <> '02'   --제휴카드행사를 제외
			                 --AND A.RECP_TODAY_YN = 'Y'  --당일영수증			                 
                 			 AND A.RECP_ADD_YN = 'N'    --합산불가능
			                 AND NVL(A.CAL_YN, 'F') = 'T'  -- 정산을 하는것 = 브랜드사은행사
			                 AND A.STR_CD   = '01' 
			                 AND C.PUMBUN_CD = '******' 
			                 AND ? BETWEEN B.EVENT_S_DT AND B.EVENT_E_DT     --2 '20161117'
			                 ) F
			         WHERE  A.PUMBUN_CD = F.PUMBUN_CD
			           AND A.STR_CD = ?     --3 '01'
			           AND A.SALE_DT = ?    --4 '20161117'
			           AND A.POS_NO = ?     --5 '1001'
			           AND A.TRAN_NO = ?    --6 '00002'
			    ORDER BY  F.EVENT_CD , A.PUMBUN_CD
			                 
			    ) A			    
			GROUP BY A.STR_CD
			        --, A.SALE_DT
			        , A.EVENT_CD 
		 ]]>
	</query>



	<!-- 지난 영수증	브랜드 사은 정보 조회 -->
	<query name="SEL_PB_SALE_INFO_PER">
		<![CDATA[
		  -- 브랜드사은행사에 인정율 적용한 인정금액 내역 [지난영수증:지급일기준]
			SELECT  A.STR_CD
			       --, A.SALE_DT
		           , A.EVENT_CD
		           , SUM(A.SALE_AMT_TAX) AS SALE_AMT_TAX            --세포함순매줄
		           , SUM(A.APP_RATE_AMT) AS APP_RATE_AMT            --인정금액
		           , A.DBL_PAID_YN    --중복지급여부
		           , 1  AS RECEIPT_CNT      -- 영수증건수
                   , ?  AS F_RECEIPT_NO     --영수증번호                        
                   , DPS.FN_GET_EVENT_NAME(A.EVENT_CD) AS EVENT_NM  
			FROM(           
			     SELECT A.STR_CD 
			           , A.SALE_DT
			           , A.POS_NO
			           , A.TRAN_NO
			           , A.PUMBUN_CD
			           , F.EVENT_CD
			           , F.APP_RATE
			           , F.DBL_PAID_YN    --중복지급여부
			           , F.RECP_TODAY_YN
			           , A.NET_SALE_AMT_TAX  AS SALE_AMT_TAX                       --세포함순매줄
			           , (A.NET_SALE_AMT_TAX * APP_RATE/100) AS APP_RATE_AMT       --인정금액
			       FROM DPS.PS_DISITEM A   --판매상품정보
			           , (
			               SELECT               
			                    A.EVENT_CD 
			                    , C.PUMBUN_CD
			                    , nvl(A.CAL_YN, 'F') CAL_YN
			                    , A.RECP_TODAY_YN
                                , A.DBL_PAID_YN   -- 중복지급여부
			                    --, (CASE NVL(A.CAL_YN, 'F') WHEN 'T' THEN C.APP_RATE ELSE 100 END) AS APP_RATE
			                    , C.APP_RATE AS APP_RATE
			               FROM MSS.MC_EVTMST A    --사은행사마스터
			                    , DPS.PC_STREVT B   --점별행사
			                    , MSS.MC_EVTPUMBUN C
			               WHERE A.STR_CD = B.STR_CD
			                 AND A.EVENT_CD = B.EVENT_CD
			                 AND A.STR_CD = C.STR_CD
			                 AND A.EVENT_CD = C.EVENT_CD 
			                 AND A.EVENT_TYPE = '01'   --브랜드사은행사
			                 --AND A.EVENT_TYPE <> '02'   --제휴카드행사를 제외
			                 AND A.RECP_TODAY_YN = 'N'  --기간중 영수증
			                 AND A.RECP_ADD_YN = 'Y'    --합산가능
			                 --AND NVL(A.CAL_YN, 'F') = 'T'  -- 정산을 하는것 = 브랜드사은행사
			                 AND A.STR_CD   = ?                           --1  '01'
			                 AND C.PUMBUN_CD <> '******' 
			                 AND ? BETWEEN B.EVENT_S_DT AND B.EVENT_E_DT  --2  '20161123'
			              UNION ALL            
			               SELECT               
			                    A.EVENT_CD 
			                    , CASE C.PUMBUN_CD WHEN '******' THEN D.PUMBUN_CD ELSE C.PUMBUN_CD END
			                    , nvl(A.CAL_YN, 'F') CAL_YN
			                    , A.RECP_TODAY_YN
                                , A.DBL_PAID_YN   -- 중복지급여부
			                    --, (CASE NVL(A.CAL_YN, 'F') WHEN 'T' THEN D.APP_RATE ELSE 100 END) AS APP_RATE
                   				, (CASE C.PUMBUN_CD WHEN '******' THEN D.APP_RATE ELSE 0 END) AS APP_RATE
			               FROM MSS.MC_EVTMST A     --사은행사마스터
			                    , DPS.PC_STREVT B   --점별행사
			                    , MSS.MC_EVTPUMBUN  C
			                    , MSS.MC_APPRATE  D
			               WHERE A.STR_CD = B.STR_CD
			                 AND A.EVENT_CD = B.EVENT_CD
			                 AND A.STR_CD = C.STR_CD
			                 AND A.EVENT_CD = C.EVENT_CD
			                 AND C.STR_CD = D.STR_CD(+)
			                 AND A.EVENT_TYPE = '01'   --브랜드사은행사
			                 --AND A.EVENT_TYPE <> '02'   --제휴카드행사를 제외
			                 AND A.RECP_TODAY_YN = 'N'  --기간중 영수증
			                 AND A.RECP_ADD_YN = 'Y'    --합산가능
			                 --AND NVL(A.CAL_YN, 'F') = 'T'  -- 정산을 하는것 = 브랜드사은행사
			                 AND A.STR_CD   = ?                             --3  '01'
			                 AND C.PUMBUN_CD = '******' 
			                 AND ? BETWEEN B.EVENT_S_DT AND B.EVENT_E_DT    --4 '20161123'
			                 ) F
			         WHERE  A.PUMBUN_CD = F.PUMBUN_CD
			           AND A.STR_CD  = ?     --3 '01'
			           AND A.SALE_DT = ?     --4 '20161123'
			           AND A.POS_NO  = ?     --5 '1001'
			           AND A.TRAN_NO = ?     --6'00002'
			    ORDER BY  F.EVENT_CD , A.PUMBUN_CD
			                 
			    ) A			    
			GROUP BY A.STR_CD
			        --, A.SALE_DT
			        , A.EVENT_CD 
			        , A.DBL_PAID_YN
		 ]]>
	</query>
	


	<!-- 지난 영수증	결제유형별 사은 정보 조회 -->
	<query name="SEL_PAID_SALE_INFO_PER">
		<![CDATA[
		  -- 결제유형별사은행사  : 브랜드 인정율 적용 불가/정산 불가 [지난영수증:지급일기준]
			SELECT  A.STR_CD
			       --, A.SALE_DT
		           , A.EVENT_CD
			       , A.PAY_TYPE_CASH
			       , A.PAY_TYPE_CARD
			       , A.PAY_TYPE_GIFT
			       , SUM(A.CASH_AMT)+SUM(A.CARD_AMT)+SUM(A.GIFT_AMT)  AS SALE_AMT_TAX            -- 매출금액
			       , A.DBL_PAID_YN    --중복지급여부
		           , 1  AS RECEIPT_CNT      -- 영수증건수
                   , ?  AS F_RECEIPT_NO     --영수증번호                   
                   , DPS.FN_GET_EVENT_NAME(A.EVENT_CD) AS EVENT_NM  
			FROM(           
			     SELECT DISTINCT A.STR_CD 
					  , A.SALE_DT
					  , A.POS_NO
					  , A.TRAN_NO
		  		 	  , F.EVENT_CD
					  , F.DBL_PAID_YN    --중복지급여부
				  	  , F.PAY_TYPE_CASH
					  , F.PAY_TYPE_CARD
					  , F.PAY_TYPE_GIFT
					  , CASE WHEN F.PAY_TYPE_CASH = 'T' THEN NVL(B.SALE_AMT, 0) ELSE 0 END AS CASH_AMT
					  , CASE WHEN F.PAY_TYPE_CARD = 'T' THEN NVL(C.PAY_AMT, 0) ELSE 0 END AS CARD_AMT
					  , CASE WHEN F.PAY_TYPE_GIFT = 'T' THEN NVL(D.PAY_AMT, 0) ELSE 0 END AS GIFT_AMT
			       FROM DPS.PS_DISITEM A   --판매상품정보
			          --, DPS.PS_DISCASH B   --현금매출집계
			          --, DPS.PS_DISCARD C   --카드매출집계
			          --, DPS.PS_DISGIFT D   --상품권매출집계
					    , (SELECT B.STR_CD, B.SALE_DT, B.POS_NO, B.TRAN_NO, SUM(B.SALE_AMT) AS SALE_AMT
		                    FROM DPS.PS_DISCASH B   							 --현금매출집계                   
		                   WHERE B.STR_CD    = ?       				     	 --5 '01'
		                     AND B.SALE_DT   = ?         				     --6 '20161123'
		                     AND B.POS_NO    = ?         					 --7 '1001'
		                     AND B.TRAN_NO   = ?          					 --8 '00002'
		                  GROUP BY B.STR_CD, B.SALE_DT, B.POS_NO, B.TRAN_NO
		                    ) B                    
		               , (SELECT C.STR_CD, C.SALE_DT, C.POS_NO, C.TRAN_NO, SUM(C.PAY_AMT) AS PAY_AMT
		                   FROM DPS.PS_DISCARD C  								 --카드매출집계        
		                  WHERE C.STR_CD    = ?          					 --5 '01'
		                    AND C.SALE_DT   = ?          				     --6 '20161123'
		                    AND C.POS_NO    = ?          					 --7 '1001'
		                    AND C.TRAN_NO   = ?         					 --8 '00002'
		                  GROUP BY C.STR_CD, C.SALE_DT, C.POS_NO, C.TRAN_NO
		                 ) C
		               , (SELECT D.STR_CD, D.SALE_DT, D.POS_NO, D.TRAN_NO, SUM(D.PAY_AMT) AS PAY_AMT
		                    FROM DPS.PS_DISGIFT D   							 --상품권매출집계
		                   WHERE D.STR_CD    = ?          					 --5 '01'
		                     AND D.SALE_DT   = ?          				     --6 '20161123'
		                     AND D.POS_NO    = ?          					 --7 '1001'
		                     AND D.TRAN_NO   = ?        					 --8 '00002'
		                  GROUP BY D.STR_CD, D.SALE_DT, D.POS_NO, D.TRAN_NO
		                 ) D
			          , (
			               SELECT A.EVENT_CD 
			                    , C.PUMBUN_CD
			                    , A.DBL_PAID_YN     -- 중복지급여부
			                    , A.PAY_TYPE_CASH
			                    , A.PAY_TYPE_CARD
			                    , A.PAY_TYPE_GIFT
			                 FROM MSS.MC_EVTMST A    --사은행사마스터
			                    , DPS.PC_STREVT B   --점별행사
			                    , MSS.MC_EVTPUMBUN C
			               WHERE A.STR_CD   = B.STR_CD
			                 AND A.EVENT_CD = B.EVENT_CD
			                 AND A.STR_CD   = C.STR_CD
			                 AND A.EVENT_CD = C.EVENT_CD 
			                 AND A.EVENT_TYPE = '03'   --결제유형별사은행사
			                 --AND A.EVENT_TYPE <> '02'   --제휴카드행사를 제외
			                 AND A.RECP_TODAY_YN = 'N'  --기간중 영수증
			                 AND A.RECP_ADD_YN = 'Y'    --합산가능
			                 --AND NVL(A.CAL_YN, 'F') = 'T'  -- 정산을 하는것 = 브랜드사은행사
			                 AND A.STR_CD   = ?                           --1  '01'
			                 AND C.PUMBUN_CD <> '******' 
			                 AND ? BETWEEN B.EVENT_S_DT AND B.EVENT_E_DT  --2  '20161123'
			              UNION ALL            
			               SELECT A.EVENT_CD 
			                    , CASE C.PUMBUN_CD WHEN '******' THEN D.PUMBUN_CD ELSE C.PUMBUN_CD END AS PUMBUN_CD
			                    , A.DBL_PAID_YN         -- 중복지급여부
			                    , A.PAY_TYPE_CASH
			                    , A.PAY_TYPE_CARD
			                    , A.PAY_TYPE_GIFT
			                 FROM MSS.MC_EVTMST A       --사은행사마스터
			                    , DPS.PC_STREVT B       --점별행사
			                    , MSS.MC_EVTPUMBUN  C
			                    , MSS.MC_APPRATE  D
			               WHERE A.STR_CD   = B.STR_CD
			                 AND A.EVENT_CD = B.EVENT_CD
			                 AND A.STR_CD   = C.STR_CD
			                 AND A.EVENT_CD = C.EVENT_CD
			                 AND C.STR_CD   = D.STR_CD(+)
			                 AND A.EVENT_TYPE  = '03'   --결제유형별사은행사
			                 --AND A.EVENT_TYPE <> '02'   --제휴카드행사를 제외
			                 AND A.RECP_TODAY_YN = 'N'  --기간중 영수증
			                 AND A.RECP_ADD_YN = 'Y'    --합산가능
			                 --AND NVL(A.CAL_YN, 'F') = 'T'  -- 정산을 하는것 = 브랜드사은행사
			                 AND A.STR_CD   = ?                             --3  '01'
			                 AND C.PUMBUN_CD = '******' 
			                 AND ? BETWEEN B.EVENT_S_DT AND B.EVENT_E_DT    --4 '20161123'
			            ) F             
			      WHERE A.PUMBUN_CD = F.PUMBUN_CD
			        AND A.STR_CD    = B.STR_CD(+)
			        AND A.SALE_DT   = B.SALE_DT(+)
			        AND A.POS_NO    = B.POS_NO(+)
			        AND A.TRAN_NO   = B.TRAN_NO(+)
			        AND A.STR_CD    = C.STR_CD(+)
			        AND A.SALE_DT   = C.SALE_DT(+)
			        AND A.POS_NO    = C.POS_NO(+)
			        AND A.TRAN_NO   = C.TRAN_NO(+)
			        AND A.STR_CD    = D.STR_CD(+)
			        AND A.SALE_DT   = D.SALE_DT(+)
			        AND A.POS_NO    = D.POS_NO(+)
			        AND A.TRAN_NO   = D.TRAN_NO(+)
			        AND A.STR_CD    = ?          --5 '01'
			        AND A.SALE_DT   = ?          --6 '20161123'
			        AND A.POS_NO    = ?          --7 '1001'
			        AND A.TRAN_NO   = ?          --8 '00002'
			    ) A			    
	         WHERE A.CASH_AMT > 0
	            OR A.CARD_AMT > 0
	            OR A.GIFT_AMT > 0
			GROUP BY A.STR_CD
			        --, A.SALE_DT
			        , A.EVENT_CD 
			        , A.PAY_TYPE_CASH
			        , A.PAY_TYPE_CARD
			        , A.PAY_TYPE_GIFT
			        , A.DBL_PAID_YN
		 ]]>
	</query>
	
	
	<!-- 영수증 제휴카드행사 사은 정보 조회 -->
	<query name="SEL_CARD_SALE_INFO_PER">
		<![CDATA[
		  -- 제휴카드사은행사  : 브랜드 인정율 적용 불가/정산 불가 [지난영수증:지급일기준]
			SELECT  A.STR_CD
		           , A.EVENT_CD
		           , A.CARD_PUBLISH
		           , SUM(A.CARD_AMT) AS SALE_AMT_TAX             -- 매출금액
		           , A.DBL_PAID_YN   							 --중복지급여부
		           , 1  AS RECEIPT_CNT      -- 영수증건수
                   , ?  AS F_RECEIPT_NO     --영수증번호                   
                   , DPS.FN_GET_EVENT_NAME(A.EVENT_CD) AS EVENT_NM  
			FROM(           
			     SELECT DISTINCT A.STR_CD 
					  , A.SALE_DT
					  , A.POS_NO
					  , A.TRAN_NO
		  		 	  , F.EVENT_CD
		                , B.CARD_PUBLISH
		                , F.DBL_PAID_YN    --중복지급여부
		                , NVL(B.PAY_AMT, 0) AS CARD_AMT
		            FROM DPS.PS_DISITEM A   --판매상품정보
		               --, DPS.PS_DISCARD B   --카드매출집계            
		               , (SELECT C.STR_CD, C.SALE_DT, C.POS_NO, C.TRAN_NO, C.CARD_PUBLISH, SUM(C.PAY_AMT) AS PAY_AMT
		                   FROM DPS.PS_DISCARD C  								 --카드매출집계        
		                  WHERE C.STR_CD    = ?          					 --5 '01'
		                    AND C.SALE_DT   = ?          				     --6 '20161123'
		                    AND C.POS_NO    = ?          					 --7 '1001'
		                    AND C.TRAN_NO   = ?         					 --8 '00002'
		                  GROUP BY C.STR_CD, C.SALE_DT, C.POS_NO, C.TRAN_NO, C.CARD_PUBLISH
		                 ) B
			          , (
			               SELECT A.EVENT_CD 
			                    , C.PUMBUN_CD
			                    , A.DBL_PAID_YN     -- 중복지급여부
			                    , A.PAY_TYPE_CASH
			                    , A.PAY_TYPE_CARD
			                    , A.PAY_TYPE_GIFT
			                 FROM MSS.MC_EVTMST A    --사은행사마스터
			                    , DPS.PC_STREVT B   --점별행사
			                    , MSS.MC_EVTPUMBUN C
			               WHERE A.STR_CD   = B.STR_CD
			                 AND A.EVENT_CD = B.EVENT_CD
			                 AND A.STR_CD   = C.STR_CD
			                 AND A.EVENT_CD = C.EVENT_CD 
		                     AND A.EVENT_TYPE = '02'   --재휴카드별사은행사
			                 --AND A.EVENT_TYPE <> '02'   --제휴카드행사를 제외
			                 AND A.RECP_TODAY_YN = 'N'  --기간중 영수증
			                 --AND NVL(A.CAL_YN, 'F') = 'T'  -- 정산을 하는것 = 브랜드사은행사
			                 AND A.STR_CD   = ?                           --1  '01'
			                 AND C.PUMBUN_CD <> '******' 
			                 AND ? BETWEEN B.EVENT_S_DT AND B.EVENT_E_DT  --2  '20161123'
			              UNION ALL            
			               SELECT A.EVENT_CD 
			                    , CASE C.PUMBUN_CD WHEN '******' THEN D.PUMBUN_CD ELSE C.PUMBUN_CD END AS PUMBUN_CD
			                    , A.DBL_PAID_YN         -- 중복지급여부
			                    , A.PAY_TYPE_CASH
			                    , A.PAY_TYPE_CARD
			                    , A.PAY_TYPE_GIFT
			                 FROM MSS.MC_EVTMST A       --사은행사마스터
			                    , DPS.PC_STREVT B       --점별행사
			                    , MSS.MC_EVTPUMBUN  C
			                    , MSS.MC_APPRATE  D
			               WHERE A.STR_CD   = B.STR_CD
			                 AND A.EVENT_CD = B.EVENT_CD
			                 AND A.STR_CD   = C.STR_CD
			                 AND A.EVENT_CD = C.EVENT_CD
			                 AND C.STR_CD   = D.STR_CD(+)
		                     AND A.EVENT_TYPE = '02'   --재휴카드별사은행사
			                 --AND A.EVENT_TYPE <> '02'   --제휴카드행사를 제외
			                 AND A.RECP_TODAY_YN = 'N'  --기간중 영수증
			                 --AND NVL(A.CAL_YN, 'F') = 'T'  -- 정산을 하는것 = 브랜드사은행사
			                 AND A.STR_CD   = ?                             --3  '01'
			                 AND C.PUMBUN_CD = '******' 
			                 AND ? BETWEEN B.EVENT_S_DT AND B.EVENT_E_DT    --4 '20161123'
			            ) F             
			      WHERE A.PUMBUN_CD = F.PUMBUN_CD
			        AND A.STR_CD    = B.STR_CD(+)
			        AND A.SALE_DT   = B.SALE_DT(+)
			        AND A.POS_NO    = B.POS_NO(+)
			        AND A.TRAN_NO   = B.TRAN_NO(+)
			        AND A.STR_CD    = ?          --5 '01'
			        AND A.SALE_DT   = ?          --6 '20161123'
			        AND A.POS_NO    = ?          --7 '1001'
			        AND A.TRAN_NO   = ?          --8 '00002'
			    ) A		
                , MSS.MC_EVTMST B
            WHERE A.EVENT_CD     = B.EVENT_CD
              AND A.CARD_PUBLISH = B.CARD_COMP	    
			GROUP BY A.STR_CD
			        --, A.SALE_DT
			        , A.EVENT_CD 
		            , A.CARD_PUBLISH
		            , A.DBL_PAID_YN 
		 ]]>
	</query>
	
	
	<!-- 지난 영수증	브랜드 사은 합산 불가 정보 조회 -->
	<query name="SEL_PB_SALE_EACH_INFO_PER">
		<![CDATA[
		  -- 사은행사별 인정율 적용한 인정금액 내역
			SELECT  A.STR_CD
			       --, A.SALE_DT
		           , A.EVENT_CD
		           , SUM(A.SALE_AMT_TAX) AS SALE_AMT_TAX            --세포함순매줄
		           , SUM(A.APP_RATE_AMT) AS APP_RATE_AMT            --인정금액
			FROM(           
			     SELECT A.STR_CD 
			           , A.SALE_DT
			           , A.POS_NO
			           , A.TRAN_NO
			           , A.PUMBUN_CD
			           , F.EVENT_CD
			           , F.APP_RATE
			           , F.RECP_TODAY_YN
			           , A.NET_SALE_AMT_TAX  AS SALE_AMT_TAX                       --세포함순매줄
			           , (A.NET_SALE_AMT_TAX * APP_RATE/100) AS APP_RATE_AMT       --인정금액
			        FROM DPS.PS_DISITEM A   --판매상품정보
			           , (
			               SELECT               
			                    A.EVENT_CD 
			                    , C.PUMBUN_CD
			                    , nvl(A.CAL_YN, 'F') CAL_YN
			                    , A.RECP_TODAY_YN
			                    --, (CASE NVL(A.CAL_YN, 'F') WHEN 'T' THEN C.APP_RATE ELSE 100 END) AS APP_RATE
			                    , C.APP_RATE AS APP_RATE
			               FROM MSS.MC_EVTMST A    --사은행사마스터
			                    , DPS.PC_STREVT B   --점별행사
			                    , MSS.MC_EVTPUMBUN C
			               WHERE A.STR_CD = B.STR_CD
			                 AND A.EVENT_CD = B.EVENT_CD
			                 AND A.STR_CD = C.STR_CD
			                 AND A.EVENT_CD = C.EVENT_CD 
			                 AND A.EVENT_TYPE <> '02'   --제휴카드행사를 제외
			                 AND A.RECP_TODAY_YN = 'N'  --기간중 영수증
                			 AND A.RECP_ADD_YN = 'N'    --합산불가능
			                 AND NVL(A.CAL_YN, 'F') = 'T'  -- 정산을 하는것 = 브랜드사은행사
			                 AND A.STR_CD   = '01' 
			                 AND C.PUMBUN_CD <> '******' 
			                 AND ? BETWEEN B.EVENT_S_DT AND B.EVENT_E_DT  --1  '20161117'
			              UNION ALL            
			               SELECT               
			                    A.EVENT_CD 
			                    , CASE C.PUMBUN_CD WHEN '******' THEN D.PUMBUN_CD ELSE C.PUMBUN_CD END
			                    , nvl(A.CAL_YN, 'F') CAL_YN
			                    , A.RECP_TODAY_YN
			                    --, (CASE NVL(A.CAL_YN, 'F') WHEN 'T' THEN D.APP_RATE ELSE 100 END) AS APP_RATE
                   				, (CASE C.PUMBUN_CD WHEN '******' THEN D.APP_RATE ELSE 0 END) AS APP_RATE
			               FROM MSS.MC_EVTMST A    --사은행사마스터
			                    , DPS.PC_STREVT B   --점별행사
			                    , MSS.MC_EVTPUMBUN  C
			                    , MSS.MC_APPRATE  D
			               WHERE A.STR_CD = B.STR_CD
			                 AND A.EVENT_CD = B.EVENT_CD
			                 AND A.STR_CD = C.STR_CD
			                 AND A.EVENT_CD = C.EVENT_CD
			                 AND C.STR_CD = D.STR_CD(+)
			                 AND A.EVENT_TYPE <> '02'   --제휴카드행사를 제외
			                 AND A.RECP_TODAY_YN = 'N'  --기간중 영수증		                 
                 			 AND A.RECP_ADD_YN = 'N'    --합산불가능
			                 AND NVL(A.CAL_YN, 'F') = 'T'  -- 정산을 하는것 = 브랜드사은행사
			                 AND A.STR_CD   = '01' 
			                 AND C.PUMBUN_CD = '******' 
			                 AND ? BETWEEN B.EVENT_S_DT AND B.EVENT_E_DT     --2 '20161117'
			                 ) F
			         WHERE  A.PUMBUN_CD = F.PUMBUN_CD
			           AND A.STR_CD = ?     --3 '01'
			           AND A.SALE_DT = ?    --4 '20161117'
			           AND A.POS_NO = ?     --5 '1001'
			           AND A.TRAN_NO = ?    --6 '00002'
			    ORDER BY  F.EVENT_CD , A.PUMBUN_CD
			                 
			    ) A			    
			GROUP BY A.STR_CD
			        --, A.SALE_DT
			        , A.EVENT_CD 
		 ]]>
	</query>
	
	
	<!-- 영수증	정보 조회 -->
	<query name="SEL_SALE_INFO">
		<![CDATA[
		  SELECT --DECODE(PRSNT.SEQ_NO,'','T','F') AS	CHK
		       DECODE(PRSNT.SEQ_NO,'','F','T') AS	CHK -- 기본 지급 미체크
			   , DECODE(PRSNT.SEQ_NO,'','미지급','지급') AS	PROVIDE_GB_NM
			   , DECODE(PRSNT.SEQ_NO,'','0','1') AS	PROVIDE_GB
			   , SALE.STR_CD
			   , SALE.SALE_DT
			   , SALE.POS_NO
			   , SALE.TRAN_NO
			   , SUM(SALE.SALE_AMT)	AS TOT_SALE_AMT
			   , SUM(SALE.APP_RATE_AMT)	AS SALE_AMT
			   , NVL(DIV_AMT,0)	AS DIV_AMT
			   , (SELECT CUST_NO 
					FROM DPS.PS_TRHEADER
				   WHERE STR_CD  = SALE.STR_CD 
				     AND SALE_DT = SALE.SALE_DT 
				     AND POS_NO  = SALE.POS_NO 
				     AND TRAN_NO = SALE.TRAN_NO) AS CUST_NO
				, (SELECT	NVL2(MIN(A.PRSNT_DT),'Y','N')
				    FROM	MSS.MC_EVTSKUPRSNT A
				  WHERE	A.PRSNT_FLAG IN	('1','2')
					AND	A.CANCEL_GB	= '1'
					AND	A.STR_CD IN ( ?, ?)
					AND	A.EVENT_CD = ?
					AND	A.CUST_ID IN
						   (SELECT CUST_NO
							  FROM DPS.PS_TRHEADER
							 WHERE STR_CD =	?
							   AND SALE_DT = ?
							   AND POS_NO =	?
							   AND TRAN_NO = ?
							 GROUP BY STR_CD, SALE_DT, POS_NO, TRAN_NO, CUST_NO)
					AND A.PRSNT_DT <= TO_CHAR(SYSDATE,'YYYYMMDD')
					AND A.PRSNT_DT >= ( SELECT CASE WHEN A.EVENT_GIFT_CYC = 'P' THEN B.EVENT_S_DT  
					                                WHEN A.EVENT_GIFT_CYC = 'D' THEN TO_CHAR(SYSDATE,'YYYYMMDD')
					                                ELSE TO_CHAR(SYSDATE,'YYYYMMDD') END
					                      FROM MSS.MC_EVTMST A
					                         , DPS.PC_STREVT B
					                     WHERE A.STR_CD = ?
					                       AND A.EVENT_CD = ?
					                       AND A.STR_CD = B.STR_CD
					                       AND A.EVENT_CD = B.EVENT_CD )  	 
				 )			
			FROM 
			   (SELECT A.STR_CD	
					 , A.SALE_DT
					 , A.POS_NO
					 , A.TRAN_NO
					 --, A.NET_SALE_AMT_TAX	AS SALE_AMT
					 , SALE_TOT_AMT	AS SALE_AMT
					 , NET_SALE_AMT_TAX	* (NVL(C.APP_RATE,100)/100)	AS APP_RATE_AMT
				  FROM DPS.PS_DISITEM A, 
					   (SELECT STR_CD
							 , PUMBUN_CD 
						  FROM MSS.MC_EVTPUMBUN
						 WHERE STR_CD =	?
						   AND EVENT_CD	= ?) B
					   LEFT	OUTER JOIN
					   MSS.MC_APPRATE C
					ON B.STR_CD	= C.STR_CD
				   AND B.PUMBUN_CD = C.PUMBUN_CD
				   , DPS.PS_TRHEADER D
				   , DPS.PC_STRPBN E
				 WHERE A.STR_CD	= D.STR_CD
				   AND A.SALE_DT = D.SALE_DT
				   AND A.POS_NO	= D.POS_NO
				   AND A.TRAN_NO = D.TRAN_NO
				   AND A.STR_CD	= E.STR_CD
				   AND A.PUMBUN_CD = E.PUMBUN_CD
				   AND D.TRAN_FLAG = '0'
				   --AND E.PUMBUN_TYPE = '0'	-- 사은품 지급대상(정상브랜드)
				   AND A.REJCT_FLAG	= '0'	-- 단품 취소 구분(0: 정상)
				   AND A.STR_CD	= B.STR_CD
				   AND A.PUMBUN_CD = B.PUMBUN_CD
				   AND A.STR_CD	= ?
				   AND A.SALE_DT = ?
				   AND A.POS_NO	= ?
				   AND A.TRAN_NO = ?) SALE
				LEFT OUTER JOIN
				(SELECT	A.PRSNT_DT
					  ,	B.SEQ_NO
					  ,	A.STR_CD
					  ,	A.PRSNT_NO
					  ,	B.SALE_DT
					  ,	B.POS_NO
					  ,	B.TRAN_NO
					  ,	B.CARD_COMP
					  ,	B.SALE_AMT
					  ,	B.DIV_AMT
				   FROM	MSS.MC_EVTSKUPRSNT A, MSS.MC_PRSNTRECP B
				  WHERE	A.PRSNT_DT = B.PRSNT_DT
					AND	A.STR_CD = B.STR_CD
					AND	A.PRSNT_NO = B.PRSNT_NO
					AND	A.PRSNT_FLAG IN	('1','2')
					AND	A.CANCEL_GB	= '1'
					AND	B.STR_CD IN( ?, ?)
					AND	B.SALE_DT =	?
					AND	B.POS_NO = ?
					AND	B.TRAN_NO =	?) PRSNT
			  ON SALE.STR_CD = PRSNT.STR_CD
			 AND SALE.SALE_DT =	PRSNT.SALE_DT
			 AND SALE.POS_NO = PRSNT.POS_NO
			 AND SALE.TRAN_NO =	PRSNT.TRAN_NO
		   GROUP BY	PRSNT.SEQ_NO, SALE.STR_CD, SALE.SALE_DT, SALE.POS_NO, SALE.TRAN_NO,	DIV_AMT
		  --"SEL_SALE_INFO"
		 ]]>
	</query>
	
	<!-- 영수증 정보 조회 : 영수증 번호-->
	<query name="SEL_SALE_INFO_ALL">
		<![CDATA[
		  SELECT --DECODE(PRSNT.SEQ_NO,'','T','F') AS	CHK
		       DECODE(PRSNT.SEQ_NO,'','F','T') AS	CHK -- 기본 지급 미체크
			   , DECODE(PRSNT.SEQ_NO,'','미지급','지급') AS	PROVIDE_GB_NM
			   , DECODE(PRSNT.SEQ_NO,'','0','1') AS	PROVIDE_GB
			   , SALE.STR_CD
			   , SALE.SALE_DT
			   , SALE.POS_NO
			   , SALE.TRAN_NO
			   , SUM(SALE.SALE_AMT)	AS TOT_SALE_AMT
			   , SUM(SALE.APP_RATE_AMT)	AS SALE_AMT
			   , NVL(DIV_AMT,0)	AS DIV_AMT
			   , (SELECT CUST_NO 
					FROM DPS.PS_TRHEADER
				   WHERE STR_CD  = SALE.STR_CD 
				     AND SALE_DT = SALE.SALE_DT 
				     AND POS_NO  = SALE.POS_NO 
				     AND TRAN_NO = SALE.TRAN_NO) AS CUST_NO
				, (SELECT	NVL2(MIN(A.PRSNT_DT),'Y','N')
				    FROM	MSS.MC_EVTSKUPRSNT A
				  WHERE	A.PRSNT_FLAG IN	('1','2')
					AND	A.CANCEL_GB	= '1'
					AND	A.STR_CD IN ( ?, ?)
					AND	A.EVENT_CD = ?
					AND	A.CUST_ID IN
						   (SELECT CUST_NO
							  FROM DPS.PS_TRHEADER
							 WHERE STR_CD =	?
							   AND SALE_DT = ?
							   AND POS_NO =	?
							   AND TRAN_NO = ?
							 GROUP BY STR_CD, SALE_DT, POS_NO, TRAN_NO, CUST_NO)
					AND A.PRSNT_DT <= TO_CHAR(SYSDATE,'YYYYMMDD')
					AND A.PRSNT_DT >= ( SELECT CASE WHEN A.EVENT_GIFT_CYC = 'P' THEN B.EVENT_S_DT  
					                                WHEN A.EVENT_GIFT_CYC = 'D' THEN TO_CHAR(SYSDATE,'YYYYMMDD')
					                                ELSE TO_CHAR(SYSDATE,'YYYYMMDD') END
					                      FROM MSS.MC_EVTMST A
					                         , DPS.PC_STREVT B
					                     WHERE A.STR_CD = ?
					                       AND A.EVENT_CD = ?
					                       AND A.STR_CD = B.STR_CD
					                       AND A.EVENT_CD = B.EVENT_CD )  	 
				 )			
			FROM 
			   (SELECT A.STR_CD	
					 , A.SALE_DT
					 , A.POS_NO
					 , A.TRAN_NO
					 , A.NET_SALE_AMT_TAX AS SALE_AMT
					 , NET_SALE_AMT_TAX	* (NVL(B.APP_RATE,100)/100)	AS APP_RATE_AMT
				  FROM DPS.PS_DISITEM A
					   LEFT	OUTER JOIN
					   MSS.MC_APPRATE B
					ON A.STR_CD	= B.STR_CD
				   AND A.PUMBUN_CD = B.PUMBUN_CD
				   , DPS.PS_TRHEADER C
				   , DPS.PC_STRPBN D
				 WHERE A.STR_CD	= C.STR_CD
				   AND A.SALE_DT = C.SALE_DT
				   AND A.POS_NO	= C.POS_NO
				   AND A.TRAN_NO = C.TRAN_NO
				   AND A.STR_CD	= D.STR_CD
				   AND A.PUMBUN_CD = D.PUMBUN_CD
				   AND C.TRAN_FLAG = '0'			-- 정상매출 영수증 체크
				   --AND D.PUMBUN_TYPE = '0'			-- 사은품 지급대상(정상브랜드)
				   AND A.REJCT_FLAG	= '0'  			-- 단품 취소 구분(0: 정상)
				   AND A.STR_CD	= ?
				   AND A.SALE_DT = ?
				   AND A.POS_NO	= ?
				   AND A.TRAN_NO = ?) SALE
				LEFT OUTER JOIN
				(SELECT	A.PRSNT_DT
					  ,	B.SEQ_NO
					  ,	A.STR_CD
					  ,	A.PRSNT_NO
					  ,	B.SALE_DT
					  ,	B.POS_NO
					  ,	B.TRAN_NO
					  ,	B.CARD_COMP
					  ,	B.SALE_AMT
					  ,	B.DIV_AMT
				   FROM	MSS.MC_EVTSKUPRSNT A, MSS.MC_PRSNTRECP B
				  WHERE	A.PRSNT_DT = B.PRSNT_DT
					AND	A.STR_CD = B.STR_CD
					AND	A.PRSNT_NO = B.PRSNT_NO
					AND	A.PRSNT_FLAG IN	('1','2')
					AND	A.CANCEL_GB	= '1'
					AND	B.STR_CD IN ( ?, ?)
					AND	B.SALE_DT =	?
					AND	B.POS_NO = ?
					AND	B.TRAN_NO =	?) PRSNT
			  ON SALE.STR_CD = PRSNT.STR_CD
			 AND SALE.SALE_DT =	PRSNT.SALE_DT
			 AND SALE.POS_NO = PRSNT.POS_NO
			 AND SALE.TRAN_NO =	PRSNT.TRAN_NO
		   GROUP BY	PRSNT.SEQ_NO, SALE.STR_CD, SALE.SALE_DT, SALE.POS_NO, SALE.TRAN_NO,	DIV_AMT
		   --ORDER BY TRAN_NO
		   ORDER BY SALE.SALE_DT DESC, SALE.POS_NO, SALE.TRAN_NO DESC
			--"SEL_SALE_INFO_ALL"
		 ]]>
	</query>

	<!-- 영수증 정보 조회 -->
	<query name="SEL_SALE_INFO2">
		<![CDATA[
		SELECT --DECODE(PRSNT.SEQ_NO,'','T','F') AS CHK
		       DECODE(PRSNT.SEQ_NO,'','F','T') AS	CHK -- 기본 지급 미체크
			 , DECODE(PRSNT.SEQ_NO,'','미지급','지급') AS PROVIDE_GB_NM
			 , DECODE(PRSNT.SEQ_NO,'','0','1') AS PROVIDE_GB
			 , SALE.STR_CD
			 , SALE.SALE_DT
			 , SALE.POS_NO
			 , SALE.TRAN_NO
			 , SUM(SALE.SALE_AMT) AS TOT_SALE_AMT
			 , SUM(SALE.APP_RATE_AMT) AS SALE_AMT
			 , 0 AS	DIV_AMT
			   , (SELECT CUST_NO 
			   		FROM DPS.PS_TRHEADER 
			   	   WHERE STR_CD  = SALE.STR_CD 
			   	     AND SALE_DT = SALE.SALE_DT 
			   	     AND POS_NO  = SALE.POS_NO 
			   	     AND TRAN_NO = SALE.TRAN_NO) AS CUST_NO
			   , (SELECT NVL2(MIN(A.PRSNT_DT),'Y','N')
				    FROM MSS.MC_EVTSKUPRSNT A
				  WHERE	A.PRSNT_FLAG IN	('1','2')
					AND	A.CANCEL_GB	= '1'
					AND	A.STR_CD = ?
					AND	A.EVENT_CD = ?
					AND	A.CUST_ID = ?
					AND A.PRSNT_DT <= TO_CHAR(SYSDATE,'YYYYMMDD')
					AND A.PRSNT_DT >= ( SELECT CASE WHEN A.EVENT_GIFT_CYC = 'P' THEN B.EVENT_S_DT  
					                                WHEN A.EVENT_GIFT_CYC = 'D' THEN TO_CHAR(SYSDATE,'YYYYMMDD')
					                                ELSE TO_CHAR(SYSDATE,'YYYYMMDD') END
					                      FROM MSS.MC_EVTMST A
					                         , DPS.PC_STREVT B
					                     WHERE A.STR_CD = ?
					                       AND A.EVENT_CD = ?
					                       AND A.STR_CD = B.STR_CD
					                       AND A.EVENT_CD = B.EVENT_CD )   
				 )		   	     
		  FROM 
			 (SELECT A.STR_CD 
				   , A.SALE_DT
				   , A.POS_NO
				   , A.TRAN_NO
				   --, A.NET_SALE_AMT_TAX AS SALE_AMT
				   , SALE_TOT_AMT AS SALE_AMT
				   , NET_SALE_AMT_TAX *	(NVL(C.APP_RATE,100)/100) AS APP_RATE_AMT
				FROM DPS.PS_DISITEM	A, 
					 (SELECT STR_CD
						   , PUMBUN_CD 
						FROM MSS.MC_EVTPUMBUN
					   WHERE STR_CD	= ?
						 AND EVENT_CD =	?
						) B
					 LEFT OUTER	JOIN
					 MSS.MC_APPRATE	C
				  ON B.STR_CD =	C.STR_CD
				 AND B.PUMBUN_CD = C.PUMBUN_CD
				 , DPS.PS_TRHEADER D
				 , DPS.PC_STRPBN E
			   WHERE A.STR_CD =	D.STR_CD
				 AND A.SALE_DT = D.SALE_DT
				 AND A.POS_NO =	D.POS_NO
				 AND A.TRAN_NO = D.TRAN_NO
				 AND A.STR_CD =	E.STR_CD
				 AND A.PUMBUN_CD = E.PUMBUN_CD
				 AND D.TRAN_FLAG = '0'
				 --AND E.PUMBUN_TYPE = '0'  -- 사은품	지급대상(정상브랜드)
				 AND A.REJCT_FLAG =	'0'	 --	단품 취소 구분(0: 정상)
				 AND A.STR_CD =	B.STR_CD
				 AND A.PUMBUN_CD = B.PUMBUN_CD
				 AND A.STR_CD =	?
				 AND D.CUST_NO = ?
				 --AND A.SALE_DT = TO_CHAR(SYSDATE,'YYYYMMDD')
				 AND A.SALE_DT <= TO_CHAR(SYSDATE,'YYYYMMDD')
				 -- 영수증 당일 체크
				   AND A.SALE_DT >= (SELECT CASE WHEN RECP_TODAY_YN = 'Y' THEN TO_CHAR(SYSDATE,'YYYYMMDD') ELSE B.EVENT_S_DT END
						FROM MSS.MC_EVTMST A
						   , DPS.PC_EVTMST B
						WHERE A.EVENT_CD = ?
						  AND A.EVENT_CD = B.EVENT_CD)				 
				 ) SALE
			  LEFT OUTER JOIN
			  (SELECT A.PRSNT_DT
					, B.SEQ_NO
					, A.STR_CD
					, A.PRSNT_NO
					, B.SALE_DT
					, B.POS_NO
					, B.TRAN_NO
					, B.CARD_COMP
					, B.SALE_AMT
					, B.DIV_AMT
				 FROM MSS.MC_EVTSKUPRSNT A,	MSS.MC_PRSNTRECP B,
				 DPS.PS_TRHEADER C
				WHERE A.PRSNT_DT = B.PRSNT_DT
				  AND A.STR_CD = B.STR_CD
				  AND A.PRSNT_NO = B.PRSNT_NO
				  AND A.PRSNT_FLAG IN ('1','2')
				  AND A.CANCEL_GB =	'1'
				  AND B.STR_CD = B.STR_CD
				  AND B.SALE_DT	= B.SALE_DT
				  AND B.POS_NO = B.POS_NO
				  AND B.TRAN_NO	= B.TRAN_NO
				  AND B.STR_CD = ?
				  AND C.CUST_NO	= ?
				  --AND B.SALE_DT	= TO_CHAR(SYSDATE,'YYYYMMDD')
				  AND B.SALE_DT	<= TO_CHAR(SYSDATE,'YYYYMMDD')
				  -- 영수증 당일 체크
					AND B.SALE_DT >= (SELECT CASE WHEN RECP_TODAY_YN = 'Y' THEN TO_CHAR(SYSDATE,'YYYYMMDD') ELSE B.EVENT_S_DT END
										FROM MSS.MC_EVTMST A
										   , DPS.PC_EVTMST B
										WHERE A.EVENT_CD = ?
										  AND A.EVENT_CD = B.EVENT_CD)				  
				  ) PRSNT
			ON SALE.STR_CD = PRSNT.STR_CD
		   AND SALE.SALE_DT	= PRSNT.SALE_DT
		   AND SALE.POS_NO = PRSNT.POS_NO
		   AND SALE.TRAN_NO	= PRSNT.TRAN_NO
		 GROUP BY PRSNT.SEQ_NO,	SALE.STR_CD, SALE.SALE_DT, SALE.POS_NO,	SALE.TRAN_NO
		 --SEL_SALE_INFO2
		 ]]>
	</query>
	
	<!-- 영수증 정보 조회 :	카드 번호 -->
	<query name="SEL_SALE_INFO_ALL2">
		<![CDATA[
		  SELECT --DECODE(PRSNT.SEQ_NO,'','T','F') AS	CHK
		         DECODE(PRSNT.SEQ_NO,'','F','T') AS	CHK -- 기본 지급 미체크
			   , DECODE(PRSNT.SEQ_NO,'','미지급','지급') AS	PROVIDE_GB_NM
			   , DECODE(PRSNT.SEQ_NO,'','0','1') AS	PROVIDE_GB
			   , SALE.STR_CD
			   , SALE.SALE_DT
			   , SALE.POS_NO
			   , SALE.TRAN_NO
			   , SUM(SALE.SALE_AMT)	AS TOT_SALE_AMT
			   , SUM(SALE.APP_RATE_AMT)	AS SALE_AMT
			   , 0 AS DIV_AMT
			   , (SELECT CUST_NO 
			   		FROM DPS.PS_TRHEADER 
			   	   WHERE STR_CD  = SALE.STR_CD 
			   	     AND SALE_DT = SALE.SALE_DT 
			   	     AND POS_NO  = SALE.POS_NO 
			   	     AND TRAN_NO = SALE.TRAN_NO) AS CUST_NO
		   , (SELECT NVL2(MIN(A.PRSNT_DT),'Y','N')
			    FROM MSS.MC_EVTSKUPRSNT A
			  WHERE	A.PRSNT_FLAG IN	('1','2')
				AND	A.CANCEL_GB	= '1'
				AND	A.STR_CD = ?
				AND	A.EVENT_CD = ?
				AND	A.CUST_ID = ?
				AND A.PRSNT_DT <= TO_CHAR(SYSDATE,'YYYYMMDD')
				AND A.PRSNT_DT >= ( SELECT CASE WHEN A.EVENT_GIFT_CYC = 'P' THEN B.EVENT_S_DT  
				                                WHEN A.EVENT_GIFT_CYC = 'D' THEN TO_CHAR(SYSDATE,'YYYYMMDD')
				                                ELSE TO_CHAR(SYSDATE,'YYYYMMDD') END
				                      FROM MSS.MC_EVTMST A
				                         , DPS.PC_STREVT B
				                     WHERE A.STR_CD = ?
				                       AND A.EVENT_CD = ?
				                       AND A.STR_CD = B.STR_CD
				                       AND A.EVENT_CD = B.EVENT_CD )   
			 )		   	     
			FROM 
			   (SELECT A.STR_CD	
					 , A.SALE_DT
					 , A.POS_NO
					 , A.TRAN_NO
					 , A.NET_SALE_AMT_TAX AS SALE_AMT
					 , NET_SALE_AMT_TAX	* (NVL(B.APP_RATE,100)/100)	AS APP_RATE_AMT
				  FROM DPS.PS_DISITEM A
					   LEFT	OUTER JOIN
					   MSS.MC_APPRATE B
					ON A.STR_CD	= B.STR_CD
				   AND A.PUMBUN_CD = B.PUMBUN_CD
				   , DPS.PS_TRHEADER C
				   , DPS.PC_STRPBN D
				 WHERE A.STR_CD	= C.STR_CD
				   AND A.SALE_DT = C.SALE_DT
				   AND A.POS_NO	= C.POS_NO
				   AND A.TRAN_NO = C.TRAN_NO
				   AND A.STR_CD	= D.STR_CD
				   AND A.PUMBUN_CD = D.PUMBUN_CD
				   AND C.TRAN_FLAG = '0'	-- 정상매출	영수증 체크
				   --AND D.PUMBUN_TYPE = '0'	-- 사은품 지급대상(정상브랜드)
				   AND A.REJCT_FLAG	= '0'  -- 단품 취소	구분(0:	정상)
				   AND A.STR_CD	= ?
				   AND C.CUST_NO = ?
				   --AND C.SALE_DT = TO_CHAR(SYSDATE,'YYYYMMDD')
				   AND C.SALE_DT <= TO_CHAR(SYSDATE,'YYYYMMDD')
				   -- 영수증 당일 체크
				   AND C.SALE_DT >= (SELECT CASE WHEN RECP_TODAY_YN = 'Y' THEN TO_CHAR(SYSDATE,'YYYYMMDD') ELSE B.EVENT_S_DT END
						FROM MSS.MC_EVTMST A
						   , DPS.PC_EVTMST B
						WHERE A.EVENT_CD = ?
						  AND A.EVENT_CD = B.EVENT_CD)
				   )	SALE
				LEFT OUTER JOIN
				(SELECT	A.PRSNT_DT
					  ,	B.SEQ_NO
					  ,	A.STR_CD
					  ,	A.PRSNT_NO
					  ,	B.SALE_DT
					  ,	B.POS_NO
					  ,	B.TRAN_NO
					  ,	B.CARD_COMP
					  ,	B.SALE_AMT
					  ,	B.DIV_AMT
				   FROM	MSS.MC_EVTSKUPRSNT A
					  ,	MSS.MC_PRSNTRECP B
					  ,	DPS.PS_TRHEADER	C
				  WHERE	A.PRSNT_DT = B.PRSNT_DT
					AND	A.STR_CD = B.STR_CD
					AND	A.PRSNT_NO = B.PRSNT_NO
					AND	A.PRSNT_FLAG IN	('1','2')
					AND	A.CANCEL_GB	= '1'
					AND	B.STR_CD = B.STR_CD
					AND	B.SALE_DT =	B.SALE_DT
					AND	B.POS_NO = B.POS_NO
					AND	B.TRAN_NO =	B.TRAN_NO
					AND	B.STR_CD = ?
					AND	C.CUST_NO =	?
					--AND	B.SALE_DT =	TO_CHAR(SYSDATE,'YYYYMMDD')
					AND	B.SALE_DT <=	TO_CHAR(SYSDATE,'YYYYMMDD')
					-- 영수증 당일 체크
					AND B.SALE_DT >= (SELECT CASE WHEN RECP_TODAY_YN = 'Y' THEN TO_CHAR(SYSDATE,'YYYYMMDD') ELSE B.EVENT_S_DT END
										FROM MSS.MC_EVTMST A
										   , DPS.PC_EVTMST B
										WHERE A.EVENT_CD = ?
										  AND A.EVENT_CD = B.EVENT_CD)
					) PRSNT
			  ON SALE.STR_CD = PRSNT.STR_CD
			 AND SALE.SALE_DT =	PRSNT.SALE_DT
			 AND SALE.POS_NO = PRSNT.POS_NO
			 AND SALE.TRAN_NO =	PRSNT.TRAN_NO
		   GROUP BY	PRSNT.SEQ_NO, SALE.STR_CD, SALE.SALE_DT, SALE.POS_NO, SALE.TRAN_NO
		   ORDER BY TRAN_NO
		   --SEL_SALE_INFO_ALL2
		 ]]>
	</query>
	
	
	<!-- 사은품	조회 -->
	<query name="SEL_SKU_LIST_back">
		<![CDATA[
			SELECT 'F' AS CHK
			      , A.TRG_CD
	              , B.TRG_NAME
			      , A.SKU_CD
			      , C.SKU_NAME
			      , A.BUY_COST_PRC
			      , A.SKU_GB
                  , A.EVENT_CD
                    , '' AS GIFTCARD_NO
			  FROM MSS.MC_EVTSKUMST A
			     , MSS.MC_EVTTRGMST B
			     , DPS.PC_SKUMST C
			     , MSS.MG_GIFTAMTMST D
			 WHERE A.STR_CD = B.STR_CD
               AND A.TRG_CD = B.TRG_CD
               AND A.SKU_CD = C.SKU_CD
			   AND C.GIFT_AMT_TYPE = D.GIFT_AMT_TYPE(+)
			   AND C.GIFT_TYPE_CD  = D.GIFT_TYPE_CD(+)
			   AND A.STR_CD = ?
			   AND A.EVENT_CD = ?
			   AND A.TRG_CD = MSS.FN_EVT_EVTSKUMSTD(A.STR_CD, ?, ?)
	        ORDER BY  A.EVENT_CD, A.SKU_GB, A.TRG_CD
		]]>
	</query>
	
			   
			   
	<!-- 사은품	조회 -->
	<query name="SEL_SKU_LIST">
		<![CDATA[
			SELECT 'F' AS CHK
	                , A.TRG_CD
	                , B.TRG_NAME
	                , A.SKU_CD
	                , C.SKU_NAME
	                , A.BUY_COST_PRC
	                , A.SKU_GB
                    , A.EVENT_CD
                    , ?   AS SALE_AMT_TAX               --매출금액
                    , ?   AS APP_RATE_AMT               --인정금액 
                    , ?   AS RECEIPT_CNT                --대상영수증cnt   
                    , ?   AS F_RECEIPT_NO               --대상영수증list                       
                    , DPS.FN_GET_EVENT_NAME(A.EVENT_CD) AS EVENT_NM    
               FROM MSS.MC_EVTSKUMST A
                    , MSS.MC_EVTTRGMST B
                    , DPS.PC_SKUMST C
                    , MSS.MG_GIFTAMTMST D
	           WHERE A.STR_CD = B.STR_CD
	             AND A.TRG_CD = B.TRG_CD
	             AND A.SKU_CD = C.SKU_CD
	             AND C.GIFT_AMT_TYPE = D.GIFT_AMT_TYPE(+)
	             AND C.GIFT_TYPE_CD  = D.GIFT_TYPE_CD(+)
	             AND A.STR_CD = ?
	             AND A.EVENT_CD = ?
	             AND ((? BETWEEN  B.TRG_F AND    B.TRG_T) 
	                   OR (B.TRG_T    <= ?))
	         ORDER BY  A.EVENT_CD, A.SKU_GB, A.TRG_CD DESC
		]]>
	</query>
	
	<!-- 상품권 번호 조회 -->
	<query name="SEL_CHECK_GIFTCARD_NO">
		<![CDATA[
			SELECT GIFTCARD_NO
			 	 , GIFTCERT_AMT
			  FROM MSS.MG_GIFTMST
			 WHERE GIFTCARD_NO = ?
			   AND STAT_FLAG = '05'  --상태정보 (D, M074) : 가판매
			   AND POUT_TYPE = '3'   --불출유형 (D, M014) : 사은행사지급용
			   AND ACDT_FLAG = 'N'   --사고여부  (Y :사고) : 사고가아닌것
		]]>
	</query>

	<query name="SEL_GIFTCARD_NO">
		<![CDATA[
			SELECT GIFTCARD_NO
				 , GIFTCERT_AMT
			  FROM MSS.MC_EVTSKUGIFTPRSNT
		]]>
	</query>


	<!-- 사은품	지급 그룹번호 조회 -->
	<query name="SEL_PRSNT_GRP">
		<![CDATA[
			SELECT MSS.SQ_MC_EVTSKUPRSNTGRP.NEXTVAL AS	PRSNT_GBP FROM DUAL
		]]>
	</query>


	<!-- 사은품	지급 번호 조회 -->
	<query name="SEL_PRSNT_NO">
		<![CDATA[
			SELECT MSS.SQ_MC_EVTSKUPRSNT.NEXTVAL AS	PRSNT_NO FROM DUAL
		]]>
	</query>

	<!-- 사은품	지급 등록 -->
	<query name="INS_EVTSKUPRSNT">
		<![CDATA[
	INSERT INTO	MSS.MC_EVTSKUPRSNT(	 PRSNT_DT
								   , STR_CD
								   , PRSNT_NO
								   , EVENT_CD
								   , SKU_CD
								   , PRSNT_FLAG     -- 지급구분(D-M004)  1:정상
								   , PRSNT_TIME
								   , TOT_SALE_AMT
								   , PRSNT_QTY
								   , PRSNT_AMT
								   , EXCP_CONF_ID
								   , EXCP_PRSNT_RSN
								   , CARD_CUST_ID								   
								   , TRG_CD
								   , CANCEL_GB      --취소구분  (취소구분 1: 정상, 2:취소)
								   , REG_DATE
								   , REG_ID
								   , MOD_DATE
								   , MOD_ID
								   , PRSNT_GRP
								   )
							VALUES(	 ?
								   , ?
								   , ?
								   , ?
								   , ?
								   , ?
								   ,TO_CHAR(SYSDATE,'HH24MISS')								   
								   , ?
								   , ?
								   , ?
								   , ?
								   , ?
								   , ?
								   , ?
								   , ?
								   ,SYSDATE
								   , ?
								   ,SYSDATE
								   , ?
								   , ?
								   )	  
		]]>
	</query>


	<!-- 사은품	지급 영수증	등록 -->
	<query name="INS_PRSNTRECP">
		<![CDATA[
	INSERT INTO MSS.MC_PRSNTRECP(	 PRSNT_DT
								   , STR_CD
								   , PRSNT_NO
								   , SEQ_NO
								   , SALE_DT
								   , POS_NO
								   , TRAN_NO
								   , SALE_AMT
								   , REG_DATE
								   , REG_ID
								   , MOD_DATE
								   , MOD_ID
								   , PRSNT_GRP
								   )
						   VALUES(	 ?
								   , ?
								   , ?
								   , (SELECT NVL(MAX(SEQ_NO),0)+1 FROM MSS.MC_PRSNTRECP	WHERE PRSNT_DT = ? AND STR_CD =	? AND PRSNT_NO = ?)
								   , ?
								   , ?
								   , ?
								   , ?
								   , SYSDATE
								   , ?
								   , SYSDATE
								   , ?
								   ,?
								   )
		 ]]>
	</query>


	<!-- 사은품지급	브랜드 집계	데이터 생성	-->
	<query name="INS_PRSNTPBN">
		<![CDATA[
		INSERT INTO	MSS.MC_PRSNTPBN	( PRSNT_DT
									, STR_CD
									, PRSNT_NO
									, SEQ_NO
									, SALE_DT
									, POS_NO
									, TRAN_NO
									, PUMBUN_CD
									, POSSALE_AMT
									, CANCEL_GB
									, SALE_AMT
									, REG_DATE
									, REG_ID
									, MOD_DATE
									, MOD_ID)
							  (SELECT C.PRSNT_DT
									, C.STR_CD
									, C.PRSNT_NO
									, ROWNUM
									, A.SALE_DT
									, A.POS_NO
									, A.TRAN_NO
									, A.PUMBUN_CD
									, A.NET_SALE_AMT_TAX AS	SALE_AMT 
									, '1'
									, A.NET_SALE_AMT_TAX * (NVL(B.APP_RATE,100)/100) AS	APP_RATE_AMT
									, SYSDATE
									, ?
									, SYSDATE
									, ?
							  FROM (SELECT STR_CD
										 , SALE_DT
										 , POS_NO
										 , TRAN_NO
										 , PUMBUN_CD
										 , SUM(NET_SALE_AMT_TAX) AS	NET_SALE_AMT_TAX
								  FROM DPS.PS_DISITEM
								  GROUP	BY STR_CD, SALE_DT,	POS_NO,	TRAN_NO, PUMBUN_CD)	A
								   LEFT	OUTER JOIN
								   MSS.MC_APPRATE B
								ON A.STR_CD	= B.STR_CD
							   AND A.PUMBUN_CD = B.PUMBUN_CD
								 , MSS.MC_PRSNTRECP	C
							 WHERE A.STR_CD	  = C.STR_CD
							   AND A.SALE_DT  = C.SALE_DT
							   AND A.POS_NO	  = C.POS_NO
							   AND A.TRAN_NO  = C.TRAN_NO
							   AND C.STR_CD	  = ?
							   AND C.PRSNT_DT =	?
							   AND C.PRSNT_NO =	?
								)
				]]>
	</query>
	
	
	<!-- 상품권 금액 조회 -->
	<query name="SEL_GIFTCERT_AMT">
		<![CDATA[
			SELECT GIFTCERT_AMT
			  FROM MSS.MG_GIFTMST
			 WHERE GIFTCARD_NO = ?
		]]>
	</query>
	
	
	<!-- 상품권 번호 등록 -->
	<query name="INS_EVTSKUGIFTPRSNT">
		 <![CDATA[
	INSERT INTO	MSS.MC_EVTSKUGIFTPRSNT(   PRSNT_DT
										, STR_CD
										, PRSNT_NO
										, SEQ_NO
										, GIFTCARD_NO
										, EVENT_CD
										, SKU_CD
										, REG_DATE
										, REG_ID
										, MOD_DATE
										, MOD_ID
										, GIFTCERT_AMT)
								 VALUES(  ?
										, ?
										, ?
										, (SELECT NVL(MAX(SEQ_NO),0)+1 FROM MSS.MC_EVTSKUGIFTPRSNT WHERE PRSNT_DT = ? AND STR_CD = ? AND PRSNT_NO = ?)
										, ?
										, ?
										, ?
										, SYSDATE
										, ?
										, SYSDATE
										, ?
										, ?)
		 ]]>
	</query>


	<!-- 상품권 마스터 상품권 판매정보 수정 -->
	<query name="UPD_GIFTMST">
        <![CDATA[
		UPDATE MSS.MG_GIFTMST
		   SET SALE_STR    = ?
		     , SALE_DT     = ?
		     , SALE_FLAG   = '06'   -- 상품권판매정보(M067) 06:사은품지급판매
		     , SALE_EMP_ID = ?
		     , SALE_AMT    = ?
		     , STAT_FLAG   = '06'   --상품권상태(M074) 06:판매
		     , MOD_ID      = ?
		     , MOD_DATE    = SYSDATE
		 WHERE STAT_FLAG   = '05'  --상태정보 (D, M074) 05: 가판매
           AND POUT_TYPE   = '3'   --불출유형 (D, M014) 3: 사은행사지급용
           AND ACDT_FLAG   = 'N'
           AND GIFTCARD_NO = ?
        ]]>
	</query>
	
	<!-- 예외지급품	대상코드, 매입원가 조회	-->
	<query name="SEL_SKU_INFO">
		<![CDATA[
		 SELECT	'' AS CHK
				 , A.TRG_CD
				 , B.TRG_NAME
				 , A.SKU_CD
				 , C.SKU_NAME
				 , A.BUY_COST_PRC
		 FROM MSS.MC_EVTSKUMST A, MSS.MC_EVTTRGMST B, DPS.PC_SKUMST	C
		 WHERE A.STR_CD	= B.STR_CD
		   AND A.TRG_CD	= B.TRG_CD
		   AND A.SKU_CD	= C.SKU_CD
		   AND A.STR_CD	= ?
		   AND A.EVENT_CD =	?
		   AND A.SKU_CD	LIKE ? || '%'
		 ]]>
	</query>
	
</service>