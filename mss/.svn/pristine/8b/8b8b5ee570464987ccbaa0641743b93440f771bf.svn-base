<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 김유완
 * 회 사 명 : 한국후지쯔
 * 작 성 일 : 2010.05.16
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  관리비청구서관리
 -->
<service name="/mren401.mr">
    <gauce name="H_SEL_MR_CALMST">
       <column colName="CHECK1"                colType="TB_STRING"   size="1"   dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="STR_CD"                colType="TB_STRING"   size="2"   dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="VEN_CD"                colType="TB_STRING"   size="6"   dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="VEN_NM"                colType="TB_STRING"   size="40"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="REP_NAME"              colType="TB_STRING"   size="40"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="COMP_NO"               colType="TB_STRING"   size="10"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="CNTR_ID"               colType="TB_STRING"   size="8"   dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="RENT_TYPE"             colType="TB_STRING"   size="2"   dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="CAL_YM"                colType="TB_STRING"   size="6"   dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="RENT_AMT"              colType="TB_DECIMAL"  size="12"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="RENT_SUPPLY_AMT"       colType="TB_DECIMAL"  size="12"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="RENT_VAT_AMT"          colType="TB_DECIMAL"  size="12"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>       
       <column colName="RENT_BAL_AMT"          colType="TB_DECIMAL"  size="12"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="MOD_RENT_ARREAR_AMT"   colType="TB_DECIMAL"  size="12"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="MOD_RENT_TOT_BAL_AMT"  colType="TB_DECIMAL"  size="12"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>       
       <column colName="TAX_AMT"               colType="TB_DECIMAL"  size="12"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="TAX_SUPPLY_AMT"        colType="TB_DECIMAL"  size="12"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="TAX_VAT_AMT"           colType="TB_DECIMAL"  size="12"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="NTAX_AMT"              colType="TB_DECIMAL"  size="12"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="BAL_AMT"               colType="TB_DECIMAL"  size="12"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="ARREAR_AMT"            colType="TB_DECIMAL"  size="12"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="TOT_BAL_AMT"           colType="TB_DECIMAL"  size="12"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>       
       <column colName="MOD_ARREAR_AMT"        colType="TB_DECIMAL"  size="12"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="MOD_TOT_BAL_AMT"       colType="TB_DECIMAL"  size="12"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/> 
       <column colName="MOD_AMT"               colType="TB_DECIMAL"  size="12"  dec="2"   keyType="TB_NORMAL" roundMode="ROUND"/>             
       <column colName="REAL_CHAREG_AMT"       colType="TB_DECIMAL"  size="12"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="CNTR_AREA"             colType="TB_DECIMAL"  size="9"   dec="2"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="MNTN_CAL_YN"           colType="TB_STRING"   size="1"   dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="RENT_CAL_YN"           colType="TB_STRING"   size="1"   dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="CHRG_YN"               colType="TB_STRING"   size="1"   dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="CNTR_S_DT"             colType="TB_STRING"   size="8"   dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="CNTR_E_DT"             colType="TB_STRING"   size="8"   dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="MNTN_CAL_DT"           colType="TB_STRING"   size="8"   dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="RENT_CAL_DT"           colType="TB_STRING"   size="8"   dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>       
       <column colName="BANK"                  colType="TB_STRING"   size="30"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="ACCOUNT_NUM"           colType="TB_STRING"   size="60"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="ACCOUNT_HDR"           colType="TB_STRING"   size="20"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
       <column colName="PAY_TERM_DD"           colType="TB_STRING"   size="8"   dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
    </gauce> 
    
    <gauce name="H_PARAMATER">
        <column colName="CAL_YM"           	   colType="TB_STRING"   size="6"   dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="STR_CD"          	   colType="TB_STRING"   size="2"   dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="CHRG_YN"         	   colType="TB_STRING"   size="1"   dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
    </gauce>
    <gauce name="H_PRINT"> 
        <column colName="CNTR_ID"              colType="TB_STRING"      size="8"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="VEN_CD"               colType="TB_STRING"      size="6"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="VEN_NAME"             colType="TB_STRING"      size="40"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REP_NAME"         	   colType="TB_STRING"      size="40"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="COMP_NO"              colType="TB_STRING"      size="10"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CNTR_AREA"            colType="TB_STRING"      size="9"     dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MNTN_TYPE"            colType="TB_STRING"      size="2"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MNTN_TYPE_NM"         colType="TB_STRING"      size="40"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MNTN_ITEM_CD"         colType="TB_STRING"      size="2"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MNTN_ITEM_NM"         colType="TB_STRING"      size="40"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="USE_QTY"     		   colType="TB_DECIMAL"     size="7"     dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="USE_AMT_NOVAT"        colType="TB_DECIMAL"     size="12"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="VAT_AMT"   		   colType="TB_DECIMAL"     size="12"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="MOD_USE_AMT"          colType="TB_DECIMAL"     size="12"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CAL_YM"         	   colType="TB_STRING"      size="8"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />      
        <column colName="BANK"                  colType="TB_STRING"   size="30"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="ACCOUNT_NUM"           colType="TB_STRING"   size="60"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="ACCOUNT_HDR"           colType="TB_STRING"   size="20"  dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
        <column colName="PAY_TERM_DD"           colType="TB_STRING"   size="8"   dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
     </gauce>
    
    <query name="SEL_MR_CALMST">
        <![CDATA[
         SELECT 'F' AS CHECK1
              , CNT.STR_CD
              , CNT.VEN_CD
              , VEN.VEN_NAME AS VEN_NM
              , VEN.REP_NAME
              , VEN.COMP_NO
              , CAM.CNTR_ID
              , CNT.RENT_TYPE
              , CAM.CAL_YM
              , CAM.RENT_AMT
              , CAM.RENT_AMT - CAM.RENT_VAT_AMT AS RENT_SUPPLY_AMT
              , CAM.RENT_VAT_AMT
              , CAM.RENT_BAL_AMT
              , CAM.MOD_RENT_ARREAR_AMT
              , CAM.MOD_RENT_TOT_BAL_AMT
              , CAM.TAX_AMT
              , CAM.TAX_AMT - CAM.TAX_VAT_AMT AS TAX_SUPPLY_AMT 
              , CAM.TAX_VAT_AMT
              , CAM.NTAX_AMT
              , CAM.BAL_AMT
              , CAM.ARREAR_AMT
              , (CAM.BAL_AMT + CAM.ARREAR_AMT) AS TOT_BAL_AMT
              , CAM.MOD_ARREAR_AMT
              , CAM.MOD_TOT_BAL_AMT  
              , (NVL(CAM.MOD_ARREAR_AMT, 0) + NVL(CAM.MOD_RENT_ARREAR_AMT, 0))  AS MOD_AMT   --조정금액 
              --, CAM.REAL_CHAREG_AMT
              , (CAM.TAX_AMT + CAM.NTAX_AMT + CAM.BAL_AMT + CAM.ARREAR_AMT + NVL(CAM.MOD_ARREAR_AMT, 0) + NVL(CAM.MOD_RENT_ARREAR_AMT, 0)) AS REAL_CHAREG_AMT   --실청구액
              , CAM.CNTR_AREA
              , CAM.MNTN_CAL_YN
              , CAM.RENT_CAL_YN
              , CAM.CHRG_YN
              , CAM.CNTR_S_DT
              , CAM.CNTR_E_DT
              , (SELECT MSS.FN_GET_CAL_PERIOD('M', CAM.CAL_YM, CAM.CNTR_S_DT, CAM.CNTR_E_DT) FROM DUAL) AS MNTN_CAL_DT
              , (SELECT MSS.FN_GET_CAL_PERIOD('R', CAM.CAL_YM, CAM.CNTR_S_DT, CAM.CNTR_E_DT) FROM DUAL) AS RENT_CAL_DT
              , (SELECT COMM_NAME1 FROM COM.TC_COMMCODE WHERE SYS_PART  = 'D' AND COMM_PART = 'M300' AND USE_YN = 'Y' AND ROWNuM = 1) AS BANK
              , (SELECT COMM_NAME2 FROM COM.TC_COMMCODE WHERE SYS_PART  = 'D' AND COMM_PART = 'M300' AND USE_YN = 'Y' AND ROWNuM = 1) AS ACCOUNT_NUM
              , (SELECT REFER_CODE FROM COM.TC_COMMCODE WHERE SYS_PART  = 'D' AND COMM_PART = 'M300' AND USE_YN = 'Y' AND ROWNuM = 1) AS ACCOUNT_HDR
              , (CASE WHEN CNT.PAY_TERM_TYPE = '0' THEN CAM.CAL_YM || CNT.PAY_TERM_DD
                     WHEN CNT.PAY_TERM_TYPE = '1' THEN TO_CHAR(ADD_MONTHS(TO_DATE(CAM.CAL_YM || CNT.PAY_TERM_DD, 'YYYYMMDD'), 1), 'YYYYMMDD') 
                     WHEN CNT.PAY_TERM_TYPE = '2' THEN TO_CHAR(ADD_MONTHS(TO_DATE(CAM.CAL_YM || CNT.PAY_TERM_DD, 'YYYYMMDD'), 2), 'YYYYMMDD') 
                     ELSE '' END) AS PAY_TERM_DD
           FROM MSS.MR_CALMST    CAM
              , MSS.MR_CNTRMST   CNT
              , DPS.PC_VENMST    VEN
          WHERE CAM.CNTR_ID   = CNT.CNTR_ID
            AND CNT.VEN_CD    = VEN.VEN_CD
            AND CNT.RENT_TYPE LIKE ?||'%' /*임대형태*/
            AND CNT.VEN_CD    LIKE ?||'%'
            AND CNT.STR_CD    = ?
            AND CAM.CAL_YM    = ?
          ORDER BY CNT.VEN_CD
        ]]>
    </query>
    
    <query name="UPD_MR_CALMST">
        <![CDATA[
         UPDATE /*+ bypass_ujvc */
                (SELECT CAL.CHRG_YN  AS CHRG_YN
                      , CHRG_DT      AS CHRG_DT
                      , CAL.MOD_ID   AS MOD_ID
                      , CAL.MOD_DATE AS MOD_DATE
                   FROM MSS.MR_CALMST    CAL
                      , MSS.MR_CNTRMST   CNT
                  WHERE CAL.CNTR_ID = CNT.CNTR_ID
                    AND CAL.CAL_YM = ?
                    AND CNT.STR_CD = ?)  
            SET CHRG_YN = ?
              , CHRG_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
              , MOD_ID = ?
              , MOD_DATE = SYSDATE 
        ]]>
    </query>
    
    <query name="UPD_MR_CALMST_CANCEL">
        <![CDATA[
         UPDATE /*+ bypass_ujvc */
                (SELECT CAL.CHRG_YN  AS CHRG_YN
                      , CHRG_DT      AS CHRG_DT
                      , CAL.MOD_ID   AS MOD_ID
                      , CAL.MOD_DATE AS MOD_DATE
                   FROM MSS.MR_CALMST    CAL
                      , MSS.MR_CNTRMST   CNT
                  WHERE CAL.CNTR_ID = CNT.CNTR_ID
                    AND CAL.CAL_YM = ?
                    AND CNT.STR_CD = ?)  
            SET CHRG_YN = ?
              , CHRG_DT = ''
              , MOD_ID = ?
              , MOD_DATE = SYSDATE 
        ]]>
    </query>
    
    <gauce name="H_SEL_CLOSE_YN">
       <column colName="CLOSE_YN"         colType="TB_STRING"   size="10"   dec="0"   keyType="TB_NORMAL" roundMode="ROUND"/>
    </gauce>
    
    <query name="SEL_CLOSE_YN">
        <![CDATA[
         SELECT  DPS.FN_GET_CLOSECHECK( FCL.STR_CD , ? , 'MREN' , '48' , '0' , 'M' ) CLOSE_YN
           FROM MSS.MR_FCLMST FCL
          WHERE FCL.STR_CD = ?
        ]]>
    </query>
    
     <!-- 전표출력  리스트 조회 -->
    <query name="SEL_PRINT">
    <![CDATA[
          SELECT CAL.CNTR_ID
    			 , VMT.VEN_CD
     			 , VMT.VEN_NAME
     			 , VMT.REP_NAME
    			 , VMT.COMP_NO
    			 , CMT.CNTR_AREA
   			     , MNT.MNTN_TYPE
    			 , COM.FN_GET_COMM_NAME('D', 'M036', MNT.MNTN_TYPE) AS MNTN_TYPE_NM
    			 , CAL.MNTN_ITEM_CD
    			 , MNT.MNTN_ITEM_NM
    			 , CAL.USE_QTY
    			 , CAL.USE_AMT - CAL.VAT_AMT AS USE_AMT
    			 , CAL.VAT_AMT
    			 , CAL.MOD_USE_AMT
    			 , CAL.CAL_YM
	             , (SELECT COMM_NAME1 FROM COM.TC_COMMCODE WHERE SYS_PART  = 'D' AND COMM_PART = 'M300' AND USE_YN = 'Y' AND ROWNuM = 1) AS BANK
	             , (SELECT COMM_NAME2 FROM COM.TC_COMMCODE WHERE SYS_PART  = 'D' AND COMM_PART = 'M300' AND USE_YN = 'Y' AND ROWNuM = 1) AS ACCOUNT_NUM
	             , (SELECT REFER_CODE FROM COM.TC_COMMCODE WHERE SYS_PART  = 'D' AND COMM_PART = 'M300' AND USE_YN = 'Y' AND ROWNuM = 1) AS ACCOUNT_HDR
	             , (CASE WHEN CMT.PAY_TERM_TYPE = '0' THEN CAL.CAL_YM || CMT.PAY_TERM_DD
	                     WHEN CMT.PAY_TERM_TYPE = '1' THEN TO_CHAR(ADD_MONTHS(TO_DATE(CAL.CAL_YM || CMT.PAY_TERM_DD, 'YYYYMMDD'), 1), 'YYYYMMDD') 
	                     WHEN CMT.PAY_TERM_TYPE = '2' THEN TO_CHAR(ADD_MONTHS(TO_DATE(CAL.CAL_YM || CMT.PAY_TERM_DD, 'YYYYMMDD'), 2), 'YYYYMMDD') 
	                     ELSE '' END) AS PAY_TERM_DD
		    FROM MSS.MR_CALITEM      CAL
    			 , MSS.MR_MNTNITEM   MNT
    			 , MSS.MR_CNTRMST    CMT
    			 , DPS.PC_VENMST     VMT
		   WHERE CAL.STR_CD = MNT.STR_CD
 				 AND CAL.MNTN_ITEM_CD = MNT.MNTN_ITEM_CD
				 AND CMT.CNTR_ID = CAL.CNTR_ID
				 AND CMT.STR_CD = CAL.STR_CD
				 AND CMT.VEN_CD = VMT.VEN_CD
				 AND CAL.STR_CD = '01'     
				 AND CAL.CNTR_ID = ?        
				 AND VMT.VEN_CD = ?
				 AND CAL.CAL_YM = ?
		ORDER BY MNT.MNTN_TYPE, CAL.MNTN_ITEM_CD
        ]]>
    </query>
</service>