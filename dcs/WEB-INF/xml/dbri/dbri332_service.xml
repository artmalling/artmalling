<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자    : kjy
 * 회 사 명    : 
 * 작 성 일    : 2017.05.18
 * 변 경 일    : 
 * 변경내용 : 
 * 개    요       :  지역/일자별회원가입현황
 -->
<service name="/dbri332.db">
    <!-- 지역별 회원 매출 현황_GRIDHEADER  -->
    <gauce name="H_MASTER"> 
        <column colName="HEADER_ADDR" 			colType="TB_STRING"      size="30"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TOT" 		       		colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="RATIO"	 	     		colType="TB_DECIMAL"     size="5"   dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="WEEKSDAY_CNT"  		colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="WEEKEND_CNT"		   	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CNT_AVG"		  	 	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="WEEKSDAY_AVG"		   	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="WEEKEND_AVG"		   	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        
        <column colName="DAY1"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY2"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY3"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY4"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY5"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY6"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY7"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY8"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY9"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY10"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />

        <column colName="DAY11"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY12"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY13"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY14"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY15"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY16"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY17"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY18"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY19"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY20"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        
        <column colName="DAY21"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY22"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY23"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY24"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY25"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY26"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY27"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY28"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY29"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY30"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="DAY31"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />             
        

        <column colName="SDT" 					colType="TB_STRING"      size="10"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="EDT" 					colType="TB_STRING"      size="10"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SIDO" 					colType="TB_STRING"      size="30"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
		<column colName="SIGUN" 				colType="TB_STRING"      size="30"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
		<column colName="OPTIONS" 				colType="TB_STRING"      size="30"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    <!-- 지역별 회원 매출 현황_GRIDDETAIL  -->
    <gauce name="H_DETAIL"> 
        <column colName="GU"		 			colType="TB_STRING"      size="30"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DONGS"		 			colType="TB_STRING"      size="30"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="TOT" 		       		colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="RATIO"	 	     		colType="TB_DECIMAL"     size="5"   dec="2" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="WEEKSDAY_CNT"  		colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="WEEKEND_CNT"		   	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CNT_AVG"		  	 	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="WEEKSDAY_AVG"		   	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="WEEKEND_AVG"		   	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        
        <column colName="DAY1"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY2"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY3"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY4"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY5"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY6"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY7"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY8"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY9"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY10"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />

        <column colName="DAY11"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY12"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY13"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY14"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY15"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY16"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY17"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY18"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY19"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY20"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        
        <column colName="DAY21"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY22"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY23"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY24"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY25"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY26"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY27"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY28"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY29"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="DAY30"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="DAY31"		 		  	colType="TB_DECIMAL"     size="13"  dec="0" keyType="TB_NORMAL" roundMode="ROUND" />             
    </gauce>

   <!-- 지역별 회원 매출 현황 -->
    <query name="SEL_MASTER">        
        <![CDATA[
             SELECT  SIDO||' '||SIGUN HEADER_ADDR
                   , COUNT(CUST_ID) TOT
                   , DECODE(MIN(OVERCNT),0,0,(COUNT(CUST_ID) / MIN(OVERCNT))*100) RATIO
                   --, MIN(B.WEEKS) TOT_DAYS
 				   , COUNT(DECODE(ENTR_WEEKS,1,NULL,7,NULL,CUST_ID)) WEEKSDAY_CNT
                   --, MIN(B.WEEKEND) WEEKEND_DAYS
                   , COUNT(DECODE(ENTR_WEEKS,1,CUST_ID,7,CUST_ID,NULL)) WEEKEND_CNT
                   --, MIN(B.WEEKSDAY) WEEKSDAY_DAYS
                   , COUNT(CUST_ID) / MIN(B.WEEKS) CNT_AVG 
                   , COUNT(DECODE(ENTR_WEEKS,1,NULL,7,NULL,CUST_ID)) / MIN(B.WEEKSDAY) WEEKSDAY_AVG
                   , COUNT(DECODE(ENTR_WEEKS,1,CUST_ID,7,CUST_ID,NULL)) / MIN(B.WEEKEND) WEEKEND_AVG
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'01',CUST_ID,NULL)) DAY1
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'02',CUST_ID,NULL)) DAY2
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'03',CUST_ID,NULL)) DAY3
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'04',CUST_ID,NULL)) DAY4
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'05',CUST_ID,NULL)) DAY5
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'06',CUST_ID,NULL)) DAY6
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'07',CUST_ID,NULL)) DAY7
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'08',CUST_ID,NULL)) DAY8
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'09',CUST_ID,NULL)) DAY9
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'10',CUST_ID,NULL)) DAY10
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'11',CUST_ID,NULL)) DAY11
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'12',CUST_ID,NULL)) DAY12
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'13',CUST_ID,NULL)) DAY13
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'14',CUST_ID,NULL)) DAY14
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'15',CUST_ID,NULL)) DAY15
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'16',CUST_ID,NULL)) DAY16
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'17',CUST_ID,NULL)) DAY17
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'18',CUST_ID,NULL)) DAY18
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'19',CUST_ID,NULL)) DAY19
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'20',CUST_ID,NULL)) DAY20
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'21',CUST_ID,NULL)) DAY21
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'22',CUST_ID,NULL)) DAY22
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'23',CUST_ID,NULL)) DAY23
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'24',CUST_ID,NULL)) DAY24
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'25',CUST_ID,NULL)) DAY25
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'26',CUST_ID,NULL)) DAY26
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'27',CUST_ID,NULL)) DAY27
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'28',CUST_ID,NULL)) DAY28
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'29',CUST_ID,NULL)) DAY29
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'30',CUST_ID,NULL)) DAY30
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'31',CUST_ID,NULL)) DAY31
                   , ? SDT
                   , ? EDT
                   , SIDO
                   , SIGUN
                   , ? OPTIONS
              FROM 
             (
              
                SELECT  A.CUST_ID											/* 회원 아이디 */
				      , A.HOME_ZIP_CD1										/* 우편번호 */
                      , min(A.ENTR_DT) ENTR_DT
                      , MIN(TO_CHAR(TO_DATE(A.ENTR_DT),'D')) ENTR_WEEKS
				      , MIN(NVL(SIDO,'기타')) SIDO							/* 시,도 */
				      , MIN(SIGUNGU) SIGUNGU									/* 시,군,구 */
                      , MIN(TRIM(DECODE(SUBSTR(SIDO,LENGTH(SIDO),1),'시',NULL,SUBSTR(SIGUNGU,1,DECODE(INSTR(SIGUNGU,' '),0,20,INSTR(SIGUNGU,' ')))))) SIGUN
                      , MIN(TRIM(DECODE(SUBSTR(SIGUNGU,LENGTH(SIGUNGU),1),'구',SUBSTR(SIGUNGU,INSTR(SIGUNGU,' ')+1,20),NULL))) GU
                      , TRIM(DECODE(MIN(DONG),NULL,MIN(BUPDONGNM),MIN(DONG))||' '||MIN(RINM)) DONGS
				      , MIN(DONG) DONG										/* 읍,동 */
				      , MIN(BUPDONGNM) BUPDONGNM								/* 법정동명 */
				      , MIN(RINM) RINM										/* 리 */
				      , MIN(HANGNM) HANGNM 									/* 행정동명 */
				      , MIN(BUILDNG_NM) BUILDNG_NM							/* 건물명 */
				      , MIN(DORONM) DORONM									/* 도로명 */
                      , COUNT(A.CUST_ID) OVER (ORDER BY 1) OVERCNT
				 FROM DCS.DM_CUSTOMER A
				    , COM.TC_ZIPMST B
				WHERE A.HOME_ZIP_CD1 = B.ZIPNO(+) 
				  AND A.ENTR_DT BETWEEN ? AND ?
				  AND A.CUST_ID LIKE ?||'%'
             GROUP BY A.CUST_ID,A.HOME_ZIP_CD1
             )
             ,(
                SELECT SUM(DECODE(WEEKS,1,1,7,1,0)) WEEKEND
                     , SUM(DECODE(WEEKS,1,0,7,0,1)) WEEKSDAY
                     , COUNT(WEEKS) WEEKS
                  FROM
                (
                    SELECT TO_CHAR(TO_DATE(SDT) + LEVEL -1,'D') WEEKS
                    FROM 
                    (
                        SELECT ? SDT
                             , ? EDT
                          FROM DUAL
                    )
                    CONNECT BY LEVEL <= (TO_DATE(EDT) - TO_DATE(SDT) + 1) 
                )
              ) B
            WHERE ( NVL(SIDO,'기타') LIKE '%'||?||'%' OR
				  		NVL(SIGUN,' ') LIKE '%'||?||'%' 
			  	  )
             GROUP BY SIDO,SIGUN
             ORDER BY TOT DESC
              ]]>        
    </query>
    
  
    
    <!-- 지역별 회원 매출 현황_detail -->
    <query name="SEL_DETAIL">        
        <![CDATA[
			 SELECT  GU
                   , DONGS
                   , COUNT(CUST_ID) TOT
                   , DECODE(MIN(OVERCNT),0,0,(COUNT(CUST_ID) / MIN(OVERCNT))*100) RATIO
                   --, MIN(B.WEEKS) TOT_DAYS
 				   , COUNT(DECODE(ENTR_WEEKS,1,NULL,7,NULL,CUST_ID)) WEEKSDAY_CNT
                   --, MIN(B.WEEKEND) WEEKEND_DAYS
                   , COUNT(DECODE(ENTR_WEEKS,1,CUST_ID,7,CUST_ID,NULL)) WEEKEND_CNT
                   --, MIN(B.WEEKSDAY) WEEKSDAY_DAYS
                   , COUNT(CUST_ID) / MIN(B.WEEKS) CNT_AVG 
                   , COUNT(DECODE(ENTR_WEEKS,1,CUST_ID,7,CUST_ID,NULL)) / MIN(B.WEEKEND) WEEKEND_AVG
                   , COUNT(DECODE(ENTR_WEEKS,1,NULL,7,NULL,CUST_ID)) / MIN(B.WEEKSDAY) WEEKSDAY_AVG
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'01',CUST_ID,NULL)) DAY1
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'02',CUST_ID,NULL)) DAY2
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'03',CUST_ID,NULL)) DAY3
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'04',CUST_ID,NULL)) DAY4
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'05',CUST_ID,NULL)) DAY5
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'06',CUST_ID,NULL)) DAY6
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'07',CUST_ID,NULL)) DAY7
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'08',CUST_ID,NULL)) DAY8
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'09',CUST_ID,NULL)) DAY9
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'10',CUST_ID,NULL)) DAY10
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'11',CUST_ID,NULL)) DAY11
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'12',CUST_ID,NULL)) DAY12
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'13',CUST_ID,NULL)) DAY13
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'14',CUST_ID,NULL)) DAY14
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'15',CUST_ID,NULL)) DAY15
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'16',CUST_ID,NULL)) DAY16
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'17',CUST_ID,NULL)) DAY17
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'18',CUST_ID,NULL)) DAY18
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'19',CUST_ID,NULL)) DAY19
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'20',CUST_ID,NULL)) DAY20
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'21',CUST_ID,NULL)) DAY21
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'22',CUST_ID,NULL)) DAY22
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'23',CUST_ID,NULL)) DAY23
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'24',CUST_ID,NULL)) DAY24
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'25',CUST_ID,NULL)) DAY25
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'26',CUST_ID,NULL)) DAY26
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'27',CUST_ID,NULL)) DAY27
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'28',CUST_ID,NULL)) DAY28
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'29',CUST_ID,NULL)) DAY29
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'30',CUST_ID,NULL)) DAY30
                   , COUNT(DECODE(SUBSTR(ENTR_DT,7,2),'31',CUST_ID,NULL)) DAY31
              FROM 
             (
              
                SELECT  A.CUST_ID											/* 회원 아이디 */
				      , A.HOME_ZIP_CD1										/* 우편번호 */
                      , min(A.ENTR_DT) ENTR_DT
                      , MIN(TO_CHAR(TO_DATE(A.ENTR_DT),'D')) ENTR_WEEKS
				      , MIN(NVL(SIDO,'기타')) SIDO							/* 시,도 */
				      , MIN(SIGUNGU) SIGUNGU									/* 시,군,구 */
                      , MIN(TRIM(DECODE(SUBSTR(SIDO,LENGTH(SIDO),1),'시',NULL,SUBSTR(SIGUNGU,1,DECODE(INSTR(SIGUNGU,' '),0,20,INSTR(SIGUNGU,' ')))))) SIGUN
                      , MIN(TRIM(DECODE(SUBSTR(SIGUNGU,LENGTH(SIGUNGU),1),'구',SUBSTR(SIGUNGU,INSTR(SIGUNGU,' ')+1,20),NULL))) GU
                      , TRIM(DECODE(MIN(DONG),NULL,MIN(BUPDONGNM),MIN(DONG))||' '||MIN(RINM)) DONGS
				      , MIN(DONG) DONG										/* 읍,동 */
				      , MIN(BUPDONGNM) BUPDONGNM								/* 법정동명 */
				      , MIN(RINM) RINM										/* 리 */
				      , MIN(HANGNM) HANGNM 									/* 행정동명 */
				      , MIN(BUILDNG_NM) BUILDNG_NM							/* 건물명 */
				      , MIN(DORONM) DORONM									/* 도로명 */
                      , COUNT(A.CUST_ID) OVER (ORDER BY 1) OVERCNT
				 FROM DCS.DM_CUSTOMER A
				    , COM.TC_ZIPMST B
				WHERE A.HOME_ZIP_CD1 = B.ZIPNO(+) 
				  AND A.ENTR_DT BETWEEN ? AND ?
				  AND A.CUST_ID LIKE ?||'%'
             GROUP BY A.CUST_ID,A.HOME_ZIP_CD1
             )
             ,(
                SELECT SUM(DECODE(WEEKS,1,1,7,1,0)) WEEKEND
                     , SUM(DECODE(WEEKS,1,0,7,0,1)) WEEKSDAY
                     , COUNT(WEEKS) WEEKS
                  FROM
                (
                    SELECT TO_CHAR(TO_DATE(SDT) + LEVEL -1,'D') WEEKS
                    FROM 
                    (
                        SELECT ? SDT
                             , ? EDT
                          FROM DUAL
                    )
                    CONNECT BY LEVEL <= (TO_DATE(EDT) - TO_DATE(SDT) + 1) 
                )
              ) B
             WHERE  NVL(SIDO,'기타') LIKE '%'||?||'%' 
               AND	NVL(SIGUN,' ') LIKE '%'||?||'%' 
			  	  
             GROUP BY GU,DONGS
             ORDER BY TOT DESC
        ]]>        
    </query>   
</service>

