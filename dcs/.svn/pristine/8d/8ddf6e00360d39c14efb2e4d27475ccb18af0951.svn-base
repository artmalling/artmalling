<?xml version="1.0" encoding="euc-kr"?>
<!-- XML 버전 1.0을 사용하며 encoding 타입은 ‘euc-kr’로 한다.-->
<!--
 * 작 성 자 : 김영진
 * 회 사 명 : 
 * 작 성 일 : 2010.02.24
 * 변 경 일 : 
 * 변경내용 : 
 * 개    요 :  법인회원가입신청서등록
 -->
<service name="/dctm105.dm">
    <!-- 법인회원등록  -->
    <gauce name="H_CUST"> 
        <column colName="CUST_ID"           colType="TB_STRING"     size="9"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="HHOLD_ID"          colType="TB_STRING"     size="9"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SS_NO"             colType="TB_STRING"     size="200"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CUST_NAME"         colType="TB_STRING"     size="40"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CARD_PWD_NO"       colType="TB_STRING"     size="100"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REP_NAME"          colType="TB_STRING"     size="100"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="HOME_PH1"          colType="TB_STRING"     size="32"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="HOME_PH2"          colType="TB_STRING"     size="32"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="HOME_PH3"          colType="TB_STRING"     size="32"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />                
        <column colName="HOME_ZIP_CD1"      colType="TB_STRING"     size="3"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="HOME_ZIP_CD2"      colType="TB_STRING"     size="3"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="HOME_ADDR1"        colType="TB_STRING"     size="200"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="HOME_ADDR2"        colType="TB_STRING"     size="200"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="EMAIL1"            colType="TB_STRING"     size="124"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="EMAIL2"            colType="TB_STRING"     size="124"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="EMAIL3"            colType="TB_STRING"     size="124"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="EMAIL_YN"          colType="TB_STRING"     size="1"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="EMAIL_AGREE_DT"    colType="TB_STRING"     size="8"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SMS_YN"            colType="TB_STRING"     size="1"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SMS_AGREE_DT"      colType="TB_STRING"     size="8"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="POST_RCV_CD"       colType="TB_STRING"     size="1"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="OFFI_NM"           colType="TB_STRING"     size="40"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="OFFI_PH1"          colType="TB_STRING"     size="4"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="OFFI_PH2"          colType="TB_STRING"     size="4"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="OFFI_PH3"          colType="TB_STRING"     size="4"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="OFFI_INTER_PH"     colType="TB_STRING"     size="4"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="OFFI_FAX1"         colType="TB_STRING"     size="4"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="OFFI_FAX2"         colType="TB_STRING"     size="4"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="OFFI_FAX3"         colType="TB_STRING"     size="4"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CARD_COUNT"        colType="TB_STRING"     size="4"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="HOME_CLS_YN"       colType="TB_STRING"     size="1"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="HOME_NEW_YN"       colType="TB_STRING"     size="1"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="HORI_ADDR1"        colType="TB_STRING"     size="200"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="HORI_ADDR2"        colType="TB_STRING"     size="200"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="HORI_ZIP_CD1"      colType="TB_STRING"     size="3"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="HORI_ZIP_CD2"      colType="TB_STRING"     size="3"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="HNEW_ZIP_CD1"      colType="TB_STRING"     size="3"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="HNEW_ZIP_CD2"      colType="TB_STRING"     size="3"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="HNEW_ADDR1"        colType="TB_STRING"     size="200"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="HNEW_ADDR2"        colType="TB_STRING"     size="200"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="HOME_SIDO"         colType="TB_STRING"     size="50"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />  
        <column colName="HOME_SIGUN"        colType="TB_STRING"     size="50"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />     
        <column colName="HOME_GU"           colType="TB_STRING"     size="50"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="HOME_YDONG"        colType="TB_STRING"     size="50"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="HOME_DONGRI"       colType="TB_STRING"     size="50"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="HOME_BUNJI_FLAG"   colType="TB_STRING"     size="10"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="HOME_BUNJI"        colType="TB_STRING"     size="50"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="HOME_GAJI_BUNJI"   colType="TB_STRING"     size="50"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="HOME_BUILD_NAME"   colType="TB_STRING"     size="50"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="HOME_BUILD_DONG"   colType="TB_STRING"     size="50"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="HOME_BUILD_HO"     colType="TB_STRING"     size="50"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="HOME_FLOOR"        colType="TB_STRING"     size="50"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="HOME_MAIL_YN"      colType="TB_STRING"     size="1"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="HORI_NEW_YN"       colType="TB_STRING"     size="1"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="CUST_GRADE"        colType="TB_STRING"     size="2"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />    
        <column colName="VIP_FLAG"          colType="TB_STRING"     size="2"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="SCED_REQ_DT"       colType="TB_STRING"     size="8"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="CHKSAVE"           colType="TB_STRING"     size="1"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" /> 
        <column colName="POCARD_PREFIX"     colType="TB_STRING"     size="3"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />       
    </gauce>

    <gauce name="H_CARD"> 
        <column colName="CARD_NO"           colType="TB_STRING"     size="200"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REP_CARD_YN"       colType="TB_STRING"     size="50"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="ISSUE_DT"          colType="TB_STRING"     size="8"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="POCARD_PREFIX"     colType="TB_STRING"     size="3"     dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>
    
    <gauce name="H_CARD_PRINT"> 
        <column colName="CARD_NO"           colType="TB_STRING"     size="200"   dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
        <column colName="REG_DATE"          colType="TB_STRING"     size="14"    dec="0" keyType="TB_NORMAL" roundMode="ROUND" />
    </gauce>

    <!-- 회원정보 조회  -->
    <query name="SEL_CUST">
        <![CDATA[
            SELECT CUST_ID        
                 , HHOLD_ID       
                 , DCS.SC_Crypto_FUN('DEC', SS_NO)    AS SS_NO          
                 , CUST_NAME      
                 , CARD_PWD_NO    
                 , REP_NAME       
                 , DCS.SC_Crypto_FUN('DEC', HOME_PH1) AS HOME_PH1       
                 , DCS.SC_Crypto_FUN('DEC', HOME_PH2) AS HOME_PH2       
                 , DCS.SC_Crypto_FUN('DEC', HOME_PH3) AS HOME_PH3
                 , HOME_ZIP_CD1   
                 , HOME_ZIP_CD2   
                 , HOME_ADDR1     
                 , HOME_ADDR2     
                 , DCS.SC_Crypto_FUN('DEC', EMAIL1) AS EMAIL1         
                 , DCS.SC_Crypto_FUN('DEC', EMAIL2) AS EMAIL1 
                 , DCS.SC_Crypto_FUN('DEC', EMAIL2) AS EMAIL3        
                 , EMAIL_YN       
                 , EMAIL_AGREE_DT 
                 , SMS_YN         
                 , SMS_AGREE_DT   
                 , POST_RCV_CD    
                 , OFFI_NM        
                 , OFFI_PH1       
                 , OFFI_PH2       
                 , OFFI_PH3       
                 , OFFI_INTER_PH  
                 , OFFI_FAX1      
                 , OFFI_FAX2      
                 , OFFI_FAX3      
                 , '' CARD_COUNT     
                 , HOME_CLS_YN    
                 , HOME_NEW_YN    
                 , '' HORI_ADDR1     
                 , '' HORI_ADDR2     
                 , '' HORI_ZIP_CD1   
                 , '' HORI_ZIP_CD2   
                 , '' HNEW_ZIP_CD1   
                 , '' HNEW_ZIP_CD2   
                 , '' HNEW_ADDR1     
                 , '' HNEW_ADDR2     
                 , '' HOME_SIDO      
                 , '' HOME_SIGUN     
                 , '' HOME_GU        
                 , '' HOME_YDONG     
                 , '' HOME_DONGRI    
                 , '' HOME_BUNJI_FLAG
                 , '' HOME_BUNJI     
                 , '' HOME_GAJI_BUNJI
                 , '' HOME_BUILD_NAME
                 , '' HOME_BUILD_DONG
                 , '' HOME_BUILD_HO  
                 , '' HOME_FLOOR     
                 , '' HOME_MAIL_YN   
                 , '' HORI_NEW_YN    
                 , (
                     SELECT DECODE(COUNT(B.CUST_GRADE),0,'N', MAX(B.CUST_GRADE)) CUST_GRADE 
                       FROM DCS.DO_CUST_GRADE B
                      WHERE B.BRCH_ID  = ?
                        AND B.APP_YEAR = TO_CHAR(SYSDATE,'YYYY')
                        AND B.CUST_ID  = ( 
                                           SELECT UNIQUE A.CUST_ID 
                                             FROM DCS.DM_CARD A
                                                , DCS.DM_CUSTOMER B
                                            WHERE A.CUST_ID  =  B.CUST_ID
                                              AND A.CARD_NO  LIKE DCS.F_GET_POCARD_NO(DCS.SC_Crypto_FUN('ENC', ?)) || '%'
                                              AND B.SS_NO    LIKE DCS.SC_Crypto_FUN('ENC', ?) || '%'
                                              AND A.CUST_ID  LIKE ? || '%'
                                         )
                   ) CUST_GRADE     
                 , (
                     SELECT DECODE(COUNT(C.VIP_FLAG),0,'', MAX(C.VIP_FLAG)) VIP_FLAG
                       FROM DCS.DO_VIP_REASON C
                      WHERE C.CUST_ID  = ( 
                                           SELECT UNIQUE A.CUST_ID 
                                             FROM DCS.DM_CARD A
                                                , DCS.DM_CUSTOMER B
                                            WHERE A.CUST_ID  =  B.CUST_ID
                                              AND A.CARD_NO  LIKE DCS.F_GET_POCARD_NO(DCS.SC_Crypto_FUN('ENC', ?)) || '%'
                                              AND B.SS_NO    LIKE DCS.SC_Crypto_FUN('ENC', ?) || '%'
                                              AND A.CUST_ID  LIKE ? || '%'
                                         )
                   ) VIP_FLAG    
                 , SCED_REQ_DT  
                 , 'U' CHKSAVE 
                 , '' POCARD_PREFIX           
              FROM DCS.DM_CUSTOMER 
             WHERE CUST_ID = ( 
                               SELECT UNIQUE A.CUST_ID 
                                 FROM DCS.DM_CARD A
                                    , DCS.DM_CUSTOMER B
                                WHERE A.CUST_ID  =  B.CUST_ID
                                  AND A.CARD_NO  LIKE DCS.F_GET_POCARD_NO(DCS.SC_Crypto_FUN('ENC', ?)) || '%'
                                  AND B.SS_NO    LIKE DCS.SC_Crypto_FUN('ENC', ?) || '%'
                                  AND A.CUST_ID  LIKE ? || '%'
                             )
        ]]>        
    </query>       

    <!-- 회원 카드정보 조회  -->
    <query name="SEL_CARD">
        <![CDATA[                 
            SELECT DCS.SC_Crypto_FUN('DEC', CARD_NO) AS CARD_NO
                 , REP_CARD_YN
                 , ISSUE_DT
                 , POCARD_PREFIX
              FROM DCS.DM_CARD 
             WHERE CUST_ID = ?
          ORDER BY REP_CARD_YN DESC, REG_DATE DESC
        
        ]]>        
    </query>   
    
    <!-- 카드 발급용 -->
    <query name="SEL_CARD_RRINT">
        <![CDATA[                 
            SELECT DCS.SC_Crypto_FUN('DEC', CARD_NO) AS CARD_NO
                 , REG_DATE 
              FROM 
                  (
                   SELECT ROWNUM
                        , CARD_NO
                        , TO_CHAR(REG_DATE,'YYYYMMDDhh24miss') REG_DATE
                     FROM DCS.DM_CARD 
                    WHERE CUST_ID = ?
                    ORDER BY REG_DATE DESC
                  )
             WHERE ROWNUM <= ?
        
        ]]>        
    </query>  
    
    <!-- 회원정보 조회  -->
    <query name="SEL_CARD_NO">
        <![CDATA[                 
            SELECT DCS.F_GET_SQ_CARD('1') CARD_NO   
              FROM DUAL
        ]]>        
    </query>
    
    <!-- 비밀번호 구하기  -->
    <query name="SEL_CARD_PWD_NO">
        <![CDATA[                 
            SELECT PWD_NO   
              FROM DCS.DM_CARD
             WHERE CUST_ID = ?
               AND ROWNUM  = 1
        ]]>        
    </query>  
    
    <!-- 회원등급 수정 -->
    <query name="UPD_CARD_PWD_NO">
        <![CDATA[
            UPDATE DCS.DM_CARD
               SET PWD_NO    = ?  
             WHERE CUST_ID   = ? 
        ]]>
    </query> 
    <!-- 카드정보 입력  -->
    <query name="INC_CARD">
        <![CDATA[
            INSERT INTO DCS.DM_CARD (
                                      CARD_NO
                                    , CUST_ID
                                    , CARD_TYPE_CD
                                    , PWD_NO
                                    , CARD_STAT_CD
                                    , REP_CARD_YN
                                    , VALID_YN
                                    , REG_INFORM_DT
                                    , PWD_NO_ERR_CNT
                                    , ISSUE_DT
                                    , FIRST_TRADE_DT
                                    , LOSS_NOTI_DT
                                    , LOSS_NOTI_NM
                                    , ENTR_PATH_CD
                                    , SCED_REQ_DT
                                    , SCED_PROC_DT
                                    , CARD_CRE_DT
                                    , CARD_CRE_SEQ
                                    , CARD_GRADE
                                    , ONLINE_ISSUE_YN
                                    , ONLINE_ISSUE_DT
                                    , POCARD_PREFIX
                                    , REG_DATE
                                    , REG_ID
                                    , MOD_DATE
                                    , MOD_ID
                                    )
                             VALUES ( 
                                      DCS.SC_Crypto_FUN('ENC', ?)
                                    , ?
                                    , '11'
                                    , DCS.SC_Crypto_FUN('ENC', ?)
                                    , 0
                                    , ?
                                    , 'Y'
                                    , NULL
                                    , 0
                                    , TO_CHAR (SYSDATE, 'YYYYMMDD')
                                    , NULL
                                    , NULL
                                    , NULL
                                    , ?
                                    , NULL
                                    , NULL
                                    , NULL
                                    , NULL
                                    , ?
                                    , 'N'
                                    , NULL
                                    , ?
                                    , SYSDATE
                                    , ?
                                    , SYSDATE
                                    , ?
                                    )               
                  
        ]]>        
    </query> 
    
    <!-- 회원등급 저장  -->
    <query name="INS_CUST_GRADE">         
        <![CDATA[    
            INSERT INTO DCS.DO_CUST_GRADE (
                                            BRCH_ID
                                          , APP_YEAR
                                          , CUST_ID
                                          , CUST_GRADE
                                          , REG_DATE
                                          , REG_ID
                                          ) 
                                   VALUES (
                                            ?
                                          , TO_CHAR(SYSDATE,'YYYY')
                                          , ?
                                          , ?
                                          , SYSDATE
                                          , ?
                                          )       
        ]]>                               
    </query>  
    
    <!-- 회원등급 수정 -->
    <query name="UPD_CUST_GRADE">
        <![CDATA[
            UPDATE DCS.DO_CUST_GRADE
               SET CUST_GRADE  = ?  
             WHERE BRCH_ID     = ?
               AND APP_YEAR    = TO_CHAR(SYSDATE,'YYYY')
               AND CUST_ID     = ? 
        ]]>
    </query> 
    
    <!-- 회원등급 조회 -->
    <query name="SEL_CUST_GRADE">
        <![CDATA[    
            SELECT DECODE(COUNT(CUST_GRADE),0,'N', MAX(CUST_GRADE)) CUST_GRADE 
              FROM DCS.DO_CUST_GRADE   
             WHERE BRCH_ID  = ?
               AND APP_YEAR = TO_CHAR(SYSDATE,'YYYY')
               AND CUST_ID  = ? 
         ]]>
    </query>  
    
    <!-- VIP회원 저장  -->
    <query name="INS_VIP_REASON">         
        <![CDATA[    
            INSERT INTO DCS.DO_VIP_REASON (
                                            CUST_ID
                                          , VIP_FLAG
                                          , USE_YN
                                          , REG_DATE
                                          , REG_ID
                                          , MOD_DATE
                                          , MOD_ID
                                          ) 
                                   VALUES (
                                            ?
                                          , ?
                                          , 'Y'
                                          , SYSDATE
                                          , ?
                                          , SYSDATE
                                          , ?
                                          )       
        ]]>                               
    </query>  
    
    <!-- VIP회원  수정 -->
    <query name="UPD_VIP_REASON">
        <![CDATA[
            UPDATE DCS.DO_VIP_REASON
               SET VIP_FLAG    = ?  
                 , USE_YN      = ?  
                 , MOD_DATE    = SYSDATE
                 , MOD_ID      = ?  
             WHERE CUST_ID     = ?
        ]]>
    </query> 
    
    <!-- VIP회원 조회 -->
    <query name="SEL_VIP_REASON">
        <![CDATA[    
            SELECT DECODE(COUNT(CUST_ID),0,'N', MAX(CUST_ID)) VIP_YN
              FROM DCS.DO_VIP_REASON
             WHERE CUST_ID  = ? 
         ]]>
    </query>          
</service>